'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1253:function(r,F,a){r=a(0);var c=a(963),b=a(4);class e{}Object(r.a)(e,"LokiTokenResult",null,[]);class f{constructor(n){this.cWb=n}xhd(){const n=this.zYh();return n?f.Krd?new Promise((z,w)=>{this.cWb.continueWith(()=>{this.cWb.kh||this.cWb.Hf?w(Error.create("Error downloading auth library")):this.cWb.result.AO("Loki",n).then(m=>{m=b.AFrameworkApplication.fa.pa("ForceLokiFallbackToACLPTokenIsEnabled")?this.CYh():
m.IsSuccess&&m.Token?Object.assign(new e,{isSuccess:!0,token:m.Token,errorMessage:null}):Object.assign(new e,{isSuccess:!1,token:null,errorMessage:JSON.stringify(m)});z(m);return m})})}):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new e,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",c.a.z0e())}))}CYh(){const n=
b.AFrameworkApplication.fa.Wa("LokiUserDataSignature")||"";return Object.assign(new e,{isSuccess:!0,token:n,errorMessage:null})}zYh(){let n=null;const z=c.a.Abc();2===z?n=b.AFrameworkApplication.fa.Wa("LokiAADAppId"):1===z&&(n=b.AFrameworkApplication.fa.Wa("LokiMSAAppId"));return n}static get Krd(){return b.AFrameworkApplication.fa.pa("IsO365CommercialHost")||b.AFrameworkApplication.fa.pa("IsO365ConsumerHost")}}Object(r.a)(f,"LokiTokenManager",null,[582]);var d=a(251),h=a(83),l=a(519);class k{get name(){return"Common.App.LivePersonaUtils"}init(){h.a.instance.resolve("Common.ILokiTokenManager")}dispose(){}Bh(n){n.register(f,
"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").qc().yc(()=>new f(l.a.Rq(n.Tb("Common.App.OAuth.IOAuthManager"))))}static main(){d.a.instance.ii(new k)}}Object(r.a)(k,"LivePersonaUtilsPackage",null,[3,4]);a.d(F,"a",function(){return t});const t=()=>{Type.registerNamespace("Common.App.LivePersonaUtils");k.main()}},1276:function(r,F,a){var c=a(9);r=a(0);var b=a(83),e=a(226),f=a(7),d=a(15),h=a(854);class l{constructor(z){this.oAuthManager=z}AO(z,w){return this.oAuthManager?
this.oAuthManager.AO(z,w).then(m=>{m.IsSuccess||d.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+m.ErrorMessage+" Error code: "+m.ErrorCode+" App name: "+z);return Object(f.a)(new h.a,{IsSuccess:m.IsSuccess,Token:m.Token,ErrorCode:m.ErrorCode,ErrorMessage:m.ErrorMessage})}):(d.ULS.sendTraceTag(537154971,0,10,"Oauth manager is null"),Promise.resolve(Object(f.a)(new h.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",ErrorMessage:"Failed to resolve IOAuthManager from the container."})))}v6a(){return this.oAuthManager?
this.oAuthManager.v6a():null}}Object(r.a)(l,"OAuthManagerWrapper",null,[571]);var k=a(712);class t extends e.a{constructor(z){super();this.$=z;this.Db()}create(){this.nb(Object(k.a)(this.$.da,349,()=>new l(b.a.instance.resolve("Common.App.OAuth.IOAuthManager"))))}static ka(z){z.da.Ha(350,new t(z))}}Object(r.a)(t,"OAuthManagerFactory",e.a,[]);a.d(F,"a",function(){return n});const n=()=>{c.a.Fa(z=>{t.ka(z)})}},1301:function(r,F,a){r=a(0);var c=a(15),b=a(862),e=a(940),f=a(4),d=a(99),h=a(556),l=a(251),
k=a(39),t=a(40),n=a(27),z=a(111),w=a(83),m=a(194);class u{get name(){return"Common.App.OAuth.OAuthPackage"}Bh(v){v.register(534,"Common.App.OAuth.IOAuthManager").qc().yc(()=>new b.OAuthManager)}init(){const v=w.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.xXj(v)}xXj(v){const C=f.AFrameworkApplication.fa.Wa("FileSource");if(f.AFrameworkApplication.fa.pa("IsO365ConsumerHost")||f.AFrameworkApplication.fa.pa("IsO365CommercialHost")||"WopiTest"===C){var x=h.OAuthManagerSettings.b5c;if(x&&
x.IsEnabled){var B=x.Application,H=h.OAuthManagerSettings.authority;if(void 0!==B&&null!==B&&B.length&&void 0!==H&&null!==H&&H.length){var I=e.a[v.uS],U=n.a.wsa,S=v.mv();try{var G=new Map;void 0!==G&&null!==G?(G.set("SupportStatus",I),G.set("Browser",U),G.set("AuthStrategy",S)):G=null}catch(E){G=null}d.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",G);var D=t.a.Td();v.AO("Core",B).then(E=>{const N=Math.floor(t.a.Td()-D);I=e.a[v.uS];U=n.a.wsa;S=v.mv();c.ULS.sendTraceTag(562943369,
3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',N,E.IsSuccess,I,E.ErrorCode,C,U,S);G&&(G.set("SupportStatus",I),G.set("Browser",U),G.set("AuthStrategy",S));var M=Object.assign(new m.a,{durationMs:N,extendedProperties:G});if(E.IsSuccess){if(d.Health.instance.recordKpiSuccess("WacCorePFT",M),E="Bearer "+E.Token,f.AFrameworkApplication.Bd.k2d=E,M=x.Endpoint){var L=t.a.Td();
f.AFrameworkApplication.Bd.fob(M,1,null,{["Authorization"]:E},"OAuthManagerValidateAccess",void 0,void 0,void 0,2E4).continueWith(aa=>{var V=Math.floor(t.a.Td()-L),P=null;aa.kh?aa="Canceled":aa.Hf?aa="Faulted":(P=aa.result,aa=P.succeeded?"Completed":"Failed");V={["TaskResult"]:aa,["BrowserTokenDurationMS"]:N,["BrowserValidationDurationMS"]:V};P&&(V.HttpStatus=P.Cg.data.httpStatus,P.succeeded&&(P=k.a(P.Cg.data.de),V.ServerValidationDurationMS=P.ElapsedMilliseconds,V.ServerValidationResult=P.ValidatedToken,
V.KMSI=P.KMSI,V.Scopes=P.Scopes,V.TokenExpirationS=Math.floor(parseInt(P.Expiration)-(new Date).getTime()/1E3)));c.ULS.sendTraceTag(520632322,3E3,"Completed"===aa?50:15,z.a.toJSON(V))})}}else d.Health.instance.recordKpiFailure("WacCorePFT",E.ErrorCode,!1,!1,M)}).catch(E=>{var N=Math.floor(t.a.Td()-D);N=Object.assign(new m.a,{durationMs:N,extendedProperties:G});d.Health.instance.recordKpiFailure("WacCorePFT","UNEXPECTED CATCH: "+E.toString(),!1,!1,N)})}}}}dispose(){}static main(){l.a.instance.ii(new u)}static Agj(){l.a.instance.ii(new u,
0,!0)}}Object(r.a)(u,"OAuthPackage",null,[3,4]);a.d(F,"a",function(){return y});const y=v=>{Type.registerNamespace("Common.App.OAuth");v?u.Agj():u.main()}},1492:function(r,F,a){a.r(F);r=a(1301);F=a(1253);a=a(1276);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");Object(r.a)();Object(F.a)();Object(a.a)()},862:function(r,F,a){a.r(F);r=a(0);var c=a(15),b=a(1426),e=a(940),f;(function(ea){ea[ea.external=0]="external";ea[ea.msa=1]="msa";ea[ea.aad=2]="aad"})(f||(f=
{}));Object(r.b)("AuthorityType",f);class d{}Object(r.a)(d,"OAuthResult",null,[]);class h{constructor(ea){this.GAg=ea}initialize(){return Promise.resolve(0)}Jlc(){return Promise.resolve(0)}AO(){c.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new d,{IsSuccess:!0,Token:this.GAg}))}dDc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}xBc(){return!1}$xb(){return"MockAuthTokenStrategy"}}
Object(r.a)(h,"MockAuthTokenStrategy",null,[635]);var l=a(963);class k{static get(ea,ra,O){if(!O)return ea;let da=0;return Promise.race([ea,new Promise(xa=>{da=window.setTimeout(()=>{xa(ra)},O)})]).then(xa=>{window.clearTimeout(da);return Promise.resolve(xa)}).catch(()=>{window.clearTimeout(da);return Promise.resolve(ra)})}}Object(r.a)(k,"PromiseWithTimeout",null,[]);var t=a(4),n=a(556);class z{constructor(ea,ra,O,da,xa){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=
null;this.resource=ea;this.scope=ra;this.silentLogin=O;this.options=da;this.correlationId=xa}}Object(r.a)(z,"TokenRequestParameters",null,[643]);var w=a(27),m=a(83);class u{constructor(){this.Lme=null;let ea=t.AFrameworkApplication.fa.Wa(t.AFrameworkApplication.J7),ra=t.AFrameworkApplication.fa.Wa(t.AFrameworkApplication.Fhg);this.XXa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",ea&&""!==ea?ea:"Unspecified",ra&&""!==ra?ra:"Unspecified")}initialize(){return new Promise(ea=>
{m.a.instance.Tb("Common.App.WopiIdentity.IWopiIdentity").execute(ra=>{this.Lme=ra;ea(0)})})}pi(ea){const ra=["HTTPS:","API:"];let O=!1;const da=ea.toLocaleUpperCase();for(const xa of ra)if(da.startsWith(xa)){O=!0;break}return O||this.Tpi(ea)?ea+"/.default":ea}Tpi(ea){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(ea)}Jlc(){return Promise.resolve(0)}AO(ea,ra,O,da,xa,ia,Ma){if(w.a.kxa){xa=n.OAuthManagerSettings.i6j;if(!xa)return ra=Object.assign(new d,
{IsSuccess:!1,ErrorCode:"TeamsNoAllowListFound",ErrorMessage:"No app list was found."}),Promise.resolve(ra);if(!Array.contains(xa,ea))return ra=Object.assign(new d,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+ea}),Promise.resolve(ra)}ea=this.pi(O);O=new z(O,ea,!da,null,t.AFrameworkApplication.userSessionId);return this.Lme.getAccessToken(O,ra,Ma).then(Ta=>Object.assign(new d,{IsSuccess:!0,Token:Ta.accessToken}),Ta=>Object.assign(new d,{IsSuccess:!1,ErrorCode:Ta}))}dDc(){return Promise.resolve(Object.assign(new d,
{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}xBc(){return!1}$xb(){return this.XXa}}Object(r.a)(u,"ParentFrameTokenStrategy",null,[635]);var y=a(85),v=a(869),C=a(192);class x{constructor(){this.reject=this.resolve=null;this.startTime=0;this.RPf=this.Xwe=null}}Object(r.a)(x,"PromiseWrapper",null,[]);class B{constructor(ea=0){this.OB=0;this.Dlb=!1;this.Im=new C.a;this._timeout=ea}enqueue(ea){return new Promise((ra,
O)=>{this.Im.add(Object.assign(new x,{RPf:ea,resolve:ra,reject:O}));this.process()})}process(){if(this.Dlb||this.OB===this.Im.count)return!1;const ea=this.Im.ma(this.OB++);try{this.Dlb=!0,ea.RPf().then(ra=>{this.Dlb=!1;this.a4c(ea,ra,null,!0)}).catch(ra=>{this.Dlb=!1;this.a4c(ea,null,ra,!1)})}catch(ra){this.Dlb=!1,this.a4c(ea,null,ra,!1)}return!0}a4c(ea,ra,O,da){if(da){const xa=()=>{ea.resolve(ra);this.process()};0<this._timeout?window.setTimeout(()=>{xa()},this._timeout):xa()}else{const xa=()=>{ea.reject(O);
this.process()};0<this._timeout?window.setTimeout(()=>{xa()},this._timeout):xa()}}}Object(r.a)(B,"PromiseQueue",null,[]);class H{constructor(){this.correlationId=this.resolve=null}}Object(r.a)(H,"ResolveWithCorrelation",null,[]);var I=a(84),U=a(150),S=a(838),G=a(168);class D extends U.a{constructor(ea,ra,O,da,xa,ia){super(!1,!1,!0);this.e8d=this.i1=null;this.RX=ea;this.jCg=O;this.Mv=da;this.XFg=xa;this.$Da=ia;this.Is=document.createElement("iframe");this.Is.id="SharedAuthInteractiveFrame";this.Is.setAttribute("name",
"SharedAuthInteractiveFrame");this.Is.setAttribute("title","SharedAuthInteractiveFrame");this.Is.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Is.style.border="0";this.Is.style.height="48px";this.Is.style.width="190px";$addHandler(this.Is,"error",Object(y.a)(this,this.k_i,"onSharedAuthFrameError"));ea=String.format("{0}{1}{2}{3}{4}{5}{6}{7}{8}",this.RX,ra,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1","&WacUserType=",t.AFrameworkApplication.userType);
this.Is.src=ea;this.Nvg=new Promise(Ma=>{this.e8d=Ma});this.f8d=!1}Kzc(){this.i1={["id"]:"SharedAuthConsentDialog",["bodyControls"]:{["promptMessage"]:this.jCg,["errorText"]:CommonUIStrings.l_InternalError,["rtl"]:t.AFrameworkApplication.isRtl,["frameLoaded"]:!1,["createFrame"]:Object(y.a)(this,this.Adh,"createFrame"),["resolveDialogStyles"]:this.e8d}};this.Ob=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(y.a)(this,this.WDj,"sharedAuthConsentDialogHandler"),this.i1)}vEc(ea=!1,ra=!1,O=5){this.i1&&
this.i1.bodyControls&&(ea!==Object(I.a)(Object,this.i1.bodyControls).frameLoaded&&(Object(I.a)(Object,this.i1.bodyControls).frameLoaded=ea),ra!==Object(I.a)(Object,this.i1.bodyControls).frameLoadSuccess&&(Object(I.a)(Object,this.i1.bodyControls).frameLoadSuccess=ra),O!==this.i1.dialogButtonsOption&&(this.i1.dialogButtonsOption=null,this.Ob=O),this.update(this.i1))}xKj(ea,ra){const O=new S.a(G.a.$Dj);O.Values={["signInLabel"]:CommonUIStrings.l_SignIn,["cancelLabel"]:CommonUIStrings.l_DialogCancel,
["rtl"]:t.AFrameworkApplication.isRtl,["messageCorrelationId"]:ea,["dialogStyles"]:ra};this.Mv.KRa(O,this.Is.contentWindow,this.RX)}wZe(){this.vEc(!0,!1,6)}get w7f(){return this.Is}get Pmh(){return this.Nvg.then(ea=>{this.f8d=!0;return ea})}get Qmh(){return this.f8d}k_i(){this.wZe()}Adh(){return this.Is}WDj(ea){0===ea&&(this.XFg.reject(Object.assign(new d,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.$Da(null))}}Object(r.a)(D,"SharedAuthConsentDialog",
U.a,[644]);var E=a(1263),N=a(99),M=a(137),L=a(40),aa=a(174),V=a(194);class P{constructor(){this.Is=null;this.sUb=0;this.Okb=this.lYa=this.BHc=this.$Da=this.NL=this.Kle=null;this.Mv=new E.a(null,null);this.XXa="SharedAuthTokenStrategy Unloaded";this.RX=n.OAuthManagerSettings.YDj;this.Lje=n.OAuthManagerSettings.XDj;this.Q8d=n.OAuthManagerSettings.enableConsoleLogging;this.dwg=t.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",!1);this.tEg=t.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",
!1);this.fra={};this.Dyg=new B(1500)}$xb(){return this.XXa}initialize(){var {OAuthManager:ea}=a(862);if("loadFrame"in this.fra)return this.fra.loadFrame.Xwe;if(!this.RX)return N.Health.instance.recordKpiFailure(ea.kpiName,"SharedAuthFrameOriginNotSet",!1,!1,null),c.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);ea=this.dBc("loadFrame");this.sUb=L.a.Td();var ra=this.RX+this.Lje+"?replyUrl="+window.location.protocol+"//"+window.location.host+
"&usid="+t.AFrameworkApplication.userSessionId+"&WacUserType="+t.AFrameworkApplication.userType;this.Is=document.createElement("iframe");this.hhi(this.Is);this.Is.style.cssText="height:0;width:0;display:none;";this.Is.id="SharedAuthFrame";this.Is.setAttribute("name","SharedAuthFrame");this.Is.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.Is.setAttribute("title","SharedAuthFrame");this.Is.src=ra;document.body.appendChild(this.Is);ra=L.a.Td()-this.sUb;c.ULS.sendTraceTag(573112899,
3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",ra,this.Is.src);return ea}Jlc(ea){this.BHc=ea;const ra=new S.a(G.a.z7f);ra.Values=this.xwe(ea);ea=this.dBc("initFrame");this.Mv.KRa(ra,this.Is.contentWindow,this.RX);c.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return ea}AO(ea,ra,O,da,xa,ia){const Ma=new S.a(G.a.aEj),Ta=this.K6e();Ma.Values=this.$gg(ea,ra,O,da,xa,ia,Ta);ea=this.dBc(Ta);da&&t.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",
!1)?this.Dyg.enqueue(()=>new Promise(Da=>{this.OWj(ia,Ma,Da,Ta)})):(this.Mv.KRa(Ma,this.Is.contentWindow,this.RX),c.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",ra));return ea}OWj(ea,ra,O,da){const xa=this.fra[da];xa&&(this.lYa=ra,this.$Da=Object.assign(new H,{resolve:O,correlationId:da}),this.NL=new D(this.RX,this.Lje,ea,this.Mv,xa,O),this.NL.Kzc())}K6e(){return aa.a.create().toString()}$gg(ea,ra,O,da,xa,ia,Ma){const Ta={};Ta.appName=ea;
Ta.appId=ra;Ta.target=O;Ta.withPopup=da;Ta.claims=xa;Ta.promptMessage=ia;Ta.messageCorrelationId=Ma;return Ta}hhi(ea){$addHandler(ea,"load",Object(y.a)(this,this.gVi,"onIFrameLoaded"));$addHandler(ea,"error",Object(y.a)(this,this.xpc,"onIFrameError"));this.Mv.RFa(this.RX);this.Mv.$n(G.a.C7f);this.Mv.Dl(G.a.C7f,Object(y.a)(this,this.BZi,"onScriptLoaded"));this.Mv.$n(G.a.B7f);this.Mv.Dl(G.a.B7f,Object(y.a)(this,this.AZi,"onScriptInitialized"));this.Mv.$n(G.a.x7f);this.Mv.Dl(G.a.x7f,Object(y.a)(this,
this.IUi,"onGetTokenResponse"));this.Mv.$n(G.a.D7f);this.Mv.Dl(G.a.D7f,Object(y.a)(this,this.AWi,"onLoginResponse"));this.Mv.$n(G.a.A7f);this.Mv.Dl(G.a.A7f,Object(y.a)(this,this.DVi,"onInteractiveFlowReady"));this.Mv.$n(G.a.y7f);this.Mv.Dl(G.a.y7f,Object(y.a)(this,this.$Ui,"onHideDialog"));this.Mv.$n(G.a.v7f);this.Mv.Dl(G.a.v7f,Object(y.a)(this,this.UPi,"onCloseDialog"))}dBc(ea){const ra=new x;ra.startTime=L.a.Td();const O=new Promise((da,xa)=>{ra.resolve=da;ra.reject=xa});ra.Xwe=O;this.fra[ea]=ra;
return O}gVi(){const ea=L.a.Td()-this.sUb;c.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",ea)}xpc(ea){const {OAuthManager:ra}=a(862),O=L.a.Td()-this.sUb,da=Object.assign(new V.a,{durationMs:O});N.Health.instance.recordKpiFailure(ra.kpiName,"SharedAuthWACOAuthAspxFrameError",!1,!0,da);c.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",O,this.Q8d?JSON.stringify(ea):"")}BZi(ea){const {OAuthManager:ra}=a(862),O=this.fra.loadFrame;
var da=L.a.Td()-O.startTime,xa=ea.Values.AuthLibrary.toString();ea=ea.Values.Success.toString();c.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",ea,xa,da);xa&&(this.XXa="SharedAuthTokenStrategy "+xa);xa=Boolean.parse(ea);xa||(ea=M.a.Pr(),void 0!==ea&&null!==ea&&(ea.set("AuthLibrary",this.$xb()),da=Object.assign(new V.a,{durationMs:da,extendedProperties:ea}),N.Health.instance.recordKpiFailure(ra.kpiName,"SharedAuthStrategyInitFailed",
!1,!0,da)));O.resolve(xa?0:1)}AZi(ea){if(ea.Values.interactive&&this.lYa&&this.lYa.Values.messageCorrelationId){const O=this.lYa.Values.messageCorrelationId.toString();if(ea.Values.interactive&&this.NL){this.NL.Pmh.then(da=>{this.Mv.KRa(this.lYa,this.NL.w7f.contentWindow,this.RX);this.NL.xKj(O,da);this.NL.vEc(!0,!0);this.lYa=null});return}}ea=this.fra.initFrame;const ra=L.a.Td()-ea.startTime;c.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ra);ea.resolve(0)}IUi(ea){if(ea.Values.messageCorrelationId&&
ea.Values.messageCorrelationId.toString()){var ra=ea.Values.messageCorrelationId.toString(),O=this.fra[ra];if(O){var da=L.a.Td()-O.startTime;c.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",da);ea.Values.isSuccess&&ea.Values.isSuccess?O.resolve(ea.Values.response):O.reject(ea.Values.response);this.ohg(ra)}else c.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(573112904,
3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")}DVi(){if(this.NL.Qmh)this.NL.wZe();else if(this.BHc&&this.NL){const ea=new S.a(G.a.z7f);ea.Values=this.xwe(this.BHc,!0);this.Mv.KRa(ea,this.NL.w7f.contentWindow,this.RX)}}$Ui(){this.NL&&this.NL.gzb()}UPi(ea){ea.Values.cancelled&&ea.Values.cancelled&&ea.Values.messageCorrelationId&&this.ohg(ea.Values.messageCorrelationId.toString());this.NL&&this.NL.hide()}xwe(ea,ra=!1){const O={};O.appIds=this.UOh();O.upn=
ea.loginHint;O.authority=ea.authority;O.authorityType=Object(b.a)(f,ea.authorityType);O.tenantId=ea.tenantId;O.correlationId=t.AFrameworkApplication.userSessionId;O.enableConsoleLogging=this.Q8d;O.enablePopupFlash=this.dwg;O.skipUpnCheck=this.tEg;O.interactive=ra;return O}UOh(){const ea=[],ra=n.OAuthManagerSettings.PYc;for(let O in ra)Array.add(ea,ra[O]);return ea}dDc(ea,ra,O,da,xa,ia){const Ma=new S.a(G.a.ZDj),Ta=this.K6e();Ma.Values=this.$gg(ea,ra,O,da,xa,ia,Ta);this.Kle=Ma;ea=this.dBc(Ta);c.ULS.sendTraceTag(555049437,
3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",ra);this.hIj();return ea}xBc(){return!0}hIj(){this.Okb||(this.Okb=new v.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Okb.id=16,this.Okb.Erd=!1,this.Okb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,()=>{c.ULS.sendTraceTag(527827290,3E3,50,"SharedAuthTokenStrategy TryLogin: User Clicked Login");this.Mv.KRa(this.Kle,this.Is.contentWindow,this.RX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,
!0),c.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))}AWi(ea){if(ea.Values.messageCorrelationId&&ea.Values.messageCorrelationId.toString()){var ra=this.fra[ea.Values.messageCorrelationId.toString()];if(ra){var O=L.a.Td()-ra.startTime;c.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",O);ea.Values.isSuccess&&ea.Values.isSuccess?ra.resolve(ea.Values.response):ra.reject(ea.Values.response)}else c.ULS.sendTraceTag(555049440,
3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else c.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")}ohg(ea){this.$Da&&this.$Da.correlationId===ea&&(this.$Da.resolve(null),this.$Da=null)}}Object(r.a)(P,"SharedAuthTokenStrategy",null,[635]);class ba{constructor(ea){this.LRc=ea;this.XXa="UnsupportedAuthTokenStrategy Reason="+e.a[this.LRc]}initialize(){return Promise.resolve(0)}Jlc(){return Promise.resolve(0)}AO(){return Promise.resolve(Object.assign(new d,
{IsSuccess:!1,ErrorCode:e.a[this.LRc],ErrorMessage:"Unable to get a token. Reason: ["+e.a[this.LRc]+"]"}))}dDc(){return Promise.resolve(Object.assign(new d,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))}xBc(){return!1}$xb(){return this.XXa}}Object(r.a)(ba,"UnsupportedAuthTokenStrategy",null,[635]);var Y=a(731);a.d(F,"OAuthManager",function(){return Z});class Z{constructor(ea=null){this.uS=
0;this.NO=null;this.QCg=0;const ra=L.a.Td();this.syg=this.fmh(ea).then(O=>O?this.ufi():(c.ULS.sendTraceTag(527827277,3E3,15,"DetermineAuthLibrary failed leaving {0} in {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(L.a.Td()-ra)),O=M.a.Pr(),void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new V.a,{durationMs:Math.floor(L.a.Td()-ra),extendedProperties:O}),N.Health.instance.recordKpiFailure(Z.kpiName,"StrategyPickFailed",!1,!0,O)),Promise.resolve(1))).then(O=>
0!==O?Promise.resolve(O):this.xAi())}gmh(){var ea=n.OAuthManagerSettings.bJi;ea&&0<ea.length?(this.uS=1,this.NO=new h(ea)):t.AFrameworkApplication.fa.pa("IsO365ConsumerHost")||t.AFrameworkApplication.fa.pa("IsO365CommercialHost")?t.AFrameworkApplication.fa.pa("IsAnonymousUser")?(this.uS=2,this.NO=new ba(this.uS)):(ea=l.a.getAuthContext().loginHint)&&ea.length?n.OAuthManagerSettings.kzb?(this.uS=1,this.NO=new u):(this.uS=1,this.NO=new P):(this.uS=3,this.NO=new ba(this.uS)):(this.uS=4,this.NO=new ba(this.uS))}mv(){return this.NO?
this.NO.$xb()||"Unknown":"None"}fmh(ea=null){c.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");const ra=L.a.Td();return t.AFrameworkApplication.fa.Pgd().then(O=>{O?(this.gmh(),ea&&(this.NO=ea),c.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",n.OAuthManagerSettings.clientVersion,n.OAuthManagerSettings.appVersion,n.OAuthManagerSettings.Zoh,this.mv(),Math.floor(L.a.Td()-ra))):c.ULS.sendTraceTag(562128579,
3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(L.a.Td()-ra));return Promise.resolve(O)},()=>{c.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(L.a.Td()-ra));return Promise.resolve(!1)})}ufi(){c.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.mv());const ea=L.a.Td();return k.get(this.NO.initialize(),
2,n.OAuthManagerSettings.yId).then(ra=>{if(0===ra)c.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",this.mv(),Math.floor(L.a.Td()-ea));else if(1===ra){c.ULS.sendTraceTag(527827291,3E3,15,"Initialization failed for {0} in {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(L.a.Td()-ea));var O=M.a.Pr();void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new V.a,{durationMs:Math.floor(L.a.Td()-ea),extendedProperties:O}),N.Health.instance.recordKpiFailure(Z.kpiName,
"StrategyInitFailed",!1,!0,O))}else 2===ra&&(c.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(L.a.Td()-ea)),O=M.a.Pr(),void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new V.a,{durationMs:Math.floor(L.a.Td()-ea),extendedProperties:O}),N.Health.instance.recordKpiFailure(Z.kpiName,"StrategyInitTimedOut",!1,!0,O)));return Promise.resolve(ra)},()=>{c.ULS.sendTraceTag(574239256,3E3,15,
"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(L.a.Td()-ea));return Promise.resolve(1)})}xAi(){c.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.mv());const ea=L.a.Td();return k.get(this.NO.Jlc(l.a.getAuthContext()),2,n.OAuthManagerSettings.yId).then(ra=>{if(0===ra)c.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",this.mv(),Math.floor(L.a.Td()-ea));else if(1===ra){c.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",
this.mv(),Math.floor(L.a.Td()-ea));var O=M.a.Pr();void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new V.a,{durationMs:Math.floor(L.a.Td()-ea),extendedProperties:O}),N.Health.instance.recordKpiFailure(Z.kpiName,"StrategyLoadFailed",!1,!0,O))}else 2===ra&&(c.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(L.a.Td()-ea)),O=M.a.Pr(),void 0!==O&&null!==O&&(O.set("AuthLibrary",this.mv()),O=Object.assign(new V.a,
{durationMs:Math.floor(L.a.Td()-ea),extendedProperties:O}),N.Health.instance.recordKpiFailure(Z.kpiName,"StrategyLoadTimedOut",!1,!0,O)));return Promise.resolve(ra)},()=>{c.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",this.mv(),Math.floor(L.a.Td()-ea));return Promise.resolve(1)})}AO(ea,ra,O=null){return this.bDc(ea,ra,!1,null,"",O)}ahg(ea,ra,O,da,xa=null){return this.bDc(ea,ra,!0,O,da,xa)}bDc(ea,ra,O,da,xa,ia,Ma=0){Ma+=1;c.ULS.sendTraceTag(42084352,
3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",ea,this.sRa(ea,ra),this.mv(),Ma);var Ta=M.a.Pr();void 0!==Ta&&null!==Ta&&(Ta.set("AuthLibrary",this.mv()),Ta.set("AppName",ea),Ta.set("Target",this.sRa(ea,ra)),N.Health.instance.recordKpiUsage(Z.kpiName,0,"WacOAuthFC",Ta));if(!n.OAuthManagerSettings.isEnabled){var Da;return this.Iwd((Da=new d,Da.IsSuccess=!1,Da.Token=null,Da.ErrorCode="NotEnabled",Da.ErrorMessage="OAuthManager is disabled.",Da),ea)}const fa=
n.OAuthManagerSettings.PYc[ea];if(void 0===fa||null===fa){c.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",ea);var ua;return this.Iwd((ua=new d,ua.IsSuccess=!1,ua.Token=null,ua.ErrorCode="DisallowedApp",ua.ErrorMessage="Disallowed appName: "+ea,ua),ea)}const Fa=L.a.Td(),ca=this;Ta=this.syg.then(yb=>ca.gli(ea,fa,ra,O,da,xa,ia,yb));Da=O?0:n.OAuthManagerSettings.yId;let ka;ua=(ka=new d,ka.IsSuccess=!1,ka.Token=
null,ka.ErrorCode="authTokenStrategy_timeout",ka.ErrorMessage="Auth Strategy timed out after ["+Da+"] ms when fetching token",ka);let Ca=this,fb=this;return k.get(Ta,ua,Da).then(yb=>Ma<=Z.LHi&&(yb.ErrorCode===Z.afg||yb.ErrorCode===Z.fPj)?(c.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Ma,Math.floor(L.a.Td()-Fa)),Ca.bDc(ea,ra,O,da,xa,ia,Ma)):yb.ErrorCode===Z.Ynf&&!O&&(c.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",
Ma,Z.wPe),Z.bsh&&Ca.NO.xBc()&&Ca.NO.dDc(ea,fa,ra,O,da,xa).then(mb=>Promise.resolve(Ca.cmc(mb,ea,ra,fa,Fa))).catch(()=>{let mb;const nb=(mb=new d,mb.IsSuccess=!1,mb.Token=null,mb.ErrorCode="authTokenStrategy_failure",mb.ErrorMessage="LoginPopup failed, GetToken could not be called",mb);return Promise.resolve(Ca.cmc(nb,ea,ra,fa,Fa))}),Z.wPe)?Ca.bDc(ea,ra,!0,da,xa,ia,Ma):Promise.resolve(Ca.cmc(yb,ea,ra,fa,Fa))).catch(()=>{let yb;const mb=(yb=new d,yb.IsSuccess=!1,yb.Token=null,yb.ErrorCode="authTokenStrategy_failure",
yb.ErrorMessage="Auth Strategy failed with an unknown error",yb);return Promise.resolve(fb.cmc(mb,ea,ra,fa,Fa))})}gli(ea,ra,O,da,xa,ia,Ma,Ta){return 1===Ta||2===Ta?this.Iwd(Object.assign(new d,{IsSuccess:!1,Token:null,ErrorCode:1===Ta?"InitFailed":"InitTimedOut",ErrorMessage:"Auth Strategy Failed to Init or Load"}),ea):this.NO.AO(ea,ra,O,da,xa,ia,Ma).then(Da=>Promise.resolve(this.Oxf(Da,!0,ea))).catch(Da=>Promise.resolve(this.Oxf(Da,!1,ea)))}cmc(ea,ra,O,da,xa){const ia={};xa=L.a.Td()-xa;ia.IsSuccess=
ea.IsSuccess;ia.ErrorCode=ea.IsSuccess?"Success":ea.ErrorCode||"";ia.ErrorMessage=ea.IsSuccess?"Success":this.sRa(ra,ea.ErrorMessage||"");ia.Target=this.sRa(ra,O||"");ia.TimeInMS=Math.floor(xa);ia.AuthLibrary=this.mv();ia.AppName=ra;ia.AuthorityType=Object(b.a)(f,l.a.Abc());ia.UserType=this.v6h(l.a.getAuthContext());ia.IsAuthSupportedInSession=e.a[this.uS];ia.RequestCount=++this.QCg;ia.AppId=da;c.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(ia));ea.IsSuccess||(O=M.a.Pr(),void 0!==O&&null!==O&&
(O.set("AppName",ra),O.set("AuthLibrary",this.mv()),O.set("ErrorCode",ea.ErrorCode),O.set("ErrorMessage",this.sRa(ra,ea.ErrorMessage)),ra=Object.assign(new V.a,{durationMs:xa,extendedProperties:O}),N.Health.instance.recordKpiFailure(Z.kpiName,"TryGetTokenFailure",!1,!0,ra)));return ea}Iwd(ea,ra){c.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",ra,this.sRa(ra,ea.ErrorMessage));const O=M.a.Pr();void 0!==O&&null!==O&&(O.set("AppName",
ra),O.set("AuthLibrary",this.mv()),O.set("ErrorCode",ea.ErrorCode),O.set("ErrorMessage",this.sRa(ra,ea.ErrorMessage)),ra=Object.assign(new V.a,{extendedProperties:O}),N.Health.instance.recordKpiFailure(Z.kpiName,"FailureBeforeGetToken",!1,!0,ra));return Promise.resolve(ea)}Tif(ea){return ea===Y.a.nCc}sRa(ea,ra){return this.Tif(ea)&&ra?"REDACTED":ra}v6h(ea){return t.AFrameworkApplication.fa.pa("IsAnonymousUser")?"anonymous":!ea.loginHint||1>ea.loginHint.length?"empty":-1<ea.loginHint.indexOf("guest#")?
"guest":-1<ea.loginHint.indexOf("ext#")?"external":0>ea.upn.indexOf("@")?"no-at":"supported"}v6a(){return 1===this.uS}Oxf(ea,ra,O){let da=null,xa=null,ia=null,Ma=null;ea?ea.ErrorCode||ea.ErrorMessage?(xa=ea.ErrorCode?ea.ErrorCode:Z.TVe,ia=ea.ErrorMessage?ea.ErrorMessage:"No message"):ea.Token?ra?da=ea.Token:(xa=Z.shj,ia="A rejected promise returned a token."):(xa=Z.TVe,ia=JSON.stringify(ea)):(xa=Z.uLi,ia="No result came from Auth Token Strategy");ea&&ea.Telemetry&&!this.Tif(O)&&(Ma=ea.Telemetry,c.ULS.sendTraceTag(579166408,
3E3,50,JSON.stringify(Ma)));if(xa===Z.lJi||xa===Z.TTj)xa=Z.afg,ia="Auth Library Timed Out";xa===Z.MUg&&-1<ia.indexOf(Z.RGg)&&(xa=Z.Ynf);if(xa||ia)da=null;return Object.assign(new d,{IsSuccess:!!da,Token:da,ErrorCode:xa,ErrorMessage:ia,Telemetry:Ma})}static get wPe(){return t.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",!1)}static get bsh(){return t.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",
!1)}}Z.TTj="token_renewal_error";Z.TVe="Exception";Z.uLi="NoResult";Z.shj="RejectToken";Z.lJi="monitor_window_timeout";Z.afg="Timeout";Z.fPj="authTokenStrategy_timeout";Z.MUg="login_required";Z.RGg="AADSTS50058";Z.Ynf="Cookies Disabled";Z.kpiName="OAuthManager";Z.LHi=2;Object(r.a)(Z,"OAuthManager",null,[534])},940:function(r,F,a){a.d(F,"a",function(){return c});r=a(0);var c;(function(b){b[b.unknown=0]="unknown";b[b.supported=1]="supported";b[b.userUnsupportedAnonymous=2]="userUnsupportedAnonymous";
b[b.userUnsupportedNoLoginHint=3]="userUnsupportedNoLoginHint";b[b.hostUnsupported=4]="hostUnsupported"})(c||(c={}));Object(r.b)("SupportStatus",c)}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.oauth.js.map/0a9025940a2705e2eae142b02a071edb/EwaDSEsNext.oauth.js.map