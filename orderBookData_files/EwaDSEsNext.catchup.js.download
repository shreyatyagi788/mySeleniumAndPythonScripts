'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[24],{1004:function(r,F,a){a.d(F,"a",function(){return e});r=a(0);var c=a(168);F=a(1263);var b=a(774);class e extends F.a{constructor(f,d){super(f,d);d!==b.a.P9&&this.RFa(d);this.Gga(e.iterateNext);this.Gga(e.pxa);this.g_b(c.a.CUa);this.g_b(c.a.DUa);this.g_b(c.a.SY)}}e.iterateNext="IterateNext";e.pxa="IteratePrevious";e.lPb="ToggleShowChanges";e.setCurrentChangeCount="SetCurrentChangeCount";e.setTotalChangesCount=
"SetTotalChangesCount";e.oPa="OnVHDiffReady";Object(r.a)(e,"VersionHistoryMessenger",F.a,[])},1285:function(r,F,a){r=a(0);var c=a(15),b=a(79),e=a(838),f=a(84),d=a(8),h=a(195),l=a(65),k=a(41),t=a(193),n=a(114),z=a(249),w=a(1),m=a(11),u=a(101),y=a(13),v=a(282),C=a(21),x=a(345);class B{constructor(E,N,M){this.OFa=E;this.Yj=N;this.j1d=M}}Object(r.a)(B,"UserActivityLocation",null,[]);var H=a(1004),I=a(60);const U=(E,N,M,L,aa,V=null)=>{V=E.Na(1,V);return I.g(E,"GetVersionHistoryHighlightActivitiesData",
V,N,M,L,aa,4)};var S=a(774),G=a(55);a.d(F,"a",function(){return D});class D{constructor(E,N,M,L){this.authorColor=this.Y1=this.Hea=null;this.Y7a=!1;this.x1a=-1;this.g7c=0;this.DIa=100;this.n5=-1;this.O1d=null;this.Wpb=d.a.x5j;this.Z7c=d.a.y5j;this.hFb=!1;this.sTh=()=>({DisplayName:d.a.z5j,Email:null,Id:null,Provider:null});this.eh=aa=>{(aa=z.a(aa)?null:aa.Result)?aa.OperationWaitingForFileDownload?20>this.g7c?(this.DIa*=2,G.Task.delay(this.DIa).continueWith(()=>{this.WZd()})):(this.fEc(),c.ULS.sendTraceTag(537150406,
0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess Next Operation enqueue failed")):aa.ActivityList?(this.initialize(aa.ActivityList,aa.VersionAuthors),w.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")?this.oPa():this.xNb(!0),this.O1d.stop(),c.ULS.sendTraceTag(41743369,0,50,`VersionHistoryHighlightManager: Time taken For showing diffs in Ms:${this.O1d.Bc.toString()}`)):(this.fEc(),c.ULS.sendTraceTag(537150407,0,50,"VersionHistoryHighlightManager::OnWebMethodSuccess no activity list found.")):
(this.DIa*=2,G.Task.delay(this.DIa).continueWith(()=>{this.WZd()}),c.ULS.sendTraceTag(537150408,0,10,"VersionHistoryHighlightManager::OnWebMethodSuccess call returned null result."))};this.Vya=()=>{this.fEc();c.ULS.sendTraceTag(537150405,0,10,"VersionHistoryHighlightManager::OnWebMethodFailure service call failed.")};this.sud=aa=>{c.ULS.sendTraceTag(537150400,0,50,`VersionHistoryHighlightManager.IterateMessageHandler called with MessageID:${aa.MessageId}`);switch(aa.MessageId){case H.a.iterateNext:this.iterateNext();
this.n5=(this.n5+1)%this.iO.length;this.QLb(H.a.setCurrentChangeCount,this.n5+1);break;case H.a.pxa:this.pxa();this.n5=0>this.n5?0:this.n5;this.n5=(this.n5+this.iO.length-1)%this.iO.length;this.QLb(H.a.setCurrentChangeCount,this.n5+1);break;case H.a.lPb:this.xNb(aa.Values.ToggleValue)}};this.h8g=(aa,V)=>this.H4b(aa.Yj,V.Yj);this.f8g=(aa,V)=>this.H4b(aa.Yj,V);this.Uc=()=>{w.EwaSettings.isChangeGateEnabled("OfficeVSO:7487107_XlOnlineVHRemovingDeselectOnSelectionChanged")||this.D7b()};this.xn=()=>{this.D7b()};
this.Ri=()=>{this.D7b()};c.ULS.sendTraceTag(537150411,0,50,"VersionHistoryHighlightManager::Constructor.");this.$=E;this.ariaLiveNotifier=L;this.gridView=C.h(this.$);this.gridView.ha.eC(this.Uc);this.gridView.jE(this.xn);this.gridView.Vb.xl(this.Ri);this.B0j();this.hFb=w.EwaSettings.isChangeGateEnabled("OfficeVSO:7468185_XlOnlineVHNewIterationAlgorithm");N&&(this.O1d=E.Jb.Gc("UserAction","VersionHistoryDiffManagerStopWatch"),this.WZd());if(this.ds=M)E=b.a.Uaa(this.$.ya.VersionHistoryActionUrl)||S.a.P9,
E!==S.a.P9&&this.ds.RFa(E),this.ds.$n(H.a.iterateNext),this.ds.$n(H.a.pxa),this.ds.$n(H.a.lPb),this.ds.Dl(H.a.iterateNext,this.sud),this.ds.Dl(H.a.pxa,this.sud),this.ds.Dl(H.a.lPb,this.sud)}get Tgb(){return this.Y1}get MLb(){return-1===this.x1a?null:this.iO[this.x1a]}get iO(){this.Y7a||(this.Hea.sort(this.h8g),this.Y7a=!0);return this.Hea}dispose(){this.yQa();this.Hea=this.Y1=null;this.gridView&&(this.gridView.ha&&this.gridView.ha.vB(this.Uc),this.gridView.AF(this.xn),this.gridView.Vb&&this.gridView.Vb.nl(this.Ri),
this.ds&&(this.ds.yea(H.a.pxa),this.ds.yea(H.a.iterateNext),this.ds.yea(H.a.lPb)))}initialize(E,N){E?(this.yQa(),this.x1a=-1,this.Hea=[],this.Y7a=!1,this.Y1={},this.authorColor={},this.AGi(N),this.O6c(E)):c.ULS.shipAssertTag(537150410,0,!1,"VersionHistoryHighlightManager.Initialize - userActivityList was Null")}WZd(){c.ULS.sendTraceTag(537150409,0,50,`VersionHistoryHighlightManager: TryFetchUserActivityandTriggerDiff triggered: ${this.g7c.toString()} --${this.DIa.toString()}`);this.g7c++;this.$.userOperationManager.Jc(new t.a(537,
0,(E,N,M)=>U(this.$.oa.xa,v.b(E,this.eh),v.a(N,this.Vya),M,null),80),null)}xNb(E){const N=this.Y1;for(let L in N){var M=L;const aa=N[L];aa?aa.zNb(E):c.ULS.shipAssertTag(537150404,0,!1,"VersionHistoryHighlightManager.ShowOrHideAllHighlights -"+M+"view was Null")}}yQa(){const E=this.Y1;for(let M in E){var N=M;const L=E[M];L?L.oLd():c.ULS.shipAssertTag(537150403,0,!1,"VersionHistoryHighlightManager.RemoveAllHighlights -"+N+"view was Null")}this.Hea=this.Y1=null}r2f(E){let N;if(this.hFb)N=E?this.f5e(this.n5):
this.j6e(this.n5),E=this.iO[N];else if(!({eef:N,Clg:E}=this.MZh(E,this.x1a)).returnValue)return;c.ULS.shipAssertTag(537150402,0,!!E,"VersionHistoryHighlightManager.SelectNextOrPreviousChange - userActivityLocation is null");this.D7b();if(E.OFa.toString()in this.Y1){this.Y1[E.OFa.toString()].Luj(E.Yj);var M=k.D(E.Yj);this.ariaLiveNotifier.setEnabled(!1);this.ariaLiveNotifier.setEnabled(!0);this.ariaLiveNotifier.readText(String.format(y.a.instance.ob(158),N+1,this.iO.length,M.RC(!1),E.j1d.DisplayName));
this.x1a=N}else c.ULS.shipAssertTag(537150401,0,!1,`VersionHistoryHighlightManager.SelectNextOrPreviousChange - ${E.OFa.toString()} view not present in views dictionary`)}QLb(E,N){if(w.EwaSettings.ra(279))if(this.ds){var M={};M.count=N;E=new e.a(E);E.Values=M;this.ds.send(E)}else c.ULS.sendTraceTag(537150370,0,10,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage hostPostmessenger is null");else c.ULS.sendTraceTag(537150371,0,50,"VersionHistoryHighlightManager.SendIteratorTextUpdateMessage VersionHistoryIterator BRS is turned off")}MZh(E,
N){let M,L=!1;M=null;let aa=0;for(;!L&&aa<this.iO.length;){N=E?this.f5e(N):this.j6e(N);M=this.iO[N];const V=Object(f.a)(u.a,this.$.va.getItemByName(M.Yj.SheetName));if(!V)return c.ULS.shipAssertTag(537150369,0,!1,"VersionHistoryHighlightManager.GetNextorPreviousUserActivityLocationFromIndex - useractivitylocation contains sheetrange with null sheet"),{returnValue:!1,eef:N,Clg:M};V.visible&&(L=!0);aa++}return{returnValue:L,eef:N,Clg:M}}f5e(E){return this.hFb||-1!==E?(E+1)%this.iO.length:this.a5e()}j6e(E){this.hFb&&
-1===E?E=0:-1===E&&(E=this.a5e());return E=(E+this.iO.length-1)%this.iO.length}O6c(E){this.Vhh(E);this.t6c()}j6h(E,N){const M=[];if(!E.RangeList)return c.ULS.shipAssertTag(537150368,0,!1,"VersionHistoryHighlightManager.GetUserActivityLocationFromRangeActivityLocation - ActivityLocationType.Range RangeList Null "),M;for(const L of E.RangeList)if(!L||!this.$.va.Gk(L.SheetName))c.ULS.shipAssertTag(537150367,0,!1,"Invalid sheet name "+L.SheetName);else if(!this.hFb||this.$.va.getItemByName(L.SheetName).visible)E=
new B(0,L,N),M.push(E);return M}Vhh(E){for(const N of E)if(!N||n.e(N.LocationList))c.ULS.sendTraceTag(537150366,0,50,"Empty Location list");else for(const M of N.LocationList)if(M)switch(M.Type){case 0:this.Hea.push(...this.j6h(M,N.Person));break;default:c.ULS.sendTraceTag(537150364,0,50,"VersionHistoryHighlightManager.CreateViews Failed. Invalid ActivityLocationType")}else c.ULS.shipAssertTag(537150365,0,!1,"VersionHistoryHighlightManager.CreateUserActivityLocationList - LocationList contains Null")}t6c(){var E=
{};const N=[];for(const M of this.Hea){if(0!==M.OFa)continue;const L=new x.a(k.D(M.Yj),l.d(this.$.va.getItemByName(M.Yj.SheetName))),aa=D.azc(L);aa in E||N.push(L);E[aa]=this.CRh(M.j1d);E[aa]===this.Z7c&&this.K2j(M)}c.ULS.sendTraceTag(42541534,0,15,`VersionHistoryHighlightManager.CreateRangeHighlightView. Total activities : ${this.Hea.length}, Highlightable activities: ${N.length},Total userlist in activities : ${this.Hea.length}, Total userlist from pane: ${N.length} `);this.fEc();0<N.length&&(E=
new (a(1391).RangeVersionHistoryHighlightView)(this.$,N,E,this.Wpb),this.Y1["0"]=E)}K2j(E){w.EwaSettings.isChangeGateEnabled("OfficeVSO:7213684_NarratorReadsAuthorNameForChangesWithoutUserAttributionDuringIteration")&&(E.j1d=this.sTh())}fEc(){const E=this.Hea?this.iO.length:0;this.QLb(H.a.setCurrentChangeCount,0);this.QLb(H.a.setTotalChangesCount,E)}oPa(){this.QLb(H.a.oPa,0)}AGi(E){if(E)for(let aa=0;aa<E.length;++aa)if(w.EwaSettings.isChangeGateEnabled("OfficeVSO:5140301_HandleEmptyInitialsColor")&&
!E[aa].InitialsColor)c.ULS.sendTraceTag(537150362,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: InitialsColor is null or empty for a version author");else{var N=E[aa].EmailAddress;var M=E[aa].UserName;var L=null;if(E[aa].LoginName){const V=E[aa].LoginName.split("|");3===V.length&&(L=V[2])}L?this.authorColor[L]=E[aa].InitialsColor:N?(c.ULS.sendTraceTag(537150361,0,15,"VersionHistoryHighlightManager Map Author Color: LoginName is null"),this.authorColor[N]=E[aa].InitialsColor):M?(c.ULS.sendTraceTag(537150360,
0,15,"VersionHistoryHighlightManager Map Author Color: Email Address is null"),this.authorColor[M]=E[aa].InitialsColor):c.ULS.sendTraceTag(537150359,0,10,"VersionHistoryHighlightManager Map Author Color: User name is null")}else c.ULS.sendTraceTag(537150363,0,15,"VersionHistoryHighlightManager.MapAuthorColorInfo: versionAuthors is null")}B0j(){if(this.$.ya.VersionHistoryHighlightsSettings){var E=Array.isArray(Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings))?
Sys.Serialization.JavaScriptSerializer.deserialize(this.$.ya.VersionHistoryHighlightsSettings):null;for(let M=0;M<E.length;M++){var N=E[M];const L=N.key?N.key:N.Key?N.Key:"";N=N.value?N.value:N.Value?N.Value:"";"DefaultColor"===L?this.Z7c=N:"InitialTint"===L?this.Wpb=N:c.ULS.sendTraceTag(537150357,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are incorrect")}}else c.ULS.sendTraceTag(537150358,0,15,"VersionHistoryHighlightManager.UpdateHighlightSettings Highlight Settings are null")}CRh(E){if(E.Email in
this.authorColor)return this.authorColor[E.Email];if(E.DisplayName in this.authorColor)return this.authorColor[E.DisplayName];c.ULS.sendTraceTag(537150356,0,15,"VersionHistoryHighlightManager GetColorFromPerson - unable to associate corresponding author in dictionary");return this.Z7c}H4b(E,N){var M=Object(f.a)(u.a,this.$.va.getItemByName(E.SheetName));const L=Object(f.a)(u.a,this.$.va.getItemByName(N.SheetName));return M&&L?(M=(M=m.HelperMethods.sz(M.index,L.index))||m.HelperMethods.sz(E.FirstRow,
N.FirstRow))||m.HelperMethods.sz(E.FirstColumn,N.FirstColumn):(c.ULS.sendTraceTag(537150355,0,10,"VersionHistoryHighlightManager.CompareSharedSheetRange - null sheet"),0)}a5e(){var E=k.m(this.gridView.ha.qa.activeRange,this.$.va.na);if(!E)return c.ULS.sendTraceTag(537150354,0,10,"VersionHistoryHighlightManager.GetNearestLocationIndexFromCurrentSelection - SelectedSharedSheetRange is null "),0;E=m.HelperMethods.Xu(new h.a(this.iO),0,this.iO.length,E,this.f8g);0>E&&(E=~E);return E%this.iO.length}D7b(){if(this.MLb){if(!(this.MLb.OFa.toString()in
this.Y1)){c.ULS.shipAssertTag(537150353,0,!1,`VersionHistoryHighlightManager.DeselectCurrentlySelectedView - ${this.MLb.OFa.toString()} view not present in views dictionary`);return}this.Y1[this.MLb.OFa.toString()].Clh(this.MLb.Yj)}this.x1a=-1}iterateNext(){this.r2f(!0)}pxa(){this.r2f(!1)}static azc(E){return`${E.range}${E.sheetId}`}}Object(r.a)(D,"VersionHistoryHighlightManager",null,[276,2])},1391:function(r,F,a){a.r(F);r=a(0);var c=a(15),b=a(8);class e{}e.qzh="ewa-vhr-rectinnerborder";Object(r.a)(e,
"CssClassNames",null,[]);var f=a(65),d=a(41),h=a(205),l=a(21),k=a(345),t=a(1285);a.d(F,"RangeVersionHistoryHighlightView",function(){return n});class n{constructor(z,w,m,u){this.Fjb=null;this.$=z;this.LDg=w;this.pSa=m;this.qSa={};this.Wpb=u;this.uii()}get XE(){return[n.v4]}get Cb(){return this.Fjb||(this.Fjb=l.h(this.$).Cb)}zNb(z){z?this.Cb.Qq(this.XE):this.Cb.Nj(this.XE)}oLd(){this.zNb(!1);this.Cb.$Ra(new k.a(null,f.d(this.$.na)),this.XE)}Luj(z){if(this.pSa){var w=new k.a(d.D(z),f.d(this.$.va.getItemByName(z.SheetName))),
m=t.a.azc(w);if(m in this.pSa)if(m in this.qSa){w=h.a.Wo(this.pSa[m]);m=this.qSa[m];for(let u in m)m[u].style.backgroundColor=`rgba(${w.r},${w.g},${w.b},${b.a.A5j})`;l.h(this.$).ha.Ra.SG(null);l.h(this.$).J9e(z,60,!0,"RangeVersionHistoryHighlightViewSelectView.SelectView")}else c.ULS.sendTraceTag(537150426,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToDivMap doesn't contain entry for "+m);else c.ULS.sendTraceTag(537150427,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap doesn't contain entry for "+
m)}else c.ULS.sendTraceTag(537150428,0,10,"RangeVersionHistoryHighlightView.SelectView sheetRangeToColorMap is null")}Clh(z){z=new k.a(d.D(z),f.d(this.$.va.getItemByName(z.SheetName)));var w=t.a.azc(z);if(w in this.qSa)if(w in this.pSa){z=h.a.Wo(this.pSa[w]);w=this.qSa[w];for(let m in w)w[m].style.backgroundColor=`rgba(${z.r},${z.g},${z.b},${this.Wpb})`}else c.ULS.sendTraceTag(537150424,0,10,"RangeVersionHistoryHighlightView.DeselectView sheetRangeToColorMap doesn't contain entry for "+w);else c.ULS.sendTraceTag(537150425,
0,10,"RangeVersionHistoryHighlightView.DeSelectView sheetRangeToDivMap doesn't contain entry for "+w)}uii(){this.Cb.zB(this.LDg,[n.v4],!1,(z,w)=>{if(z&&z.range&&z.sheetId&&w){var m=new k.a(z.range,z.sheetId);m=t.a.azc(m);m in this.qSa||(this.qSa[m]={});this.qSa[m][z.paneType.toString()]=w;m in this.pSa?(z=this.pSa[m],m=h.a.Wo(z),w.style.borderColor=z,w.style.backgroundColor=`rgba(${m.r},${m.g},${m.b},${this.Wpb})`,z=document.createElement("div"),z.className=e.qzh,w.appendChild(z)):c.ULS.sendTraceTag(537150419,
0,10,"RangeVersionHistoryHighlightView.InitializeSheetRangeList sheetRangeToColorMap doesn't contain entry for "+m)}else c.ULS.shipAssertTag(537150423,0,!!z,"RangeVersionHistoryHighlightView.AddSheetRangeList: state is null"),c.ULS.shipAssertTag(537150422,0,!z||!!z.range,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.Range is null"),c.ULS.shipAssertTag(537150421,0,!z||!!z.sheetId,"RangeVersionHistoryHighlightView.AddSheetRangeList: state.SheetId is null"),c.ULS.shipAssertTag(537150420,
0,!!w,"RangeVersionHistoryHighlightView.AddSheetRangeList: div is null")})}}n.v4=23;Object(r.a)(n,"RangeVersionHistoryHighlightView",null,[304])},1456:function(r,F,a){a.r(F);var c=a(9),b=a(0),e=a(4),f=a(226),d=a(15),h=a(118),l=a(145),k=a(39);class t extends h.a{constructor(Jb,tc,fd,Ad,me){super(Jb,tc);this.executionContext=null;this.retryCount=0;this.XYi=Vd=>{({qOd:Vd}=this.IWj(Vd)).returnValue?Vd.Success?(l.c(2138207060,!0),d.ULS.sendTraceTag(42287318,0,15,"RestoreVersionActivity:onRestoreSuccessCallback Restore version is successful")):
(l.c(2138207060,!1),d.ULS.sendTraceTag(42287317,0,10,`RestoreVersionActivity:onRestoreSuccessCallback Restore version failed with message ${Vd.Output}`),this.gh(this.EJ)):(l.c(2138207060,!1),this.gh(this.EJ));(Vd=this.executionContext.activityState[t.oxd])&&Vd();this.kp();this.executionContext.lM()};this.WYi=()=>{if(0<this.retryCount)d.ULS.sendTraceTag(537150418,0,15,`RestoreVersionActivity:onRestoreFailureCallback Retrying version restore, retry count : ${this.retryCount}`),this.retryCount--,this.b_f();
else{d.ULS.sendTraceTag(42287320,0,10,"RestoreVersionActivity:onRestoreFailureCallback Restore version failed");l.c(2138207060,!1);this.gh(this.EJ);var Vd=this.executionContext.activityState[t.oxd];Vd&&Vd();this.kp();this.executionContext.lM()}};this.EJ=fd;this.S2=Ad;this.baseUrl=me}execute(Jb){this.executionContext=Jb;this.retryCount=3;this.b_f();return 1}b_f(){var Jb=this.executionContext.activityState[t.ctc];const tc=`${this.baseUrl}${"restoreversion.ashx"}`,fd={};fd.VersionId=this.executionContext.activityState[t.Jmg];
fd.QuerySignature=Jb;Jb=k.c(fd);this.S2.Jm(tc,2,Jb,{"Content-Type":"application/json; charset=utf-8"},!1,2,this.XYi,this.WYi,null)}IWj(Jb){let tc;tc=null;Jb=Jb?Jb.data?Jb.data.de:null:null;return Jb&&Jb.length?({ht:tc}=k.d(Jb)).returnValue?{returnValue:!0,qOd:tc}:(d.ULS.sendTraceTag(537150416,0,10,"RestoreVersionActivity:TryGetRestoreResult Failed in deserialization of returned data from restore version"),{returnValue:!1,qOd:tc}):(d.ULS.sendTraceTag(537150417,0,10,"RestoreVersionActivity:TryGetRestoreResult data returned from restoreversion call is null or empty"),
{returnValue:!1,qOd:tc})}}t.Jmg="RVAvi";t.ctc="RVAqs";t.oxd="RVlvrt";Object(b.a)(t,"RestoreVersionActivity",h.a,[]);var n=a(6);class z extends f.a{constructor(Jb,tc,fd){super();this.activityName=Jb;this.wJ=tc;this.EJ=fd;this.Db()}create(){this.nb(new t(this.activityName,this.wJ,this.EJ,e.AFrameworkApplication.Bd,e.AFrameworkApplication.sa.Qa.t_))}static ka(Jb){Jb.da.Ha(320,new z(n.a.tOd,n.a.Fi,n.a.uOd))}}Object(b.a)(z,"RestoreVersionActivityFactory",f.a,[]);class w extends h.a{constructor(Jb,tc){super(Jb,
tc)}execute(Jb){(0,Jb.activityState[w.H$f])(()=>{this.kp();Jb.lM()});return 1}}w.H$f="RVEAssea";Object(b.a)(w,"RestoreVersionErrorActivity",h.a,[]);class m extends f.a{constructor(Jb,tc){super();this.activityName=Jb;this.wJ=tc;this.Db()}create(){this.nb(new w(this.activityName,this.wJ))}static ka(Jb){Jb.da.Ha(321,new m(n.a.uOd,n.a.Fi))}}Object(b.a)(m,"RestoreVersionErrorActivityFactory",f.a,[]);var u=a(79),y=a(709),v=a(50),C=a(37),x=a(189),B=a(377),H=a(55);class I{constructor(Jb,tc){this.$=Jb;this.D5j=
tc}Hc(){return e.AFrameworkApplication.fa.pa("IsAnonymousUser")?(d.ULS.sendTraceTag(537150415,0,15,"Verison History Command Handler: Anonymous user."),!0):!1}executeCommand(Jb,tc){d.ULS.sendTraceTag(537150414,0,50,"VersionHistoryCommandHandler:ExecuteCommand called.");Jb=!1;switch(tc.command){case -1112508866:B.a(this.$)&&this.$.da.Aa(423).Zzc(!1),Jb=this.D5j.RKj()}d.ULS.sendTraceTag(537150413,0,50,`VersionHistoryCommandHandler:ExecuteCommand response${Jb}.`);return Jb?H.Task.Sa(Jb):x.a(tc.command)}wc(Jb,
tc){return-1112508866===tc.command&&this.$.isVersionHistoryEnabled()}Nc(){return!1}}Object(b.a)(I,"VersionHistoryCommandHandler",null,[222]);var U=a(7),S=a(255),G=a(168),D=a(389);class E{static addAppPLTEventToLog(Jb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.addAppPLTEventToLog(Jb)}catch(tc){}}static setIsPageLoadForFirstTime(Jb){try{Microsoft.VersionHistory.VersionHistoryLogHelper.setIsPageLoadForFirstTime(Jb)}catch(tc){}}}Object(b.a)(E,"VersionHistoryLogConnector",null,[]);var N=a(27),
M=a(838),L=a(1263),aa=a(157),V=a(94),P=a(29),ba=a(1),Y=a(45),Z=a(253),ea=a(1004),ra=a(263),O=a(250),da=a(12);class xa{constructor(Jb){this.Gw=Jb}Yh(){ra.a(this.Gw.$).mw(this.Xd)||ra.a(this.Gw.$).Yh(this)}L7(){ra.a(this.Gw.$).mw(this.Xd)&&ra.a(this.Gw.$).Ez(this)}get Xd(){return O.a.Gmg}get jc(){return document.querySelector('[id="vhHeader"]')}get Ff(){return!0}sh(Jb){return da.DOMElementExtensions.Af(this.jc,Jb)}rj(){this.Gw.$.frame.Le.kk(this.Gw.$.frame.Le.HE)}dk(){}ag(Jb,tc){tc||this.Gw.HPb.then(fd=>
{fd.enterHeaderFocusTrapZone();return null});return!tc}}Object(b.a)(xa,"VersionHistoryHeader",null,[54]);class ia{constructor(Jb){this.Gw=Jb}Yh(){ra.a(this.Gw.$).mw(this.Xd)||ra.a(this.Gw.$).Yh(this)}L7(){ra.a(this.Gw.$).mw(this.Xd)&&ra.a(this.Gw.$).Ez(this)}get Xd(){return O.a.Hmg}get jc(){return document.querySelector('[aria-describedby="versionHistoryPane"]')}get Ff(){return!0}sh(Jb){return da.DOMElementExtensions.Af(this.jc,Jb)}rj(){this.Gw.$.frame.Le.kk(this.Gw.$.frame.Le.HE)}dk(){}ag(Jb,tc){tc||
this.Gw.HPb.then(fd=>{fd.enterFocusTrapZone();return null});return!tc}}Object(b.a)(ia,"VersionHistoryPane",null,[54]);class Ma{constructor(Jb){this.Gw=Jb}Yh(){ra.a(this.Gw.$).mw(this.Xd)||ra.a(this.Gw.$).Yh(this)}L7(){ra.a(this.Gw.$).mw(this.Xd)&&ra.a(this.Gw.$).Ez(this)}get Xd(){return O.a.Img}get jc(){return document.querySelector('[id="vhViewer"]')}get Ff(){return!0}sh(Jb){return da.DOMElementExtensions.Af(this.jc,Jb)}rj(){this.Gw.$.frame.Le.kk(this.Gw.$.frame.Le.HE)}dk(){}ag(Jb,tc){tc||this.Gw.HPb.then(fd=>
{fd.enterViewerFocusTrapZone();return null});return!tc}}Object(b.a)(Ma,"VersionHistoryViewer",null,[54]);var Ta=a(147),Da=a(256),fa=a(73),ua=a(428),Fa=a(774);class ca{constructor(){this.actionUrl=this.ulsLogger=null;this.useFetch=this.hideEmbedFooter=!1}}Object(b.a)(ca,"AppBootSettings",null,[]);class ka{constructor(){this.rootDiv=this.appBootSettings=null}}Object(b.a)(ka,"AppVersionControllerFactoryParameters",null,[]);class Ca{constructor(){this.telemetryCollector=this.baseVersionInfo=this.selectedVersionInfo=
null}}Object(b.a)(Ca,"OnVersionSelectedParams",null,[]);class fb{constructor(){this.appName=0;this.wdEnableDownloadTokens=!1;this.retryCount=0;this.wdEnableIterator=this.wdEnableRestore=this.wdEnableSaveACopy=!1;this.uiLocale=this.wacCluster=this.userSessionId=null;this.disableSaveACopy=this.wdEnableShowVersionChanges=this.wdEnableHiddenButtonsUntilVersionLoadComplete=this.viewerRootPositionRelative=this.useXhr=this.isRtl=!1;this.disabledChangeGates=null;this.wdEnableDeleteVersions=this.wdEnableSaveACopyOverFlowMenu=
!1;this.wdDisableSPOFileCache=this.wdExperimentWithIteratorLocation=this.wdEnableAppColorUpdate=null}}Object(b.a)(fb,"AppSettings",null,[]);class yb{constructor(){this.perfTelemetryInfos=this.appSettings=this.docId=this.latestStreamServiceBase=this.serviceBase=this.ulsLogger=null}}Object(b.a)(yb,"ControllerFactoryParameters",null,[]);var mb;(function(Jb){Jb[Jb.none=0]="none";Jb[Jb.vhUnknown=1]="vhUnknown";Jb[Jb.vhFailedToLoadVersionList=100]="vhFailedToLoadVersionList";Jb[Jb.vhFailedToGetDownloadToken=
101]="vhFailedToGetDownloadToken";Jb[Jb.vhFailedToParseVersionList=102]="vhFailedToParseVersionList";Jb[Jb.vhFetchFailed=103]="vhFetchFailed";Jb[Jb.vhVersioningNotEnabled=104]="vhVersioningNotEnabled";Jb[Jb.vhFileNotFound=105]="vhFileNotFound";Jb[Jb.vhVersionTooOld=106]="vhVersionTooOld";Jb[Jb.vhFetchException=107]="vhFetchException";Jb[Jb.vhServiceUnavailable=108]="vhServiceUnavailable";Jb[Jb.vhBadGateway=109]="vhBadGateway";Jb[Jb.vhUnauthorized=110]="vhUnauthorized";Jb[Jb.vhInternalServerError=
111]="vhInternalServerError";Jb[Jb.vhEmptyVersionMetadatas=112]="vhEmptyVersionMetadatas";Jb[Jb.vhFailedHostDownload=113]="vhFailedHostDownload";Jb[Jb.vhFailedToAddDownloadToVersionStore=114]="vhFailedToAddDownloadToVersionStore";Jb[Jb.vhFailedToCacheParts=115]="vhFailedToCacheParts";Jb[Jb.vhFailedToDownloadVersionMetadata=116]="vhFailedToDownloadVersionMetadata";Jb[Jb.vhFailedToDownloadParts=117]="vhFailedToDownloadParts";Jb[Jb.vhInvalidDocID=118]="vhInvalidDocID";Jb[Jb.vhMissingDocID=119]="vhMissingDocID";
Jb[Jb.vhNullDocID=120]="vhNullDocID";Jb[Jb.vhNullHashedDocID=121]="vhNullHashedDocID";Jb[Jb.vhNullGetDownloadAccessTokenRequest=122]="vhNullGetDownloadAccessTokenRequest";Jb[Jb.vhFailedToDownloadVersionFromHost=123]="vhFailedToDownloadVersionFromHost";Jb[Jb.vhNullResponseFromFetch=124]="vhNullResponseFromFetch";Jb[Jb.vhGetTipVersionException=125]="vhGetTipVersionException";Jb[Jb.vhGetVersionsException=126]="vhGetVersionsException";Jb[Jb.vhGetDownloadTokenException=127]="vhGetDownloadTokenException";
Jb[Jb.vhFetchRetryException=128]="vhFetchRetryException";Jb[Jb.vhNullResponseFromRequestVersionHistory=129]="vhNullResponseFromRequestVersionHistory";Jb[Jb.vhNullResponseFromRequestDownloadToken=130]="vhNullResponseFromRequestDownloadToken";Jb[Jb.vhXhrJsonParseFailed=131]="vhXhrJsonParseFailed";Jb[Jb.vhXhrException=132]="vhXhrException";Jb[Jb.vhNullResponseFromXhr=133]="vhNullResponseFromXhr";Jb[Jb.vhFileGone=134]="vhFileGone";Jb[Jb.vhNullRevisionIDs=135]="vhNullRevisionIDs";Jb[Jb.vhRequestDeleteVersionsException=
136]="vhRequestDeleteVersionsException";Jb[Jb.vhNullResponseFromRequestDeleteVersions=137]="vhNullResponseFromRequestDeleteVersions";Jb[Jb.vhVersionInfoFromTipVersionException=138]="vhVersionInfoFromTipVersionException"})(mb||(mb={}));Object(b.b)("VersionHistoryFullAppErrorCode",mb);var nb=a(303);class X{constructor(Jb){this.baseVersionInfo=this.l3=this.Zoa=this.rl=this.ewaAccessibilityManager=this.HPb=null;this.YKd=this.Jxf=!1;this.UJe=!0;this.dialog=this.accessTokenExpirationManager=this.Cy=this.FYe=
this.zD=this.R1d=this.P1d=this.Q1d=null;this.sHf=tc=>{d.ULS.sendTraceTag(42553885,0,50,"VersionHistoryPaneActor:OnRestoreVersionSelected - Restore is triggered");if(this.EHj()){var fd=me=>{l.c(2138207060,!1);this.rl.setRestoreFailedAtServer(me)};this.zD&&this.zD.startTimer(X.Teg);var Ad=()=>{this.zD.endTimer(X.Teg);this.UAe(this.zD)};this.rl.setRestoreInProgress();Y.a(this.$).vr(new Z.a(n.a.hw,5,()=>{const me=fa.a(this.$).gd.activityState;me[Da.a.Dp]=n.a.MDe;me[Ta.a.aY]=!0;me[Ta.a.jT]=0;me[t.Jmg]=
tc;me[t.ctc]=e.AFrameworkApplication.vi;me[t.oxd]=Ad;me[w.H$f]=fd;ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.RestoreVersionForConvergenceExcelOnline",!1)&&(me[nb.a.Tqc]=!0)}))}else l.c(2138207060,!1)};this.YJf=tc=>{this.HPb.then(fd=>{fd.enterFocusTrapZone();return null});d.ULS.sendTraceTag(537150349,0,50,"VersionHistoryPaneActor: OnVersionsReady called");this.zD.endTimer(X.yYd);this.zD.incrementCounter(X.Lah);d.ULS.sendTraceTag(537150348,0,50,`VersionHistoryPaneActor: OnVersionsReady TimeTakenGetVersionsToOnVersionsReady Ms:${this.zD.getTimerDuration(X.yYd)}`);
this.voj(tc.containerDiv);tc.versions&&0<tc.versions.length&&(this.FYe=X.UE(tc.versions[tc.versions.length-1]));this.l3&&this.Zoa&&this.cQd(this.l3);d.ULS.sendTraceTag(537150346,0,50,"VersionHistoryPaneActor:OnVersionsReady Exit")};this.onVersionSelected=tc=>{d.ULS.sendTraceTag(537150345,0,50,`VersionHistoryPaneActor:OnVersionSelected called. for Version:${X.UE(tc.currentVersion)}, LastSelected:${X.UE(this.l3)}`);this.zD.incrementCounter(X.Kah);this.l3=tc.currentVersion;this.baseVersionInfo=tc.baseVersion;
this.Jxf=tc.noBaseToCompareTo;this.Zoa&&this.S4j()&&(this.cQd(tc.currentVersion),d.ULS.sendTraceTag(537150344,0,50,"VersionHistoryPaneActor:OnVersionSelected Exit"))};this.$Bf=tc=>{d.ULS.sendTraceTag(537150337,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady called. for Version:${(null===tc||void 0===tc?0:tc.versionSelected)?X.UE(tc.versionSelected.currentVersion):null} UpdatedVersionsCount${(null===tc||void 0===tc?0:tc.updatedVersions)?tc.updatedVersions.length:0}, LastSelected:${X.UE(this.l3)}`);
this.zD.incrementCounter(X.Jah);if(this.baseVersionInfo){if((null===tc||void 0===tc?0:tc.updatedVersions)&&2<=tc.updatedVersions.length){let fd=null,Ad=null;const me=X.UE(this.l3),Vd=X.UE(this.baseVersionInfo);for(const oe of tc.updatedVersions)if(tc=X.UE(oe),me===tc?fd=oe:Vd===tc&&(Ad=oe),fd&&Ad)break;fd&&Ad?(this.l3=fd,this.baseVersionInfo=Ad,d.ULS.sendTraceTag(537150307,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady -Calling versionsViewController:OnVersionSelected RevisionID[N]: ${X.UE(this.l3)}, RevisionID[N-1]: ${X.UE(this.baseVersionInfo)}.`),
this.cQd(this.l3)):d.ULS.sendTraceTag(537150306,0,50,`VersionHistoryPaneActor:OnDownloadTokenReady - does not find currentVersion or baseVersion from UpdatedVersions. RevisionID[N]: ${me}, RevisionID[N-1]: ${Vd}.`)}else d.ULS.sendTraceTag(537150305,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady - no diff call due to downloadTokenReadyObject or downloadTokenReadyObject.UpdatedVersions objects are null or not enough.");d.ULS.sendTraceTag(537150304,0,50,"VersionHistoryPaneActor:OnDownloadTokenReady")}else d.ULS.sendTraceTag(537150336,
0,50,"VersionHistoryPaneActor:OnDownloadTokenReady baseVersionInfo is null in OnDownloadTokenReady callback.")};this.XAf=()=>{d.ULS.sendTraceTag(537150303,0,50,"VersionHistoryPaneActor:OnCloseVersionHistoryDialog Called");this.p6g();const tc=new V.a(1470556788,0,this.$.xc,0,null);this.$.Ia.Hb(tc)};this.JHf=tc=>{d.ULS.sendTraceTag(41739662,0,50,"VersionHistoryPaneActor:OnSaveACopy Called");let fd=new V.a(-1244760097,0,this.$.xc,0,null);this.$.$d.get(51)&&(d.ULS.sendTraceTag(537150301,0,50,"VersionHistoryPaneActor:OnSaveACopy for ODConsumer Called"),
fd=new V.a(-309686558,0,this.$.xc,0,null));l.c(1604651619,!0);this.$.Ia.Hb(fd,{["FileDownloadUrl"]:tc})};this.aCf=tc=>{d.ULS.sendTraceTag(537150300,0,50,"VersionHistoryPaneActor:OnDownloadVersion Called");if(!ba.EwaSettings.isChangeGateEnabled("OfficeVSO:6794681_VHDisableDownloadACopy")||this.DHj())tc=new S.QueryStringBuilder(tc),tc.Zi("fn",e.AFrameworkApplication.fileName),d.ULS.sendTraceTag(537150299,0,50,"VersionHistoryPaneActor:OnDownloadVersion URL Length is "+tc.toString().length),8===this.$.frame.O9a(tc.toString(),
!0)?(d.ULS.sendTraceTag(587830283,0,10,"VersionHistoryPaneActor:OnDownloadVersion failed"),l.c(1316171850,!1)):l.c(1316171850,!0)};this.Dzf=tc=>{this.rl.setFullAppErrorCode(tc);ba.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&this.rl.setViewerError(!0)};this.hwe=tc=>{const fd=document.getElementById(X.RVe);!fd||this.Cy&&!tc||(d.ULS.sendTraceTag(537150293,0,50,"VersionHistoryPaneActor: SelectVersion Lazy instantiate VersionHistoryMessenger"),this.Cy=new ea.a(fd.contentWindow,
u.a.Uaa(this.$.ya.VersionHistoryActionUrl)||Fa.a.P9),this.Cy.Dl(G.a.CUa,this.Qbb),this.Cy.Dl(G.a.DUa,this.Qbb),this.Cy.Dl(G.a.SY,this.Qbb),this.Cy.$n(ea.a.setCurrentChangeCount),this.Cy.$n(ea.a.setTotalChangesCount),ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.Cy.$n(ea.a.oPa),this.Cy.Dl(ea.a.setCurrentChangeCount,this.Qbb),this.Cy.Dl(ea.a.setTotalChangesCount,this.Qbb),ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&
this.Cy.Dl(ea.a.oPa,this.Qbb))};this.nDf=tc=>{if(ba.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes"))tc=mb[tc]?mb[tc]:"None";else switch(tc){case 101:tc="VHFailedToGetDownloadToken";break;case 100:tc="VHFailedToLoadVersionList";break;case 104:tc="VHVersioningNotEnabled";break;case 105:tc="VHFileNotFound";break;case 106:tc="VHVersionTooOld";break;default:tc="None"}this.zD.addEvent("OnFullAppError",tc);d.ULS.sendTraceTag(537150291,0,10,`FullApp Error Event: ${tc}`)};
this.CEd=tc=>{this.UJe=tc;d.ULS.sendTraceTag(537150290,0,50,`VersionHistoryPaneActor:Show Changes toggled to:${tc.toString()}`);this.yQd(ea.a.lPb,{["ToggleValue"]:tc})};this.IEf=tc=>{d.ULS.sendTraceTag(50405840,0,50,`VersionHistoryPaneActor:OnIteratorSelected next: ${tc}`);l.c(1488635506,!0);const fd={};tc?this.yQd(ea.a.iterateNext,fd):this.yQd(ea.a.pxa,fd)};this.Qbb=tc=>{switch(tc.MessageId){case G.a.CUa:d.ULS.sendTraceTag(537150289,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppCompleted ");
ba.EwaSettings.ra(370)&&this.rl.setVersionLoadComplete();break;case G.a.DUa:d.ULS.sendTraceTag(51128035,0,10,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession WacAppFailed");break;case ea.a.setCurrentChangeCount:tc=tc.Values.count;d.ULS.sendTraceTag(537150288,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetCurrentChangeCount : ${tc}`);this.rl.setCurrentChangeCount(tc);break;case ea.a.setTotalChangesCount:tc=tc.Values.count;d.ULS.sendTraceTag(537150287,0,50,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession SetTotalChangesCount : ${tc}`);
this.rl.setTotalChangesCount(tc);break;case ea.a.oPa:this.CEd(this.UJe);break;case G.a.SY:if(!ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7402639_ExcelVHAccessTokenExpiredRefreshFix"))break;d.ULS.sendTraceTag(509682466,0,50,"VersionHistoryPaneActor.ReceivePostMessageFromVHSession DocumentRefresh");this.FNi();break;default:d.ULS.sendTraceTag(537150286,0,15,`VersionHistoryPaneActor.ReceivePostMessageFromVHSession MessageID:${tc.MessageId}`)}};this.$=Jb;this.n$b=this.$.Bb+X.MDh;this.XKd=!1;ba.EwaSettings.ra(341)&&
this.$hh();ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&this.$.da.gb(38,tc=>{this.accessTokenExpirationManager=tc;this.mPa=this.mPa.bind(this);this.accessTokenExpirationManager.uob(this.mPa)});this.fDb="";this.hvd=0;this.perfTelemetryInfos=[]}mPa(){null!=this.rl&&(this.rl.updateDocId(e.AFrameworkApplication.vi),d.ULS.sendTraceTag(509699330,0,50,"VersionHistoryPaneActor:onTokenRefreshed completed Successfully"))}dispose(){ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7323755_ExcelVersionHistoryTokenRefreshFix")&&
this.accessTokenExpirationManager.Wuc(this.mPa);this.yCe()}d7i(){this.$.da.gb(15,Jb=>{this.ewaAccessibilityManager=Jb;this.ewaAccessibilityManager.mode=2})}$hh(){this.Q1d=new ia(this);this.P1d=new xa(this);this.R1d=new Ma(this)}RKj(){d.ULS.sendTraceTag(41739649,0,15,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction called");e.AFrameworkApplication.iN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryEnableODCSaveACopy");e.AFrameworkApplication.iN("Microsoft.Office.Excel.Server.Flighting.IDenyListVersionHistorySaveACopyOverFlowMenu");
e.AFrameworkApplication.iN("Microsoft.Office.Excel.Server.Flighting.IDenyListExcelVersionHistoryRestoreSkipCoauthCheck");e.AFrameworkApplication.Tp("8492a557;72ff4572");this.zD=excelVersionHistory.FactoryGlobal.getTelemetryCollector();this.perfTelemetryInfos=[];this.zD.startTimer(X.Seg);if(!this.rl&&(ua.a(()=>{this.rl=versionHistory.FactoryGlobal.getVersionHistoryControllerInstance(Object(U.a)(new yb,{ulsLogger:new D.a,docId:e.AFrameworkApplication.vi,appSettings:Object(U.a)(new fb,{appName:120,userSessionId:e.AFrameworkApplication.userSessionId,
wdEnableSaveACopy:ba.EwaSettings.ra(312),wdEnableDownloadTokens:ba.EwaSettings.ra(309),wacCluster:e.AFrameworkApplication.Bd.HO,uiLocale:e.AFrameworkApplication.uiCulture||"en-us",wdEnableRestore:ba.EwaSettings.ra(281)&&this.$.isEditMode,wdEnableIterator:ba.EwaSettings.ra(278)&&ba.EwaSettings.ra(279),useXhr:!1,wdEnableHiddenButtonsUntilVersionLoadComplete:ba.EwaSettings.ra(370),disableSaveACopy:this.ETd(),wdEnableShowVersionChanges:ba.EwaSettings.ra(278)&&ba.EwaSettings.ra(280),disabledChangeGates:this.$.ya.VHSDisabledChangeGates,
wdEnableSaveACopyOverFlowMenu:ba.EwaSettings.ra(466),isRtl:e.AFrameworkApplication.isRtl,wdExperimentWithIteratorLocation:ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.VersionHistoryIteratorInPane",!1)}),perfTelemetryInfos:this.perfTelemetryInfos}))}),!this.rl))return d.ULS.sendTraceTag(537150352,0,10,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction - VersionHistoryController should not be null"),l.c(429638140,!1),!1;this.SKj();this.zD.endTimer(X.Seg);this.zD.startTimer(X.Veg);
d.ULS.sendTraceTag(537150351,0,50,"VersionHistoryPaneActor:ShowVersionHistoryDialogAction Returned Success");l.c(429638140,!0);return!0}SKj(){var Jb;this.jhj();if(!document.getElementById(this.n$b)){const tc=document.createElement("div");tc.id=this.n$b;tc.style.width="100%";tc.style.zIndex="998";tc.style.display="block";tc.style.position="absolute";if(e.AFrameworkApplication.sa.Qa.df){const fd=(null===(Jb=document.getElementById("HeaderRegion"))||void 0===Jb?void 0:Jb.offsetHeight)||0;tc.style.top=
fd+"px";tc.style.bottom="0px";tc.style.height=`calc(100vh - ${fd}px)`}else tc.style.height="100%";this.$.ar.insertBefore(tc,this.$.ar.firstChild);this.HPb=this.rl.createVersionHistoryDialog(tc)}document.getElementById(this.n$b).style.display="block";this.NKd();this.zD.startTimer(X.yYd);this.rl.getVersions("")}NKd(){ba.EwaSettings.ra(341)&&(this.Q1d.Yh(),this.P1d.Yh(),this.R1d.Yh(),this.d7i())}G_d(){ba.EwaSettings.ra(341)&&(this.Q1d.L7(),this.P1d.L7(),this.R1d.L7(),this.ewaAccessibilityManager&&(this.ewaAccessibilityManager.mode=
0))}jhj(){this.rl.getVersionsReadyEvent().addListener(this.YJf);this.rl.getVersionSelectedEvent().addListener(this.onVersionSelected);this.rl.getCloseSelectedEvent().addListener(this.XAf);this.rl.getFullAppErrorEvent().addListener(this.nDf);this.rl.getIteratorSelectedEvent().addListener(this.IEf);this.rl.getShowVersionChangesToggledEvent().addListener(this.CEd);ba.EwaSettings.ra(309)&&(this.rl.getDownloadTokenReadyEvent().addListener(this.$Bf),this.XKd=!0);ba.EwaSettings.ra(312)&&(this.rl.getSaveACopySelectedEvent().addListener(this.JHf),
this.rl.getDownloadVersionSelectedEvent().addListener(this.aCf));ba.EwaSettings.ra(281)&&this.$.isEditMode&&(this.rl.getRestoreVersionSelectedEvent().addListener(this.sHf),this.YKd=!0)}khj(){this.Zoa.getAppErrorEvent().addListener(this.Dzf)}Sj(){this.rl.getVersionsReadyEvent().removeListener(this.YJf);this.rl.getVersionSelectedEvent().removeListener(this.onVersionSelected);this.rl.getCloseSelectedEvent().removeListener(this.XAf);this.rl.getFullAppErrorEvent().removeListener(this.nDf);this.rl.getIteratorSelectedEvent().removeListener(this.IEf);
this.rl.getShowVersionChangesToggledEvent().removeListener(this.CEd);ba.EwaSettings.ra(312)&&(this.rl.getSaveACopySelectedEvent().removeListener(this.JHf),this.rl.getDownloadVersionSelectedEvent().removeListener(this.aCf));this.XKd&&(this.rl.getDownloadTokenReadyEvent().removeListener(this.$Bf),this.XKd=!1);this.YKd&&(this.rl.getRestoreVersionSelectedEvent().removeListener(this.sHf),this.YKd=!1);this.Zoa&&this.Zoa.getAppErrorEvent().removeListener(this.Dzf)}iFj(){return this.ETd()||!e.AFrameworkApplication.UY}DHj(){return this.iFj()?
(d.ULS.sendTraceTag(520180169,0,15,"VersionHistoryPaneActor:OnDownloadVersion blocked"),l.c(1316171850,!1),!1):!0}EHj(){let Jb=!0;if(ba.EwaSettings.ra(521)&&!this.$.SM)return d.ULS.sendTraceTag(537150350,0,15,"VersionHistoryPaneActor:ShouldTriggerRestore - Skipping coauth check with status "+this.$.ea.amIAlone.toString()),!0;if(!this.$.ea.amIAlone&&!ba.EwaSettings.ra(277)){this.XBi();this.rl.setCoauthRestoreError();Jb=!1;const tc=new V.a(-729359593,0,this.$.xc,0,null);this.$.Ia.Hb(tc)}this.$.SM&&
(d.ULS.sendTraceTag(42522439,0,10,"VersionHistoryPaneActor:ShouldTriggerRestore - Restore failed, Unsaved changes present"),Jb&&(Jb=!1,this.QKj()));return Jb}QKj(){var Jb=P.a.ed(1,0,1902,1901,0,-1603358883,"RestoreVersionUnsavedChangesError");Jb=this.dialog||new aa.ErrorDialog(this.$,Jb);Jb.initialize();Jb.kg()}S4j(){d.ULS.sendTraceTag(537150343,0,50,`VersionHistoryPaneActor:ValidateDiffDiffParameters called for BaseVersion${this.baseVersionInfo?X.UE(this.baseVersionInfo):""}`);if(X.UE(this.l3)===
this.FYe)return d.ULS.sendTraceTag(537150342,0,15,"VersionHistoryPaneActor:ValidateDiffDiffParameters for last version"),!0;if(ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4381797_XLVHSkipBaseVersionValidateForGroupingUI")&&!this.baseVersionInfo&&this.Jxf)return d.ULS.sendTraceTag(537150341,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters skipping diff last version"),!0;if(!this.baseVersionInfo)return d.ULS.sendTraceTag(537150340,0,10,"VersionHistoryPaneActor:ValidateDiffDiffParameters for null BaseVersion"),
!1;const Jb=X.ZTh(this.baseVersionInfo);d.ULS.sendTraceTag(537150339,0,50,`downloadURL length ${Jb?Jb.length:0}`);return Jb?!0:(d.ULS.sendTraceTag(537150338,0,50,"VersionHistoryPaneActor:ValidateDiffDiffParameters downloadURL is null"),!1)}ETd(){return!this.$.Gka}p6g(){document.getElementById(this.n$b).style.display="none";const Jb=new V.a(-1423792966,0,this.$.xc,0,null);this.$.Ia.Hb(Jb);this.yCe()}yCe(){this.zD&&(this.zD.endTimer(X.Veg),this.UAe(this.zD),this.zD=null);this.Sj();this.G_d();this.perfTelemetryInfos&&
(d.ULS.sendTraceTag(537150302,0,15,this.perfTelemetryInfos.map(Jb=>JSON.stringify(Jb)).toString()),this.perfTelemetryInfos=null);this.Cy&&(this.Cy.yea(G.a.CUa),this.Cy.yea(G.a.DUa),this.Cy.yea(ea.a.setCurrentChangeCount),this.Cy.yea(ea.a.setTotalChangesCount),this.Cy.yea(G.a.SY),ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4844740_ExcelVersionHistoryHighlightChangesFix")&&this.Cy.yea(ea.a.oPa),this.Cy.dispose(),this.Cy=null)}voj(Jb){try{this.Zoa?(E.setIsPageLoadForFirstTime(!1),ba.EwaSettings.isChangeGateEnabled("OfficeVSO:6773359_ExcelVersionHistoryErrorHandlingFixes")&&
!document.getElementById(X.RVe)&&(this.Zoa.resetContainer(Jb),this.hwe(!0))):(E.setIsPageLoadForFirstTime(!0),ua.a(()=>{const tc=new ca;tc.ulsLogger=new D.a;tc.actionUrl=this.$.ya.VersionHistoryActionUrl;tc.hideEmbedFooter=!0;tc.useFetch=ba.EwaSettings.ra(365)&&!N.a.sw;this.Zoa=excelVersionHistory.FactoryGlobal.getAppVersionControllerInstance(Object(U.a)(new ka,{appBootSettings:tc,rootDiv:Jb}))})),this.khj()}catch(tc){d.ULS.sendTraceTag(41239239,0,10,`VersionHistoryPaneActor: ResetAppVersionController failed due to exception. ${tc}`)}}cQd(Jb){d.ULS.sendTraceTag(537150298,
0,50,`VersionHistoryPaneActor:SelectVersion called. for Version:${X.UE(Jb)}, LastSelected:${this.fDb}`);if(Jb)if(X.UE(Jb).length){var tc=(new Date).getTime();if(X.UE(Jb)===this.fDb&&1E3>tc-this.hvd)d.ULS.sendTraceTag(537150295,0,50,"VersionHistoryPaneActor:SelectVersion reattempt within 1 sec");else{X.UE(Jb)!==this.fDb&&(d.ULS.sendTraceTag(537150294,0,50,"VersionHistoryPaneActor:Reset Iterator states if user clicks on different version"),this.rl.setTotalChangesCount(-1),this.rl.setCurrentChangeCount(-1));
var fd=excelVersionHistory.FactoryGlobal.getTelemetryCollector();fd.addEvent("SelectVersion",X.UE(Jb));try{this.A7j(fd);this.hvd=tc;this.fDb=X.UE(Jb);const Ad=new Ca;Ad.selectedVersionInfo=this.l3;Ad.baseVersionInfo=this.baseVersionInfo;Ad.telemetryCollector=fd;this.Zoa.onVersionSelectedWithParams(Ad);this.rl&&ba.EwaSettings.ra(312)&&this.rl.setDisableSaveACopy(this.ETd());this.hwe(!1)}catch(Ad){this.hvd=0,this.fDb="",fd.addEvent("Exception",Ad.toString()),d.ULS.sendTraceTag(42016832,0,10,`VersionHistoryPaneActor: OnVersionSelected failed due to exception. ${Ad}`)}finally{d.ULS.sendTraceTag(537150292,
0,50,fd?fd.getJsonForLogging():"")}}}else d.ULS.sendTraceTag(537150296,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion RevisionId is null");else d.ULS.sendTraceTag(537150297,0,50,"VersionHistoryPaneActor:SelectVersion selectedVersion is null")}A7j(Jb){for(const tc of this.perfTelemetryInfos){const fd=tc.TelemetryEventKey?tc.TelemetryEventKey:tc.telemetryEventKey?tc.telemetryEventKey:"",Ad=tc.TelemetryEventData?tc.TelemetryEventData:tc.telemetryEventData?tc.telemetryEventData:"";fd&&Ad&&
Jb.addEvent(fd,Ad)}this.perfTelemetryInfos.length=0}UAe(Jb){d.ULS.sendTraceTag(42553886,0,15,`VersionHistoryPaneActor:CaptureSessionTelemetry - ${Jb?Jb.getJsonForLogging():""} `)}XBi(){const Jb=this.$.ea.uo,tc={};let fd=null;for(const Ad of Jb)Ad.UserEmail&&(tc[Ad.UserEmail]=Ad.UserEmail in tc?tc[Ad.UserEmail]+1:1),Ad.User.UserID===this.$.ea.clientId&&(fd=Ad.UserEmail);d.ULS.sendTraceTag(42522438,0,10,`VersionHistoryPaneActor:LogCoauthorsTelemetry Restore failed, TotalAuthors: ${Jb.length}, TotalAuthorsAsYourself ${fd?
tc[fd]:-1}`)}FNi(){Y.a(this.$).vr(new Z.a(n.a.hw,5,()=>{const Jb=fa.a(this.$).gd.activityState;Jb[Da.a.Dp]=n.a.Fi;Jb[nb.a.Tqc]=!0}))}yQd(Jb,tc){d.ULS.sendTraceTag(537150285,0,50,`VersionHistoryPaneActor.SendPostMessageToTheVHSession called with MessageID:${Jb}`);if(this.Cy){Jb=new M.a(Jb);Jb.Values[L.a.d7c]=this.$.ya.UserSessionId;if(tc)for(let fd in tc)Jb.Values[fd]=tc[fd];this.Cy.send(Jb)}else d.ULS.sendTraceTag(537150284,0,10,"VersionHistoryPaneActor.SendPostMessageToTheVHSession versionHistoryMessenger is null")}static UE(Jb){return Jb?
Jb.RevisionID?Jb.RevisionID:Jb.revisionID?Jb.revisionID:"":""}static ZTh(Jb){return Jb?Jb.DownloadUrl?Jb.DownloadUrl:Jb.downloadUrl?Jb.downloadUrl:"":""}}X.MDh="_excelVersionHistoryOverlay";X.RVe="vhs_frame";X.Seg="TimeTakenShowVersionHistoryDialogAction";X.Veg="TimeTillVersionHistoryDialogWasOpenMs";X.yYd="TimeTakenGetVersionsToOnVersionsReady";X.Kah="CountOnVersionSelectedCalledinOneVHSession";X.Lah="CountOnVersionsReadyCalledinOneVHSession";X.Jah="CountOnDownloadTokenReadyCalledinOneVHSession";
X.Teg="TimeTakenVersionRestore";Object(b.a)(X,"VersionHistoryPaneActor",null,[2]);var R=a(204),wa=a(187),na=a(105);class Ba extends y.a{constructor(Jb){super(Jb)}hd(){const Jb=this.fBi(),tc=v.GetServiceTaskFactory.Oa(this.$.da,21,137,this.Xa);C.TaskExtensions.za(C.TaskExtensions.Fd([Jb,tc],this.la,3),()=>{var fd=tc.result;const Ad=u.a.Uaa(this.$.ya.VersionHistoryActionUrl);Ad!==Fa.a.P9&&fd.RFa(Ad);fd=new X(this.$);this.$c([new I(this.$,fd)])},this.la,3)}fBi(){if(ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService"))return R.c(wa.a.resolve(na.d,
{Tl:this.Xa}).then(tc=>tc("excelVersionHistory")));const Jb=v.GetServiceTaskFactory.c4(this.$.da,283,284,this.Xa).then(tc=>tc.Hl.loadScript("excelVersionHistory"),tc=>{d.ULS.sendTraceTag(537150412,0,10,`versionHistoryManagerFactory: Dynamic Script Loading failed due to exception. ${tc}`);return Promise.reject(tc)});return R.c(Jb)}static ka(Jb){y.a.Md(304,new Ba(Jb))}}Object(b.a)(Ba,"VersionHistoryCommandHandlerFactory",y.a,[]);var Ra=a(1285),qa=a(712);class La extends f.a{constructor(Jb){super();
this.$=Jb;this.Db()}create(){const Jb=v.GetServiceTaskFactory.Oa(this.$.da,211,212,this.Xa),tc=v.GetServiceTaskFactory.Oa(this.$.da,21,137,this.Xa);C.TaskExtensions.za(C.TaskExtensions.Fd([Jb,tc],this.$.la),()=>{const fd=Object(qa.a)(this.$.da,305,()=>new Ra.a(this.$,!0,tc.result,Jb.result));this.nb(fd)},this.$.la,3)}static ka(Jb){Jb.da.Ha(306,new La(Jb))}}Object(b.a)(La,"VersionHistoryHighlightManagerFactory",f.a,[]);var Yb=a(512),mc=a(5),Zb=a(166),qb=a(13);class Ha extends h.a{constructor(Jb,tc,
fd){super(Jb,tc);this.lineageManager=fd}execute(Jb){this.lineageManager.lineageHidePreviousHistory();return super.execute(Jb)}}Object(b.a)(Ha,"LineageClearHistoryConfirmedActivity",h.a,[]);var Ya=a(17),Gb=a(142);class Ja{constructor(Jb,tc){this.$=Jb;this.lineageManager=tc;Jb=[new Ya.a(n.a.Yvd,1038647878,0,0,2243),new Ya.a(n.a.idle,1038647878,0,1)];fa.a(this.$).zKd(new Gb.a(n.a.Xvd,n.a.idle,Jb),new Ha(n.a.Yvd,n.a.idle,tc))}Hc(){return!1}executeCommand(Jb,tc,fd){Jb=!1;switch(tc.command){case 1834994092:9===
tc.Ve&&this.rQj();this.qIj(tc,fd);Jb=!0;break;case -409942531:this.sIj(),Jb=!0}return Jb?H.Task.Sa(!0):x.a(tc.command)}wc(Jb,tc){return 1834994092===tc.command||-409942531===tc.command}Nc(){return!1}qIj(Jb,tc){d.ULS.sendTraceTag(537155483,0,50,`LineageActivityCommandHandler::ShowChangesCore command location: ${tc.MenuItemId||Jb.Ve}`);this.lineageManager.e$f(19===Jb.Ve&&!!tc.MenuItemId,tc.MenuItemId,Jb.Ve,tc)}rQj(){const Jb=mc.a.utc;Jb!==Zb.a(this.$).pp.Lz&&Zb.a(this.$).pp.activateRibbonTab(Jb)}sIj(){Y.a(this.$).vr(new Z.a(n.a.Xvd,
5,()=>{const Jb=fa.a(this.$).gd,tc=P.a.ed(3,1,2240,2241,2242,1038647878,"LineageConfirmClearHistory");tc.HelpTopicId="a1493bf9-25c3-470a-b970-60eceb0136e5";tc.HelpDescription=qb.a.instance.ga(1318);Jb.Yq([tc])}))}}Object(b.a)(Ja,"LineageActivityCommandHandler",null,[222]);class Na extends y.a{constructor(Jb){super(Jb)}hd(){C.TaskExtensions.za(v.GetServiceTaskFactory.Oa(this.$.da,366,367,this.Xa),Jb=>{this.$c([new Ja(this.$,Jb.result)])},this.la,3)}static ka(Jb){y.a.Md(363,new Na(Jb))}}Object(b.a)(Na,
"LineageActivityCommandHandlerFactory",y.a,[]);class Qa{constructor(Jb){this.ISa=!0;Qa.Zgf()?Qa.smi()?this.ISa=!1:Qa.ihf()?(d.ULS.sendTraceTag(526434368,0,50,`LineageCatchUpExperimentManager is running in hybrid mode. TUI exhausted: ${!Jb}`),this.ISa=Jb):this.ISa=!1:this.ISa=!0}g7a(){return!this.ISa}static ihf(){return Qa.Zgf()&&ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationTeachingUXTreatmentToControl",!1)}static Zgf(){return ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.LineageCatchUpIntegrationSummaryStringTreatment",
!1)}static smi(){return ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)}}Object(b.a)(Qa,"LineageCatchUpExperimentManager",null,[411]);class Oa extends f.a{constructor(Jb){super();this.$=Jb;this.Db()}create(){Qa.ihf()?C.TaskExtensions.za(v.GetServiceTaskFactory.Oa(this.$.da,456,457,this.Xa),Jb=>{C.TaskExtensions.za(Jb.result.OGj(),tc=>{this.KHe(tc.result)},this.$.la,3)},this.$.la,3):this.KHe(!0)}KHe(Jb){this.nb(this.$.da.Aa(458)||this.$.da.Ha(458,new Qa(Jb)))}static ka(Jb){Jb.da.Ha(459,
new Oa(Jb))}}Object(b.a)(Oa,"LineageCatchUpExperimentManagerFactory",f.a,[]);var bb=a(422),Ga=a(33),tb=a(83),wb=a(151),lb=a(122);class db{}Object(b.a)(db,"LineageClientParams",null,[]);class Pa{}Object(b.a)(Pa,"LineageFilter",null,[]);var ja=a(65),Ka=a(68),ub=a(127),Kb=a(41),W=a(193),za=a(113),Sa=a(114),Wa=a(249),ab=a(282),ma=a(21),ha=a(128),eb=a(60);const ta=(Jb,tc,fd,Ad,me,Vd,oe,Me=null)=>{Me=Jb.Na(1,Me);Me.clientParams=tc;Me.lineageFilter=fd;return eb.g(Jb,"LineageOpenPaneOrChangeFilter",Me,Ad,
me,Vd,oe,0)},ya=(Jb,tc,fd,Ad,me,Vd,oe=null)=>{oe=Jb.Na(1,oe);oe.fetchFromBelow=tc;return eb.g(Jb,"LineageLoadMore",oe,fd,Ad,me,Vd,0)},sb=(Jb,tc,fd,Ad,me,Vd=null)=>{Vd=Jb.Na(1,Vd);return eb.g(Jb,"LineageRefreshView",Vd,tc,fd,Ad,me,0)},Qb=(Jb,tc,fd,Ad,me,Vd=null)=>{Vd=Jb.Na(1,Vd);return eb.g(Jb,"LineageUpdateView",Vd,tc,fd,Ad,me,0)},oc=(Jb,tc,fd,Ad,me,Vd=null)=>{Vd=Jb.Na(1,Vd);return eb.g(Jb,"LineageClosePane",Vd,tc,fd,Ad,me,0)},kb=(Jb,tc,fd,Ad,me,Vd=null)=>{Vd=Jb.Na(1,Vd);return eb.g(Jb,"LineageHidePreviousHistory",
Vd,tc,fd,Ad,me,0)},jb=(Jb,tc,fd,Ad,me,Vd=null)=>{Vd=Jb.Na(1,Vd);return eb.g(Jb,"LineageLoadInGridBlueDots",Vd,tc,fd,Ad,me,0)},Wb=(Jb,tc,fd,Ad,me,Vd=null)=>{Vd=Jb.Na(1,Vd);return eb.g(Jb,"LineageGetOriginalBlueDotsUidList",Vd,tc,fd,Ad,me,4)};var wc=a(52),Jc=a(346);class zc{constructor(){this.activityList=null;this.oldestActivityId=this.latestActivityId=0;this.lastSearchedActivityTimestamp=null;this.serverLastActivityId=this.serverFirstActivityId=this.serverMessageCode=0;this.docId=null;this.showLoadPrevious=
!1;this.eolPersonHideHistory=this.eolDateHideHistory=this.eolCorrelationId=null}}Object(b.a)(zc,"LineageActivitiesResponseDTO",null,[]);class gd extends zc{constructor(){super();this.hasNewActivities=!1;this.filterSheetMultiRange=null}}Object(b.a)(gd,"LineageActivitiesUpdateResponseDTO",zc,[]);class Va{constructor(){this.shouldShowBlueDot=this.onDisplayInGridHighlightsChanged=this.areInGridHighlightsEnabled=this.areInGridHighlightsAvailable=this.onDegradedCardGiveFeedbackButtonClicked=this.onLearnMoreLinkClicked=
this.isFeatureEnabled=this.onRangeFilterInputEnabled=this.tryParseRangeInfo=this.onVersionHistoryButtonClicked=this.onCardSelected=this.lineageUpdateViewRequest=this.lineageRefreshViewRequest=this.lineageLoadMoreRequest=this.lineageOpenPaneOrChangeFilterRequest=null}}Object(b.a)(Va,"LineageAppCallbacks",null,[]);class Eb{constructor(){this.imageUrl=this.email=this.displayName=this.provider=this.id=null}}Object(b.a)(Eb,"LineageAuthorDTO",null,[]);class hc{constructor(){this.logger=this.uiCulture=this.dataCulture=
null;this.clientBatchSize=0;this.lineageAppCallbacks=this.filterableSheetList=null}}Object(b.a)(hc,"LineageControllerFactoryParams",null,[]);class Ab{constructor(){this.lastCol=this.firstCol=this.lastRow=this.firstRow=0}}Object(b.a)(Ab,"LineageSharedRangeDTO",null,[]);class Bb{constructor(){this.sheetName=this.rangeList=null}}Object(b.a)(Bb,"LineageSheetMultiRangeDTO",null,[]);class ec{constructor(){this.activityId=0;this.displayTimestamp=this.author=this.activityGuid=null;this.activityType=0;this.rangeHighlightLocation=
this.isBulkEditOverflow=this.valueChanges=this.gridLocation=this.sheetName=this.nestedActivityList=null;this.degradedCardTypeBits=0}}Object(b.a)(ec,"LineageUserActivityDTO",null,[]);class Qd{constructor(){this.hasOldValue=this.hasNewValue=!1;this.cellLocation=this.oldValue=this.newValue=null}}Object(b.a)(Qd,"LineageValueChangeDTO",null,[]);var dc;(function(Jb){Jb[Jb.default=0]="default";Jb[Jb.D48X48=1]="D48X48";Jb[Jb.D64X64=2]="D64X64";Jb[Jb.D96X96=3]="D96X96";Jb[Jb.D120X120=4]="D120X120";Jb[Jb.D240X240=
5]="D240X240";Jb[Jb.D360X360=6]="D360X360";Jb[Jb.D432X432=7]="D432X432";Jb[Jb.D504X504=8]="D504X504";Jb[Jb.D648X648=9]="D648X648"})(dc||(dc={}));Object(b.b)("ProfilePhotoDimension",dc);const dd=(Jb,tc)=>{let fd=[];for(const ae of Jb){Jb=ae;var Ad=tc,me=Object(U.a),Vd=new ec,oe=Number.parseLocale(Jb.UserActivity.Id),Me=Jb.Uid,cb=Jb.UserActivity.Type;var Mb=Jb.UserActivity.Person;var kc=Ad;if(Mb){var Uc=null;e.AFrameworkApplication.fa.pa("IsUserProfilePictureResolutionEnabled")&&(Uc=kc.rta(Mb.Email,
Mb.Provider,e.AFrameworkApplication.vi,dc.default));Mb=Object(U.a)(new Eb,{id:Mb.Id,provider:Mb.Provider,displayName:Mb.DisplayName,email:Mb.Email,imageUrl:Uc})}else Mb=null;kc=Jb.SheetName;Uc=new Date(Jb.UserActivity.DisplayTimestamp);var qd=Jb.DisplayLocation,va=Jb.LineageValueChangeList;var rb=[];for(const Wd of va)va=Object(U.a)(new Qd,{hasNewValue:Wd.HasNewValue,hasOldValue:Wd.HasOldValue,newValue:Wd.HasNewValue?Wd.NewValue:null,oldValue:Wd.HasOldValue?Wd.OldValue:null,cellLocation:Wd.CellLocation}),
rb.push(va);va=Jb.IsBulkEditOverFlow;a:{var fc=Jb.UserActivity.LocationList;var Nc=Jb.UserActivity.Type;if(!fc){d.ULS.sendTraceTag(512259102,0,15,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is null");Nc=null;break a}if(!fc.length){d.ULS.sendTraceTag(512259101,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is empty");Nc=null;break a}var hd=[],xd=[];let Wd="";21===Nc?xd.push(fc[0]):xd=fc;for(const Ne of xd)switch(Ne.Type){case 1:break;case 2:Wd=Ne.SheetName;
break;case 0:fc=Ne;if(!fc.RangeList){d.ULS.sendTraceTag(512259099,0,50,"LineageManagerUtil:: RangeHighlightLocation.RangeActivityLocation is null");break}Wd=fc.RangeList[0].SheetName;xd=[];21===Nc?xd.push(fc.RangeList[0]):xd=fc.RangeList;for(const Ue of xd)fc=Object(U.a)(new Ab,{firstCol:Ue.FirstColumn,firstRow:Ue.FirstRow,lastRow:Ue.LastRow,lastCol:Ue.LastColumn}),hd.push(fc);break;default:d.ULS.sendTraceTag(512259098,0,50,"LineageManagerUtil:: RangeHighlightLocation.ActivityLocationList is of type: ",
Ne.Type)}Nc=Object(U.a)(new Bb,{sheetName:Wd,rangeList:hd})}Ad=(hd=Jb.NestedActivityList)?dd(hd,Ad):null;Jb=me(Vd,{activityId:oe,activityGuid:Me,activityType:cb,author:Mb,sheetName:kc,displayTimestamp:Uc,gridLocation:qd,valueChanges:rb,isBulkEditOverflow:va,rangeHighlightLocation:Nc,nestedActivityList:Ad,degradedCardTypeBits:Jb.DegradedCardTypeBits});25===Jb.activityType?(me=[],jd(Jb,me),fd=[...fd,...me]):fd.push(Jb)}return fd},jd=(Jb,tc)=>{25===Jb.activityType?Jb.nestedActivityList.forEach(fd=>{fd&&
jd(fd,tc)}):tc.push(Jb)};class md{constructor(Jb,tc,fd,Ad,me){this.k3a=this.aD=null;this.fE=this.LNa=0;this.tGb=()=>{this.m7&&(this.m7.stop(),this.m7=null);this.qNb.start();this.aD.createLineageTaskPane(this.Wvd,this.k3a,this.activityGuid)};this.onBlueDotDismissed=()=>{this.aD.onBlueDotDismissed()};this.lineageOpenPaneOrChangeFilterRequest=(Vd,oe)=>{this.qNb.stop();ha.b(this.$).rd(ub.a.oWi,{});this.mVd();const Me=Object(U.a)(new db,{ClientViewCapacity:Vd.clientViewCapacity});let cb=null;oe&&(cb=Object(U.a)(new Pa,
{FilterSheetMultiRange:this.kVj(oe.filterSheetMultiRange)}));const Mb=kc=>{kc=za.a.Pe(kc.data);d.ULS.sendTraceTag(537155481,0,50,`LineageManager::LineageOpenPaneOrChangeFilter service call failed. Errors: [${P.a.nc(kc)}]`)};this.$.userOperationManager.Jc(new W.a(1010,0,(kc,Uc,qd)=>ta(this.$.oa.xa,Me,cb,ab.b(kc,this.vhd("LineageOpenPaneOrChangeFilter")),ab.a(Uc,Mb),qd,null),80),null)};this.lineageLoadMoreRequest=Vd=>{ha.b(this.$).rd(ub.a.nWi,{});const oe=Me=>{Me=za.a.Pe(Me.data);d.ULS.sendTraceTag(537155480,
0,50,`LineageManager::LineageLoadMore service call failed. Errors: [${P.a.nc(Me)}]`)};this.$.userOperationManager.Jc(new W.a(1011,0,(Me,cb,Mb)=>ya(this.$.oa.xa,Vd,ab.b(Me,this.vhd("LineageLoadMore")),ab.a(cb,oe),Mb,null),80),null)};this.lineageRefreshViewRequest=()=>{ha.b(this.$).rd(ub.a.pWi,{});const Vd=oe=>{oe=za.a.Pe(oe.data);d.ULS.sendTraceTag(537155479,0,50,`LineageManager::LineageRefreshView service call failed. Errors: [${P.a.nc(oe)}]`)};this.$.userOperationManager.Jc(new W.a(1012,0,(oe,Me,
cb)=>sb(this.$.oa.xa,ab.b(oe,this.vhd("LineageRefreshView")),ab.a(Me,Vd),cb,null),80),null)};this.lineageUpdateViewRequest=()=>{Qb(this.$.oa.xa,Vd=>{if(Vd=Wa.a(Vd)?null:Vd.Result){var oe={["CountOfUpdatedActivities"]:Vd.LineageActivitiesResponse.ActivityList.length};ha.b(this.$).rd(ub.a.qWi,oe);Vd=Object(U.a)(new gd,{activityList:ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?dd(Vd.LineageActivitiesResponse.ActivityList,this.vza):this.nId(Vd.LineageActivitiesResponse.ActivityList),
latestActivityId:Vd.LineageActivitiesResponse.LastSearchedActivityId,oldestActivityId:Vd.LineageActivitiesResponse.FirstSearchedActivityId,serverMessageCode:Vd.LineageActivitiesResponse.LineageResponseCode,lastSearchedActivityTimestamp:new Date(Vd.LineageActivitiesResponse.EcmaLastSearchedDate),hasNewActivities:Vd.HasNewActivities,filterSheetMultiRange:this.aVj(Vd.LineageActivitiesResponse.FilterSheetMultiRange),serverFirstActivityId:Vd.LineageActivitiesResponse.ServerFirstActivityId,serverLastActivityId:Vd.LineageActivitiesResponse.ServerLastActivityId,
showLoadPrevious:Vd.LineageActivitiesResponse.ShowLoadPrevious,eolCorrelationId:Vd.LineageActivitiesResponse.EolCorrelationId,eolDateHideHistory:new Date(Vd.LineageActivitiesResponse.EolDateHideHistory),eolPersonHideHistory:this.Fxb(Vd.LineageActivitiesResponse.EolPersonHideHistory)});this.aD.onLineageActivitiesUpdateResponse(Vd)}else d.ULS.shipAssertTag(537155475,0,!!Vd,"LineageManager.LineageUpdateView returned null response.")},Vd=>{Vd=za.a.Pe(Vd.data);d.ULS.sendTraceTag(537155474,0,50,`LineageManager::LineageUpdateView service call failed. Errors: [${P.a.nc(Vd)}]`)},
null,null)};this.areInGridHighlightsAvailable=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsAvailable();this.areInGridHighlightsEnabled=()=>this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled();this.onDisplayInGridHighlightsChanged=Vd=>{this.blueDotManager&&this.blueDotManager.Ezj(Vd)};this.onCardSelected=(Vd,oe)=>{var Me,cb;if(null===(Me=this.blueDotManager)||void 0===Me?0:Me.shouldShowBlueDot(Vd.activityGuid))null===(cb=this.blueDotManager)||void 0===cb?void 0:
cb.X1a(Vd.activityGuid);if(Vd=Vd.rangeHighlightLocation){if(oe){if(({range:Me}=Kb.Y(oe,ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7236999_passEwaSheetsInLineageManager")?this.$.va:null)).returnValue){this.ycf(Vd.sheetName,this.Oxb([Kb.j(Me)]));return}d.ULS.shipAssertTag(537155472,0,!1,"The produced subCellLocation string "+oe+" is not valid.")}Vd.rangeList.length?this.ycf(Vd.sheetName,Vd.rangeList):this.kdi(Vd.sheetName)}};this.onLearnMoreLinkClicked=()=>{const Vd=new V.a(-859308420,Ka.a.zb,this.$.xc,
12,null);this.$.Ia.Hb(Vd,{[Ka.a.Pf]:"HelpID=XLO_LineageTS",["InputMethod"]:Ka.a.zb,[Ka.a.Kc]:mc.a.WU,["ShouldCanvasTakeFocus"]:!0})};this.onVersionHistoryButtonClicked=Vd=>{this.$.Ia.Hb(new V.a(-1112508866,Vd,this.$.xc,12,null))};this.onDegradedCardGiveFeedbackButtonClicked=()=>{const Vd={};Vd[mc.a.wM]="LineageDegradedCard";this.$.Yc(802602464,0,12,Vd)};this.isFeatureEnabled=Vd=>{switch(Vd){case "FlattenListInLineageManager":return ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager");
default:return!1}};this.tf=()=>{const Vd=this.$.ea.Qn.LineageVersion;Vd!==this.LNa&&(d.ULS.sendTraceTag(537155470,0,50,`LineageManager.OnWorkbookMetadataChanged: lineageVersion: ${Vd}, this.lineageVersion: ${this.LNa}`),this.LNa=Vd,this.cfj())};this.Rc=(Vd,oe)=>{this.aD&&!this.lineageTaskPane.wic&&oe.oH&&(d.ULS.sendTraceTag(587220563,0,15,"LineageManager::SessionIdChanged detected."),this.onStaleActivitiesDetected())};this.Ao=()=>{this.aD&&!this.lineageTaskPane.wic&&(d.ULS.sendTraceTag(587220562,
0,15,"LineageManager::LoadOnDemandOccurred detected."),this.onStaleActivitiesDetected())};this.mD=()=>{const Vd=this.W4a();this.aD.onFilterableSheetListChange(Vd)};this.Sya=()=>{const Vd=this.W4a();this.aD.onFilterableSheetListChange(Vd)};this.yqc=()=>{const Vd=this.W4a();this.aD.onFilterableSheetListChange(Vd)};this.onPaneClosed=()=>{this.aD.onPaneClosed();oc(this.$.oa.xa,null,Vd=>{Vd=za.a.Pe(Vd.data);d.ULS.sendTraceTag(537155469,0,50,`LineageManager::OnLineageClosePaneFailed service call failed. Errors: [${P.a.nc(Vd)}]`)},
null,null)};this.onRangeFilterInputEnabled=Vd=>{Vd?this.gridView.ha.rT(this.Uc):this.gridView.ha.AR(this.Uc)};this.Uc=()=>{var Vd=Kb.q(this.gridView.ha.qa.activeRange,this.$);Vd=Object(U.a)(new Bb,{rangeList:this.Oxb(Vd.Ranges),sheetName:Vd.SheetName});this.aD.onSelectedRangeUpdated(Vd)};this.tryParseRangeInfo=Vd=>{let oe;if(({sheetName:oe,range:Vd}=Kb.Y(Vd,this.$.va)).returnValue){oe||(oe=this.$.va.na.sheetName);const Me=[];Me.push(Vd);Vd=Kb.u(oe,null,Me);return Object(U.a)(new Bb,{rangeList:this.Oxb(Vd.Ranges),
sheetName:Vd.SheetName})}return null};this.xz=()=>{const Vd=this.fE!==this.$.ea.se;this.aD&&this.lineageTaskPane.isVisible&&Vd&&(this.fE=this.$.ea.se,this.aD.onRefreshRequired())};this.$=Jb;tc.Ha(366,this);this.blueDotManager=Ad;this.gridView=ma.h(this.$);this.lineageTaskPane=fd;this.Wvd=this.lineageTaskPane.YT();this.batchSize=50;this.m7=me;this.qNb=this.$.Jb.zg("UserAction","LineagePaneLoadingShimmerStopWatch");this.vza=tb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Rhi();
this.ZIg()}dispose(){this.eij();this.$=null;this.lineageTaskPane&&(this.lineageTaskPane.lW(this.onPaneClosed),this.lineageTaskPane.BF(this.xz),this.lineageTaskPane=null);this.qNb=this.vza=this.k3a=this.Wvd=this.aD=null}e$f(Jb,tc,fd,Ad){this.activityGuid=null;if(this.lineageTaskPane.isVisible){if(9===fd){d.ULS.sendTraceTag(560989858,0,50,"LineageManager::ShowLineageTaskPane open from callout was invoked with an opened pane");return}if(!Jb&&16!==fd&&18!==fd&&30!==fd){this.lineageTaskPane.g3c();return}}Ga.a.Ad(this.$)||
(this.qNb.start(),this.m7&&(wc.b().cC(this.qNb.id,this.m7.id,"actions","actions"),this.m7.stop(),this.m7=null));this.lineageTaskPane.wic||d.ULS.sendTraceTag(537155482,0,50,`LineageManager::ShowLineageTaskPane pane reopened by user via ${Jb?tc:fd}`);this.fE=this.$.ea.se;this.k3a=null;Jb?(Jb=Kb.r(this.gridView.ha.qa.selectedRanges,this.$),this.k3a=Object(U.a)(new Bb,{rangeList:tc.toString()===mc.a.y9f?this.Oxb(Jb.Ranges):null,sheetName:Jb.SheetName})):ba.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&
30===fd&&this.f8i(Ad);Ga.a.Ad(this.$)&&this.lineageTaskPane.wic?this.lineageTaskPane.Yzj(this.tGb):this.aD.createLineageTaskPane(this.Wvd,this.k3a,this.activityGuid);this.lineageTaskPane.Kg(!0);this.$.Yc(-71295319,-1,0,null)}f8i(Jb){if(Jb){var tc=Jb.sheetRanges;Jb=Jb.activityGuid;tc&&Jb?(this.activityGuid=Jb,this.k3a=this.eVh(tc)):d.ULS.shipAssertTag(509752709,0,!1,"Blue dot gridLocation/activityGuid is not set.")}else d.ULS.shipAssertTag(509752710,0,!1,"Blue dot unexpected undefined properties for command handling.")}lineageHidePreviousHistory(){const Jb=
{["paneVisible"]:this.lineageTaskPane.isVisible};wb.a.sendTelemetryEvent(Object(U.a)(new Jc.a,{name:"Office.Excel.Online.Lineage.ClearHistoryConfirmed",dataFields:lb.a.Mi(Jb)}));this.$.userOperationManager.Jc(new W.a(1018,0,(tc,fd,Ad)=>kb(this.$.oa.xa,tc,fd,Ad,null),64),null);this.lineageTaskPane.isVisible||this.e$f(!1,null,4,void 0)}Rhi(){const Jb=Object(U.a)(new Va,{tryParseRangeInfo:this.tryParseRangeInfo,isFeatureEnabled:this.isFeatureEnabled,onCardSelected:this.onCardSelected,onVersionHistoryButtonClicked:this.onVersionHistoryButtonClicked,
onRangeFilterInputEnabled:this.onRangeFilterInputEnabled,onLearnMoreLinkClicked:this.onLearnMoreLinkClicked,onDegradedCardGiveFeedbackButtonClicked:this.onDegradedCardGiveFeedbackButtonClicked,lineageOpenPaneOrChangeFilterRequest:this.lineageOpenPaneOrChangeFilterRequest,lineageLoadMoreRequest:this.lineageLoadMoreRequest,lineageRefreshViewRequest:this.lineageRefreshViewRequest,lineageUpdateViewRequest:this.lineageUpdateViewRequest,areInGridHighlightsAvailable:this.areInGridHighlightsAvailable,areInGridHighlightsEnabled:this.areInGridHighlightsEnabled,
onDisplayInGridHighlightsChanged:this.onDisplayInGridHighlightsChanged,shouldShowBlueDot:tc=>{var fd,Ad;return null!==(Ad=null===(fd=this.blueDotManager)||void 0===fd?void 0:fd.shouldShowBlueDot(tc))&&void 0!==Ad?Ad:!1}});ua.a(()=>{this.aD=cellLineage.LineageActivityControllerFactoryGlobal.createLineageActivityController(Object(U.a)(new hc,{clientBatchSize:this.batchSize,filterableSheetList:this.W4a(),uiCulture:this.$.ya.UICultureTag,dataCulture:this.$.ya.DataCultureTag,logger:new D.a,lineageAppCallbacks:Jb}))})}eVh(Jb){const tc=
[],fd=this.$.va.na;for(const Ad of Jb)Ad.sheetId===fd.sheetId&&(Jb=Kb.j(Ad.range),Jb=Object(U.a)(new Ab,{firstCol:Jb.FirstColumn,firstRow:Jb.FirstRow,lastCol:Jb.LastColumn,lastRow:Jb.LastRow}),tc.push(Jb));return Object(U.a)(new Bb,{rangeList:tc,sheetName:fd.sheetName})}vhd(Jb){return tc=>{if(tc=Wa.a(tc)?null:tc.Result){var fd={["CountOfActivities"]:tc.ActivityList.length};fd.WebRequestName=Jb;ha.b(this.$).rd(ub.a.PTi,fd);tc=Object(U.a)(new zc,{activityList:ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7124981_HandleFlatteningActivitiesInLineageManager")?
dd(tc.ActivityList,this.vza):this.nId(tc.ActivityList),latestActivityId:tc.LastSearchedActivityId,oldestActivityId:tc.FirstSearchedActivityId,serverMessageCode:tc.LineageResponseCode,lastSearchedActivityTimestamp:new Date(tc.EcmaLastSearchedDate),serverFirstActivityId:tc.ServerFirstActivityId,serverLastActivityId:tc.ServerLastActivityId,showLoadPrevious:tc.ShowLoadPrevious,eolCorrelationId:tc.EolCorrelationId,eolDateHideHistory:new Date(tc.EolDateHideHistory),eolPersonHideHistory:this.Fxb(tc.EolPersonHideHistory)});
this.aD.onLineageActivitiesResponse(tc)}else d.ULS.shipAssertTag(537155477,0,!!tc,"LineageManager."+Jb+" returned null response.")}}aVj(Jb){return Sa.e(Jb.Ranges)&&!Jb.SheetName?null:Object(U.a)(new Bb,{rangeList:this.Oxb(Jb.Ranges),sheetName:Jb.SheetName})}Oxb(Jb){const tc=[];for(const fd of Jb)Jb=Object(U.a)(new Ab,{firstCol:fd.FirstColumn,firstRow:fd.FirstRow,lastRow:fd.LastRow,lastCol:fd.LastColumn}),tc.push(Jb);return tc}kVj(Jb){if(!Jb)return null;const tc={};tc.Ranges=this.yid(Jb.rangeList);
tc.SheetName=Jb.sheetName;return tc}yid(Jb){const tc=[];if(Sa.e(Jb))return tc;for(const fd of Jb)Jb={},Jb.FirstColumn=fd.firstCol,Jb.FirstRow=fd.firstRow,Jb.LastRow=fd.lastRow,Jb.LastColumn=fd.lastCol,tc.push(Jb);return tc}kdi(Jb){(Jb=this.$.va.getItemByName(Jb))&&Jb.visible&&Jb.activate(!0)}ycf(Jb,tc){const fd=[];for(var Ad of tc)tc={},tc.FirstColumn=Ad.firstCol,tc.FirstRow=Ad.firstRow,tc.LastRow=Ad.lastRow,tc.LastColumn=Ad.lastCol,fd.push(Kb.D(tc));Ad=fd.length-1;tc=fd[Ad].topLeft;ma.h(this.$).l4(fd,
Ad,Jb,null,tc,null,null,3,"LineageManager.OnCardSelected",void 0,void 0,void 0,!0)}cfj(){this.aD&&this.lineageTaskPane.isVisible&&(this.fE=this.$.ea.se,this.aD.onRefreshRequired())}ZIg(){var Jb;this.lineageTaskPane.pT(this.onPaneClosed);this.lineageTaskPane.kE(this.xz);this.$.ea.$t(this.tf);this.$.ea.Jj(this.Rc);this.$.ea.TL(this.Ao);const tc=this.$.va;tc.fY(this.mD);tc.Nga(this.yqc);tc.aGa(this.Sya);tc.YYa(this.yqc);null===(Jb=this.blueDotManager)||void 0===Jb?void 0:Jb.Bqe(this.onBlueDotDismissed)}eij(){var Jb;
this.$.ea.Av(this.tf);this.gridView.ha.AR(this.Uc);this.$.ea.ik(this.Rc);this.$.ea.yR(this.Ao);const tc=this.$.va;tc.N6(this.mD);tc.bna(this.yqc);tc.HQa(this.Sya);tc.VJb(this.yqc);null===(Jb=this.blueDotManager)||void 0===Jb?void 0:Jb.kWf(this.onBlueDotDismissed)}onStaleActivitiesDetected(){this.aD.onStaleActivitiesDetected()}W4a(){const Jb=this.$.va.items,tc=[];for(const fd of Jb)fd.visible&&!ja.e(fd)&&tc.push(fd.sheetName);return tc}mVd(){if(ba.EwaSettings.ra(527)){var Jb=this.$.da.Aa(403);Jb&&
Jb.disable();Jb=new V.a(-847286761,Ka.a.zb,this.$.xc,0,mc.a.Q_);this.$.Ia.Hb(Jb,{["InputMethod"]:Ka.a.zb,CalloutName:5})}}nId(Jb){const tc=[];for(const fd of Jb)Jb=Object(U.a)(new ec,{activityId:Number.parseLocale(fd.UserActivity.Id),activityGuid:fd.Uid,activityType:fd.UserActivity.Type,author:this.Fxb(fd.UserActivity.Person),sheetName:fd.SheetName,displayTimestamp:new Date(fd.UserActivity.DisplayTimestamp),gridLocation:fd.DisplayLocation,valueChanges:this.j$i(fd.LineageValueChangeList),isBulkEditOverflow:fd.IsBulkEditOverFlow,
rangeHighlightLocation:this.W9i(fd.UserActivity.LocationList,fd.UserActivity.Type),nestedActivityList:this.P9i(fd.NestedActivityList),degradedCardTypeBits:fd.DegradedCardTypeBits}),tc.push(Jb);return tc}W9i(Jb,tc){if(!Jb)return d.ULS.sendTraceTag(537155468,0,15,"LineageManager:: RangeHighlightLocation.ActivityLocationList is null"),null;if(!Jb.length)return d.ULS.sendTraceTag(537155467,0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is empty"),null;const fd=[];var Ad=[];let me=
"";21===tc?Ad.push(Jb[0]):Ad=Jb;for(const Vd of Ad)switch(Vd.Type){case 1:break;case 2:me=Vd.SheetName;break;case 0:Jb=Vd;if(!Jb.RangeList){d.ULS.sendTraceTag(537155465,0,50,"LineageManager:: RangeHighlightLocation.RangeActivityLocation is null");break}me=Jb.RangeList[0].SheetName;Ad=[];21===tc?Ad.push(Jb.RangeList[0]):Ad=Jb.RangeList;for(const oe of Ad)Jb=Object(U.a)(new Ab,{firstCol:oe.FirstColumn,firstRow:oe.FirstRow,lastRow:oe.LastRow,lastCol:oe.LastColumn}),fd.push(Jb);break;default:d.ULS.sendTraceTag(537155464,
0,50,"LineageManager:: RangeHighlightLocation.ActivityLocationList is of type: ")}return Object(U.a)(new Bb,{sheetName:me,rangeList:fd})}j$i(Jb){const tc=[];for(const fd of Jb)Jb=Object(U.a)(new Qd,{hasNewValue:fd.HasNewValue,hasOldValue:fd.HasOldValue,newValue:fd.HasNewValue?fd.NewValue:null,oldValue:fd.HasOldValue?fd.OldValue:null,cellLocation:fd.CellLocation}),tc.push(Jb);return tc}P9i(Jb){return Jb?this.nId(Jb):null}Fxb(Jb){if(!Jb)return null;let tc=null;e.AFrameworkApplication.fa.pa("IsUserProfilePictureResolutionEnabled")&&
(tc=this.vza.rta(Jb.Email,Jb.Provider,e.AFrameworkApplication.vi,0));return Object(U.a)(new Eb,{id:Jb.Id,provider:Jb.Provider,displayName:Jb.DisplayName,email:Jb.Email,imageUrl:tc})}}Object(b.a)(md,"LineageManager",null,[409,2]);class vd extends f.a{constructor(Jb){super();this.m7=this.lineageTaskPane=null;this.$=Jb;this.Db()}Lqf(Jb,tc){C.TaskExtensions.za(Jb,()=>{this.nb(this.$.da.Aa(366)||new md(this.$,this.$.da,this.lineageTaskPane,tc,this.m7))},this.$.la,3)}create(){this.m7=this.$.Jb.Gc("UserAction",
"LineagePaneSeenStopwatch");this.m7.start();const Jb=v.GetServiceTaskFactory.Oa(this.$.da,365,364,this.Xa),tc=bb.a(this.$);let fd;fd=ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?R.c(wa.a.resolve(na.e,{Tl:this.Xa})):v.GetServiceTaskFactory.Oa(this.$.da,283,284,this.Xa);if(ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const Ad=v.GetServiceTaskFactory.Oa(this.$.da,501,500,0);C.TaskExtensions.za(C.TaskExtensions.Fd([Jb,tc,fd,Ad],this.$.la),
()=>{this.lineageTaskPane=Jb.result;Ga.a.Ad(this.$)||tc.result.GQ(this.lineageTaskPane);this.Lqf(R.c(fd.result.Hl.loadScript("cellLineage")),Ad.result)},this.$.la,3)}else C.TaskExtensions.za(C.TaskExtensions.Fd([Jb,tc,fd],this.$.la),()=>{this.lineageTaskPane=Jb.result;Ga.a.Ad(this.$)||tc.result.GQ(this.lineageTaskPane);this.Lqf(R.c(fd.result.Hl.loadScript("cellLineage")),null)},this.$.la,3)}static ka(Jb){Jb.da.Ha(367,new vd(Jb))}}Object(b.a)(vd,"LineageManagerFactory",f.a,[]);var wd=a(802),Pd=a(227),
ic=a(14),cd=a(110),Hd=a(264),he=a(86),Lb=a(239),Ic=a(19),Ob=a(719);const Kc=mc.a.aYd+"LineageActivityPaneTitle",Ac=mc.a.KOb+"LineageActivityCloseButton";class Yc extends Lb.a{constructor(Jb,tc,fd){super(Jb);this.tGb=this.DDe=this.ye=null;this.Rrd=!0;this.Hv=0;this.Bs=!1;this.uc=(Ad,me)=>{me.Bf||this.g3c()};this.ll=()=>{this.g3c();return!0};this.$=tc;this.taskPaneManager=fd;this.$.nj(this.uc);ra.a(this.$).Yh(this);Ga.a.Ad(this.$)&&(this.isVisible=!1)}qT(Jb){this.get_events().addHandler("LineageTaskPaneRemove",
Jb)}mW(Jb){this.get_events().removeHandler("LineageTaskPaneRemove",Jb)}kE(Jb){this.addHandler("LineageTaskPaneVisibilityChanged",Jb)}BF(Jb){this.removeHandler("LineageTaskPaneVisibilityChanged",Jb)}pT(Jb){this.get_events().addHandler("LineageTaskPaneClose",Jb)}lW(Jb){this.get_events().removeHandler("LineageTaskPaneClose",Jb)}get isVisible(){return super.isVisible}set isVisible(Jb){super.isVisible!==Jb&&(super.isVisible=Jb,this.raiseEvent("LineageTaskPaneVisibilityChanged"))}get wic(){return this.Rrd}get Ff(){return this.isVisible}get Jh(){return 15}get Xd(){return O.a.iAi}get ek(){return Ic.a.RAh}get AQ(){return qb.a.instance.ga(1076)}get Vp(){return 300}get isResizable(){return!1}get jc(){return this.domElement}get height(){return this.taskPaneManager.rO.offsetHeight}get titleText(){return qb.a.instance.ga(1293)}get FB(){return this.taskPaneManager.Vua(this.jc,
this.titleText,this.Vp,this.isResizable,()=>{this.isVisible=!0;this.tGb?this.tGb():d.ULS.shipAssertTag(537155462,0,!1,"OnLineagePaneOpened callback not set.")},()=>{this.isVisible=!1},()=>{this.isVisible=!0},()=>{this.isVisible=!1},this.Vp)}Cq(){return this.Bs}wt(){return this.Bs}IV(){}TU(){return!1}rj(){}dk(){}dispose(){this.$&&(this.$.ol(this.uc),ra.a(this.$).Ez(this));this.ye&&(Pd.a.instance.Ba(ic.a.click,this.ye,this.ll),cd.KeyInputManager.instance.Xw(this.ye,this.DDe));this.ye=this.taskPaneManager=
this.$=null;super.dispose()}ag(Jb,tc){if(!tc){Jb=da.DOMElementExtensions.getElementById(this.domElement,"LineagePaneFilterButton");if(!Jb)return!1;da.DOMElementExtensions.setFocus(Jb)}return!tc}sh(Jb){return da.DOMElementExtensions.Af(this.jc,Jb)}Kg(Jb){this.Bs=Jb;const tc=this.taskPaneManager;if(this.isVisible=Jb)this.$.frame.Le.Qj("LineagePane"),this.Rrd=!1;if(Ga.a.Ad(this.$))Jb?tc.q6("LineageTaskPane",this.FB):tc.hideTaskPane("LineageTaskPane");else{this.taskPaneManager.HB();const fd=!!this.taskPaneManager.Ch&&
15===this.taskPaneManager.Ch.taskPane.Jh;Jb&&0<tc.GD.length&&(!fd||tc.isCollapsed)&&tc.hI(this,!0)}this.$.qf()}YT(){var Jb=this.$.Bb;Jb=Ga.a.Ad(this.$)?this.domElement:document.getElementById(Jb+mc.a.$vd);var tc=this.pM();Jb.appendChild(tc);tc=Ob.b("div","LineagePaneBodyId","LineageActivityBody");Jb.appendChild(tc);this.Zzj();return tc}g3c(){this.$.frame.Le.Qj(this.$.frame.Le.HE||Hd.AFrame.wT);this.Rrd=!0;this.Kg(!1);this.raiseEvent("LineageTaskPaneClose")}Yzj(Jb){this.tGb=Jb}Zzj(){this.$.frame.Le.kk("LineagePane");
const Jb=this.$.frame.Le.pi("LineagePane");Jb.parent=Hd.AFrame.wT;Jb.gN=!0}pM(){const Jb=Ob.b("div","LineagePaneHeaderId","LineageActivityPaneHeader"),tc=Ob.b("h1","LineagePaneTitleId",Kc);tc.innerText=this.titleText;this.ye=wd.a.pb("LineagePaneCloseButtonId",Ac,qb.a.instance.ga(10),"ClosePaneGlyph_16x16x32",!1);this.ye.classList.add(e.AFrameworkApplication.isRtl?mc.a.Xia:mc.a.Yia);Pd.a.instance.ta(ic.a.click,this.ye,this.ll);this.DDe=cd.KeyInputManager.instance.Dt(this.ye,this.ll,he.a.Lh);Jb.appendChild(tc);
Jb.appendChild(this.ye);return Jb}static ka(Jb,tc){const fd=Jb.Bb;let Ad=document.getElementById(fd+mc.a.$vd);Ad||(Ad=document.createElement("div"),Ad.id=Jb.Bb+mc.a.$vd,Ad.classList.add("LineageActivityPane"),Ga.a.Ad(Jb)||document.getElementById(fd+mc.a.AV).appendChild(Ad));return Jb.da.Aa(365)||Jb.da.Ha(365,new Yc(Ad,Jb,tc))}}Object(b.a)(Yc,"LineageTaskPane",Lb.a,[412,2,262,54]);class td extends f.a{constructor(Jb){super();this.Yg=this.$h=null;this.$=Jb;this.Db()}get pD(){this.$h||(this.$h=C.TaskExtensions.za(bb.a(this.$),
Jb=>{this.Yg=Yc.ka(this.$,Jb.result)},this.la,3));return this.$h}create(){const Jb=v.GetServiceTaskFactory.create(this.$.da,203,this.la,this.Xa),tc=v.GetServiceTaskFactory.create(this.$.da,155,this.la,this.Xa);C.TaskExtensions.za(C.TaskExtensions.ts(C.TaskExtensions.Fd([Jb,tc],this.la),()=>this.pD,this.la),()=>{this.nb(this.Yg)},this.la,3)}dispose(){this.Yg=this.$h=this.$=null;super.dispose()}static ka(Jb){Jb.da.Ha(364,new td(Jb))}}Object(b.a)(td,"LineageTaskPaneFactory",f.a,[]);class $d{constructor(Jb,
tc){this.wsd=!1;this.tf=()=>{this.ugg()};this.$=Jb;ba.EwaSettings.ra(527)&&this.$.ea.V8a&&!$d.Kyb&&(tc&&!tc.ISa||this.n5j(),$d.Faf?d.ULS.sendTraceTag(537155461,0,50,"LineageTeachingCalloutTriggerManager will not trigger WYWA waterline check as it was already checked in session"):tc&&!tc.ISa||this.u5j());d.ULS.sendTraceTag(537155460,0,50,"LineageTeachingCalloutTriggerManager is initialized.")}dispose(){this.vLd();this.$=null;d.ULS.sendTraceTag(537155459,0,50,"LineageTeachingCalloutTriggerManager is disposed.")}disable(){$d.Kyb||
($d.Kyb=!0,d.ULS.sendTraceTag(578557781,0,50,"LineageTeachingCalloutTriggerManager.Disable as the pane was opened."));this.vLd()}u5j(){ba.EwaSettings.ra(523)&&!this.$.isAnonymousUser()&&eb.i(this.$.oa.xa,Jb=>{this.$?(Jb=Jb.Result,d.ULS.sendTraceTag(578557780,0,50,`CheckLineageWywaChanges service call succeeded, hasnewchanges = ${Jb}.`),$d.Faf=!0,Jb&&this.APb(0)):d.ULS.sendTraceTag(537155458,0,50,"LineageTeachingCalloutTriggerManager.VerifyWaterlineTrigger ignoring server response as class is disposed.")},
()=>{d.ULS.sendTraceTag(537155457,0,10,"CheckLineageWywaChanges service call failed.")},null,null)}n5j(){ba.EwaSettings.ra(522)&&!this.ugg()&&(this.$.ea.$t(this.tf),this.wsd=!0)}ugg(){return this.$.ea&&this.$.ea.Qn&&this.$.ea.Qn.ShouldTriggerLineageCalloutOnMerge?(d.ULS.sendTraceTag(578557778,0,50,"LineageTeachingCalloutTriggerManager.TriggerLineageCalloutOnMerge"),this.APb(1),!0):!1}APb(Jb){$d.Kyb?d.ULS.sendTraceTag(537155456,0,50,"LineageTeachingCalloutTriggerManager.TriggerCallout Will not trigger dialog as it was already shown in session"):
($d.Kyb=!0,d.ULS.sendTraceTag(578557776,0,50,`LineageTeachingCalloutTriggerManager.TriggerCallout triggering callout due to reason ${Jb}.`),this.vLd(),ba.EwaSettings.ra(418)&&(Jb=new V.a(-847286761,Ka.a.zb,this.$.xc,0,mc.a.Q_),this.$.Ia.Hb(Jb,{["CalloutName"]:4})))}vLd(){this.wsd&&(this.wsd=!1,this.$.ea.Av(this.tf))}}$d.Kyb=!1;$d.Faf=!1;Object(b.a)($d,"LineageTeachingCalloutTriggerManager",null,[410,2]);class be extends f.a{constructor(Jb){super();this.$=Jb;this.Db()}create(){C.TaskExtensions.za(v.GetServiceTaskFactory.Oa(this.$.da,
458,459,this.Xa),Jb=>{const tc=Jb.result;Jb=Object(qa.a)(this.$.da,403,()=>new $d(this.$,tc));this.nb(Jb)},this.$.la,3)}static ka(Jb){Jb.da.Ha(402,new be(Jb))}}Object(b.a)(be,"LineageTeachingCalloutTriggerManagerFactory",f.a,[]);var ke=a(892),Pe=a(80);class Dd{constructor(Jb,tc){this.ph=Jb;this.Pu=tc}AW(Jb,tc,fd,Ad=null){return this.Voh(Jb,Ad,me=>this.ph.fob(me,2,fd,tc,void 0,void 0,void 0,void 0,void 0,"2"))}Voh(Jb,tc,fd){const Ad=!!tc&&""!==tc;let me=Jb;Ad&&(me=u.a.mT(Jb,"perfTag",tc));const Vd=
new Date;return ke.a.then(fd(me),oe=>{const Me=+new Date-+Vd;if(!oe||!oe.Cg||!oe.Cg.data)return oe;Ad&&oe.Cg.data.request&&this.Qvj(oe.Cg.data.request.getResolvedUrl(),tc,Me);return oe})}Qvj(Jb,tc,fd){Jb=this.Pu.c2h(Jb);if(Jb.count&&(Jb=Pe.last(Jb))){const Ad={Message:"Request durations for activities calls."};Ad.PerfTag=tc;Ad.CustomDuration=fd;Ad.PerformanceDuration=Jb.duration;d.ULS.sendTraceTag(592189641,3012,50,JSON.stringify(Ad))}}}Object(b.a)(Dd,"CatchUpNetworkingWrapper",null,[527]);var ge=
a(245);class ne extends ge.a{constructor(Jb,tc){super(Jb,tc)}Maa(){return 6}}Object(b.a)(ne,"GetActivityFeedRequest",ge.a,[]);class ce extends ge.a{constructor(Jb,tc,fd,Ad,me,Vd){super(Jb,tc);this.ItemIds=null;this.ActivityStatesToReset=this.ActivityStatesToSet=0;this.ResetUnseenCount=!1;this.ItemIds=fd;this.ActivityStatesToSet=Ad;this.ActivityStatesToReset=me;this.ResetUnseenCount=Vd}Maa(){return 7}}Object(b.a)(ce,"UpdateActivityFeedStateRequest",ge.a,[]);var we=a(391);class ve{constructor(Jb,tc,
fd){this.Yee=Jb;this.NCa=tc;this.eDa=fd}getActivityFeed(Jb){return ke.a.then(this.eDa.execute(new ne(this.NCa(),null),(tc,fd,Ad)=>this.Yee.AW(tc,fd,Ad,"ActivityFeed"),Jb),tc=>{if(!tc)return d.ULS.sendTraceTag(572846937,3012,10,"GetActivityFeed: Response is null"),null;if(!tc.Cg)return d.ULS.sendTraceTag(572846938,3012,10,"GetActivityFeed: Response.Args is null"),null;if(!tc.Cg.data)return d.ULS.sendTraceTag(572846939,3012,10,"GetActivityFeed: Response.Args.Data is null"),null;if(!tc.Cg.data.de)return d.ULS.sendTraceTag(572846940,
3012,10,"GetActivityFeed: Response.Args.Data.ResponseData is null"),null;tc=we.a.EIa(tc.Cg.data.de);return tc?tc:(d.ULS.sendTraceTag(572846941,3012,10,"GetActivityFeed: Deserialized response is null"),null)})}DZj(Jb,tc,fd,Ad){return ke.a.then(this.eDa.execute(new ce(this.NCa(),null,Jb,tc,fd,Ad),(me,Vd,oe)=>this.Yee.AW(me,Vd,oe,"UpdateActivityFeedState"),null),me=>{try{return me.succeeded}catch(Vd){return d.ULS.sendTraceTag(523121054,3012,10,"UpdateActivityFeed: Exception: "+Vd.message),!1}})}}Object(b.a)(ve,
"CatchUpRequestHandler",null,[526]);var Re=a(468);class rf{constructor(Jb){this.hga=Jb;this.Ide=new Re.a}VBi(){this.ICi()}ICi(){if(this.hga){var Jb=tc=>{this.Ide.contains("CatchUpChangesFeedback")||(this.Ide.add("CatchUpChangesFeedback"),tc.logActivity("CatchUpChangesFeedback",null))};this.hga.execute(tc=>{window.setTimeout(()=>{Jb(tc)},2E4)})}else d.ULS.sendTraceTag(571586199,383,15,"FloodgateEventLogger: IFuture<ISystemInitiatedFeedback> was null")}}Object(b.a)(rf,"FloodgateEventLogger",null,[]);
var We=a(192);class Ye{constructor(Jb){this.LBg=Jb}get duration(){return this.LBg.duration}}Object(b.a)(Ye,"PerformanceResourceTimingWrapper",null,[]);class bf{constructor(Jb){this.Pu=Jb}c2h(Jb){const tc=new We.a;if(!this.Pu)return tc;Jb=this.Pu.getEntriesByName(Jb,"resource");if(!Jb)return tc;for(const fd of Jb)tc.add(new Ye(fd));return tc}}Object(b.a)(bf,"PerformanceWrapper",null,[]);var Ve=a(251);class Za{constructor(){this.$a=null}get name(){return"Common.App.CatchUpActivity"}Bh(Jb){this.$a=Jb;
this.$a.register(Dd,"Common.App.CatchUpActivity.CatchUpNetworkingWrapper").as("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper").qc().yc(()=>new Dd(e.AFrameworkApplication.Bd,new bf(window.performance)));this.$a.register(ve,"Common.App.CatchUpActivity.CatchUpRequestHandler").as("Common.App.CatchUpActivity.ICatchUpRequestHandler").qc().yc(()=>new ve(this.$a.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper"),()=>e.AFrameworkApplication.vi,new we.a));this.$a.register(rf,"Common.App.CatchUpActivity.FloodgateEventLogger").qc().yc(()=>
new rf(this.$a.Tb("Common.ISystemInitiatedFeedback")))}init(){this.$a.resolve("Common.App.CatchUpActivity.ICatchUpNetworkingWrapper");this.$a.resolve("Common.App.CatchUpActivity.ICatchUpRequestHandler")}dispose(){}static main(){Ve.a.instance.ii(new Za)}}Object(b.a)(Za,"CatchUpActivityPackage",null,[3,4]);class Xb{constructor(Jb,tc){this.$=Jb;this.catchUpActivityManager=tc}Hc(Jb,tc){return this.catchUpActivityManager?-876699925===tc?!this.catchUpActivityManager.Ygf:!1:!0}executeCommand(Jb,tc){Jb=!1;
switch(tc.command){case -876699925:Jb=this.catchUpActivityManager.F0i();break;case 950288339:return this.catchUpActivityManager.showHideInGridHighlights(),H.Task.Sa(!0)}return Jb?H.Task.Sa(!0):x.a(tc.command)}wc(Jb,tc){return ba.EwaSettings.ra(382)?-876699925===tc.command||950288339===tc.command:!1}Nc(){return!1}}Object(b.a)(Xb,"CatchUpActivityCommandHandler",null,[222]);class ib extends y.a{constructor(Jb){super(Jb)}hd(){this.$.da.gb(286,Jb=>{this.$c([new Xb(this.$,Jb)])})}static ka(Jb){y.a.Md(285,
new ib(Jb))}}Object(b.a)(ib,"CatchUpActivityCommandHandlerFactory",y.a,[]);var Rb=a(161),lc=a(268),nc=a(519),Oc=a(89),Ib=a(84),gc=a(25);class Fc{constructor(Jb){this.hh=Jb}doesContentExist(Jb){if(!Jb)return d.ULS.sendTraceTag(537168066,3012,10,"Null activity: DoesContentExist. Default to false."),!1;switch(Jb.type){case 2:case 3:case 4:case 6:case 8:case 9:case 7:case 10:if(!Jb.navigationId)return d.ULS.sendTraceTag(537168065,3012,10,"Null activity.NavigationId: DoesContentExist. Default to false."),
!1;const tc={};tc.NavigationId=atob(Jb.navigationId);return 32===this.hh.Vd(gc.a.TIa,2,tc);default:return!1}}}Object(b.a)(Fc,"CatchUpActivityContentManager",null,[419]);var Vc=a(839),ed=a(1260);class Sd{constructor(Jb){this.pGb=()=>{switch(this.qw.model.state){case 1:this.q$f(!0);break;case 0:this.zNb(!1);break;case 2:case 3:this.zNb(!0);break;default:d.ULS.shipAssertTag(537167968,0,!1,"RangeCatchUpActivityView.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+this.qw.model.state)}};
this.Yxg=Jb;this.qw.mqe(this.pGb);this.az=[]}get qw(){return this.Yxg}dispose(){this.qw.YVf(this.pGb);this.az=null}vzj(Jb){this.az.push(Jb)}t5g(){this.az.length=0}q$f(Jb){for(const tc of this.az){tc.className=Vc.a.m2g;const fd=document.getElementById(`${tc.id}-${mc.a.ZAe}`);da.DOMElementExtensions.setVisible(fd,Jb)}}zNb(Jb){for(const tc of this.az)tc&&(Jb?tc.className=2===this.qw.model.state?Vc.a.hcj:Vc.a.icj:this.q$f(!1))}}Object(b.a)(Sd,"RangeCatchUpActivityView",null,[532,2]);var Zd=a(22);class pa extends ed.a{constructor(Jb,
tc,fd){super(Jb,tc,fd);this.gridView=ma.h(Jb);this.Nma=tc}dispose(){this.gridView=null;super.dispose()}vLg(Jb){const tc=this.Tgb[0];tc?tc.vzj(Jb):d.ULS.shipAssertTag(537168004,0,!1,"RangeCatchUpActivityHighlightController.AddViewElement - RangeCatchUpActivityView is null for activityId"+this.Nma.activityId)}gpj(){const Jb=this.Tgb[0];Jb&&Jb.t5g()}JJg(Jb){this.Nma.addRange(Jb)}SRh(){if(3!==this.Nma.activityType)return null;d.ULS.shipAssertTag(537168003,0,1===this.Nma.YNb.length,"RangeCatchUpActivityHighlightController::GetCommentActivityRange Range Information Length should be 1.");
return Kb.D(this.Nma.YNb[0])}kxc(Jb){if(Jb){if(!this.Nma)return;this.mAd(this.nqj())}super.kxc(Jb)}O6c(){const Jb=this.t6c();this.Tgb.push(Jb)}t6c(){return new Sd(this)}mAd(Jb){Jb?Jb.SheetName?(this.gridView.ha.Ra.SG(null),this.gridView.focus(),this.gridView.J9e(Jb,3,!1,"RangeCatchUpActivityHighlightController.NavigateToRange")):d.ULS.shipAssertTag(537168E3,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: SheetName in the range is null."):d.ULS.shipAssertTag(537168001,0,!1,"RangeCatchUpActivityHighlightController.NavigateToRange: Range is null. Either the location list is empty or sheet is hidden.")}nqj(){if(Sa.e(this.Nma.YNb))return d.ULS.shipAssertTag(537167971,
0,!1,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : SortedRanges is either null or empty."),null;var Jb=this.$.va.na;d.ULS.shipAssertTag(537167970,0,!!Jb,"RangeCatchUpActivityHighlightController.RetrieveRangeInformationForNavigation : currentSheet is null.");Jb=this.oWj(Jb.sheetName,this.Nma.YNb);if(!Jb&&(Jb=this.O6h(this.Nma.YNb),!Jb))return null;const tc={};tc.SheetName=Jb.SheetName;tc.FirstColumn=Jb.FirstColumn;tc.FirstRow=Jb.FirstRow;tc.LastColumn=Jb.FirstColumn;
tc.LastRow=Jb.FirstRow;return tc}O6h(Jb){if(Sa.e(Jb))return null;let tc=null;for(let Ad=0;Ad<Jb.length;Ad++){var fd=Jb[Ad].SheetName;if(!Zd.a.equals(fd,tc,!1)&&(tc=fd,fd=this.$.va.getItemByName(fd),null===fd||void 0===fd?0:fd.visible))return Jb[Ad]}return null}oWj(Jb,tc){if(tc)for(const fd of tc)if(Zd.a.equals(fd.SheetName,Jb,!1))return fd;return null}}Object(b.a)(pa,"RangeCatchUpActivityHighlightController",ed.a,[]);var zb=a(81);class Vb extends zb.a{constructor(Jb,tc,fd,Ad,me){super();this.$=Jb;
this.v4d=tc;this.qsg=fd;this.vG=Ad;this.state=me?1:0}get type(){return this.vG}get activityId(){return this.v4d}get activityType(){return this.qsg}dispose(){this.v4d=null;super.dispose()}}Object(b.a)(Vb,"CatchUpActivityHighlightModelBase",zb.a,[]);class xc extends Vb{constructor(Jb,tc,fd,Ad,me,Vd){super(Jb,tc,fd,Ad,Vd);this.ranges=me;this.Y7a=!1}get YNb(){this.Y7a||(this.ranges.sort(xc.H4b),this.Y7a=!0);return this.ranges}addRange(Jb){for(const tc of Jb)this.ranges.push(tc)}dispose(){this.ranges=
null;super.dispose()}static H4b(Jb,tc){if(!Jb.SheetName||!tc.SheetName)return d.ULS.shipAssertTag(537167969,0,!1,"RangeCatchUpActivityHighlightModel.CompareSharedSheetRange : SheetName is null."),0;const fd=Jb.SheetName.localeCompare(tc.SheetName);return fd?fd:Jb.FirstColumn<tc.FirstColumn||Jb.FirstColumn===tc.FirstColumn&&Jb.FirstRow<tc.FirstRow?-1:Jb.FirstColumn===tc.FirstColumn&&Jb.FirstRow===tc.FirstRow?0:1}}Object(b.a)(xc,"RangeCatchUpActivityHighlightModel",Vb,[]);var Sc=a(345);class Jd{constructor(){this.c4c=
[];this.TMb={};this.fWc={}}dispose(){this.fWc=this.TMb=this.c4c=null}lXf(Jb,tc){tc?ma.h(Jb).Cb.Qq([24]):ma.h(Jb).Cb.Nj([24])}Bch(Jb,tc,fd,Ad){const me={};for(const oe of tc){if(!oe||Sa.e(oe.LocationList))continue;tc=[];const Me={},cb=[];for(const Mb of oe.LocationList){if(!Mb){d.ULS.shipAssertTag(537168013,0,!1,"CatchUpActivityHighlightManagerHelper.CreateControllersAndHighlights - Location is Null for activityId : "+oe.Id);break}switch(Mb.Type){case 0:var Vd=Mb;let kc;"0"in Me?(kc=Me["0"],kc.JJg(Vd.RangeList)):
(kc=new pa(Jb,new xc(Jb,oe.Id,oe.Type,0,Vd.RangeList,Ad),fd),tc.push(kc),Me["0"]=kc);for(const Uc of Vd.RangeList){Vd=new Sc.a(Kb.D(Uc),ja.d(Jb.va.getItemByName(Uc.SheetName)));if(this.$yc(Vd)in this.TMb)this.TMb[this.$yc(Vd)].push(kc);else{let qd=[];qd.push(kc);this.TMb[this.$yc(Vd)]=qd}cb.push(Vd);this.c4c.push(Vd)}break;default:d.ULS.sendTraceTag(537168012,0,10,"CatchUpHighlightControllersCreator.CreateControllersAndHighlights(): Failed.Invalid ActivityLocationType")}}d.ULS.shipAssertTag(537168011,
0,!(oe.Id in me),"CatchUpHighlightControllersCreator.CreateAndUpdateControllers - highlightControllers already has activity: "+oe.Id);this.fWc[oe.Id]=cb;me[oe.Id]=tc}this.Vdh(Jb,this.c4c,this.TMb,Ad);return me}Zxb(Jb){return this.fWc[Jb]}m5g(Jb){for(let tc in Jb){const fd=Jb[tc];for(const Ad of fd)Ad.gpj()}}$yc(Jb){return`${Jb.range}-${Jb.sheetId}`}Vdh(Jb,tc,fd,Ad){this.m5g(fd);ma.h(Jb).Cb.zB(tc,[24],Ad,(me,Vd)=>{var oe=new Sc.a(me.range,me.sheetId);oe=this.$yc(oe);const Me=fd[oe];if(Me)for(const cb of Me)cb.vLg(Vd),
me.metadata=cb;else d.ULS.shipAssertTag(537168010,0,!1,"CatchUpHighlightControllersCreator.CreateHighlightsAndUpdateControllers(), Missing Controller for SheetRangeKey "+oe)})}}Object(b.a)(Jd,"CatchUpHighlightControllersCreator",null,[]);class ye{constructor(){this.activityIds=this.container=this.target=null;this.isSticky=!1;this.dirHint=0;this.onHoverLeave=this.onHoverEnter=this.activityNavigationManager=null}}Object(b.a)(ye,"CreateIndicatorTooltipParameters",null,[]);class pe{constructor(){this.clearSticky=
!1}}Object(b.a)(pe,"DismissIndicatorTooltipParameters",null,[]);class re{constructor(){this.target=null;this.isSticky=!1}}Object(b.a)(re,"UpdateIndicatorTooltipParameters",null,[]);class He{constructor(Jb,tc,fd){this.$=Jb;this.hh=tc;this.Zxb=fd}navigateToActivity(Jb){if(Jb.fromSummaryString){var tc=new V.a(1834994092,Ka.a.zb,this.$.xc,18,null);this.$.Ia.Hb(tc);return this.wCa(1)}Jb=Jb.activity;if(ba.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")&&
Jb&&1===Jb.type){var fd=new V.a(1834994092,Ka.a.zb,this.$.xc,30,null);const Ad={["activityGuid"]:Jb.activityId,["sheetRanges"]:null===(tc=this.Zxb)||void 0===tc?void 0:tc.call(this,Jb.activityId)};this.$.Ia.Hb(fd,Ad);return this.wCa(1)}if(!this.xli(Jb))return this.wCa(4);if(!this.hvi(Jb))return this.wCa(7);tc={};try{fd=window.self.atob(Jb.navigationId);if(!fd)return this.wCa(5);tc.NavigationId=fd}catch(Ad){return d.ULS.sendTraceTag(537168023,3012,10,`Exception thrown when trying to decode activity NavigationID: ${Ad}`),
this.wCa(5)}if(8===this.hh.Vd(gc.a.TIa,2,tc))return this.hh.processAction(gc.a.a$a,2),this.wCa(2);tc=32===this.hh.Vd(gc.a.L0a,2,tc)?1:6;return this.wCa(tc)}xli(Jb){return Jb&&Jb.navigationId?!0:!1}hvi(Jb){switch(Jb.type){case 3:case 4:case 6:case 7:case 9:case 8:case 10:return!0;default:return!1}}wCa(Jb){return Promise.resolve(Jb)}}Object(b.a)(He,"CatchUpActivityNavigationManager",null,[420]);class ze{constructor(Jb,tc){this.r5b=this.ppa=null;this.Hdd=!1;this.CRa=null;this.gka={};this.CDa=null;this.kmd=
!1;this.Zxb=fd=>this.WHa.Zxb(fd);this.pGb=(fd,Ad)=>{switch(Ad.state){case 0:case 1:3===Ad.VHd&&(this.zci(),this.CRa=null);break;case 2:break;case 3:this.r8c();this.CRa=Ad.activityId;this.tIj();break;default:d.ULS.shipAssertTag(537168030,0,!1,"CatchUpActivityHighlightManager.OnHighlightStateChanged - Invalid CatchUpActivityHighlightState:"+Ad.state)}};this.Xl=()=>{this.Atb()};this.Uc=()=>{this.Atb()};this.xn=()=>{this.Atb()};this.Ri=()=>{this.Atb()};this.K0i=()=>{this.a4b()};this.L0i=()=>{this.NCe();
this.cZe=setTimeout(()=>{this.W1a()},200)};this.o9f=(fd,Ad)=>{Ad.cni?(this.a4b(),this.W1a()):(this.ZCe(),this.sdd=setTimeout(()=>{this.a4b();this.W1a();const me=this.FWj(Ad.fba);me?(this.ppa.createActivityIndicatorTooltip(Object(U.a)(new ye,{target:Ad.fba,container:me,activityIds:[Ad.activityId],isSticky:!1,dirHint:this.gridView.rtl?12:9,activityNavigationManager:ba.EwaSettings.isChangeGateEnabled("OfficeVSO:6883957_InvokeEntryPointForClickingActivityIndicatorTooltip")?this.h3b:void 0,onHoverEnter:this.K0i,
onHoverLeave:this.L0i})),this.rfc=Ad.fba,d.ULS.sendTraceTag(51172353,0,50,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler: Activity Indicator Raising Hover/Unhover Event."),this.Whc||(this.gridView.view.Ps(this.EDc),this.gridView.Uu(this.EDc),this.Whc=!0)):d.ULS.shipAssertTag(537168027,0,!1,"CatchUpActivityHighlightManager::ShowActivityFlyoutHandler FlyoutContainer is null.")},150))};this.$Cf=()=>{this.a4b();this.cZe=setTimeout(()=>{this.W1a()},200)};this.EDc=()=>{this.ppa?(this.ALa&&
this.ppa.updateActivityIndicatorTooltip(Object(U.a)(new re,{target:this.ALa,isSticky:!0})),this.rfc&&this.ppa.updateActivityIndicatorTooltip(Object(U.a)(new re,{target:this.ALa,isSticky:!1}))):d.ULS.shipAssertTag(537168024,0,!1,"CatchUpActivityHighlightManager::UpdateActivityFlyouts ActivityIndicatorTooltipManager is null.")};this.$=Jb;this.gridView=ma.h(this.$);this.ha=this.gridView.ha;this.eb=this.gridView.Vb;this.ha.F_b(this.Xl);this.ha.eC(this.Uc);this.gridView.jE(this.xn);this.eb.xl(this.Ri);
this.ALa=this.rfc=null;this.Whc=!1;this.mdd={};this.h3b=new He(this.$,e.AFrameworkApplication.rb,this.Zxb);this.blueDotManager=tc}get Pne(){return this.ppa}set Pne(Jb){this.ppa=Jb}get excelCommentManager(){this.CDa||(this.CDa=this.$.da.Aa(65));return this.CDa}get WHa(){this.r5b||(this.r5b=new Jd);return this.r5b}set WHa(Jb){this.r5b=Jb}dispose(){this.ha.Fuc(this.Xl);this.ha.vB(this.Uc);this.gridView.AF(this.xn);this.eb.nl(this.Ri);this.ELe();this.mdd=this.ALa=this.rfc=this.CRa=this.eb=this.ha=this.gridView=
null}YQd(Jb){const tc=this.gpb();this.ELe();if(!Sa.e(Jb)){d.ULS.sendTraceTag(537168035,0,50,"In CatchUpActivityHighlightManager:ProcessActivityPayloadHighlights().");if(this.gka=this.WHa.Bch(this.$,Jb,this,tc)){Jb=this.gka;for(let fd in Jb){const Ad=Jb[fd];for(const me of Ad)this.WTg(me)}}this.WHa.lXf(this.$,tc)}}xNb(){const Jb=this.gpb();Jb&&this.kmd?d.ULS.shipAssertTag(537168034,0,!1,"CatchUpActivityHighlightManager.ShowOrHideAllHighlights - Trying to show all highlights when marked as read"):(Jb||
this.Atb(),this.WHa.lXf(this.$,Jb))}jdi(Jb){if(this.gpb())if(this.ALa&&this.W1a(),this.r8c(),Jb=this.gka[Jb.activityId])for(const tc of Jb)tc.kxc(!0);else d.ULS.sendTraceTag(537168032,0,50,"CatchUpActivityHighlightManager.OnSelectHighlight - Controllers not found during select")}X1a(Jb){this.blueDotManager&&this.blueDotManager.X1a(Jb)}c5f(Jb){if(this.Hdd!==Jb){var tc=this.gpb();this.Hdd=Jb;tc!==this.gpb()&&this.xNb()}}ELe(){if(this.gka){const Jb=this.gka;for(let tc in Jb){const fd=Jb[tc];for(const Ad of fd)this.fij(Ad),
Ad.dispose()}}this.gka={};this.WHa.dispose();this.WHa=null}tIj(){if(this.excelCommentManager){var Jb=this.gka[this.CRa];Jb&&0<Jb.length&&3===Jb[0].model.activityType&&((Jb=Jb[0])?this.excelCommentManager.YIj(Jb.SRh()):d.ULS.shipAssertTag(537168029,0,!1,"RangeCatchUpActivityHighlightController::ShowCommentFlyoutOnSelectedActivity RangeController is Null."))}}zci(){this.excelCommentManager&&this.excelCommentManager.Aub()}r8c(){if(this.CRa){const Jb=this.gka[this.CRa];if(Jb){for(const tc of Jb)tc.kxc(!1);
this.CRa=null}else d.ULS.sendTraceTag(537168028,0,50,"CatchUpActivityHighlightManager.DeselectCurrentlySelected - Controllers not found for deselection")}}Atb(){this.r8c();this.W1a()}FWj(Jb){if(!Jb)return d.ULS.shipAssertTag(537168026,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer HighlightDot is null."),null;Jb=`${Jb.id}-${mc.a.k2g}`;let tc=this.mdd[Jb];if(!tc){if(!this.gridView.domElement)return d.ULS.shipAssertTag(537168025,0,!1,"CatchUpActivityHighlightManager::TryGetFlyoutContainer gridView.DOMElement is null."),
null;tc=document.createElement("Div");tc.className=Vc.a.l2g;tc.id=Jb;this.gridView.domElement.appendChild(tc);this.mdd[Jb]=tc}return tc}W1a(){this.ppa&&(this.ppa.dismissActivityIndicatorTooltips(Object(U.a)(new pe,{clearSticky:!0})),this.ALa=this.rfc=null,this.Whc&&!this.ALa&&(this.gridView.view.Mq(this.EDc),this.gridView.my(this.EDc),this.Whc=!1))}WTg(Jb){Jb.mqe(this.pGb);Jb.$Lg(this.o9f);Jb.ZLg(this.$Cf)}fij(Jb){Jb.YVf(this.pGb);Jb.njj(this.o9f);Jb.mjj(this.$Cf)}ZCe(){this.sdd&&clearTimeout(this.sdd)}NCe(){this.sdd&&
clearTimeout(this.cZe)}a4b(){this.ZCe();this.NCe()}gpb(){return this.blueDotManager&&this.blueDotManager.areInGridHighlightsEnabled()&&!this.Hdd}}Object(b.a)(ze,"CatchUpActivityHighlightManager",null,[507,2]);var ef=a(448);class $a{}Object(b.a)($a,"GetRelevantActivitiesDataRequest",null,[]);class Nb{constructor(){this.activityFeedItemId=this.activityId=null;this.type=0;this.collectionId=this.state=this.navigationId=this.relevancy=this.displayTimestamp=this.location=this.actors=null}}Object(b.a)(Nb,
"Activity",null,[]);class qc{constructor(){this.collectionId=this.type=this.id=null;this.activityState=0;this.timestamp=this.activityFeedItemPayload=null}}Object(b.a)(qc,"ActivityFeedItem",null,[]);class Lc{constructor(){this.activityFeedItems=null}}Object(b.a)(Lc,"ActivityFeedPayload",null,[]);class sd{constructor(){this.lowWaterline=this.highWaterline=this.wywaWaterline=this.actors=this.activities=null;this.hasMore=!1;this.isFirstDocumentOpen=null}}Object(b.a)(sd,"ActivityRequestPayload",null,[]);
class Fd{constructor(){this.color=this.imageUrl=this.email=this.givenName=this.displayName=this.provider=this.id=null}}Object(b.a)(Fd,"Person",null,[]);class Td extends Nb{constructor(){super();this.relationship=0}}Object(b.a)(Td,"TaskActivity",Nb,[]);const ue=(Jb,tc,fd,Ad,me,Vd=null)=>{Vd=Jb.Na(1,Vd);return eb.g(Jb,"GetLineageWywaAuthors",Vd,tc,fd,Ad,me,4)},Ae=(Jb,tc,fd,Ad,me,Vd,oe=null)=>{oe=Jb.Na(1,oe);oe.getRelevantActivitiesDataRequest=tc;return eb.g(Jb,"GetRelevantActivitiesData",oe,fd,Ad,me,
Vd,0)};class Le{constructor(Jb,tc,fd=!1,Ad=null){this.i1d=null;this.$=Jb;this.i3b=tc;this.THb=tb.a.instance.resolve("Common.App.People.IPeopleColorUtils");this.vza=tb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.g7a=fd;this.blueDotManager=Ad}requestWYWAActivities(){return this.g7a?new Promise((Jb,tc)=>{ue(this.$.oa.xa,fd=>{var Ad;fd=Wa.a(fd)?null:fd.Result;if(ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)){const me=null===(Ad=null===fd||void 0===
fd?void 0:fd.WywaAuthors)||void 0===Ad?void 0:Ad.length;if(null!=me&&0<me){const Vd={activities:[],actors:fd?this.hdc(fd.WywaAuthors):null,hasMore:!1,highWaterline:Le.kia,lowWaterline:Le.kia,wywaWaterline:Le.kia};this.Tjg(oe=>{Vd.activities=oe;Jb(Vd)},oe=>{d.ULS.sendTraceTag(509638481,0,10,`updateInGridBlueDots failed: reason: "${oe}"`);Jb(Vd)})}else Jb(Le.utb)}else Ad=Object(U.a)(new sd,{activities:[],actors:fd?this.hdc(fd.WywaAuthors):null,hasMore:!1,highWaterline:Le.kia,lowWaterline:Le.kia,wywaWaterline:Le.kia}),
Jb(Ad)},()=>{d.ULS.sendTraceTag(537168022,0,10,"CatchUpActivityRequestManager::GetLineageWywaAuthors service call failed.");tc(null)},null,null)}):Promise.resolve(Le.utb)}requestActivities(){return Promise.resolve(Le.utb)}requestRelevantActivities(){if(!this.$.ea.Xb||this.$.ea.z5a)return d.ULS.sendTraceTag(537168021,3012,15,`CatchUpActivityRequestManager.RequestRelevantActivities: RequestRelevantActivities skipped [IsSessionActive: ${this.$.ea.Xb}, HasRaisedSessionEnded: ${this.$.ea.z5a}]`),Promise.resolve(Le.utb);
const Jb=Object(U.a)(new $a,{SetDaysBack:e.AFrameworkApplication.fa.vd("AppWaterlineOverrideDaysValue",0),SetTimestamp:e.AFrameworkApplication.fa.vd("AppWaterlineOverrideTimestampValue",0)});return new Promise((tc,fd)=>{Ae(this.$.oa.xa,Jb,Ad=>{let me=Le.utb;Ad?Wa.a(Ad)?(Ad=P.a.nc(Ad.Errors),d.ULS.sendTraceTag(578353159,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call returned errors codes: ${Ad}`)):me=this.I1h(Ad.Result):d.ULS.sendTraceTag(537168020,3012,10,"CatchUpActivityRequestManager::GetRelevantActivitiesData call returned Null result.");
tc(me)},Ad=>{Ad=za.a.Pe(Ad.data);Ad=P.a.nc(Ad);d.ULS.sendTraceTag(537168019,3012,10,`CatchUpActivityRequestManager::GetRelevantActivitiesData call has failed - Errors: [${Ad}]`);fd(null)},null,null)})}requestActivityFeed(){return R.b(this.getActivityFeed()).then(Jb=>Object(U.a)(new Lc,{activityFeedItems:this.ZUj(Jb)}))}updateActivityState(Jb){return this.i3b?R.b(this.i3b).then(tc=>{var fd,Ad;return R.b(tc.DZj(Jb.itemIds,null!==(fd=Jb.activityStatesToSet)&&void 0!==fd?fd:0,null!==(Ad=Jb.activityStatesToReset)&&
void 0!==Ad?Ad:0,Jb.resetUnseenCount))}):Promise.resolve(!1)}getActivityFeed(){return this.i3b?ke.a.sYd(this.i3b,Jb=>Jb.getActivityFeed(null)):H.Task.Sa([])}I1h(Jb){if(!Jb)return d.ULS.sendTraceTag(537168018,3012,10,"CatchUpActivityRequestManager::GetRelevantActivityRequestPayload response is null."),Object(U.a)(new sd,{activities:[]});const tc=this.dgg(Jb.NewActivities,2);Jb=this.dgg(Jb.OutstandingActivities,3);for(const fd of Jb)tc.push(fd);return Object(U.a)(new sd,{activities:tc})}dgg(Jb,tc=1){const fd=
[];if(!Jb||!Jb.length)return fd;for(const Ad of Jb)Ad?(Jb=Le.fVj(Ad.Type),6===Jb||7===Jb||9===Jb||8===Jb?fd.push(Object(U.a)(new Td,{activityId:Ad.Id,type:Jb,displayTimestamp:new Date(Ad.DisplayTimestamp),navigationId:Ad.NavigationId,actors:this.hdc(Ad.People),relevancy:tc,relationship:this.eVj(Ad.Relationship)})):fd.push(Object(U.a)(new Nb,{activityId:Ad.Id,type:Jb,displayTimestamp:new Date(Ad.DisplayTimestamp),navigationId:Ad.NavigationId,actors:this.hdc(Ad.People),relevancy:tc}))):d.ULS.shipAssertTag(537168017,
3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivitiesToActivities: relevantActivity is null");return fd}eVj(Jb){switch(Jb){case 1:return 1;case 2:return 2;case 3:return 3}d.ULS.sendTraceTag(537168016,0,10,"Unexpected Relationship.");return 1}ZUj(Jb){const tc=[];for(const fd of Jb)Jb=Object(U.a)(new qc,{id:fd.id,type:fd.type,collectionId:fd.collectionId,activityState:fd.activityState,activityFeedItemPayload:fd.activityFeedItemPayload,timestamp:fd.timestamp}),tc.push(Jb);return tc}hdc(Jb){const tc=
[];if(!Jb||!Jb.length)return tc;for(const fd of Jb)fd&&tc.push(this.Fxb(fd));return tc}Fxb(Jb){return Object(U.a)(new Fd,{id:Jb.Id,provider:Jb.Provider,displayName:Jb.DisplayName,email:Jb.Email,imageUrl:this.vza.rta(Jb.Email,Jb.Provider,e.AFrameworkApplication.vi,0),color:this.THb.Ijd(new ef.a(null,void 0,Jb.DisplayName),6)})}static fVj(Jb){switch(Jb){case 1:return 3;case 2:return 4;case 3:return 6;case 4:return 7;case 6:return 8;case 5:return 9;case 7:return 10;default:return d.ULS.shipAssertTag(537168015,
3012,!1,"CatchUpActivityRequestManager.TranslateRelevantActivityTypeToActivityType: unknown RelevantActivityType"),1}}jGc(){if(this.blueDotManager){const Jb=this.blueDotManager.O_c;return this.i1d.filter(tc=>!Jb.has(tc.Id))}return this.i1d}A9i(Jb,tc){const fd=Jb.map(Ad=>({activityId:Ad.activityGuid,activityFeedItemId:null,type:1,actors:[{id:Ad.author.id,provider:Ad.author.provider,displayName:Ad.author.displayName,givenName:null,email:Ad.author.email,imageUrl:Ad.author.imageUrl,color:null}],location:{type:105,
region:null,subregion:null},displayTimestamp:Ad.displayTimestamp,relevancy:null,navigationId:null,state:0,collectionId:null}));this.i1d=Jb.map(Ad=>{var me,Vd;const oe=null!==(Vd=null===(me=Ad.rangeHighlightLocation)||void 0===me?void 0:me.rangeList.map(Me=>({Type:0,RangeList:[{SheetName:Ad.sheetName,FirstRow:Me.firstRow,LastRow:Me.lastRow,FirstColumn:Me.firstCol,LastColumn:Me.lastCol}]})))&&void 0!==Vd?Vd:[];return{Id:Ad.activityGuid,Type:null,Person:null,DisplayTimestamp:null,LocationList:oe}});
tc(fd)}Tjg(Jb,tc){this.blueDotManager?this.blueDotManager.qJj().then(fd=>{this.A9i(fd,Jb)},fd=>{tc&&tc(fd)}):d.ULS.shipAssertTag(509703879,3012,!1,"CatchUpActivityRequestManager.updateInGridBlueDots: Missing blue dot manager in blue dot method")}}Le.kia="<WywaWaterline>DefaultWaterline</WywaWaterline>";Le.utb=Object(U.a)(new sd,{activities:[],actors:[],hasMore:!1,highWaterline:Le.kia,lowWaterline:Le.kia,wywaWaterline:Le.kia});Object(b.a)(Le,"CatchUpActivityRequestManager",null,[421]);class df{constructor(Jb){this.$=
Jb}shouldShowEmptyExperienceButton(){return this.$.ea.V8a?!0:!1}onButtonClick(){const Jb={["InputMethod"]:Ka.a.zb};this.$.Ia.Hb(new V.a(1834994092,Ka.a.zb,this.$.xc,16,null),Jb)}onInviteOthersButtonClick(){const Jb={["InputMethod"]:Ka.a.zb};this.$.Ia.Hb(new V.a(869186573,Ka.a.zb,this.$.xc,16,null),Jb)}getExplanationText(){const Jb=this.$.da.Aa(365);return qb.a.instance.Ta(Jb&&Jb.isVisible?657:656)}getCommandName(){return qb.a.instance.ga(442)}}Object(b.a)(df,"CatchUpEmptyExperienceBehaviorManager",
null,[422]);const Oe=Jb=>{window.performance&&"function"===typeof window.performance.mark&&window.performance.mark("CatchUpInit."+Jb)};class cf{constructor(Jb,tc=null){this.$=Jb;this.flyoutRibbonButton=tc;ra.a(this.$).Yh(this);this.hasFocus=!1}dispose(){ra.a(this.$).Ez(this)}get jc(){return document.getElementById("catchUpFlyoutContainer")}get Ff(){return this.flyoutRibbonButton.Oif&&!this.hasFocus}get Xd(){return O.a.D1c}ag(Jb,tc){if(tc)return!1;Jb=document.getElementById("flyoutItem0");if(!Jb)return d.ULS.sendTraceTag(537168009,
3012,10,"Could not find firstItem in flyout when setting up focus"),!1;Jb.focus();this.Hnh(Jb);return!0}sh(Jb){return this.jc?da.DOMElementExtensions.Af(this.jc,Jb):!1}rj(){this.hasFocus=!0}dk(){this.hasFocus=!1}Hnh(Jb){if(Sys.Browser.agent===Sys.Browser.Firefox){var tc=document.createEvent("KeyboardEvent");tc.initKeyEvent(ic.a.Sb,!0,!0,window.self,!1,!1,!1,!1,he.a.AQb,0);Jb.dispatchEvent(tc)}else tc=document.createEvent("Events"),tc.initEvent(ic.a.Sb,!0,!0),tc.keyCode=he.a.AQb,tc.which=he.a.AQb,
Jb.dispatchEvent(tc)}}Object(b.a)(cf,"FlyoutFocus",null,[54,2]);var vf=a(425);class hf{constructor(Jb){this.buttonClickedCallback=null;this.ckb=this.VAb=!1;this.kJh=new Date;this.QYe=Jb}dispose(){this.ckb=this.VAb=!1}registerButtonClickedEvent(Jb){this.buttonClickedCallback&&d.ULS.sendTraceTag(537168008,3012,15,"RegisterButtonClickedEvent: Button clicked callback should only be registered once.");this.buttonClickedCallback=Jb.buttonClickedCallback}onFlyoutInitialized(){this.VAb&&d.ULS.sendTraceTag(537168007,
3012,15,"OnFlyoutInitialized: Flyout should only be initialized once.");const Jb=(new Date).getTime()-this.kJh.getTime();d.ULS.sendTraceTag(593601546,3012,50,`Time from retrieve activities to initialize Flyout: ${Jb}`);l.c(gc.a.p2g,!0,l.e,0,0,Jb);this.VAb=!0;vf.a.WI&&vf.a.WI.updateCommandUI(!0)}logFlightTriggers(){}toggleCatchUpFlyout(){this.VAb?this.buttonClickedCallback?this.buttonClickedCallback():d.ULS.sendTraceTag(537168005,3012,10,"ToggleCatchUpFlyout: User clicked the button before the buttonClickedCallback was registered."):
d.ULS.sendTraceTag(537168006,3012,10,"ToggleCatchUpFlyout: User clicked the button before the flyout was initialized.")}get Oif(){return this.ckb}onFlyoutVisibilityChanged(Jb){this.ckb!==Jb.flyoutIsVisible&&(this.ckb=Jb.flyoutIsVisible,vf.a.WI&&vf.a.WI.updateCommandUI(!0),this.ckb||this.QYe&&this.QYe.VBi())}}Object(b.a)(hf,"FlyoutRibbonButton",null,[506]);var Mf=a(523);class xf{constructor(){this.flyoutAnchorTarget=this.useCompactSummaryString=this.disableDismissOnClick=this.customDynamicEntryPointEnabled=
this.dynamicEntryPointEnabled=this.activityFeedDataEnabled=this.includeRelevantAuthorsInSummaryString=this.summaryStringEnabled=this.flyoutEnabled=this.featuredActivityGroupsEnabled=null}}Object(b.a)(xf,"CatchUpConfiguration",null,[]);class sc{constructor(){this.emptyCatchUpBehaviorManager=this.ulsLogger=this.uiCulture=this.flyoutRibbonButton=this.flyoutFocus=this.dataCulture=this.changeSummariesDataProvider=this.appColorUpdateIsEnabled=this.activityRequestManager=this.activityNavigationManager=this.activityContentManager=
null}}Object(b.a)(sc,"SharedControllerFactoryParameters",null,[]);class ad{constructor(Jb,tc,fd=null,Ad=null,me=null){this.nHa=null;this.Daf=!1;this.LNa=0;this.tf=()=>{const Vd=this.$.ea.Qn.LineageVersion;this.LNa!==Vd&&(d.ULS.sendTraceTag(509645837,0,50,`CatchUpActivityManager.onWorkbookMetadataChanged: lineageVersion: ${Vd}, this.lineageVersion: ${this.LNa}`),this.LNa=Vd,this.m$.c5f(!0),this.b0a.Tjg(()=>{this.m$.YQd(this.b0a.jGc());this.m$.c5f(!1)}))};this.qKf=Vd=>{var oe;ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",
!1)&&!lc.a.lh(Vd.wywaActivities)&&2!==Vd.wywaActivities[0].type&&(this.m$.YQd(this.b0a.jGc()),this.showHideInGridHighlights(),this.m$.jdi(Vd.wywaActivities[0]),this.$.ea.$t(this.tf),null===(oe=this.blueDotManager)||void 0===oe?void 0:oe.Bqe(this.onBlueDotDismissed))};this.onBlueDotDismissed=()=>{this.m$.YQd(this.b0a.jGc())};this.$=Jb;this.blueDotManager=me;this.m$=new ze(this.$,this.blueDotManager);this.d6d=new Fc(e.AFrameworkApplication.rb,ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CatchUpMockDataEnabled",
!1));Jb=nc.a.ATj(tb.a.instance.Tb("Common.App.CatchUpActivity.ICatchUpRequestHandler"));this.pqf=Ad;this.b0a=new Le(this.$,Jb,this.g7a(),this.blueDotManager);this.h3b=new He(this.$,e.AFrameworkApplication.rb);this.emptyCatchUpBehaviorManager=new df(this.$);this.zAi(Vd=>{this.dPi(Vd)},tc);this.BCi();tc=null;fd||(tc=tb.a.instance.resolve("Common.App.CatchUpActivity.FloodgateEventLogger"));this.flyoutRibbonButton=fd||new hf(tc);this.flyoutFocus=new cf(this.$,this.flyoutRibbonButton)}get Ygf(){const Jb=
this.flyoutRibbonButton.VAb;Jb&&!this.Daf&&(d.ULS.sendTraceTag(588129368,3012,50,"Catch Up Flyout is ready and button is enabled."),this.Daf=!0);return Jb}get Lmi(){return this.flyoutRibbonButton.Oif}dispose(){var Jb;this.nHa&&this.nHa.getWywaEvent().removeListener(this.qKf);this.nHa=this.$=null;Oc.a.Ja(this.m$);this.flyoutRibbonButton=this.flyoutFocus=this.d6d=this.h3b=this.b0a=this.m$=null;this.$.ea.Av(this.tf);null===(Jb=this.blueDotManager)||void 0===Jb?void 0:Jb.kWf(this.onBlueDotDismissed)}F0i(){this.flyoutRibbonButton.toggleCatchUpFlyout();
return!0}showHideInGridHighlights(){this.m$.xNb()}BCi(){d.ULS.sendTraceTag(589608192,3012,50,"Catch Up script is loaded and Flyout is enabled.");this.vgf()&&d.ULS.sendTraceTag(526718752,3012,50,"ActivityFeedData is enabled")}zAi(Jb,tc){Oe("ScriptDownload");ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7457857_DynamicScriptLoaderNewService")?void wa.a.resolve(na.d,{Tl:tc}).then(fd=>Object(Rb.a)(this,void 0,void 0,function*(){Jb(R.c(fd("catchUpActivity")))})):C.TaskExtensions.za(v.GetServiceTaskFactory.Oa(this.$.da,
283,284,tc),fd=>{Jb(R.c(fd.result.Hl.loadScript("catchUpActivity")))},this.$.da.la,3)}g7a(){return!!this.pqf&&this.pqf.g7a()&&this.$.ea.V8a}vgf(){return ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.SharedOnline.ActivityFeedIsEnabled",!1)}dPi(Jb){C.TaskExtensions.za(Jb,()=>{ua.a(()=>{this.nHa=catchUpActivity.FactoryGlobal.getExcelCatchUpAppInstance(Object(U.a)(new sc,{activityContentManager:Object(Ib.a)(419,this.d6d),activityNavigationManager:Object(Ib.a)(420,this.h3b),activityRequestManager:Object(Ib.a)(421,
this.b0a),dataCulture:this.$.ya.DataCultureTag,flyoutFocus:null,flyoutRibbonButton:Object(Ib.a)(hf,this.flyoutRibbonButton),uiCulture:this.$.ya.UICultureTag,ulsLogger:new D.a,emptyCatchUpBehaviorManager:Object(Ib.a)(422,this.emptyCatchUpBehaviorManager)}))});this.m$.Pne=this.nHa.getActivityIndicatorTooltipManager();Mf.a(this.$);this.nHa.getWywaEvent().addListener(this.qKf);Oe("InitializeCatchUpApp");this.nHa.initialize(Object(U.a)(new xf,{featuredActivityGroupsEnabled:!1,summaryStringEnabled:this.g7a(),
includeRelevantAuthorsInSummaryString:!1,useCompactSummaryString:!0,activityFeedDataEnabled:this.vgf()}))},this.$.la,3)}}Object(b.a)(ad,"CatchUpActivityManager",null,[423,2]);class gb extends f.a{constructor(Jb){super();this.$=Jb;this.Db()}create(){let Jb=ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.BlueDot",!1)?v.GetServiceTaskFactory.Oa(this.$.da,501,500,1):H.Task.Sa(null),tc=v.GetServiceTaskFactory.Oa(this.$.da,458,459,this.Xa);C.TaskExtensions.za(C.TaskExtensions.Fd([Jb,tc],this.$.la),
()=>{const fd=tc.result,Ad=Jb.result,me=Object(qa.a)(this.$.da,286,()=>new ad(this.$,this.Xa,null,fd,Ad));this.nb(me)},this.$.la,3)}static ka(Jb){Jb.da.Ha(287,new gb(Jb))}}Object(b.a)(gb,"CatchUpActivityManagerFactory",f.a,[]);var Hb=a(237),ac=a(160),Ec=a(284),pd=a(38);class Bd extends pd.a{constructor(Jb,tc){super();this.blueDotSettings=0;this.cLf=null;this.areInGridHighlightsAvailable=()=>!0;this.areInGridHighlightsEnabled=()=>0===(this.blueDotSettings&1);this.Ezj=fd=>{d.ULS.sendTraceTag(509732679,
0,50,"User toggled in grid highlights, new value {0}.",fd);this.blueDotSettings=fd?0:1;fd=new V.a(950288339,0,2,12,null);this.$.Ia.Hb(fd,{});this.u7j()};this.$=Jb;this.blueDotSettings=tc;this.vza=tb.a.instance.resolve("Common.App.People.IUserProfilePictureUtils");this.Hxe=new Map;this.O_c=new Set}dispose(){this.$=null}Bqe(Jb){this.addHandler("cubddek",Jb)}kWf(Jb){this.removeHandler("cubddek",Jb)}X1a(Jb){this.O_c.add(Jb);ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7525040_BlueDotDismissal")&&this.raiseEvent("cubddek",
Jb)}shouldShowBlueDot(Jb){return this.Hxe.has(Jb)&&!this.O_c.has(Jb)}qJj(){return Object(Rb.a)(this,void 0,void 0,function*(){return new Promise((Jb,tc)=>{d.ULS.sendTraceTag(512234945,0,50,"BlueDotManager::showInGridBlueDots");ha.b(this.$).rd(ub.a.lineageLoadInGridBlueDots,{});const fd=me=>{me=za.a.Pe(me.data);d.ULS.sendTraceTag(512234944,0,50,`BlueDotManager::LineageLoadInGridBlueDots service call failed. Errors: [${P.a.nc(me)}]`);tc("LoadInGridBlueDots failed")},Ad=me=>{if(me=Wa.a(me)?null:me.Result){var Vd=
{["CountOfActivities"]:me.ActivityList.length};ha.b(this.$).rd(ub.a.hAi,Vd);var oe=dd(me.ActivityList,this.vza);null==this.cLf?this.Wki().then(Me=>{this.cLf=Me;this.LFe(oe);Jb(oe)},Me=>{tc(Me)}):(this.LFe(oe),Jb(oe))}else d.ULS.shipAssertTag(512234914,0,!!me,"BlueDotManager LineageLoadInGridBlueDots returned null response.")};this.$.userOperationManager.Jc(new W.a(1024,0,(me,Vd,oe)=>jb(this.$.oa.xa,ab.b(me,Ad),ab.a(Vd,fd),oe,null),80),null)})})}LFe(Jb){this.Hxe=new Map(Jb.map(tc=>[tc.activityGuid,
tc]))}Wki(){return Object(Rb.a)(this,void 0,void 0,function*(){return new Promise((Jb,tc)=>{d.ULS.sendTraceTag(509645136,0,50,"BlueDotManager::invokeOriginalBlueDotsUidList");const fd=me=>{me=za.a.Pe(me.data);d.ULS.sendTraceTag(509645135,0,50,`BlueDotManager  LineageGetOriginalBlueDotsUidList service call failed. Errors: [${P.a.nc(me)}]`);tc("BlueDotUidList load failed")},Ad=me=>{(me=Wa.a(me)?null:me.Result)?Jb(me):d.ULS.shipAssertTag(509645133,0,!!me,"BlueDotManager LineageGetOriginalBlueDotsUidList returned null response.")};
this.$.userOperationManager.Jc(new W.a(1029,0,(me,Vd,oe)=>Wb(this.$.oa.xa,ab.b(me,Ad),ab.a(Vd,fd),oe,null),80),null)})})}u7j(){ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7146345_bluedotroamingsetting")&&!ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1)&&Ec.C(this.$.oa.xa,4,this.blueDotSettings.toString(),Jb=>{P.a.Wf(Jb.Errors)?d.ULS.sendTraceTag(509732678,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: encountered an error. Errors: ${P.a.nc(Jb.Errors)}`):
Jb.Result||d.ULS.sendTraceTag(509732677,0,10,"BlueDotManager.writeBlueDotSettingsToRoamingService failed to write to roaming service.")},(Jb,tc,fd)=>{Jb=za.a.Pe(Jb.data);d.ULS.sendTraceTag(509732676,0,10,`BlueDotManager.writeBlueDotSettingsToRoamingService: Encountered errors for ${fd}. Errors: ${P.a.nc(Jb)}.`)},null,null)}}Object(b.a)(Bd,"BlueDotManager",pd.a,[408,2]);class de extends f.a{constructor(Jb){super();this.Cbc=null;this.aTi=tc=>{tc=za.a.Pe(tc.data);d.ULS.sendTraceTag(509732673,0,10,`LineageBlueDotFactory: Encountered errors while reading roaming setting. Errors: ${P.a.nc(tc)}.`)};
this.$=Jb;this.Db()}create(){this.Cbc||(this.Cbc=this.PPh());this.Cbc.continueWith(()=>{this.nb(Object(qa.a)(this.$.da,501,()=>new Bd(this.$,this.Cbc.result)))})}static ka(Jb){Jb.da.Ha(500,new de(Jb))}PPh(){if(ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.Test.BlueDotSkipRoamingCall",!1))return Hb.a.Sa(0);let Jb=new ac.a;Object(Ec.w)(this.$.oa.xa,4,tc=>{this.bTi(tc,Jb)},tc=>{this.aTi(tc);Jb.setResult(1)},null,null);return Jb.task}bTi(Jb,tc){P.a.Wf(Jb.Errors)?(d.ULS.sendTraceTag(509732675,
0,10,`LineageBlueDotFactory encountered an error while reading roaming setting. Errors: ${P.a.nc(Jb.Errors)}`),tc.setResult(1)):null==Jb.Result?tc.setResult(0):(Jb=parseInt(Jb.Result,10),d.ULS.sendTraceTag(509732674,0,50,`LineageBlueDotFactory read roaming setting. Value: ${Jb}`),tc.setResult(Jb))}}Object(b.a)(de,"BlueDotManagerFactory",f.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.Lineage");Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.VersionHistory");
Type.registerNamespace("_Ewa");c.a.Fa(Ba.ka);c.a.Fa(La.ka);c.a.Fa(m.ka);c.a.Fa(z.ka);Yb.a.Bi('.LineageActivityPane{height:100%;display:flex;flex-direction:column;overflow:hidden;background-color:#edebe9}.LineageActivityPaneHeader{display:flex;flex-direction:row;position:relative;overflow:hidden;padding-right:16px;padding-left:16px;padding-top:16px;padding-bottom:11px;height:auto;background-color:#edebe9}.LineageActivityPaneTitle{max-width:240px;display:inline-flex;font-weight:bold;font-family:"Segoe UI Semi Bold","Segoe UI Web",Arial,Verdana,sans-serif;font-size:16px;line-height:16px;flex-grow:1;align-content:center;height:auto;text-overflow:ellipsis;overflow:hidden;background-color:#edebe9;margin:0}.LineageActivityCloseButton{display:inline-flex;align-self:center}.LineageActivityBody{height:100%;padding-left:16px;overflow:hidden;background-color:#edebe9}');
(()=>{c.a.Fa(Jb=>{td.ka(Jb);vd.ka(Jb);Oa.ka(Jb);be.ka(Jb);Na.ka(Jb)})})();Type.registerNamespace("Common.App.CatchUpActivity");Za.main();(()=>{c.a.Fa(Jb=>{Oe("Begin");gb.ka(Jb);ib.ka(Jb)})})();(()=>{c.a.Fa(Jb=>{de.ka(Jb)})})()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.catchup.js.map/68941471e671234c01a0b73d147e4af8/EwaDSEsNext.catchup.js.map