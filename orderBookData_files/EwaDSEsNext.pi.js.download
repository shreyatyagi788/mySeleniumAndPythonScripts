'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[19],{1134:function(r,F,a){a.d(F,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertFile")}},1135:function(r,F,a){a.d(F,"a",function(){return c});const c=()=>{Type.registerNamespace("Common.App.InsertPicture")}},1137:function(r,F,a){a.d(F,"a",function(){return b});var c=a(512);const b=()=>{c.a.Bi(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}")}},
1138:function(r,F,a){a.d(F,"a",function(){return c});r=a(0);class c{}c.aGc="b-ring_Apc_Trans";c.Log="cdn_static_resource_ewa_image";Object(r.a)(c,"ResourceHosts",null,[])},1139:function(r,F,a){a.d(F,"a",function(){return e});r=a(0);var c=a(59),b=a(1319);class e{static Fed(f,d,h,l=null){e.Nnc||(e.Nnc=Array.isArray(c.a.Xh(h.ya.NetworkMeasurementUrlList))?c.a.Xh(h.ya.NetworkMeasurementUrlList):null);const k=[];for(let t=0;t<e.Nnc.length;t++){const n=e.Nnc[t];let z=n.key;z||(z=n.Key);if(l&&!l.includes(z))continue;
let w=n.value;w||(w=n.Value);z&&w&&k.push(new b.a(h,z,w,f,d))}return k}}e.Nnc=null;Object(r.a)(e,"NetworkConnectionHelpers",null,[])},1162:function(r,F,a){var c=a(0),b=a(7),e=a(15),f=a(226),d=a(30),h=a(27),l=a(353),k=a(174),t=a(268),n=a(356),z=a(4),w=a(24),m=a(1),u=a(38),y=a(8),v=a(285),C=a(13);class x extends v.a{constructor(Za){super(Za);this.S5g=()=>{e.ULS.sendTraceTag(537167827,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};e.ULS.sendTraceTag(537167828,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");
this.Ob=0;this.tc(1,C.a.instance.ga(2259));Za=C.a.instance.ga(2257);const Xb=this.HM();this.initializeAndShow(Za,this.S5g,Xb)}get kc(){return"ClipboardReadPermissionAskDialog"}HM(){const Za={};Za.id=this.kc;const Xb=C.a.instance.ga(2258);Za.DialogMessage=Xb;return Za}}Object(c.a)(x,"ClipboardReadPermissionAskDialog",v.a,[]);var B=a(52);const H=(Za,Xb,ib,Rb,lc)=>{const nc=Za.Stopwatch,Oc={};Oc.a=lc;Oc.e=nc.id;Oc.c="RearrangeRowColumn";Oc.b="mouse";Oc.d=Za.OperationId.toString();Oc.f=ib.toString();
Oc.g=Rb.toString();Oc.h=Xb.toString();Oc.i=Za.DragDropIsShiftKeyDown;Oc.j=!0;Oc.o=nc.Bc;Oc.q=!1;Oc.r=Za.CopyPasteTargetType.toString();Oc.s=Za.EncounteredDeploymentErrors;return Oc};class I{constructor(Za,Xb){this.NLh=()=>{const ib={};ib.SourceItem=this.toString();return ib};this.sessionStateId=Za;this.sessionId=Xb;this.toJSON=this.NLh}lif(Za){return Za?this.sessionStateId===Za.sessionStateId&&this.sessionId===Za.sessionId:!1}isFromCurrentSession(Za){return this.sessionId===Za.ya.UserSessionId}}Object(c.a)(I,
"SourceItem",null,[]);class U extends I{constructor(Za,Xb,ib,Rb,lc){super(ib,Rb);this.activeFloatingObjectControlId=Za;this.sheetName=Xb;this.type=lc}isEqual(Za){return Za&&Object.getType(Za)===U?this.lif(Za)&&this.activeFloatingObjectControlId===Za.activeFloatingObjectControlId&&this.sheetName===Za.sheetName:!1}toString(){return this.type.toString()}}Object(c.a)(U,"ArtSourceItem",I,[]);var S;(function(Za){Za[Za.valid=0]="valid";Za[Za.notPairwiseDisjoint=1]="notPairwiseDisjoint";Za[Za.cutNotSupportedInDiscontinuousSelection=
2]="cutNotSupportedInDiscontinuousSelection";Za[Za.notValidForm=3]="notValidForm";Za[Za.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(S||(S={}));Object(c.b)("CopySourceValidationOptions",S);var G=a(41);class D extends I{constructor(Za,Xb,ib,Rb,lc){super(Rb,lc);e.ULS.shipAssertTag(537167645,0,!!Xb&&0<Xb.length,"RangeSourceItem.ctor: ranges should not be null or empty");this.$=Za;this.ranges=Xb;this.sheetName=ib}isEqual(Za){return Za&&Object.getType(Za)===D?this.lif(Za)&&G.Q(this.ranges,Za.ranges)&&
this.sheetName===Za.sheetName:!1}toString(){return G.i(this.ranges,",",this.$,!1)}}Object(c.a)(D,"RangeSourceItem",I,[]);const E=Za=>!!Za&&Object.getType(Za)===D;class N{}N.z3j="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(c.a)(N,"ExpectedErrorNames",null,[]);class M{}M.plainText="text/plain";M.html="text/html";M.png="image/png";M.shadowWorkbook="data/shadow-workbook";M.Qqi="metadata/is-last-copy-was-external";M.eni="metadata/is-last-copy-was-external-XLO-source";M.u4g="metadata/chrome-extension-id";
M.nsb="copyId";M.RPg="metadata/additional-signature-data-attributes";Object(c.a)(M,"ClipboardDataFormat",null,[]);const L=Za=>Za.clipboardItems&&(Za=Za.clipboardItems.getItem(M.Qqi))&&"1"===Za?!0:!1,aa=Za=>L(Za)&&!(void 0===Za.clipboardItems||null===Za.clipboardItems)&&!!Za.clipboardItems.getItem(M.png)&&!Za.clipboardItems.getItem(M.plainText),V=Za=>Za.clipboardItems&&(Za=Za.clipboardItems.getItem(M.eni))&&"1"===Za?!0:!1,P=Za=>Za&&(Za=Za.getCachedMetadata(),null===Za||void 0===Za?0:Za.lastCopy)?Za.lastCopy:
null;var ba=a(49),Y=a(21),Z=a(34);class ea{constructor(Za,Xb,ib,Rb){this.$=Za;this.originalDestinations=Xb;this.v$b=ib;this.Csg=Rb;this.ACg=this.originalDestinations;this.twg=this.v$b;this.Wzg="PasteRecoveryUI"}get QPg(){return this.Csg}get yzi(){return this.Wzg}get Gej(){return this.ACg}get BWe(){return this.twg}qKa(){return ea.Q4i}OTh(){return this.v$b&&1===this.v$b.length?this.PTh(this.v$b[0]):null}PTh(Za){var Xb=Y.h(this.$);const ib=Xb.ib.Ai(Za);var Rb=Xb.xg(Za,ib);Xb=Xb.rtl;if(!Rb)return null;
Za=Y.h(this.$).Rf(ib);const lc=Za.zn;if(!lc.zd(Rb))return null;Rb=lc.we(Rb);const nc=Rb.topLeft.y;var Oc=Rb.bottomRight.y;const Ib=Xb?Rb.bottomRight.x:Rb.topLeft.x;Rb=Xb?Rb.topLeft.x:Rb.bottomRight.x;var gc=new ba.a(Rb+(Xb?-81:81),Oc+38+6);if(lc.Rha(gc))return this.O4a(Za,lc,ib,Rb,Oc,Xb?12:-3,66);gc=new ba.a(Rb+(Xb?-81:81),Oc);if(lc.Rha(gc))return this.O4a(Za,lc,ib,Rb,Oc,Xb?20:3,22);gc=new ba.a(Rb,Oc+38+6);if(lc.Rha(gc))return this.O4a(Za,lc,ib,Rb,Oc,-81+(Xb?18:0),66);Rb=new ba.a(Ib+(Xb?81:-81),Oc);
if(lc.Rha(Rb))return this.O4a(Za,lc,ib,Ib,Oc,-81+(Xb?12:-6),22);Oc=new ba.a(Ib,nc-38-6);return lc.Rha(Oc)?this.O4a(Za,lc,ib,Ib,nc,Xb?15:0,16):this.O4a(Za,lc,ib,Xb?lc.topLeft.x:lc.bottomRight.x,lc.bottomRight.y,-81+(Xb?15:-6),22)}O4a(Za,Xb,ib,Rb,lc,nc,Oc){var Ib=Y.h(this.$);const gc=Ib.rtl;Za=Sys.UI.DomElement.getLocation(Za.domElement);Rb=new Sys.UI.Point(Rb+(gc?0:Za.x)-Xb.topLeft.x,lc+Za.y-Xb.topLeft.y);gc&&(Ib=Ib.view.visibleArea,Rb.x=Ib.bottomRight.x-Ib.topLeft.x-Rb.x,2===ib||4===ib)&&(Rb.x+=Xb.bottomRight.x);
Rb=Z.a(this.$).Mja(Rb);return new Sys.UI.Point(Rb.x+nc,Rb.y+Oc)}}ea.Q4i=["PasteRecoveryUI"];Object(c.a)(ea,"PasteRecoveryUI",null,[789]);var ra=a(68),O=a(382);class da{}da.JHg="ActiveSelection";da.shadowWorkbook="ShadowWorkbook";da.Wpg="GVML";da.plainText="PlainText";da.html="Html";da.eWg="Bitmap";Object(c.a)(da,"PayloadType",null,[]);class xa{}xa.FLj="Slice6";Object(c.a)(xa,"SliceName",null,[]);class ia{}ia.ILi="NotCalled";ia.success="Success";ia.failed="Failed";Object(c.a)(ia,"SucceededPopulatingSystemClipboardOptions",
null,[]);var Ma=a(362);const Ta=(Za,Xb)=>Za?Xb&&Xb.ya?Za.sessionId!==Xb.ya.UserSessionId:(e.ULS.shipAssertTag(537166209,0,!1,"ewaControl shouldn't be null"),!1):(e.ULS.shipAssertTag(537166210,0,!1,"copyContext shouldn't be null"),!1),Da=Za=>{switch(Za){case 0:return"None";case 2:return"Art";case 1:return"Range";default:return"Unknown"}},fa=Za=>{if(!Za)return"null";const Xb=[];for(const ib of Za.get())Xb.push(`${ib.clipboardDataFormat}(${ib.data.length})`);Xb.sort();return Xb.join(",")};var ua;(function(Za){Za[Za.valid=
0]="valid";Za[Za.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";Za[Za.discontinuousSelectionNotSupportPasteFromExternal=2]="discontinuousSelectionNotSupportPasteFromExternal";Za[Za.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";Za[Za.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";Za[Za.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";
Za[Za.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";Za[Za.copySourceNotValid=7]="copySourceNotValid";Za[Za.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";Za[Za.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";Za[Za.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";Za[Za.unknown=100]="unknown"})(ua||(ua={}));Object(c.b)("PasteValidationOptions",ua);var Fa=a(50),ca=a(140),ka=a(37),Ca=a(157),fb=a(347),
yb=a(29),mb=a(319),nb=a(11),X=a(22),R=a(129),wa=a(115),na=a(566),Ba=a(100),Ra=a(55),qa=a(204),La=a(65),Yb=a(345);class mc extends Sys.EventArgs{constructor(Za,Xb,ib){super();this.command=Za;this.destinationRange=Xb;this.sourceRange=ib}}Object(c.a)(mc,"PasteCSERenderedEventArgs",Sys.EventArgs,[]);var Zb=a(126),qb;(function(Za){Za[Za.source=0]="source";Za[Za.destination=1]="destination"})(qb||(qb={}));Object(c.b)("RangeType",qb);class Ha extends u.a{constructor(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc=null){super();
this.pasteShortcutManager=null;this.lhf=m.EwaSettings.wb();this.Swa=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.Deg=null;this.R7a=!1;this.Atd=m.EwaSettings.isChangeGateEnabled("OfficeVSO:6660890_Tag_aoi75RetryLoggingFix2");this.Kwa=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7205979_DemoteDragDropNonEmptyRangeLogLevel");this.MDd=Fc=>{this.UEj(Fc)&&(this.fo.efc(),e.ULS.sendTraceTag(537167777,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};
this.oEi=(Fc,Vc)=>{e.ULS.sendTraceTag(537167768,0,50,`CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [${Fc}]. userPressedExtensionLink=${Vc}`);this.gridView.focus()};this.dd=(Fc,Vc)=>{Vc.cN||Vc.Bf||this.fr("OnWorkbookOpened",!1).catch(()=>{})};this.ij=(Fc,Vc)=>{Fc=P(this.qK);const ed=this.fo.Qxb(Fc);ed&&(Vc.na&&Vc.na.sheetName===ed.sheetName&&ed.isFromCurrentSession(this.$)?this.fo.xcf(ed.ranges,Fc.commandParameters.commandType):this.fo.efc())};this.Dpc=
(Fc,Vc)=>{Fc=P(this.qK);(Fc=this.fo.Qxb(Fc))&&Vc.item&&Vc.item.sheetName===Fc.sheetName&&Fc.isFromCurrentSession(this.$)&&this.fr("OnItemDeleting",!1).catch(()=>{})};this.UGb=(Fc,Vc)=>{this.lhf?this.Deg(Fc,Vc):this.gJf()};this.lR=(Fc,Vc)=>{1===Vc.Iq&&Vc.Lf.operation.flags&2&&this.fr("OnQueueItemChanged/ItemRemoved",!1).catch(()=>{})};this.$=Za;this.Nh=ib;this.gridView=Y.h(Za);this.fo=lc;this.hji=nc;this.qK=Xb;this.u5b=Rb;this.getStringifiedError=gc||copyPasteInfra.getStringifiedError;this.Z8f=1===
Ib;this.cdd=m.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray");this.Aj();this.copyPasteShortcutDialogFactory=this.$.da.Aa(85);e.ULS.shipAssertTag(537167825,0,!!this.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");Oc||(e.ULS.sendTraceTag(537167824,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),Oc=Ha.Gkh);this.userHash=d.a.Yu(Oc);this.xIi="CultureTag: "+C.a.instance.s7b+" HASH: ";
this.qK.addMetadataChangeListener(Ha.Wvf,this.MDd);this.kHi=O.a.wEb;this.cya=this.Swa?m.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):y.a.cya;(this.ro=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste"))&&Za.da.gb(478,Fc=>{this.pasteShortcutManager=Fc});this.lhf&&(this.Deg=mb.a(()=>{this.gJf()},1,this.$.la,"CopyPasteInfrastructure.OnStartEditInternal",!0))}rNe(){var Za=P(this.qK);return Za?(Za=Za.sourceItem)&&
!Za.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167778,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),!1):!0:!1}get pasteIndicationManager(){return this.$.da.Aa(373)}iOg(Za){this.addHandler(Ha.GEd,Za)}Zkj(Za){this.removeHandler(Ha.GEd,Za)}copy(Za){Za.stopwatch=this.$.Jb.Gc("UserAction",B.b().Cj(Za.ribbonCommandInfo.command)+"ClientSide");if(this.ro){const nc=Fa.GetServiceTaskFactory.Oa(this.$.da,478,479,0);ka.TaskExtensions.za(nc,
()=>{this.pasteShortcutManager=nc.result},this.la,3)}const Xb=!!P(this.qK);m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.ZA&&(this.R7a=!1);this.fr("Copy/before/"+l.a[Za.ribbonCommandInfo.method],!1,void 0,!0,Za.copyPasteTargetType).catch(()=>{});var ib=-1985798686===Za.ribbonCommandInfo.command;if(1===this.gridView.Ke&&(ib=this.fo.Bhf(this.gridView.ha.qa.selectedRanges,ib),0!==ib)){const nc=Ha.y$g(ib);this.kza(nc,S[ib],!1);return Promise.reject(!1)}Za.userHash=
this.userHash;Za.id=k.a.create().toString();let Rb=this,lc=this;return this.u5b.onCopy(Za).then(nc=>{nc.isAsyncCopy||Za.stopwatch.stop();Rb.pasteIndicationManager.NNe();const Oc=Ma.d(Za);e.ULS.sendTraceTag(24150883,0,50,`CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. ${Oc}`);Rb.hCi(nc,Xb);nc=m.EwaSettings.isChangeGateEnabled("OfficeVSO:6591921_CheckTargetTypeForEnterToPaste")?1===Za.copyPasteTargetType:!0;!Za.isFormatPainter&&Rb.ro&&nc&&(Rb.pasteShortcutManager?Rb.pasteShortcutManager.csh():
e.ULS.shipAssertTag(537167823,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},nc=>{let Oc=!1,Ib="none",gc=Ha.ttb,Fc=!0,Vc=-1,ed=Ha.copyErrorName+Ha.iJa,Sd=!1,Zd=null;if(nc){Zd=nc.copyContext;Vc=nc.reason;ed+=Ha.AKa(nc);nc.message&&(gc=nc.message);var pa=Ha.x$g(nc);if(pa)if(3===pa.copyErrorName)Oc=!0,gc=Ib="Async Copy canceled by the user.",Fc=!1;else if(yb.a.qq(pa.ewaErrors))if(gc=lc.occ(pa.ewaErrors),yb.a.dh(pa.ewaErrors,Ha.operationSucceededWithAlert))Sd=Oc=!0;else if(yb.a.dh(pa.ewaErrors,
Ha.pasteDataLimitHit)||yb.a.dh(pa.ewaErrors,Ha.copyThrottlingError))Oc=!0;13===nc.reason?(Oc=!0,Fc=!1):11===nc.reason&&(Fc=!1)}pa=nc?lc.getStringifiedError(nc):"null";Oc?(pa=Ma.d(Za),e.ULS.sendTraceTag(36304157,0,15,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: ${Fc}, Friendly message: ${Ib}, Error Message: ${gc}, CommandParameters: ${pa}`)):e.ULS.sendTraceTag(24150912,0,10,`CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: ${Fc}, Error Message: ${pa}, CommandParameters: ${Ma.d(Za)}`);
Fc&&lc.fr("Copy/fail/"+l.a[Za.ribbonCommandInfo.method],!0,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});lc.gCi(Za,Oc,gc,ed,Vc,Sd,Zd);return Promise.reject(nc)})}paste(Za){Za.stopwatch=this.$.Jb.Gc("UserAction",B.b().Cj(Za.ribbonCommandInfo.command)+"ClientSide");m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.ZA&&(e.ULS.sendTraceTag(537167822,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.R7a=!1,Za.clipboardPicklingApiDataFormatsToRead=
[M.shadowWorkbook]);Y.h(this.$).wh&&Y.h(this.$).wh.z0(this.Rhd(Za.ribbonCommandInfo.command),Za.stopwatch.id);if(Za.isPasteCommandFromRecoveryUI){var Xb=this.$.da.Aa(406);var ib=this.cdd?G.d(Xb.alc):t.a.clone(Xb.alc);Xb=Xb.Qud;Za.pasteRecoveryCachedClipboardItems=Xb?Xb[Ha.kMf]:null}else ib=this.cdd?G.d(this.gridView.ha.qa.selectedRanges):t.a.clone(this.gridView.ha.qa.selectedRanges);Za.originalDestinations=ib;Za.expandDestinations=this.M0c(Za.originalDestinations,Za.commandType);if(this.X0c(Za.commandType,
Za.expandDestinations)||this.t1g())return Za.userHash=this.userHash,Za.id=k.a.create().toString(),m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!h.a.ZA&&(Za.clipboardReadPermissionPromptShown=!1,Za.clipboardAsyncApiDataFormatsToRead=[M.plainText+"Async"],this.u5b.shouldShowClipboardReadPermissionDialog().then(Rb=>{Rb&&(Za.clipboardReadPermissionPromptShown=!0,new x(this.$));return Promise.resolve(!0)},()=>Promise.resolve(!0))),this.u5b.onPaste(Za).then(Rb=>
this.dqc(Rb,Za),Rb=>this.GGb(Za,Rb));this.$.Yc(927125067,ra.a.zb,30,null);ib=G.i(Za.expandDestinations,",",this.$,!1);e.ULS.sendTraceTag(24150913,0,15,`CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: ${ib}, CommandType: ${Za.commandType}, copyPasteTargetType="${Za.copyPasteTargetType}"`);return Promise.resolve(!0)}Rhd(Za){switch(Za){case 1804571062:return 6;case -185374993:return 7;case 1766348718:return 8;default:return 3}}t1g(){return!!Y.h(this.$).ha.Ra.activeFloatingObjectControlId&&
this.$.Us(null,!1,470)}aDb(){const Za=P(this.qK);return Za&&Za.commandParameters?Za.commandParameters.copyPasteTargetType:0}Pqi(){return!!P(this.qK)&&Ta(P(this.qK),this.$)}fr(Za,Xb,ib=!1,Rb=!1,lc=0){try{this.ro&&this.pasteShortcutManager&&this.pasteShortcutManager.Y7b();let nc=lc;const Oc=this.syi();if(!Rb&&2===Oc)return e.ULS.sendTraceTag(537167821,0,50,`CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '${Xb}', isExplicit = '${ib}', isForce = '${Rb}', Current CCP operation copyPasteTargetType = '${lc}', LastCopyPasteTargetType = '${Oc}'`),
Promise.reject(null);0===nc&&(nc=Oc);const Ib=this.$.Jb.Gc("UserAction","ClearCopyState"),gc=Ib.id;e.ULS.sendTraceTag(537167820,0,50,`CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '${Xb}', isExplicit = '${ib}', isForce = '${Rb}', Current CCP operation copyPasteTargetType = '${lc}', LastCopyPasteTargetType = '${Oc}'`);this.fo.efc();this.Tbj();return this.u5b.onCancelCopy(Xb).then(()=>{Xb&&m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!h.a.ZA&&(this.R7a=!1);Ib.stop();this.Drf(Za,gc,!0,ib,Xb,"","",Ib.Bc,nc);return Promise.resolve(!0)},Fc=>{var Vc=Fc?this.getStringifiedError(Fc):"null";e.ULS.sendTraceTag(24150915,0,15,`CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: ${Vc}`);Ib.stop();Vc=Ha.J1g+Ha.iJa;let ed=Ha.ttb;Fc&&(Vc+=Ha.AKa(Fc),Fc.message&&(ed=Fc.message));this.Drf(Za,gc,!1,ib,Xb,ed,Vc,Ib.Bc,nc);return Promise.reject(Fc)})}catch(nc){return Promise.reject(null)}}L2c(Za,Xb,
ib=!1,Rb=!1,lc=0){return Rb||this.rNe()?this.fr(Za,Xb,ib,Rb,lc):(e.ULS.sendTraceTag(537167819,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))}kza(Za,Xb,ib){e.ULS.sendTraceTag(590705172,0,50,`CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: ${Xb}`);const Rb=new Ba.a;Rb.ia("reason",Xb);
na.a(R.a.discontinuousSelectionBlocking,[ib?wa.a.J4i:wa.a.tah],!0,!0,!1,!1,Rb);Za=yb.a.ed(1,1,750,Za,0,371863010,"DiscontinuousSelectionBlocking");m.EwaSettings.mz()?new fb.a(this.$,Za):(Za=new Ca.ErrorDialog(this.$,Za),Za.initialize(),Za.kg())}syi(){const Za=P(this.qK);return Za&&Za.sourceItem?Object.getType(Za.sourceItem)===U?2:1:0}dragDropCells(Za,Xb,ib,Rb,lc=!1){Za.stopwatch=this.$.Jb.Gc("UserAction","DragDropClientSide");Za.isDragDrop=!0;this.fr("DragDrop/before/"+l.a[Za.ribbonCommandInfo.method],
!1,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});const nc=lc?2:1;let Oc=0;Oc=lc?4:Rb?256:128;const Ib={encounteredDeploymentErrors:!1};Ib.commandParameters=Za;Za.userHash=this.userHash;Za.id=k.a.create().toString();return this.Atd?this.fo.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(ib,this.$),nc,Oc,[Za.stopwatch],Ib,!1,()=>{e.ULS.sendTraceTag(537167818,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.$8a(Za,nc,Xb,ib,Ib)},gc=>
{const Fc=gc?this.getStringifiedError(gc):"null";this.Kwa||e.ULS.sendTraceTag(537167817,0,10,`CopyPasteInfrastructure.DragDropCells: ${Fc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.u$a(gc,Za,nc,Xb,ib,Ib)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},gc=>Promise.reject(gc)):this.fo.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(ib,this.$),nc,Oc,[Za.stopwatch],Ib,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410075,0,50,`CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);
this.gridView.ha.selectionType=-1;this.$8a(Za,nc,Xb,ib,Ib);return Promise.resolve(!0)},gc=>{const Fc=gc?this.getStringifiedError(gc):"null";this.Kwa||e.ULS.sendTraceTag(521410074,0,10,`CopyPasteInfrastructure.DragDropCells: ${Fc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.u$a(gc,Za,nc,Xb,ib,Ib);return Promise.reject(gc)})}Fph(Za,Xb,ib,Rb,lc=!1){Za.stopwatch=this.$.Jb.Gc("UserAction","DragDropReplaceClientSide");Za.isDragDrop=!0;this.L2c("DragDropReplace/before/"+l.a[Za.ribbonCommandInfo.method],
!1,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});const nc=lc?2:1;let Oc=0;Oc=lc?4:Rb?256:128;const Ib={encounteredDeploymentErrors:!1};Ib.commandParameters=Za;m.EwaSettings.getBooleanFeatureGate(O.a.E8b,!1)&&(Za.isDragInsert=!1);Za.userHash=this.userHash;Za.id=k.a.create().toString();return this.Atd?this.fo.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(ib,this.$),nc,Oc,[Za.stopwatch],Ib,!1,()=>{e.ULS.sendTraceTag(537167816,0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);
this.$8a(Za,nc,Xb,ib,Ib)},gc=>{const Fc=gc?this.getStringifiedError(gc):"null";this.Kwa||e.ULS.sendTraceTag(537167815,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Fc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);return this.u$a(gc,Za,nc,Xb,ib,Ib)}).then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},gc=>Promise.reject(gc)):this.fo.pasteRange(Za.ribbonCommandInfo,G.q(Xb,this.$),G.q(ib,this.$),nc,Oc,[Za.stopwatch],Ib,!1,null,null).then(()=>{e.ULS.sendTraceTag(521410073,
0,50,`CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.$8a(Za,nc,Xb,ib,Ib);return Promise.resolve(!0)},gc=>{const Fc=gc?this.getStringifiedError(gc):"null";this.Kwa||e.ULS.sendTraceTag(521410072,0,10,`CopyPasteInfrastructure.DragDropReplaceCells: ${Fc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.u$a(gc,Za,nc,Xb,ib,Ib);return Promise.reject(gc)})}Eph(Za,Xb,ib,Rb,lc=!1){Za.stopwatch=this.$.Jb.Gc("UserAction",
"DragDropInsertClientSide");this.L2c("DragDropInsert/before/"+l.a[Za.ribbonCommandInfo.method],!1,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});const nc=lc?2:1,Oc=G.K(this.M0c([ib],nc));var Ib=this.$.ea.na.sheetName;const gc=this.$.ea.na.sheetName,Fc=G.v(Xb,this.$);Fc.SheetName=Ib;Ib=G.v(Oc,this.$);Ib.SheetName=gc;Rb=Oc.isRow||Xb.isRow||Rb?1:0;const Vc={encounteredDeploymentErrors:!1};Za.isDragInsert=!0;Vc.commandParameters=Za;Za.userHash=this.userHash;Za.id=k.a.create().toString();if(this.Atd)return lc=
this.fo.WNe(Vc,Fc,Ib,lc,Rb,Za.ribbonCommandInfo,()=>{e.ULS.sendTraceTag(537167814,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.$8a(Za,nc,Xb,ib,Vc)},Sd=>{const Zd=Sd?this.getStringifiedError(Sd):"null";this.Kwa||e.ULS.sendTraceTag(537167813,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Zd}, copyPasteTargetType="${Za.copyPasteTargetType}"`);this.u$a(Sd,Za,nc,Xb,ib,Vc)}),qa.c(lc.then(()=>{this.gridView.ha.selectionType=-1;return Promise.resolve(!0)},
Sd=>Promise.reject(Sd))).So(()=>!0);lc=this.fo.WNe(Vc,Fc,Ib,lc,Rb,Za.ribbonCommandInfo,null,null);let ed=this;return qa.c(lc.then(()=>{e.ULS.sendTraceTag(521410071,0,50,`CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="${Za.copyPasteTargetType}"`);this.gridView.ha.selectionType=-1;this.$8a(Za,nc,Xb,ib,Vc);return Promise.resolve(!0)},Sd=>{const Zd=Sd?ed.getStringifiedError(Sd):"null";this.Kwa||e.ULS.sendTraceTag(521410070,0,10,`CopyPasteInfrastructure.DragDropInsertCells: ${Zd}, copyPasteTargetType="${Za.copyPasteTargetType}"`);
ed.u$a(Sd,Za,nc,Xb,ib,Vc);return Promise.reject(Sd)})).So(()=>!0)}jff(Za,Xb){var ib=P(this.qK);if(!ib)return e.ULS.sendTraceTag(537167812,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),Ra.Task.Sa(!1);if(!E(ib.sourceItem))return e.ULS.sendTraceTag(537167811,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Ra.Task.Sa(!1);var Rb=ib.sourceItem;if(!Rb)return e.ULS.shipAssertTag(537167810,0,!!Rb,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Ra.Task.Sa(!1);
if(!Rb.isFromCurrentSession(this.$))return e.ULS.sendTraceTag(537167809,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Ra.Task.Sa(!1);if(1<Rb.ranges.length)return e.ULS.sendTraceTag(537167808,0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.kza(2191,"InsertCopiedCutCells",!0),Ra.Task.Sa(!1);ib=G.K(Rb.ranges);var lc=this.gridView.ha.qa.ld.clone();Za=G.K(this.M0c([lc],Za));const nc=this.opf();Rb=Rb.sheetName;lc=this.$.ea.na.sheetName;const Oc=G.v(ib,
this.$);Oc.SheetName=Rb;const Ib=G.v(Za,this.$);Ib.SheetName=lc;Rb=this.gridView.ha.qa.activeRange;return(Za.Rg||ib.Rg||m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578311_InsertCopiedCutCellsDefaultShiftInTable")&&this.fo.HGj(this.$,ib,Rb)?Ra.Task.Sa(0):Za.isRow||ib.isRow||m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578311_InsertCopiedCutCellsDefaultShiftInTable")&&this.fo.IGj(this.$,ib,Rb)?Ra.Task.Sa(1):this.hji.L5b(this.$,Y.h(this.$).rtl)).So(gc=>this.fo.executeInsertCopiedCutCellsOperation(Oc,
Ib,nc,gc.result,Xb,null,null)).continueWith(()=>{nc?this.fo.efc():this.fr("InsertCopiedCutCells/success/"+l.a[Xb.method],!0)})}pic(){const Za=P(this.qK),Xb=this.gridView.ha.qa.Tg;return!!Za&&E(Za.sourceItem)&&Xb&&1===Za.sourceItem.ranges.length}opf(){return this.ppf(-911352779)}$kc(){return this.ppf(-1985798686)}X0c(Za,Xb){var ib=new ca.a(this.$.va),Rb=36===Za;const lc=ib.Pd(4);Za=2===this.aDb()&&ib.Pd(1);Rb=Rb&&lc;ib=!ib.Ph||!this.$kc()||!ca.a.t8b(Xb,Y.h(this.$));return Rb||Za||this.$.Us(Xb,!0)&&
ib}cic(Za,Xb){return this.fo.cic(Za,Xb)}dispose(){super.dispose();this.Sj();this.qK.removeMetadataChangeListener(Ha.Wvf)}a9c(Za,Xb,ib,Rb,lc,nc){if(!this.C5g(Za.commandParameters.ribbonCommandInfo.command))return Za.cseStatus=2,!1;if(nc&&Xb.zd(Rb))return Za.cseStatus=4,!1;if(ib!==lc)return Za.cseStatus=6,!1;if(m.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")&&(Rb.width%Xb.width||Rb.height%Xb.height))return Za.cseStatus=16,!1;if(m.EwaSettings.getBooleanFeatureGate(O.a.DJe,
!1)){if(ib=Xb,Rb=Rb.we(this.gridView.hi),Xb=null===Xb.we(this.gridView.hi),lc=Za.commandParameters.ribbonCommandInfo.command,Xb&&1804571062!==lc&&-185374993!==lc||!Rb)return Za.cseStatus=7,!1}else if(ib=Xb.we(this.gridView.hi),Rb=Rb.we(this.gridView.hi),!ib||!Rb)return Za.cseStatus=7,!1;if(O.a.uxe){Xb=this.txe(this.gridView,Za.commandParameters.ribbonCommandInfo.command,ib,qb.source);if(0!==Xb)return Za.cseStatus=Xb,!1;Xb=this.txe(this.gridView,Za.commandParameters.ribbonCommandInfo.command,Rb,qb.destination);
if(0!==Xb)return Za.cseStatus=Xb,!1}Xb=G.v(ib,this.$);Xb=this.Nh.O4i(this.gridView,Xb,G.v(Rb,this.$),Za.commandParameters.ribbonCommandInfo.command,Za.commandParameters.stopwatch);1===Xb&&(nc&&(this.Nh.D2c(ib,!1),this.Nh.D2c(ib,!0)),nc=new mc(Za.commandParameters.ribbonCommandInfo.command,Rb,ib),Y.h(this.$).Abj(nc),this.pasteIndicationManager.Xld(Za.commandParameters.id),this.mxc(Za.commandParameters.expandDestinations,Za.commandParameters.isPasteCommandFromRecoveryUI),this.$Ce("DoPasteClientEstimation/"+
l.a[Za.commandParameters.ribbonCommandInfo.method],Za));Za.cseStatus=Xb;return 1===Xb}txe(Za,Xb,ib,Rb){const lc=new Zb.a("CopyPasteInfrastructure.blockCseForPaste",Za,ib);try{for(;lc.moveNext();){let nc=lc.get_current().cell;if(nc.hz)return 8;if(237279923===Xb||-185374993===Xb){if(nc.rS&&m.EwaSettings.isChangeGateEnabled("OfficeVSO:7148128_BlockWrapTextCseForPaste"))return 18;if(nc.MM&&m.EwaSettings.isChangeGateEnabled("OfficeVSO:7327017_BlockCondFormattingForPaste"))return 19}if(Rb===qb.source){if(nc.Iba)return 23;
if(nc.mtd)return 24;if(nc.hasIgnorableError)return 25;if((237279923===Xb||1804571062===Xb)&&this.Vsi(Za,ib))return 20;if(237279923===Xb){if(nc.bka)return 22;if(nc.hasHyperlink||nc.Oka)return 21}}}}finally{lc&&lc.dispose()}return 0}xNf(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,!1,this.oEi)}UDi(Za,Xb,ib,Rb){Za=H(Za,Xb,ib,Rb,this.$.ya.UserSessionId);Za.k=!0;B.b().Se(45,Za,!0)}zYi(Za,Xb,ib,Rb,lc){var nc=!1,Oc=!1,Ib=Ha.ttb,gc=Ha.PNe+Ha.iJa;Za&&(gc+=Ha.AKa(Za),yb.a.qq(Za.ewaErrors)?
(Ib=this.occ(Za.ewaErrors),yb.a.dh(Za.ewaErrors,[-103190598])&&(nc=!0)):Za.message&&(Ib=Za.message));Oc||(Oc=this.Aqd(Za));Xb=H(Xb,ib,Rb,lc,this.$.ya.UserSessionId);Xb.k=!1;Xb.l=Oc;Xb.n=Ib;Xb.p=gc;Xb.q=nc;B.b().Se(45,Xb,!0);return Promise.reject(Za)}Vsi(Za,Xb){const ib=Za.Wj("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",new w.Range(Xb.top,Xb.right,Xb.bottom,Xb.right,!0,!0));for(;ib.$$mn();){let Rb=ib.$$cu();if(Rb&&Rb.Yva())return e.ULS.sendTraceTag(509436432,0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),
!0}for(Za=Za.Wj("CopyPasteInfrastructure.isRangeWithBottomOrRightBorder",new w.Range(Xb.bottom,Xb.left,Xb.bottom,Xb.right,!0,!0));Za.$$mn();)if((Xb=Za.$$cu())&&Xb.Uva())return e.ULS.sendTraceTag(509436431,0,50,"CopyPasteInfrastructure.ShowInstantaneousFormattingFromRange: no instantaneous."),!0;return!1}C5g(Za){switch(Za){case 237279923:case 808159687:return m.EwaSettings.isChangeGateEnabled("OfficeVSO:7317055_PasteCse");case -185374993:return!0;case 1804571062:return!0;default:return!1}}ppf(Za){const Xb=
P(this.qK);if(!Xb)return!1;const ib=Xb.sourceItem;return ib&&!ib.isFromCurrentSession(this.$)?(e.ULS.sendTraceTag(537167779,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):Xb.commandParameters.ribbonCommandInfo.command===Za}UEj(Za){return Za&&Za.lastCopy?Ta(Za.lastCopy,this.$):!0}t2e(Za,Xb,ib,Rb,lc){const nc={};nc.a=this.$.ya.UserSessionId;nc.e=Za.stopwatch.id;nc.c=B.b().Cj(Za.ribbonCommandInfo.command);nc.b=l.a[Za.ribbonCommandInfo.method];
nc.d=Za.id;nc.f=ib.toString();nc.g=Rb.toString();nc.h=Xb.toString();nc.o=Za.stopwatch.Bc;nc.q=!1;nc.r=Za.copyPasteTargetType.toString();nc.s=lc.encounteredDeploymentErrors;m.EwaSettings.getBooleanFeatureGate(O.a.E8b,!1)&&(nc.i=lc.commandParameters.dragDropIsShiftKeyDown,nc.j=lc.commandParameters.isDragInsert);return nc}$8a(Za,Xb,ib,Rb,lc){Za=this.t2e(Za,Xb,ib,Rb,lc);Za.k=!0;B.b().Se(45,Za,!0)}pCi(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc){Za=this.t2e(Za,Xb,ib,Rb,gc);Za.k=!1;Za.l=lc;Za.n=nc;Za.p=Oc;Za.q=Ib;B.b().Se(45,
Za,!0)}Drf(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc){const Fc={};Fc.a=this.$.ya.UserSessionId;Fc.b=Xb;Fc.c=Za;Fc.f=ib;Fc.e=Rb;Fc.d=lc;Fc.g=nc;Fc.h=Oc;Fc.i=Ib;Fc.j=gc.toString();B.b().Se(46,Fc,!0)}hCi(Za,Xb){Za=this.Q1e(Za.commandParameters,Za);Za.l=!0;Za.j=Xb;B.b().Se(43,Za,!0)}gCi(Za,Xb,ib,Rb,lc,nc,Oc){Za=this.Q1e(Za,Oc);Za.l=!1;Za.m=Xb;Za.o=ib;Za.y=Rb;Za.x=lc;Za.z=nc;B.b().Se(43,Za,!0);e.ULS.sendTraceTag(537167776,0,15,`CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName=${Za.y},ErrorReason=${Za.x},IsExpectedError=${Za.m},IsSucceededWithAlert=${Za.z},ErrorMessage=${Za.o}`)}Q1e(Za,
Xb){const ib={};ib.a=this.$.ya.UserSessionId;ib.f=Za.stopwatch.id;ib.g=Za.id;ib.c=B.b().Cj(Za.ribbonCommandInfo.command);ib.b=l.a[Za.ribbonCommandInfo.method];ib.q=Za.stopwatch.Bc;ib.bd=Ha.Ebc();ib.bg=Za.copyPasteHandlerName;ib.bj=void 0===Za.ribbonCommandInfo.Ve||null===Za.ribbonCommandInfo.Ve?null:n.a[Za.ribbonCommandInfo.Ve];ib.bq=Za.uploadToClipService;ib.br=Za.floatingObjectType;ib.s=Za.copyPasteTargetType.toString();ib.bc=Da(Za.copyPasteTargetType);ib.z=!1;if(Xb){ib.bk=Xb.id;ib.bl=Xb.serverRequestTimeInMs;
Xb.requestTelemetryData&&(ib.bm=Xb.requestTelemetryData.EcsOperationDuration,ib.bn=Xb.requestTelemetryData.EcsRequestDuration,ib.bo=Xb.requestTelemetryData.WfeRequestDuration);ib.d=Xb.sourceItem?Xb.sourceItem.toString():null;ib.e=-1;if(E(Xb.sourceItem)){ib.e=0;Za=Xb.sourceItem.ranges;for(const Rb of Za)ib.e+=Rb.Oy}ib.h=Xb.isAsyncCopy;ib.i=Xb.isFromCache;ib.k=Xb.isSelectionAllowed;ib.r=Xb.plainTextPayloadSize;ib.u=Xb.htmlPayloadSize;ib.v=Xb.htmlSizeExceedsLimit;ib.w=Xb.copyTotalSizeExceedsLimit;ib.t=
Xb.shadowWorkbookPayloadSize;ib.p=Xb.clientSideCopyTime;ib.ba=Xb.encounteredDeploymentErrors;ib.bb=Xb.shadowWorkbookSizeExceedsLimit;ib.be=Xb.syncClipboardItemsKeys;ib.bf=Xb.asyncClipboardItemsKeys;ib.bh=this.zGe(Xb.succeededPopulatingSystemClipboardSync);ib.bi=this.zGe(Xb.succeededPopulatingSystemClipboardAsync)}return ib}mxc(Za,Xb=!1){if(!this.gridView.fb&&!this.gridView.Vh){var ib=this.gridView.ha.qa,Rb=!Xb&&1===Za.length&&G.Q(Za,ib.selectedRanges),lc=Rb?ib.activeCell:Za[0].topLeft;Za[0].contains(lc)||
(e.ULS.shipAssertTag(537167775,0,!1,`CopyPasteInfrastructure.SelectPastedRange: SelectedRanges ${ib.selectedRanges}, IndexOfActiveRange ${ib.es}, ActiveCell ${ib.activeCell}, calculatedDestinationRanges ${Za}, keepThePreviousActiveCell ${Rb}, newActiveCell ${lc}, isPasteCommandFromRecoveryUI ${Xb}`),lc=Za[0].topLeft);this.gridView.ha.ty(Za,0,lc,0,void 0,"CopyPasteInfrastructure.SelectPastedRange")}}Q5e(Za,Xb){const ib={};ib.a=this.$.ya.UserSessionId;ib.g=Za.stopwatch.id;ib.t=Za.stopwatch.Bc;ib.bz=
!1;Xb&&(ib.bv=Xb.id,ib.bw=Xb.serverRequestTimeInMs,ib.n=Xb.commandParameters.clipboardFormatReadTimes,ib.o=Xb.commandParameters.clipboardFormatReadStatus,ib.p=Xb.commandParameters.clipboardReadPermissionPromptShown,ib.q=Xb.commandParameters.asyncApiReadTimedOut,Xb.requestTelemetryData&&(ib.cb=Xb.requestTelemetryData.EcsOperationDuration,ib.cc=Xb.requestTelemetryData.EcsRequestDuration,ib.cd=Xb.requestTelemetryData.WfeRequestDuration));ib.x=Za.copyPasteTargetType.toString();ib.bl=Da(Za.copyPasteTargetType);
ib.br=Za.copyPasteHandlerName;ib.i=G.i(Za.expandDestinations,",",this.$,!1);ib.h=G.i(Za.originalDestinations,",",this.$,!1);ib.e=Za.id;ib.d=Za.commandType;ib.c=B.b().Cj(Za.ribbonCommandInfo.command);ib.b=l.a[Za.ribbonCommandInfo.method];ib.bf=!1;ib.bg=!1;ib.bp=Ha.Ebc();ib.bt=void 0===Za.ribbonCommandInfo.Ve||null===Za.ribbonCommandInfo.Ve?null:n.a[Za.ribbonCommandInfo.Ve];ib.cj=Za.isPasteCommandFromEnterShortcut;if(ib.ca=Za.isPasteCommandFromRecoveryUI)ib.cf=Za.pasteRecoveryUndoStopwatch.id,ib.cg=
Za.pasteRecoveryUndoStopwatch.Bc;if(Xb){if((Za=Xb.copyContextSnapshot)&&!Xb.wasLastCopyExternal){ib.f=Za.commandParameters.id;ib.j=Za.sourceItem.toString();ib.k=-1;if(E(Za.sourceItem)){ib.k=0;const Rb=Za.sourceItem.ranges;for(const lc of Rb)ib.k+=lc.Oy}ib.bg=1===Za.commandParameters.commandType}else Xb.clipboardItems?ib.f=Xb.clipboardItems.getItem(M.nsb):e.ULS.sendTraceTag(537167774,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");ib.bz=Xb.pasteRecoveryUIDisplayed;
ib.ci=Xb.cseStatus}else e.ULS.sendTraceTag(537167773,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return ib}ADi(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc){Za=this.Q5e(Za,Ib);Za.l=!1;Za.m=Xb;Za.s=ib;Za.bc=Rb;Za.be=lc;Za.bd=nc;Za.bf=Oc;Ib?(Za.y=L(Ib)||!Ib.copyContextSnapshot,Za.bi=!Za.y&&Ta(Ib.copyContextSnapshot,this.$),Za.bj=Ib.shadowWorkbookSizeExceedsLimit,Za.v=Ib.shadowWorkbookPayloadSize,Za.w=Ib.htmlPayloadSize,Za.bq=fa(Ib.clipboardItems),Za.bb=Ib.activeSelectionType,Za.bs=Ib.isSameSession,
Za.bn=Ib.payloadOrigin,Za.bo=Ib.payloadType,Za.bu=Ib.externalAppSource,Za.bx=Ib.indicationDisplayScheduled,Za.by=Ib.pasteIndicationDisplayStatus,Za.ck=Ib.pasteDestinationHasMergedCells):Za.bi=Ta(gc,this.$);B.b().Se(44,Za,!0);e.ULS.sendTraceTag(537167772,0,15,`CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName=${Za.be},ErrorReason=${Za.bd},IsExpectedError=${Za.m},IsSucceededWithAlert=${Za.bf},ErrorMessage=${Za.s}`)}BDi(Za){const Xb=this.Q5e(Za.commandParameters,Za);Xb.y=Za.wasLastCopyExternal;
Xb.l=!0;Xb.u=Za.plainTextPayloadSize;Xb.v=Za.shadowWorkbookPayloadSize;Xb.w=Za.htmlPayloadSize;Xb.z=Za.isClipboardDataContainShadowWorkbook;Xb.ba=Za.isShadowWorkbookParsedSuccessfully;Xb.bb=Za.activeSelectionType;Xb.bc=Za.pasteResult;Xb.bh=Za.encounteredDeploymentErrors;Xb.bj=Za.shadowWorkbookSizeExceedsLimit;Xb.bk=V(Za);Xb.bq=fa(Za.clipboardItems);Xb.bs=Za.isSameSession;Xb.bn=Za.payloadOrigin;Xb.bo=Za.payloadType;Xb.bu=Za.externalAppSource;Xb.bx=Za.indicationDisplayScheduled;Xb.by=Za.pasteIndicationDisplayStatus;
Xb.ck=Za.pasteDestinationHasMergedCells;Xb.bm=Za.clipboardItems?Za.clipboardItems.getItem(M.u4g):null;Xb.bi=!Za.isSameSession&&!Za.wasLastCopyExternal;B.b().Se(44,Xb,!0)}Aj(){this.$.va.Vf(this.ij);this.$.va.qNg(this.Dpc);this.$.userOperationManager.Zq(this.lR);this.$.Lk(this.dd);Y.h(this.$).Vb.xl(this.UGb)}Sj(){this.$&&this.$.va&&(this.$.va.sg(this.ij),this.$.va.qkj(this.Dpc));this.$&&this.$.userOperationManager&&this.$.userOperationManager.Un(this.lR);this.gridView&&this.gridView.Vb&&this.gridView.Vb.nl(this.UGb)}GGb(Za,
Xb){var ib=null;let Rb=!1;var lc=null;let nc="UnknownFailure",Oc=-1,Ib=Ha.ttb,gc=Ha.pasteErrorName+Ha.iJa,Fc=!1;this.pasteIndicationManager.Xld(Za.id);this.pasteDestinationHasMergedCells(Za.expandDestinations)&&(Xb.pasteContext.pasteDestinationHasMergedCells=!0);const Vc=P(this.qK);(Za.clearStateOnFinish||Za.clearSystemClipboard)&&this.fr("Paste/fail/"+l.a[Za.ribbonCommandInfo.method],!0,void 0,void 0,Za.copyPasteTargetType).catch(()=>{});if(Xb){Oc=Xb.reason;gc+=Ha.AKa(Xb);Xb.message&&(Ib=Xb.message);
if(ib=Ha.L$g(Xb))if(1===ib.pasteErrorName)Rb=!0,nc="CopyPasteLengthTooLongPopup",Ib=lc="The pasted content is too long. Popup a dialog to the user.",e.ULS.sendTraceTag(25216992,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`),ib=yb.a.ed(1,0,26,689,0,1306609195,"CopyPasteOversizeError"),m.EwaSettings.mz()?new fb.a(this.$,ib):(ib=new Ca.ErrorDialog(this.$,ib),ib.initialize(),ib.kg());else if(7===ib.pasteErrorName)Rb=!0,nc="No-Op",Ib=lc="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",
e.ULS.sendTraceTag(33948251,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`);else if(8===ib.pasteErrorName)Rb=!0,nc="UseShortcutsPopup",Ib=lc="Unable to paste content from the system clipboard. Popup dialog to the user.",e.ULS.sendTraceTag(25216994,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`),this.xNf();else if(18===ib.pasteErrorName){Rb=!0;nc="PasteExternalNotSupportMultipleSelectionPopup";
Ib="Paste external not support multiple selection.";lc="Unknown";var ed=2191;100!==ib.validationFailureReason&&(lc=ua[ib.validationFailureReason],ed=Ha.rGe(ib.validationFailureReason));this.kza(ed,lc,!0)}else 20===ib.pasteErrorName||19===ib.pasteErrorName?(Rb=!0,20===ib.pasteErrorName?(nc="PasteAcrossSessionNotSupportMultipleSelectionPopup",Ib="Paste across session does not support multiple selection."):(nc="PasteInSameSessionNotSupportMultipleSelectionPopup",Ib="This kind of multiple selection is not supported for same session paste."),
lc="Unknown",ed=2191,100!==ib.validationFailureReason&&(lc=ua[ib.validationFailureReason],ed=Ha.rGe(ib.validationFailureReason)),ib=6===ib.validationFailureReason,this.X0c(Za.commandType,Za.expandDestinations)&&ib&&this.mxc(Za.expandDestinations),this.kza(ed,lc,!0)):6===ib.pasteErrorName?(Rb=!0,nc="No-Op",Ib=lc="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",e.ULS.sendTraceTag(36263241,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`)):
17===ib.pasteErrorName?(Rb=!0,nc="No-Op",Ib=lc="Paste text on Art is not yet a supported operation",e.ULS.sendTraceTag(0,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}"`)):16===ib.pasteErrorName?(Rb=!0,nc="No-Op",Ib=lc="Paste has failed because the previous copy has failed",ib=this.getStringifiedError(ib),e.ULS.sendTraceTag(537167771,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${lc}, copyPasteTargetType="${Za.copyPasteTargetType}", error=${ib}`)):
yb.a.qq(ib.ewaErrors)?(yb.a.S9(ib.ewaErrors)||yb.a.dh(ib.ewaErrors,yb.a.Xdc())?(Rb=!0,nc="CommunicationError",lc=yb.a.nc(ib.ewaErrors),e.ULS.sendTraceTag(36304159,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib} copyPasteTargetType="${Za.copyPasteTargetType}"`)):yb.a.dh(ib.ewaErrors,Ha.Ssj)?(Rb=!0,nc="SavingWorkbookError",lc=yb.a.nc(ib.ewaErrors),e.ULS.sendTraceTag(36304160,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib} copyPasteTargetType="${Za.copyPasteTargetType}"`)):yb.a.dh(ib.ewaErrors,
Ha.operationSucceededWithAlert)&&(Fc=Rb=!0,nc="OperationSucceededWithAlert",lc=yb.a.nc(ib.ewaErrors),e.ULS.sendTraceTag(36304161,0,15,`CopyPasteInfrastructure.OnPasteFailed: ${Ib} copyPasteTargetType="${Za.copyPasteTargetType}"`)),Rb||(Ib=this.occ(ib.ewaErrors),Rb=this.Aqd(Xb))):11===ib.pasteErrorName&&(Rb=!0,nc="No-Op",Ib="Paste has failed because user try copy cross-session oart object");15===Xb.reason&&(Rb=!0,nc="No-Op",Ib="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");
X.a.equals(gc,N.z3j,!1)&&(Rb=!0,nc="No-Op",Ib="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}Rb||(ib=Xb?this.getStringifiedError(Xb):"null",e.ULS.sendTraceTag(24150916,0,10,`CopyPasteInfrastructure.OnPasteFailed: ${ib}, copyPasteTargetType="${Za.copyPasteTargetType}"`));this.ADi(Za,Rb,Ib,nc,gc,Oc,Fc,Xb.pasteContext,Vc);return Promise.reject(Xb)}dqc(Za,Xb){var ib,Rb,lc;e.ULS.sendTraceTag(24150917,0,50,`CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="${Xb.copyPasteTargetType}"`);
this.pasteIndicationManager.Xld(Xb.id);if(this.T4i(Xb.copyPasteTargetType,Za)){m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.ZA&&Za.wasLastCopyExternal&&Za.payloadType===da.shadowWorkbook&&(this.R7a=!0);let nc=null;(null===(ib=Za.pastedRange)||void 0===ib?0:ib.Ranges)&&0<Za.pastedRange.Ranges.length?nc=G.g(Za.pastedRange.Ranges):Za.wasLastCopyExternal||(nc=Xb.expandDestinations);this.Huj(Za,nc);if(this.cHj(Za,nc)){let Oc;this.cdd?(ib=G.d(Xb.originalDestinations),
Oc=1028===Xb.commandType?G.d(Xb.expandDestinations):G.d(nc)):(ib=t.a.clone(Xb.originalDestinations),Oc=1028===Xb.commandType?t.a.clone(Xb.expandDestinations):t.a.clone(nc));let Ib=null;Za.wasLastCopyExternal&&(Xb.isKeyboardEvent||Xb.isPasteCommandFromRecoveryUI)&&(Ib={[Ha.kMf]:Za.clipboardItems});this.pasteDestinationHasMergedCells(Xb.expandDestinations)&&(Za.pasteDestinationHasMergedCells=!0);Za.pasteRecoveryUIDisplayed=!0;const gc=new ea(this.$,ib,Oc,Ib),Fc=Fa.GetServiceTaskFactory.Oa(this.$.da,
406,405,0);ka.TaskExtensions.za(Fc,()=>{const Vc=Fc.result;Vc.dWg(gc);Vc.nKj(Xb.ribbonCommandInfo.method)},this.la,8)}m.EwaSettings.isChangeGateEnabled("OfficeVSO:7512213_SVNoPasteFormatting")?(ib=[237279923,-875588320,-185374993,-958589048],!Za.pasteRecoveryUIDisplayed&&1===nc.length&&ib.includes(null===(lc=null===(Rb=Za.commandParameters)||void 0===Rb?void 0:Rb.ribbonCommandInfo)||void 0===lc?void 0:lc.command)&&(Rb=G.K(nc),z.AFrameworkApplication.Tp("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),
m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Rb&&(lc=La.d(this.$.va.na),Rb=new Yb.a(Rb,lc),this.ZCc(Rb,"CutAndPaste")))):Za.pasteRecoveryUIDisplayed||1!==nc.length||(Rb=G.K(nc),z.AFrameworkApplication.Tp("XLS-SmartView-CutAndPaste-Treatment;XLS-SmartView-CutAndPaste-Control"),m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.CutAndPasteEnabled",!1)&&Rb&&(lc=La.d(this.$.va.na),Rb=new Yb.a(Rb,lc),this.ZCc(Rb,"CutAndPaste")))}this.$Ce("Paste/success/"+
l.a[Xb.ribbonCommandInfo.method],Za);this.BDi(Za);this.Z8f&&(!Xb.isKeyboardEvent||V(Za))&&this.$.ea.wg.get(66)&&(e.ULS.sendTraceTag(537167770,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),this.Z8f=!1,this.tbh());return Promise.resolve(!0)}cHj(Za,Xb){return!Xb||1!==Xb.length||Za.commandParameters.clearSystemClipboard||Za.commandParameters.clearStateOnFinish||Za.commandParameters.skipClipboardAccess?!1:L(Za)&&(Xb=Za.clipboardItems.getItem(M.plainText),Za=Za.clipboardItems.getItem(M.html),
void 0===Xb||null===Xb||Xb.length>this.kHi||void 0===Za||null===Za||Za.length>this.cya)?(e.ULS.sendTraceTag(537167769,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),!1):!0}T4i(Za,Xb){return 1===Za||Xb.payloadType===da.plainText||m.EwaSettings.ra(151)&&Xb.payloadType===da.html||m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.ZA&&Xb.payloadType===da.shadowWorkbook}pasteDestinationHasMergedCells(Za){const Xb=
Y.h(this.$).Ca.MA();if(!Xb||!Xb.length)return!1;for(const ib of Xb)if(ib.ov(Za[0]))return!0;return!1}$Ce(Za,Xb){let ib;({vHa:ib}=this.bni(Xb)).returnValue&&this.fr(Za,ib,void 0,void 0,Xb.commandParameters.copyPasteTargetType).catch(()=>{})}u$a(Za,Xb,ib,Rb,lc,nc){const Oc=Za?this.getStringifiedError(Za):"null";this.Kwa||e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${Oc}`);let Ib=!1,gc=!1,Fc=!1,Vc=Ha.ttb,ed=Ha.PNe+Ha.iJa;Za&&(ed+=Ha.AKa(Za),yb.a.qq(Za.ewaErrors)?
(Vc=this.occ(Za.ewaErrors),yb.a.dh(Za.ewaErrors,Ha.operationSucceededWithAlert)&&(Ib=!0),yb.a.dh(Za.ewaErrors,Ha.dragDropNonEmptyRange)&&(gc=Fc=!0)):Za.message&&(Vc=Za.message));Fc||(Fc=this.Aqd(Za));gc?this.gridView.ha.selectionType=-1:this.fo.Kej(lc);this.Kwa&&!Fc&&e.ULS.sendTraceTag(24150918,0,10,`CopyPasteInfrastructure.OnDragAndDropCellsFailed: ${Oc}, copyPasteTargetType="${Xb.copyPasteTargetType}`);this.pCi(Xb,ib,Rb,lc,Fc,Vc,ed,Ib,nc)}M0c(Za,Xb){let ib=Za;const Rb=this.$Xh();if(null===Rb||void 0===
Rb?0:Rb.ranges)ib=this.fo.C0g(Xb,Rb.ranges,Za);return ib}$Xh(){const Za=P(this.qK);return Za&&E(Za.sourceItem)?Za.sourceItem:null}Tbj(){this.raiseEvent(Ha.GEd,null)}Huj(Za,Xb){const ib=Za.commandParameters.originalDestinations;Xb&&(G.Q(this.gridView.ha.qa.selectedRanges,ib)?(this.mxc(Xb),Za=nb.HelperMethods.vpb(Xb),e.ULS.sendTraceTag(537167767,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: ${Za}`)):Za.commandParameters.isPasteCommandFromRecoveryUI?(this.mxc(Xb,
!0),e.ULS.sendTraceTag(537167766,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: ${Xb}, active cell: ${Xb[0].topLeft}`)):(Za=nb.HelperMethods.vpb(ib),e.ULS.sendTraceTag(537167765,0,50,`CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: ${Za}`)))}bni(Za){if(Za.isPlainTextPaste||Za.isHtmlPaste||aa(Za)||Za.commandParameters.isPasteCommandFromEnterShortcut)return{returnValue:!0,
vHa:!1};var Xb=Za.copyContextSnapshot;if(Za.commandParameters.clearStateOnFinish)return{returnValue:!0,vHa:!0};if(Xb&&E(Xb.sourceItem)){var ib=Xb.sourceItem;if(!ib.isFromCurrentSession(this.$))return{returnValue:!1,vHa:!0};Xb=-1985798686===Xb.commandParameters.ribbonCommandInfo.command;if(!(1<ib.ranges.length||1<Za.commandParameters.expandDestinations.length)){const Rb=G.K(ib.ranges);Za=G.K(Za.commandParameters.expandDestinations);const lc=this.$.ea.na.sheetName;ib=ib.sheetName;if(ib===lc&&Za.equals(Rb))return{returnValue:!1,
vHa:!0};if(ib===lc&&Za.we(Rb))return{returnValue:!0,vHa:!1}}return{returnValue:Xb,vHa:!0}}return{returnValue:!1,vHa:!0}}gJf(){var Za=P(this.qK);(Za=this.fo.Qxb(Za))&&Za.isFromCurrentSession(this.$)&&this.fr("OnStartEdit",!1).catch(()=>{})}occ(Za){Za=yb.a.DUh(Za,Ha.iJa);return this.xIi+d.a.Yu(Za).toString()}Aqd(Za){Za=Ha.AKa(Za);return!!Za&&X.a.x2a(Za,Ha.wIi)}tbh(){const Za=yb.a.ed(1,2,326,327,h.a.cp?328:h.a.uH?329:330,530046625,"ActivateLocalStorage"),Xb=Fa.GetServiceTaskFactory.Oa(this.$.da,5,4,
0);ka.TaskExtensions.za(Xb,()=>{Xb.result.ih(43,Za)},this.la,3)}zGe(Za){return void 0===Za||null===Za?ia.ILi:Za?ia.success:ia.failed}static L$g(Za){const Xb=Za.innerError;return Xb&&0!==Xb.pasteErrorName?Za.innerError:null}static x$g(Za){const Xb=Za.innerError;return Xb&&0!==Xb.copyErrorName?Za.innerError:null}static AKa(Za){let Xb="";if(!Za)return Ha.HKe;Za.errorName&&(Xb=Za.errorName,Za.innerError&&(Xb+=Ha.iJa+Ha.AKa(Za.innerError)));Xb||(Xb=Za&&Za.name?Za.name:Ha.HKe);return Xb}static Ebc(){Ha.Bm||
(Ha.Bm=xa.FLj);return Ha.Bm}static rGe(Za){switch(Za){case 7:case 1:return 2198;case 5:return 2195;case 6:return 2194;case 8:case 3:case 2:case 4:case 9:case 10:return 2191;default:return e.ULS.shipAssertTag(537167764,0,!1,`CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = ${Za}`),2198}}static y$g(Za){switch(Za){case 3:return 2192;case 1:return 2193;case 2:case 4:return 2191;default:return e.ULS.shipAssertTag(537167763,0,!1,`CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = ${Za}`),
2198}}ZCc(Za,Xb){ka.TaskExtensions.za(Fa.GetServiceTaskFactory.Oa(this.$.da,426,427,1),ib=>{void ib.result.vea(Za,Xb);e.ULS.sendTraceTag(512615303,0,50,"CopyPasteInfrastructure.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Ha.Wvf="EwaJsMetadataChangeListenerId";Ha.GEd="cpiOSC";Ha.Gkh="cpiDID";Ha.ttb="Unknown";Ha.HKe="UnknownError";Ha.iJa="_";Ha.PNe="DragAndDropError";Ha.pasteErrorName="PasteError";Ha.J1g="CancelError";Ha.copyErrorName="CopyError";
Ha.wIi="MergedCellOverlap";Ha.kMf="PasteRecoveryCachedClipboardItems";Ha.Ssj=[1352631530,1679665408];Ha.operationSucceededWithAlert=[-103190598];Ha.pasteDataLimitHit=[1306609195];Ha.copyThrottlingError=[-386183710];Ha.dragDropNonEmptyRange=[563945982];Ha.Bm=null;Object(c.a)(Ha,"CopyPasteInfrastructure",u.a,[777,778,2]);class Ya{constructor(){this.v0a=this.mDe=null}}Object(c.a)(Ya,"ClipboardPlatformInitializationResult",null,[]);var Gb=a(192),Ja=a(648),Na=a(553),Qa=a(123),Oa=a(5),bb=a(60);const Ga=
(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc,Fc=null)=>{gc=Za.Na(9,gc);gc.sourceRanges=Xb;gc.destinationRanges=ib;gc.flags=Rb;return bb.g(Za,"PasteRange",gc,lc,nc,Oc,Ib,64,Fc)},tb=(Za,Xb,ib,Rb,lc,nc,Oc,Ib=null)=>{Oc=Za.Na(1,Oc);Oc.pasteHtmlParameters=Xb;return bb.g(Za,"PasteHtmlContent",Oc,ib,Rb,lc,nc,64,Ib)},wb=(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc=null)=>{Ib=Za.Na(9,Ib);Ib.destinationRange=Xb;Ib.source=ib;return bb.g(Za,"PasteString",Ib,Rb,lc,nc,Oc,64,gc)},lb=(Za,Xb,ib,Rb,lc,nc,Oc=null,Ib=null)=>{Oc=Za.Na(1,Oc);Oc.copyParameters=
Xb;return bb.g(Za,"Copy",Oc,ib,Rb,lc,nc,0,Ib)},db=(Za,Xb,ib,Rb,lc,nc,Oc=null,Ib=null)=>{Oc=Za.Na(1,Oc);Oc.copyParameters=Xb;return bb.g(Za,"Cut",Oc,ib,Rb,lc,nc,0,Ib)},Pa=(Za,Xb,ib,Rb,lc,nc,Oc=null,Ib=null)=>{Oc=Za.Na(1,Oc);Oc.pasteParameters=Xb;return bb.g(Za,"Paste",Oc,ib,Rb,lc,nc,64,Ib)};class ja{constructor(Za,Xb,ib){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=Za;this.destinationRange=Xb;this.pasteFlags=ib}}Object(c.a)(ja,"MacroRecorderPasteRangePayload",null,
[162]);class Ka{constructor(Za,Xb){this.content=this.destinationRange=null;this.destinationRange=Za;this.content=Xb}getContent(){return this.content}}Object(c.a)(Ka,"MacroRecorderPasteStringPayload",null,[162]);class ub{constructor(Za){this.pasteParameters=null;this.pasteParameters=Za}}Object(c.a)(ub,"MacroRecorderPastePayload",null,[162]);var Kb=a(589),W=a(796),za=a(193),Sa=a(33),Wa=a(213),ab=a(113),ma=a(282);const ha=(Za,Xb,ib,Rb,lc,nc,Oc=null)=>{Oc=Za.Na(41,Oc);Oc.insertCopiedCutCellsParameters=
Xb;return bb.g(Za,"InsertCopiedCutCells",Oc,ib,Rb,lc,nc,4)},eb=(Za,Xb,ib,Rb,lc,nc,Oc=null)=>{Oc=Za.Na(41,Oc);Oc.insertCopiedCutCellsParameters=Xb;return bb.g(Za,"InsertCopiedCutCellsV2",Oc,ib,Rb,lc,nc,0)};class ta{constructor(Za){this.parameters=null;this.parameters=Za}getParameters(){return this.parameters}}Object(c.a)(ta,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[162]);var ya=a(376);class sb{constructor(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc){this.destinationRange=Za;this.nsb=ib;this.M4i=Rb;this.Sd=
lc;this.vQb=nc;this.pasteContext=Oc;this.P3b=Ib;this.Mfg=gc}}Object(c.a)(sb,"PasteHtmlRequestParams",null,[]);class Qb{constructor(Za,Xb){this.Mkc=this.ANa=null;this.EPa=O.a.EPa;this.UFd=O.a.UFd;this.wEb=O.a.wEb;this.zhc=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578455_CrossSessionDiscontinuousCCPEnabled");this.wqi=m.EwaSettings.isChangeGateEnabled("OfficeVSO:7316963_InsertCopiedCutCellsV2Enabled");this.Wod=!1;this.Swa=m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",
!1);this.yz=(ib,Rb)=>{if(2===Rb.Iq)this.yv.clear(),this.ANa=null;else if(1===Rb.Iq&&this.yv&&this.yv.contains(Rb.Lf)){ib=Qa.a(Rb.Lf.operation.operationName);const lc=Rb.Lf.dequeueUtcTime.getTime()-Rb.Lf.enqueueUtcTime.getTime();e.ULS.sendTraceTag(526758673,0,50,`CopyPasteUtils.OnQueueChanged: web method ${ib} returned, it took ${lc} milliseconds to complete.`);this.yv.remove(Rb.Lf);this.ANa=null}};this.$=Za;this.gridView=Xb;this.Wod&&(this.$.userOperationManager.Zq(this.yz),this.yv=new Gb.a)}get cya(){return this.Swa?
m.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.ya.CopyPasteMaxPayloadLength):y.a.cya}copy(Za,Xb,ib,Rb=null,lc=null){const nc=this.$.oa.xa.Wb();this.Wod&&this.WX();this.Mkc=nc.ClientRequestId;var Oc=new za.a(505,0,(Ib,gc,Fc)=>{const Vc={CopyPasteTargetType:1};Vc.SourceRanges=Za;Vc.CopyOperationId=Xb.id;e.ULS.sendTraceTag(537167756,0,50,`CopyPasteInfrastructure.Copy served from CopyPasteProxy : ${this.Swa}, CopyOperationId : ${Vc.CopyOperationId}`);return this.ANa=
this.Swa?lb(this.$.oa.Zv,Vc,ma.b(Ib,ib),Rb?ma.a(gc,Rb):gc,Fc,Xb.ribbonCommandInfo,nc,lc):lb(this.$.oa.xa,Vc,ma.b(Ib,ib),Rb?ma.a(gc,Rb):gc,Fc,Xb.ribbonCommandInfo,nc,lc)},80);Oc=this.$.userOperationManager.Jc(Oc,Xb.ribbonCommandInfo);this.Wod&&this.yv.add(Oc)}jMf(Za,Xb,ib,Rb,lc,nc){return new Promise((Oc,Ib)=>{var gc;const Fc=nc.commandParameters.stopwatch.Bc;let Vc=2;20===nc.commandParameters.commandType&&(Vc=16);36===nc.commandParameters.commandType&&(Vc=32);68===nc.commandParameters.commandType&&
(Vc=64);Sa.a.iud(this.$)&&1028===nc.commandParameters.commandType&&(Vc=1024);let ed=null;if(null===(gc=nc.copyContextSnapshot)||void 0===gc?0:gc.commandParameters)ed=nc.copyContextSnapshot.commandParameters.id;Qb.xQd(this.$,Za,Rb,Xb,ib,null,Sd=>{Qb.xec(Sd,nc,Oc,Ib,Fc,this.$,null,!0,null,null)},Sd=>{nc.serverRequestTimeInMs=nc.commandParameters.stopwatch.Bc-Fc;Sd=ab.a.Pe(Sd.data);Ib(new W.a(5,Sd))},lc,Vc,ed,nc.commandParameters.id)})}pasteRange(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc,Fc){return new Promise((Vc,
ed)=>{const Sd=Oc.commandParameters.stopwatch.Bc;Qb.Ovj(this.$,Za,Xb,ib,Rb|-5&lc,Zd=>{Qb.xec(Zd,Oc,Vc,ed,Sd,this.$,null,!0,gc,Fc)},Zd=>{Oc.serverRequestTimeInMs=Oc.commandParameters.stopwatch.Bc-Sd;Zd=ab.a.Pe(Zd.data);Zd=new W.a(5,Zd);null===Fc||void 0===Fc?void 0:Fc(Zd);ed(Zd)},nc,Ib)})}U9i(Za,Xb,ib,Rb,lc,nc,Oc){return(new Promise((Ib,gc)=>{if(Xb)if(Xb.length>this.cya){var Fc=Oc.clipboardItems.getItem(M.plainText);let Vc=-1;void 0!==Fc&&null!==Fc&&(Vc=Fc.length);O.a.yif&&Xb.length<this.UFd&&Xb.length>
this.EPa&&(this.pNf(Xb),this.QV=new sb(Za,Xb,ib,Rb,lc,nc,Oc,0,this.Drc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.kGd()));e.ULS.sendTraceTag(42071712,0,15,`CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: ${Xb.length}, MaxHtmlImportLength: ${this.cya}, PlainTextLength: ${Vc}`);gc(new W.a(1))}else Fc=new za.a(204,0,(Vc,ed,Sd)=>{this.$.py();const Zd=Oc.commandParameters.stopwatch.Bc;Vc=ma.b(Vc,xc=>{Qb.xec(xc,Oc,Ib,gc,Zd,this.$,Xb,
!1,null,null)});ed=ma.a(ed,xc=>{Oc.serverRequestTimeInMs=Oc.commandParameters.stopwatch.Bc-Zd;xc=ab.a.Pe(xc.data);gc(new W.a(3,xc))});const pa=this.$.oa.xa.Wb(),zb=G.v(Za,this.$),Vb={};Vb.SourceHtml=Xb;Vb.DestinationRanges=zb?G.s(zb):null;Vb.CopyOperationId=ib;Vb.PasteId=Rb;e.ULS.sendTraceTag(537167755,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Swa}. PasteId : ${Vb.PasteId}`);return this.Swa?tb(this.$.oa.Zv,Vb,Vc,ed,Sd,null,pa,nc):tb(this.$.oa.xa,Vb,Vc,ed,Sd,
null,pa,nc)},65),this.$.userOperationManager.Jc(Fc,lc);else Ib("")})).then(()=>{O.a.yif&&Xb.length>this.EPa&&(this.pNf(Xb),this.QV=new sb(Za,Xb,ib,Rb,lc,nc,Oc,0,this.Drc.length),window.requestIdleCallback&&window.requestIdleCallback(()=>this.kGd()))})}pNf(Za){const Xb=this.$.Jb.Gc("Task","pasteHtmlChunkOperation"),ib=Math.floor(Za.length/this.EPa)+1;this.Drc=Array(ib);let Rb=0;for(;Rb<ib;)this.Drc[Rb]=Za.substring(Rb*this.EPa,(Rb+1)*this.EPa),Rb++;e.ULS.sendTraceTag(523257954,0,50,`CopyPasteUtils.populatePasteChunks Time taken for chunking: ${Xb.Bc}`)}kGd(){this.L4i(this.QV.destinationRange,
this.Drc[this.QV.P3b],this.QV.nsb,this.QV.M4i,this.QV.Sd,this.QV.vQb,this.QV.pasteContext,this.QV.P3b,this.QV.Mfg);this.QV.P3b++;this.QV.P3b<this.QV.Mfg&&window.requestIdleCallback(()=>this.kGd())}L4i(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc){const Fc=new za.a(204,0,(Vc,ed,Sd)=>{const Zd=Oc.commandParameters.stopwatch.Bc;Vc=ma.b(Vc,()=>{e.ULS.sendTraceTag(512313415,0,15,`CopyPasteUtils.pasteHtmlServerCall succeeded serverRequestTimeInMs:${Oc.commandParameters.stopwatch.Bc-Zd},
             pasteid:${Rb},
             chunkIndex:${Ib},
             totalChunks:${gc}`)});ed=ma.a(ed,()=>{Oc.serverRequestTimeInMs=Oc.commandParameters.stopwatch.Bc-Zd;e.ULS.sendTraceTag(512313414,0,15,`CopyPasteUtils.pasteHtmlServerCall failed serverRequestTimeInMs:${Oc.serverRequestTimeInMs},
               pasteid:${Rb},
               chunkIndex:${Ib},
               totalChunks:${gc}`)});const pa=this.$.oa.xa.Wb();var zb=G.v(Za,this.$);zb={SourceHtml:Xb,DestinationRanges:zb?G.s(zb):null,CopyOperationId:ib,PasteId:`${Rb}_chunk_${Ib}`,ChunkIndex:Ib,TotalChunks:gc};e.ULS.sendTraceTag(523257952,0,50,`CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : ${this.Swa}. PasteId : ${zb.PasteId}`);return tb(this.$.oa.Zv,zb,Vc,ed,Sd,null,pa,nc)},65);this.$.userOperationManager.Jc(Fc,lc)}V9i(Za,Xb,ib,Rb,lc){return new Promise((nc,Oc)=>{e.ULS.sendTraceTag(537167754,
0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id=${lc.id}`);Xb&&(Xb=X.a.trimEnd(Xb,"\n","\r"));e.ULS.sendTraceTag(537167753,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id=${lc.id}`);if(Xb)if(Xb.length>this.wEb)e.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",Xb.length,this.wEb),Oc(new W.a(1));
else{let gc,Fc;const Vc=G.v(Za,this.$);e.ULS.sendTraceTag(537167752,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id=${lc.id}`);var Ib=!this.$.ea.isNamedObjectViewMode&&!Xb.includes("\n")&&!Xb.includes("\t");e.ULS.sendTraceTag(537167751,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id=${lc.id}. treatAsLink=${Ib}`);Ib=Ib&&X.a.Xjf(Xb);e.ULS.sendTraceTag(537167750,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id=${lc.id}. treatAsLink=${Ib}`);
const ed=this.$.oa.xa.Wb();if(Ib){Fc=526;e.ULS.sendTraceTag(537167749,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id=${lc.id}`);const Sd=Wa.a.edd(Xb);e.ULS.sendTraceTag(537167748,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id=${lc.id}`);const Zd=G.s(Vc);Ib=(pa,zb,Vb)=>{const xc=lc.commandParameters.stopwatch.Bc;pa=ma.b(pa,Sc=>{e.ULS.sendTraceTag(537167747,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id=${lc.id}`);
lc.requestTelemetryData=Sc.RequestTelemetryData;lc.serverRequestTimeInMs=lc.commandParameters.stopwatch.Bc-xc;Sc.Errors&&0<Sc.Errors.length?Oc(new W.a(2,Sc.Errors)):nc(Xb)});zb=ma.a(zb,Sc=>{lc.serverRequestTimeInMs=lc.commandParameters.stopwatch.Bc-xc;Sc=ab.a.Pe(Sc.data);Oc(new W.a(2,Sc))});this.$.py();e.ULS.sendTraceTag(537167746,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id=${lc.id}`);return bb.b(this.$.oa.xa,Zd,Xb,Sd,!1,!1,63,pa,zb,Vb,Za,
ed,Rb)};gc=()=>new Kb.a(Zd,Xb,Sd)}else Fc=180,Ib=(Sd,Zd,pa)=>{this.$.py();const zb=lc.commandParameters.stopwatch.Bc;Sd=ma.b(Sd,Vb=>{e.ULS.sendTraceTag(537167745,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id=${lc.id}`);Qb.xec(Vb,lc,nc,Oc,zb,this.$,Xb,!1,null,null)});Zd=ma.a(Zd,Vb=>{lc.serverRequestTimeInMs=lc.commandParameters.stopwatch.Bc-zb;Vb=ab.a.Pe(Vb.data);Oc(new W.a(4,Vb))});e.ULS.sendTraceTag(537167744,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id=${lc.id}`);
return wb(this.$.oa.xa,Vc,Xb,Sd,Zd,pa,null,ed,Rb)},gc=()=>new Ka(Vc,Xb);e.ULS.sendTraceTag(537167715,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserWebMethodOperation. pasteContext.Id=${lc.id}`);Ib=new za.a(Fc,0,Ib,65,gc);e.ULS.sendTraceTag(537167714,0,50,`CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id=${lc.id}`);this.$.userOperationManager.Jc(Ib,ib)}else nc("")})}xcf(Za,Xb){Xb=[1===Xb?4:5];this.gridView.Cb.zB(Yb.a.ITa(La.d(this.$.na),
Za),Xb,!0);this.gridView.Cb.Qq(Xb);this.gridView.Cb.update(!0)}efc(){const Za=[4,5];this.gridView.Cb.Nj(Za,!1,!1);this.gridView.Cb.wk(null,Za,!1);1===this.gridView.ha.Ke&&this.gridView.Qq(!1,!1);this.gridView.Cb.update(!1,!1)}C0g(Za,Xb,ib){const Rb=[];for(const lc of ib)Rb.push(this.H0g(Za,Xb,lc));return Rb}WX(){if(this.yv)for(let Za of this.yv)if(this.$&&this.$.userOperationManager){if(Za.operation){const Xb=Qa.a(Za.operation.operationName);e.ULS.sendTraceTag(526758675,0,50,`CopyPasteUtils.AbortOutstandingUserOperation: Trying to abort pending operation ${Xb}.`)}this.H1g();
this.$.userOperationManager.Jta(Za)}}H1g(){if(this.ANa){const Za=this.ANa.Rs;e.ULS.sendTraceTag(526758674,0,15,`Cancelling pending copy request with Id=${Za}`);ab.a.Nt(Za);!m.EwaSettings.isChangeGateEnabled("OfficeVSO:6151555_DisableCancelCopyRequest")&&this.Mkc&&bb.h(this.$.oa.xa,this.Mkc,null,null,null);this.Mkc=this.ANa=null}}H0g(Za,Xb,ib){e.ULS.shipAssertTag(537167713,0,!!Xb,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");e.ULS.shipAssertTag(537167712,0,0<Xb.length,
"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");let Rb=0,lc=0;var nc=new Set;const Oc=new Set;for(const Ib of Xb){Xb=`${Ib.left}_${Ib.right}`;const gc=`${Ib.top}_${Ib.bottom}`;Oc.has(Xb)||(Oc.add(Xb),lc+=Ib.width);nc.has(gc)||(nc.add(gc),Rb+=Ib.height)}if(36===Za)return ib.isSingle?Qb.yWe(lc,Rb,ib):ib.clone();516===Za&&(Za=Rb,Rb=lc,lc=Za);Za=!(ib.width%lc)&&!(ib.height%Rb);nc=ib.XZ&&!(ib.height%Rb);ib.i5&&!(ib.width%lc)||nc?ib=Qb.yWe(lc,Rb,ib):Za?ib=ib.clone():
(ib=ib.clone(),ib.bottom=Math.min(y.a.Vg,ib.top+Rb-1),ib.right=Math.min(y.a.Ug,ib.left+lc-1));return ib}hTg(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc,Fc,Vc){if(!Rb||!Rb.length)return 1;if(1<Rb.length){if(!this.zhc&&nc)return 3;if(Fc)return 0;if(Ib)return 9;if(gc)return 8;if(Vc)return 2;if(1<Xb.length)return 4;const ed=Xb[0];if(!Oc&&!t.a.all(Rb,Sd=>Sd.isSingle||!(Sd.width%ed.width)&&!(Sd.height%ed.height)))return 5;if((!this.zhc||!nc)&&X.a.equals(Za,ib,!0))for(const Sd of lc)if(Sd.zd(ed)&&!Sd.equals(ed))return 6}else if(Xb&&
0<Xb.length){if(0!==this.Bhf(Xb,gc))return 7;if(1<Xb.length){if(!this.zhc&&nc)return 3;if((!this.zhc||!nc)&&X.a.equals(Za,ib,!0))for(const ed of Xb)if(Za=lc[0],ed.zd(Za)&&!ed.equals(Za))return 6}}return 0}Bhf(Za,Xb){if(!Za||1>=Za.length)return 0;if(Xb)return 2;if(!G.S(Za))return 1;Xb=new Ja.a(Na.a.Oi());for(const ib of Za)for(const Rb of Za){const lc=ib.top===Rb.top&&ib.bottom===Rb.bottom,nc=ib.left===Rb.left&&ib.right===Rb.right,Oc=Math.max(ib.left,Rb.left)<Math.min(ib.right,Rb.right);if(Math.max(ib.top,
Rb.top)<Math.min(ib.bottom,Rb.bottom)&&!lc||Oc&&!nc)return 3;Xb.add(`${ib.top}-${ib.bottom}-${Rb.left}-${Rb.right}`);Xb.add(`${Rb.top}-${Rb.bottom}-${ib.left}-${ib.right}`)}for(const ib of Za)Xb.remove(`${ib.top}-${ib.bottom}-${ib.left}-${ib.right}`);return 0<Xb.count?3:0}Kej(Za){const Xb=this.gridView.ha;Xb.updateSelection(Za,Za.topLeft,0);Xb.selectionType=-1}Qxb(Za){if(null===Za||void 0===Za?0:Za.sourceItem){if(!E(Za.sourceItem))return null;if((Za=Za.sourceItem)&&G.bb(Za.ranges,!0))return Za}return null}cic(Za,
Xb){e.ULS.shipAssertTag(537167711,0,!!Za,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return Xb&&Oa.a.KF in Xb||Za.tabName?!1:1===Za.method}static Ovj(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc){const Fc=Za.oa.xa.Wb(gc?{Dla:!0,vka:1}:{Dla:!1,vka:0});gc=new za.a(506,0,(Vc,ed,Sd)=>{Za.py();return Ga(Za.oa.xa,ib,Rb,lc,ma.b(Vc,nc),ma.a(ed,Oc),Sd,null,Fc,Ib)},65,()=>new ja(ib,Rb,lc));Za.userOperationManager.Jc(gc,Xb)}static xec(Za,Xb,ib,Rb,lc,nc,Oc=null,Ib,gc,Fc){e.ULS.sendTraceTag(537167710,
0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id=${Xb.id}`);Xb.requestTelemetryData=Za.RequestTelemetryData;Xb.serverRequestTimeInMs=Xb.commandParameters.stopwatch.Bc-lc;yb.a.Wf(Za.Errors)?yb.a.Xga(Za.Errors)?(Xb&&(Xb.encounteredDeploymentErrors=!0),Za=yb.a.nc(Za.Errors),e.ULS.sendTraceTag(537167707,0,15,`CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Za}`)):
(Za=new W.a(5,Za.Errors),null===Fc||void 0===Fc?void 0:Fc(Za),Rb(Za)):Za.Result?(Rb=!!Za&&!!Za.RequestTelemetryData,Y.h(nc).wh.Fla(Xb.commandParameters.stopwatch.id,Za.StateId,Rb?Za.RequestTelemetryData.EcsOperationDuration:0,Rb?Za.RequestTelemetryData.EcsRequestDuration:0,Rb?Za.RequestTelemetryData.WfeRequestDuration:0),Xb.pastedRange=Za.Result.SheetMultiRange,e.ULS.sendTraceTag(537167708,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id=${Xb.id}`),
null===gc||void 0===gc?void 0:gc(),ib(!0),m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&Ib&&(Xb=Xb.commandParameters.isDragDrop?9:6,(nc=nc.da.Aa(465))&&nc.K0(Xb,Za))):(e.ULS.sendTraceTag(537167709,0,50,`CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id=${Xb.id}`),ib(Oc||!0))}static xQd(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc,Fc,Vc,ed){const Sd=Za.oa.xa.Wb(),Zd=Qb.yfh(ib,
Rb,lc,Fc,Vc,ed);ib=new za.a(503,0,(pa,zb,Vb)=>{Za.py();return Pa(Za.oa.xa,Zd,ma.b(pa,Oc),ma.a(zb,Ib),Vb,nc,Sd,gc)},65,()=>new ub(Zd));Za.userOperationManager.Jc(ib,Xb)}static yfh(Za,Xb,ib,Rb,lc,nc){const Oc={};Oc.ShadowWorkbookBase64=Za.shadowWorkbookBase64;Oc.SourceRanges={};Oc.SourceRanges.Ranges=Array(1);Oc.SourceRanges.Ranges[0]={};Oc.SourceRanges.Ranges[0].FirstRow=Za.rangeRowStart;Oc.SourceRanges.Ranges[0].LastRow=Za.rangeRowEnd;Oc.SourceRanges.Ranges[0].FirstColumn=Za.rangeColumnStart;Oc.SourceRanges.Ranges[0].LastColumn=
Za.rangeColumnEnd;m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578455_CrossSessionDiscontinuousCCPEnabled")?ib?Oc.DestinationRanges=G.u(ib.SheetName,ib.NamedObjectName,G.g(ib.Ranges)):(e.ULS.sendTraceTag(537167706,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),Oc.DestinationRanges=null):Oc.DestinationRanges=Xb?G.s(Xb):null;Oc.CopyPasteTargetType=1;Oc.PasteType=Rb;Oc.CopyOperationId=lc;Oc.PasteId=nc;Oc.SourceClientPath=Za.sourceClientPath;Oc.SourceSheetName=Za.sourceSheetName;
Oc.SourceWorkbookName=Za.sourceWorkbookName;if(!Za.originalSourceRangesCountExceedsLimit&&Za.originalSourceRanges&&0<Za.originalSourceRanges.length&&1024===Rb){Oc.OriginalSourceMultiRange={};Xb=Array(Za.originalSourceRanges.length);for(ib=0;ib<Xb.length;++ib)Xb[ib]={},Xb[ib].FirstRow=Za.originalSourceRanges[ib][0],Xb[ib].FirstColumn=Za.originalSourceRanges[ib][1],Xb[ib].LastRow=Za.originalSourceRanges[ib][2],Xb[ib].LastColumn=Za.originalSourceRanges[ib][3];Oc.OriginalSourceMultiRange.Ranges=Xb}return Oc}static yWe(Za,
Xb,ib){ib=ib.clone();ib.height<Xb&&(ib.bottom=Math.min(y.a.Vg,ib.top+Xb-1));ib.width<Za&&(ib.right=Math.min(y.a.Ug,ib.left+Za-1));return ib}IGj(Za,Xb,ib){return(Za=Y.h(Za).tb.Dh(ib))?Xb.width===Za.usedRange.width&&ib.left===Za.usedRange.left||ib.left===Za.usedRange.left&&ib.right===Za.usedRange.right&&0===ib.width%Xb.width:!1}HGj(Za,Xb,ib){return(Za=Y.h(Za).tb.Dh(ib))?Xb.height===Za.usedRange.height&&ib.top===Za.usedRange.top||ib.top===Za.usedRange.top&&ib.bottom===Za.usedRange.bottom&&0===ib.height%
Xb.height:!1}executeInsertCopiedCutCellsOperation(Za,Xb,ib,Rb,lc,nc=null,Oc=null){const Ib={};Ib.InsertDirection=Rb;Ib.SourceRange=Za;Ib.DestRange=Xb;Ib.CopyCutOperation=ib?0:1;const gc=this.$.oa.xa,Fc=this.$.oa.xa.Wb(),Vc=()=>new ta(Ib);return ya.a(this.$.userOperationManager,(ed,Sd,Zd)=>this.wqi?eb(gc,Ib,nc?ma.b(ed,nc):ed,Oc?ma.a(Sd,Oc):Sd,Zd,Fc):ha(gc,Ib,nc?ma.b(ed,nc):ed,Oc?ma.a(Sd,Oc):Sd,Zd,null),ed=>new za.a(104,0,ed,void 0,Vc),lc,m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.MoveTaskCompletionToQueueItemLevelByOptingIn",
!1))}WNe(Za,Xb,ib,Rb,lc,nc,Oc,Ib){return new Promise((gc,Fc)=>{this.executeInsertCopiedCutCellsOperation(Xb,ib,Rb,lc,nc,Vc=>{Za.requestTelemetryData=Vc.RequestTelemetryData;if(Vc.Errors&&0<Vc.Errors.length){const ed=new W.a(21,Vc.Errors);null===Ib||void 0===Ib?void 0:Ib(ed);Fc(new W.a(21,Vc.Errors))}else null===Oc||void 0===Oc?void 0:Oc(),gc(!0)},Vc=>{Vc=ab.a.Pe(Vc.data);Vc=new W.a(21,Vc);null===Ib||void 0===Ib?void 0:Ib(Vc);Fc(Vc)})})}}Object(c.a)(Qb,"CopyPasteUtils",null,[776]);var oc=a(495),kb;
(function(Za){Za[Za.range=0]="range";Za[Za.art=1]="art"})(kb||(kb={}));Object(c.b)("SourceItemType",kb);var jb=a(94);class Wb{constructor(Za){this.vcg={["SourceItemType.Range"]:0,["SourceItemType.Art"]:1};this.ZNb={};this.rcg={["FloatingObjectType.Unknown"]:99,["FloatingObjectType.CardView"]:6,["FloatingObjectType.Chart"]:0,["FloatingObjectType.Group"]:7,["FloatingObjectType.Image"]:1,["FloatingObjectType.Ink"]:8,["FloatingObjectType.InteractiveReport"]:4,["FloatingObjectType.ModernOfficeExtension"]:3,
["FloatingObjectType.Shape"]:5,["FloatingObjectType.Slicer"]:2,["FloatingObjectType.Unsupported"]:100};this.zZc={["99"]:"FloatingObjectType.Unknown",["6"]:"FloatingObjectType.CardView",["0"]:"FloatingObjectType.Chart",["7"]:"FloatingObjectType.Group",["1"]:"FloatingObjectType.Image",["8"]:"FloatingObjectType.Ink",["4"]:"FloatingObjectType.InteractiveReport",["3"]:"FloatingObjectType.ModernOfficeExtension",["5"]:"FloatingObjectType.Shape",["2"]:"FloatingObjectType.Slicer",["100"]:"FloatingObjectType.Unsupported"};
this.ucg={["RibbonCommand.Copy"]:-911352779,["RibbonCommand.Cut"]:-1985798686};this.HOd={["-911352779"]:"RibbonCommand.Copy",["-1985798686"]:"RibbonCommand.Cut"};this.tcg={["InputManager.InputMethod.NotDefined"]:-1,["InputManager.InputMethod.Unknown"]:0,["InputManager.InputMethod.Keyboard"]:1,["InputManager.InputMethod.Mouse"]:2,["InputManager.InputMethod.Touch"]:3,["InputManager.InputMethod.CrossSlide"]:9};this.ska={};this.scg={["FrameMode.None"]:0,["FrameMode.Reading"]:1,["FrameMode.Edit"]:2};this.F3a=
{};this.wcg={["UILocation.Unknown"]:0,["UILocation.UpperRibbon"]:1,["UILocation.Ribbon"]:2,["UILocation.QAT"]:3,["UILocation.Jewel"]:4,["UILocation.NavigationPane"]:5,["UILocation.KeyboardShortcut"]:6,["UILocation.StatusBar"]:7,["UILocation.Dialog"]:8,["UILocation.Floatie"]:9,["UILocation.NotificationBar"]:10,["UILocation.StandaloneCuiRoot"]:11,["UILocation.TaskPane"]:12,["UILocation.HeroDock"]:13,["UILocation.SingleLineRibbon"]:14,["UILocation.MultilineRibbon"]:15,["UILocation.Overflow"]:16,["UILocation.TellMe"]:17,
["UILocation.FarPeripheralControls"]:18,["UILocation.ContextMenu"]:19,["UILocation.DialogMenu"]:20,["UILocation.Header"]:21,["UILocation.FileMenu"]:22,["UILocation.Toolbar"]:26,["UILocation.Canvas"]:30};this.Fr={};this.$=Za;this.ska.notDefined="InputManager.InputMethod.NotDefined";this.ska.unknown="InputManager.InputMethod.Unknown";this.ska.keyboard="InputManager.InputMethod.Keyboard";this.ska.mouse="InputManager.InputMethod.Mouse";this.ska.touch="InputManager.InputMethod.Touch";this.ska.crossSlide=
"InputManager.InputMethod.CrossSlide";this.F3a.none="FrameMode.None";this.F3a.reading="FrameMode.Reading";this.F3a.edit="FrameMode.Edit";this.Fr.unknown="UILocation.Unknown";this.Fr.upperRibbon="UILocation.UpperRibbon";this.Fr.ribbon="UILocation.Ribbon";this.Fr.QAT="UILocation.QAT";this.Fr.jewel="UILocation.Jewel";this.Fr.navigationPane="UILocation.NavigationPane";this.Fr.keyboardShortcut="UILocation.KeyboardShortcut";this.Fr.statusBar="UILocation.StatusBar";this.Fr.dialog="UILocation.Dialog";this.Fr.floatie=
"UILocation.Floatie";this.Fr.notificationBar="UILocation.NotificationBar";this.Fr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.Fr.taskPane="UILocation.TaskPane";this.Fr.heroDock="UILocation.HeroDock";this.Fr.singleLineRibbon="UILocation.SingleLineRibbon";this.Fr.multilineRibbon="UILocation.MultilineRibbon";this.Fr.overflow="UILocation.Overflow";this.Fr.tellMe="UILocation.TellMe";this.Fr.farPeripheralControls="UILocation.FarPeripheralControls";this.Fr.header="UILocation.Header";this.Fr.fileMenu=
"UILocation.FileMenu";this.Fr.contextMenu="UILocation.ContextMenu";this.Fr.dialogMenu="UILocation.DialogMenu";this.Fr.toolbar="UILocation.Toolbar";this.Fr.canvas="UILocation.Canvas";this.ZNb.range="SourceItemType.Range";this.ZNb.art="SourceItemType.Art"}serializeSourceItem(Za){const Xb={};if(Za&&Object.getType(Za)===D)Xb.sheetName=Za.sheetName,Xb.topArray=t.a.map(Za.ranges,ib=>ib.top),Xb.leftArray=t.a.map(Za.ranges,ib=>ib.left),Xb.bottomArray=t.a.map(Za.ranges,ib=>ib.bottom),Xb.rightArray=t.a.map(Za.ranges,
ib=>ib.right),Xb.sessionStateId=Za.sessionStateId,Xb.sessionId=Za.sessionId,Xb.sourceItemType=this.l3f(0);else if(Za&&Object.getType(Za)===U)Xb.activeFloatingObjectControlId=Za.activeFloatingObjectControlId,Xb.sheetName=Za.sheetName,Xb.sessionStateId=Za.sessionStateId,Xb.sessionId=Za.sessionId,Xb.floatingObjectType=this.pwj(Za.type),Xb.sourceItemType=this.l3f(1);else return e.ULS.shipAssertTag(537167705,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;
return JSON.stringify(Xb)}serializeCommandParameters(Za){if(!Za)return e.ULS.shipAssertTag(537167704,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;const Xb={};Xb.id=Za.id;Xb.commandType=Za.commandType;Xb.copyPasteTargetType=Za.copyPasteTargetType;Za.ribbonCommandInfo&&(Xb.ribbonCommandName=this.ywj(Za.ribbonCommandInfo.command),Xb.inputMethodName=this.swj(Za.ribbonCommandInfo.method),Xb.frameModeName=this.qwj(Za.ribbonCommandInfo.mode),Xb.uiLocationName=
this.Cwj(Za.ribbonCommandInfo.Ve),Xb.tabName=Za.ribbonCommandInfo.tabName);return JSON.stringify(Xb)}deserializeSourceItem(Za){if(!Za)return null;try{const Xb=JSON.parse(Za);if(!Xb)return e.ULS.shipAssertTag(537167703,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;let ib=null;switch(this.Jlh(Xb.sourceItemType)){case 0:ib=new D(this.$,this.Glh(Xb),Xb.sheetName,Xb.sessionStateId,Xb.sessionId);break;case 1:ib=new U(Xb.activeFloatingObjectControlId,Xb.sheetName,
Xb.sessionStateId,Xb.sessionId,this.Dlh(Xb.floatingObjectType))}return ib}catch(Xb){return e.ULS.sendTraceTag(537167702,0,10,`EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: ${Za?Za.length:0}, errror: ${Xb}`),null}}deserializeCommandParameters(Za){if(!Za)return null;try{const Xb=JSON.parse(Za);if(!Xb)return e.ULS.shipAssertTag(537167701,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;
const ib=Ma.a();ib.id=Xb.id;ib.ribbonCommandInfo=this.Ilh(Xb);ib.commandType=Xb.commandType;ib.copyPasteTargetType=Xb.copyPasteTargetType;return ib}catch(Xb){return e.ULS.sendTraceTag(537167700,0,10,`EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: ${Za?Za.length:0}, errror: ${Xb}`),null}}Glh(Za){const Xb=[];e.ULS.shipAssertTag(537167699,0,!!Za.topArray&&0<Za.topArray.length,`EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be ${Za.topArray?
"empty":"null"}.`);e.ULS.shipAssertTag(537167698,0,!!Za.leftArray&&0<Za.leftArray.length,`EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be ${Za.leftArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167697,0,!!Za.bottomArray&&0<Za.bottomArray.length,`EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be ${Za.bottomArray?"empty":"null"}.`);e.ULS.shipAssertTag(537167696,0,!!Za.rightArray&&0<Za.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be ${Za.rightArray?
"empty":"null"}.`);if(!(Za.topArray&&Za.leftArray&&Za.bottomArray&&Za.rightArray))return Xb;e.ULS.shipAssertTag(537167695,0,Za.topArray.length===Za.bottomArray.length&&Za.topArray.length===Za.leftArray.length&&Za.topArray.length===Za.rightArray.length,`EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray(${Za.topArray.length}), BottomArray(${Za.bottomArray.length}), LeftArray(${Za.leftArray.length}), RightArray(${Za.rightArray.length}) should be the same.`);const ib=Math.min(Za.topArray.length,
Za.bottomArray.length,Za.leftArray.length,Za.rightArray.length);for(let Rb=0;Rb<ib;Rb++)Xb.push(new w.Range(Za.topArray[Rb],Za.leftArray[Rb],Za.bottomArray[Rb],Za.rightArray[Rb],!1,!1));return Xb}Ilh(Za){return new jb.a(this.Hlh(Za.ribbonCommandName),this.Flh(Za.inputMethodName),this.Elh(Za.frameModeName),this.Llh(Za.uiLocationName),Za.tabName)}ywj(Za){return void 0!==Za&&null!==Za&&Za.toString()in this.HOd?this.HOd[Za.toString()]:(e.ULS.shipAssertTag(537167694,0,!1,`EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Za}`),
this.HOd["-911352779"])}Hlh(Za){return Za&&Za in this.ucg?this.ucg[Za]:(e.ULS.shipAssertTag(537167693,0,!1,`EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy(${-911352779}) or RibbonCommand.Cut(${-1985798686}) but got ${Za}`),-911352779)}swj(Za){return void 0!==Za&&null!==Za&&l.a[Za]in this.ska?this.ska[l.a[Za]]:(e.ULS.shipAssertTag(537167692,0,!1,`EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value ${Za}`),this.ska.unknown)}Flh(Za){return Za&&
Za in this.tcg?this.tcg[Za]:(e.ULS.shipAssertTag(537167691,0,!1,`EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value ${Za}`),0)}qwj(Za){return void 0!==Za&&null!==Za&&oc.a[Za]in this.F3a?this.F3a[oc.a[Za]]:(e.ULS.shipAssertTag(537167690,0,!1,`EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value ${Za}`),this.F3a.edit)}Elh(Za){return Za&&Za in this.scg?this.scg[Za]:(e.ULS.shipAssertTag(537167689,0,!1,`EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value ${Za}`),
2)}l3f(Za){return void 0!==Za&&null!==Za&&kb[Za]in this.ZNb?this.ZNb[kb[Za]]:(e.ULS.shipAssertTag(537167688,0,!1,`EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value ${Za}`),this.ZNb.range)}Jlh(Za){return Za&&Za in this.vcg?this.vcg[Za]:(e.ULS.shipAssertTag(537167687,0,!1,`EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value ${Za}`),0)}pwj(Za){return void 0!==Za&&null!==Za&&Za.toString()in this.zZc?this.zZc[Za.toString()]:(e.ULS.shipAssertTag(537167686,
0,!1,`EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value ${Za}`),this.zZc["99"])}Dlh(Za){return Za&&Za in this.rcg?this.rcg[Za]:(e.ULS.shipAssertTag(537167685,0,!1,`EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value ${Za}`),99)}Cwj(Za){return void 0!==Za&&null!==Za&&n.a[Za]in this.Fr?this.Fr[n.a[Za]]:(e.ULS.shipAssertTag(36229129,0,!1,`EnvironmentSerializationHelper.SerializeUILocation: got unexpected value ${Za}`),this.Fr.ribbon)}Llh(Za){return Za&&
Za in this.wcg?this.wcg[Za]:(e.ULS.shipAssertTag(537167684,0,!1,`EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value ${Za}`),2)}}Object(c.a)(Wb,"EnvironmentSerializationHelper",null,[]);class wc{}wc.D0f="SameSession";wc.EJe="CrossSession";wc.dqf="LegacyCrossSession";wc.external="External";Object(c.a)(wc,"PayloadOrigin",null,[]);const Jc=Za=>Za?Za.shadowWorkbookSizeExceedsLimit&&void 0!==Za.shadowWorkbookBlockedSize&&null!==Za.shadowWorkbookBlockedSize?Za.shadowWorkbookBlockedSize:
Za.shadowWorkbookBase64?Za.shadowWorkbookBase64.length:0:0,zc=Za=>Za.shadowWorkbookSizeExceedsLimit?!0:Jc(Za)>y.a.Tmc;class gd{constructor(Za,Xb){this._name=Xb;this.$=Za;this.cm=C.a.instance;this.fo=new Qb(Za,Y.h(Za))}get name(){return this._name}get CZc(){return this.cm.Ta(5)}shouldWaitForCopyToComplete(){return!1}onDeferredPasteStarted(){}onDeferredPasteCompleted(){}beforePaste(){}cXj(Za){let Xb;Xb=null;try{const ib=Za.getItem(M.shadowWorkbook);if(!ib)return{returnValue:!1,u0:Xb};Xb=JSON.parse(ib);
return{returnValue:this.zwi(Xb),u0:Xb}}catch(ib){return e.ULS.sendTraceTag(537167835,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+ib),{returnValue:!1,u0:Xb}}}zwi(Za){return!!Za&&(!!Za.shadowWorkbookBase64||Za.shadowWorkbookSizeExceedsLimit)&&void 0!==Za.rangeRowStart&&void 0!==Za.rangeRowEnd&&void 0!==Za.rangeColumnStart&&void 0!==Za.rangeColumnEnd}Brc(Za){Za.wasLastCopyExternal=!0;m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SetDefaultPaste",!1)&&
this.$.shortcutKeyManager&&(Za.commandParameters.commandType=-185374993===this.$.shortcutKeyManager.o7b?20:4);if(m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!h.a.ZA&&516!==Za.commandParameters.commandType&&1028!==Za.commandParameters.commandType){var Xb=null;if(({u0:Xb}=this.cXj(Za.clipboardItems)).returnValue)return Za.isShadowWorkbookParsedSuccessfully=!0,this.K4i(Za,Xb)}if(516!==Za.commandParameters.commandType&&36!==Za.commandParameters.commandType){if(m.EwaSettings.ra(151)&&
20!==Za.commandParameters.commandType&&(Xb=Za.clipboardItems.getItem(M.html),void 0!==Xb&&null!==Xb&&Xb&&Xb.trim()!==this.CZc&&(Xb.startsWith("<")||h.a.Cf&&Xb.startsWith("\n<")))){const ib=Za.clipboardItems.getItem(M.nsb);return this.I4i(Za,Xb,void 0===ib?null:ib)}return this.fMf(Za)}return Promise.reject(new W.a(6))}K4i(Za,Xb){e.ULS.sendTraceTag(537167834,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");Za.pasteResult="SystemClipboardShadowWorkbookPaste";
Za.payloadType=da.shadowWorkbook;Za.payloadOrigin=wc.external;Za.shadowWorkbookPayloadSize=Jc(Xb);Za.shadowWorkbookSizeExceedsLimit=zc(Xb);let ib=null,Rb=null;const lc=Za.commandParameters.originalDestinations;m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578455_CrossSessionDiscontinuousCCPEnabled")?ib=G.r(lc,this.$):Rb=G.v(G.K(lc),this.$);Xb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Za.originalSourceRangesCountExceedsLimit=Xb.originalSourceRangesCountExceedsLimit);if(Za.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(537167833,
0,15,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length(${Za.shadowWorkbookPayloadSize}) is over the limit(${y.a.Tmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Xb.shadowWorkbookSizeExceedsLimit}`),Promise.reject(new W.a(1));e.ULS.sendTraceTag(537167832,0,50,`BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId=${Za.commandParameters.id}`);return this.fo.jMf(Za.commandParameters.ribbonCommandInfo,Rb,ib,Xb,[Za.commandParameters.stopwatch],
Za)}fMf(Za){var Xb=Za.clipboardItems.getItem(M.plainText);if(void 0!==Xb&&null!==Xb&&Xb.trim()===this.CZc)return Promise.reject(new W.a(7));void 0!==Xb&&null!==Xb&&(Za.plainTextPayloadSize=Xb.length);Za.isPlainTextPaste=!0;Za.pasteResult="SystemClipboardPaste";Za.payloadOrigin=V(Za)?wc.dqf:wc.external;Za.payloadType=da.plainText;e.ULS.sendTraceTag(537167831,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id=${Za.id}, PasteOperationId=${Za.commandParameters.id}`);
Xb=this.fo.V9i(G.K(Za.commandParameters.originalDestinations),Xb,Za.commandParameters.ribbonCommandInfo,[Za.commandParameters.stopwatch],Za);e.ULS.sendTraceTag(537167830,0,50,`BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id=${Za.id}`);return Xb}I4i(Za,Xb,ib){Za.htmlPayloadSize=Xb.length;Za.isHtmlPaste=!0;Za.pasteResult="SystemClipboardHtmlPaste";Za.payloadType=da.html;Za.payloadOrigin=V(Za)?wc.dqf:wc.external;e.ULS.sendTraceTag(42071711,0,50,`BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId=${Za.commandParameters.id}`);
return this.fo.U9i(G.K(Za.commandParameters.originalDestinations),Xb,ib,Za.commandParameters.id,Za.commandParameters.ribbonCommandInfo,[Za.commandParameters.stopwatch],Za)}bJe(Za){const Xb={};Za&&(Xb.shadowWorkbookBase64=Za.ShadowWorkbookBase64,Xb.shadowWorkbookSizeExceedsLimit=Za.ShadowWorkbookSizeExceedsLimit,Xb.originalSourceRangesCountExceedsLimit=Za.OriginalSourceRangesCountExceedsLimit,Xb.originalSourceRangesCount=Za.OriginalSourceRangesCount,Xb.shadowWorkbookBlockedSize=Za.ShadowWorkbookBlockedSize);
return Xb}kmg(Za,Xb){const ib=L(Za),Rb=32===(Za.commandParameters.commandType&32),lc=1024===(Za.commandParameters.commandType&1024);let nc=!1,Oc=null,Ib=null,gc=!1;if(!ib){nc=-1985798686===Za.commandParameters.ribbonCommandInfo.command;var Fc=Za.copyContextSnapshot;if(Xb)gc=!Fc.sourceItem.isFromCurrentSession(this.$);else if(Fc=this.fo.Qxb(Fc))Oc=Fc.ranges,Ib=Fc.sheetName,gc=!Za.isSameSession}return this.fo.hTg(Ib,Oc,this.$.na.sheetName,Za.commandParameters.originalDestinations,Za.commandParameters.expandDestinations,
gc,Rb,lc,nc,Xb,ib)}}Object(c.a)(gd,"BaseCopyPasteHandler",null,[864,865,866]);class Va{constructor(Za){this.clipboardItems=this.key=null;this.v$=Za}Kva(Za){return this.key&&this.key.isEqual(Za)?this.createClipboardItems(this.clipboardItems):null}setValue(Za,Xb){this.key=Za;this.clipboardItems=this.createClipboardItems(Xb)}createClipboardItems(Za){const Xb=this.v$.create();var ib=Za.getItem(M.plainText);ib&&Xb.setItem(M.plainText,ib);(ib=Za.getItem(M.shadowWorkbook))&&Xb.setItem(M.shadowWorkbook,ib);
(Za=Za.getItem(M.html))&&Xb.setItem(M.html,Za);return Xb}}Object(c.a)(Va,"CopyCache",null,[]);var Eb=a(66);class hc extends gd{constructor(Za,Xb,ib,Rb,lc=null){super(Za,Rb);this.xah=Xb;this.v$=ib;this.Z4c=lc||new Va(this.v$);this.gridView=Y.h(Za);this.ha=this.gridView.ha;this.clipboardRangeFactory=Za.da.Aa(169)}getSourceItem(){const Za=m.EwaSettings.isChangeGateEnabled("OfficeVSO:6713439_FixCloneRangeArray")?G.d(this.gridView.ha.qa.selectedRanges):t.a.clone(this.gridView.ha.qa.selectedRanges);return new D(this.$,
Za,this.$.ea.na.sheetName,this.$.ea.se,this.$.ya.UserSessionId)}beforeSerialize(Za){Za.isSelectionAllowed=!1;Za.isAsyncCopy=!1;Za.isFromCache=!1;Za.encounteredDeploymentErrors=!1;Za.plainTextPayloadSize=0;Za.shadowWorkbookPayloadSize=0;Za.htmlPayloadSize=0;Za.clientSideCopyTime=0;const Xb=new ca.a(this.$.va),ib=Za.sourceItem;Za.isSelectionAllowed=t.a.all(ib.ranges,Rb=>this.isSelectionAllowed(Xb,Rb));Za.isSelectionAllowed&&this.fo.xcf(ib.ranges,Za.commandParameters.commandType)}RMa(Za){return this.gridView.Ca.E4()&&
Y.j(this.gridView,Za)}h5i(Za,Xb,ib,Rb){let lc=!1,nc=1===Xb.commandParameters.commandType,Oc=Rb[0].Oy;1===ib.ranges.length&&1===Rb.length?m.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests1")&&nc&&1!==Oc&&Oc!==ib.ranges[0].Oy?Za.cseStatus=17:lc=this.xah.a9c(Za,G.K(ib.ranges),ib.sheetName,G.K(Za.commandParameters.expandDestinations),this.$.ea.na.sheetName,nc):Za.cseStatus=5;lc&&Y.h(this.$).wh.$R(Za.commandParameters.stopwatch.id,Eb.BasicTelemetryCalculator.HQ);return this.R4i(Za,
ib,G.u(this.$.na.sheetName,null,Rb),Xb.commandParameters.commandType,lc)}isSelectionAllowed(Za,Xb){return Za.bCb(Xb,this.gridView)}R4i(Za,Xb,ib,Rb,lc){Xb=G.u(Xb.sheetName,null,Xb.ranges);Za.pasteResult="SameSessionPaste";Za.payloadOrigin=wc.D0f;Za.payloadType=da.JHg;e.ULS.sendTraceTag(537167829,0,50,`BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId=${Za.commandParameters.id}`);return this.fo.pasteRange(Za.commandParameters.ribbonCommandInfo,Xb,ib,Rb,Za.commandParameters.commandType,
[Za.commandParameters.stopwatch],Za,lc,null,null)}}Object(c.a)(hc,"BaseRangeCopyPasteHandler",gd,[]);var Ab=a(35);class Bb{constructor(Za){this.iU=new Ab.a(!0);this.$=Za}onDeferredPasteStarted(Za){this.iU.hb(Za.id)||this.iU.add(Za.id,!0);if(0<this.iU.count){const Xb=Fa.GetServiceTaskFactory.Oa(this.$.da,5,4,0);ka.TaskExtensions.za(Xb,()=>{Xb.result.ih(28,null)},this.$.la,3)}}onDeferredPasteCompleted(Za){const Xb=0<this.iU.count;this.iU.hb(Za.id)&&this.iU.remove(Za.id);if(Xb&&!this.iU.count){const ib=
Fa.GetServiceTaskFactory.Oa(this.$.da,5,4,0);ka.TaskExtensions.za(ib,()=>{ib.result.removeEntry(28)},this.$.la,3)}}}Object(c.a)(Bb,"DeferredPasteTracker",null,[]);var ec;(function(Za){Za[Za.none=0]="none";Za[Za.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";Za[Za.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";Za[Za.asyncCopyCanceled=3]="asyncCopyCanceled";Za[Za.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(ec||(ec={}));Object(c.b)("CopyErrorType",
ec);var Qd=a(942),dc=a(1136);class dd extends Qd.a{constructor(Za,Xb=null){super(ec[Za]);this.copyErrorName=0;this.ewaErrors=null;this.copyErrorName=Za;this.ewaErrors=Xb;if(null===Xb||void 0===Xb?0:Xb.length)this.innerError=new dc.a(Xb,null)}}Object(c.a)(dd,"CopyInnerError",Qd.a,[]);class jd extends hc{constructor(Za,Xb,ib,Rb=null){super(Za,Xb,ib,"AcrossSessionRangeCopyPasteHandler",Rb);this.iU=new Bb(Za)}serialize(Za){const Xb=Za.sourceItem,ib={};let Rb=this.Z4c.Kva(Xb);if(Rb)ib.synchronousResult=
Rb,Za.isFromCache=!0,Za.clientSideCopyTime=Za.commandParameters.stopwatch.Bc;else{let nc=null;var lc=G.F(Xb.ranges);if(!Sa.a.tjf()&&this.RMa(lc)){e.ULS.sendTraceTag(537167936,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");lc=this.clipboardRangeFactory.create(lc);try{nc=lc.toString(),Rb=this.v$.create(),Rb.setItem(M.plainText,nc),this.Z4c.setValue(Xb,Rb),ib.synchronousResult=Rb,Za.clientSideCopyTime=Za.commandParameters.stopwatch.Bc}finally{lc&&
lc.dispose()}}else Za.isAsyncCopy=!0,ib.synchronousResult=this.v$.create(),ib.synchronousResult.setItem(M.plainText,this.CZc);ib.asynchronousResult=this.Pfd(Za,Xb,nc)}Za.syncClipboardItemsKeys=fa(ib.synchronousResult);return ib}shouldWaitForCopyToComplete(Za){if(!Za||!Za.copyContextSnapshot)return e.ULS.sendTraceTag(537167907,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),!1;e.ULS.shipAssertTag(537167906,
0,!!this.$.ya,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(Za.copyContextSnapshot.sessionId===this.$.ya.UserSessionId)return e.ULS.sendTraceTag(537167905,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),!1;e.ULS.sendTraceTag(537167904,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Za){this.iU.onDeferredPasteStarted(Za)}onDeferredPasteCompleted(Za){this.iU.onDeferredPasteCompleted(Za)}deserialize(Za){Za.isClipboardDataContainShadowWorkbook=
!(void 0===Za.clipboardItems.getItem(M.shadowWorkbook)||null===Za.clipboardItems.getItem(M.shadowWorkbook));if(Y.h(this.$).ha.Ke&326)return L(Za)&&(Za.wasLastCopyExternal=!0),Promise.reject(new W.a(17));var Xb=this.kmg(Za,!1);if(0!==Xb)return Promise.reject(new W.a(L(Za)?18:Za.isSameSession?19:20,void 0,void 0,void 0,Xb));var ib=Za.copyContextSnapshot,Rb=this.fo.Qxb(ib);if(L(Za))return this.Brc(Za);Xb=Za.commandParameters.originalDestinations;if(Rb&&Za.isSameSession)return this.h5i(Za,ib,Rb,Xb);if(516!==
Za.commandParameters.commandType){if(({u0:ib}=this.bXj(Za.clipboardItems)).returnValue){Za.isShadowWorkbookParsedSuccessfully=!0;let lc=Rb=null;m.EwaSettings.isChangeGateEnabled("OfficeVSO:7578455_CrossSessionDiscontinuousCCPEnabled")?Rb=G.r(Xb,this.$):lc=G.v(G.K(Xb),this.$);return this.G4i(Za,lc,Rb,ib)}if(Za.isClipboardInaccessible)return Promise.reject(new W.a(8));if(36!==Za.commandParameters.commandType)return this.fMf(Za)}return Promise.reject(new W.a(6))}beforePaste(Za){this.$.da.Aa(373).ltj(Za);
Za.indicationDisplayScheduled=!0}tWj(Za){let Xb;if(!(Za&&Za.SourceRanges&&Za.SourceRanges.Ranges&&Za.SourceRanges.Ranges.length&&(Za.OriginalSourceRangesCountExceedsLimit||Za.OriginalSourceMultiRange&&Za.OriginalSourceMultiRange.Ranges&&Za.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,u0:null};var ib=Za.SourceRanges.Ranges[0];if(!Za.ShadowWorkbookBase64&&!Za.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,u0:null};Xb=this.bJe(Za);Xb.rangeRowStart=ib.FirstRow;Xb.rangeRowEnd=ib.LastRow;
Xb.rangeColumnStart=ib.FirstColumn;Xb.rangeColumnEnd=ib.LastColumn;Xb.sourceClientPath=Za.SourceClientPath;Xb.sourceSheetName=Za.SourceSheetName;Xb.sourceWorkbookName=Za.SourceWorkbookName;if(!Za.OriginalSourceRangesCountExceedsLimit)for(Za=Za.OriginalSourceMultiRange.Ranges,Xb.originalSourceRanges=Array(Za.length),ib=0;ib<Za.length;++ib)Xb.originalSourceRanges[ib]=[Za[ib].FirstRow,Za[ib].FirstColumn,Za[ib].LastRow,Za[ib].LastColumn];return{returnValue:!0,u0:Xb}}bXj(Za){let Xb;Xb=null;Za=Za.getItem(M.shadowWorkbook);
if(!Za)return{returnValue:!1,u0:Xb};Xb=JSON.parse(Za);return{returnValue:this.ywi(Xb),u0:Xb}}ywi(Za){return!!Za&&(!!Za.shadowWorkbookBase64||Za.shadowWorkbookSizeExceedsLimit)&&void 0!==Za.rangeRowStart&&void 0!==Za.rangeRowEnd&&void 0!==Za.rangeColumnStart&&void 0!==Za.rangeColumnEnd}G4i(Za,Xb,ib,Rb){e.ULS.shipAssertTag(537167903,0,!!Rb,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");z.AFrameworkApplication.iN("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");
Za.pasteResult="CrossSessionPaste";Za.payloadOrigin=wc.EJe;Za.payloadType=da.shadowWorkbook;Za.shadowWorkbookPayloadSize=Jc(Rb);Za.shadowWorkbookSizeExceedsLimit=zc(Rb);Rb.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(Za.originalSourceRangesCountExceedsLimit=Rb.originalSourceRangesCountExceedsLimit);if(Za.shadowWorkbookSizeExceedsLimit)return e.ULS.sendTraceTag(34415003,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length(${Za.shadowWorkbookPayloadSize}) is over the limit(${y.a.Tmc}). reject the paste request. ShadowWorkbookSizeExceedsLimit: ${Rb.shadowWorkbookSizeExceedsLimit}`),
Promise.reject(new W.a(1));if(1028===Za.commandParameters.commandType&&Za.originalSourceRangesCountExceedsLimit)return e.ULS.sendTraceTag(572617859,0,15,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count(${Rb.originalSourceRangesCount}) is over the limit(${y.a.lHi}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: ${Rb.originalSourceRangesCountExceedsLimit}`),Promise.reject(new W.a(1));e.ULS.sendTraceTag(537167902,0,50,`AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId=${Za.commandParameters.id}`);
return this.fo.jMf(Za.commandParameters.ribbonCommandInfo,Xb,ib,Rb,[Za.commandParameters.stopwatch],Za)}Pfd(Za,Xb,ib){e.ULS.shipAssertTag(537167901,0,!!Za,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");const Rb=Za.commandParameters.stopwatch.Bc;return new Promise((lc,nc)=>{e.ULS.sendTraceTag(26035421,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: ${Za.id}`);const Oc=G.u(Xb.sheetName,
null,Xb.ranges);this.fo.copy(Oc,Za.commandParameters,Ib=>{Za.requestTelemetryData=Ib.RequestTelemetryData;Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Rb;if(yb.a.Wf(Ib.Errors))if(yb.a.Xga(Ib.Errors))Za.encounteredDeploymentErrors=!0,Ib=yb.a.nc(Ib.Errors),e.ULS.sendTraceTag(537167898,0,15,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Ib}. copy Id: ${Za.id}`);else{var gc=yb.a.nc(Ib.Errors);
e.ULS.sendTraceTag(26035419,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${gc}. copy Id: ${Za.id}`);nc(new dd(2,Ib.Errors))}else if(e.ULS.sendTraceTag(537167900,0,50,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: ${Za.id}`),Za.markForCancellation)nc(new dd(3,Ib.Errors));else{gc=Ib.Result;var Fc=gc.PlainTextResult;void 0!==ib&&null!==ib&&(Fc=ib);void 0!==Fc&&null!==Fc&&(Za.plainTextPayloadSize=
Fc.length);var Vc=this.v$.create();if(({u0:ed}=this.tWj(gc)).returnValue){Za.shadowWorkbookPayloadSize=Jc(ed);Za.shadowWorkbookSizeExceedsLimit=zc(ed);Za.originalSourceRangesCountExceedsLimit=gc.OriginalSourceRangesCountExceedsLimit;var ed=JSON.stringify(ed);Vc.setItem(M.shadowWorkbook,ed)}Vc.setItem(M.plainText,Fc);Sa.a.tjf()&&(Fc=gc.HtmlResult,Za.htmlSizeExceedsLimit=gc.HtmlSizeExceedsLimit,void 0!==Fc&&null!==Fc&&(Za.htmlPayloadSize=Fc.length),Vc.setItem(M.html,Fc));Za.copyTotalSizeExceedsLimit=
gc.CopyTotalSizeExceedsLimit;Vc.setItem(M.nsb,Za.commandParameters.id);this.Z4c.setValue(Xb,Vc);Za.asyncClipboardItemsKeys=fa(Vc);lc(Vc);m.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)&&(gc=1===Za.commandParameters.commandType?8:7,(Vc=this.$.da.Aa(465))&&Vc.K0(gc,Ib))}},Ib=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Rb;Ib=ab.a.Pe(Ib.data);const gc=yb.a.nc(Ib);e.ULS.sendTraceTag(537167897,0,10,`AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${gc}. copy Id: ${Za.id}`);
nc(new dd(2,Ib))},[Za.commandParameters.stopwatch])})}}Object(c.a)(jd,"AcrossSessionRangeCopyPasteHandler",hc,[]);class md{constructor(Za,Xb,ib,Rb,lc,nc=null,Oc=null){this.floatingObjectId=Za;this.commandParameters=Xb;this.Kt=ib;this.Vih=Rb;this.xaa=nc;this.vQb=Oc;this.nah=lc}}Object(c.a)(md,"CopyArtRequest",null,[]);class vd{constructor(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc){this.promise=null;this.ribbonCommandInfo=Za;this.destination=Xb;this.ALe=ib;this.vQb=lc;this.u0=nc;this.item=Oc;this.pasteContext=Ib;
this.bOa=ib||Xb.FirstRow+"_"+Xb.FirstColumn;this.Njf=!0;this.iDe=gc}}Object(c.a)(vd,"PasteArtRequest",null,[]);class wd{constructor(Za,Xb){this.BKb=new Ba.a;this.SZa=Za;this.$=Xb;this.w$i=ib=>Promise.resolve(ib);this.GGb=ib=>Promise.reject(ib)}bai(Za){if(this.hsi(Za.bOa)){e.ULS.sendTraceTag(537167681,5,50,`PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: ${Za.bOa}`);const Xb=this.BKb.ma(Za.bOa);this.BKb.ia(Za.bOa,Za);const ib=Xb.promise;
Xb.Njf=!1;return this.Ash(Za,ib)}this.BKb.ia(Za.bOa,Za);return this.rzi(Za)}hsi(Za){return this.BKb.hb(Za)}rzi(Za){return new Promise((Xb,ib)=>{Za.promise=this.SZa.eMf(Za).then(Rb=>{Xb(null);return this.dqc(Za,Rb)},Rb=>{ib(null);return this.GGb(Rb)})})}Ash(Za,Xb){return new Promise((ib,Rb)=>{Za.promise=Xb.then(lc=>{this.w1j(Za,lc);return this.SZa.eMf(Za).then(nc=>{ib(null);return this.dqc(Za,nc)},nc=>{Rb(null);return this.GGb(nc)})},lc=>this.GGb(lc))})}dqc(Za,Xb){Za.Njf&&(this.a5g(Za.bOa),this.aQd(Za,
Xb));return this.w$i(Xb)}a5g(Za){this.BKb.remove(Za)}aQd(Za,Xb){const ib=this.U2h();Za.bOa===ib&&this.SZa.aQd(Za.destination,Xb,Za.item.type)}U2h(){var Za=Y.h(this.$).ha.Ra.activeFloatingObjectControlId;Za||(Za=G.v(Y.h(this.$).ha.qa.activeCell,this.$),Za=Za.FirstRow+"_"+Za.FirstColumn);return Za}w1j(Za,Xb){Za.destination=null;Za.ALe=Xb}}Object(c.a)(wd,"PasteArtRequestManager",null,[]);var Pd=a(206),ic=a(124),cd=a(106);class Hd extends gd{constructor(Za,Xb,ib,Rb,lc=null){super(Za,"ArtCopyPasteHandler");
this.T5g="XLO";this.U5g="3";this.iU=new Bb(Za);this.v$=Xb;this.SZa=ib;this.ha=Y.h(Za).ha;this.Y4c=lc||new Va(this.v$);this.H4i=new wd(ib,Za);this.xpb=Rb}getSourceItem(){e.ULS.shipAssertTag(537167896,0,!!this.ha.Ra.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");e.ULS.sendTraceTag(537167895,0,50,`ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[${this.ha.Ra.activeFloatingObjectControlId}]`);return new U(this.ha.Ra.activeFloatingObjectControlId,
this.$.ea.na.sheetName,this.$.ea.se,this.$.ya.UserSessionId,this.ha.Ra.dc.floatingObject.type)}beforeSerialize(Za){Za&&Za.commandParameters?(Za?(Za.isAsyncCopy=!1,Za.isSelectionAllowed=!1,Za.isFromCache=!1,Za.plainTextPayloadSize=0,Za.shadowWorkbookPayloadSize=0,Za.htmlPayloadSize=0,Za.htmlSizeExceedsLimit=!1,Za.clientSideCopyTime=0,Za.encounteredDeploymentErrors=!1,Za.shadowWorkbookSizeExceedsLimit=!1,Za.originalSourceRangesCountExceedsLimit=!1,Za.copyTotalSizeExceedsLimit=!1):e.ULS.sendTraceTag(537167826,
0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),Za.commandParameters.copyPasteTargetType=2):e.ULS.sendTraceTag(537167894,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")}serialize(Za){const Xb=Za.sourceItem,ib={};if(!Xb)return e.ULS.sendTraceTag(537167893,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),ib;if(!this.ivi())return e.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),
ib;e.ULS.sendTraceTag(537167892,0,50,`ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[${Xb.activeFloatingObjectControlId}]`);this.hHd();let Rb=this.Y4c.Kva(Xb);if(Rb)ib.synchronousResult=Rb,Za.isFromCache=!0,Za.isAsyncCopy=!1,Za.clientSideCopyTime=Za.commandParameters.stopwatch.Bc,1===Za.commandParameters.commandType&&this.$.Yc(2045211913,Za.commandParameters.ribbonCommandInfo.method,Za.commandParameters.ribbonCommandInfo.Ve,null);else{Za.isFromCache=!1;Za.isAsyncCopy=
!0;Rb=this.v$.create();if(Za.commandParameters.uploadToClipService){const lc={};lc["data-clipservice-ccpid"]=Za.commandParameters.id;lc["data-pkey"]=Za.commandParameters.pKey;lc["data-clipservice-type"]=Za.commandParameters.clipServiceDataType;lc["data-clipservice-count"]=Za.commandParameters.objectCount.toString();lc["data-clipservice-dc"]=Za.commandParameters.clipServiceDataCenter;lc["data-clipservice-client"]=this.T5g;lc["data-TimeStamp"]=(new Date).toUTCString();lc["data-clipservice-version"]=
this.U5g;Rb.setItem(M.RPg,JSON.stringify(lc))}ib.synchronousResult=this.rJg(Rb);ib.asynchronousResult=this.Pfd(Za,Xb,Rb)}Za.syncClipboardItemsKeys=fa(ib.synchronousResult);return ib}rJg(Za){e.ULS.shipAssertTag(537167891,0,!!this.ha.Ra.dc,"Expecting a floating object to be currently selected for copy");Za||(Za=this.v$.create());const Xb=this.ha.Ra.dc.hwb();Xb&&Za.setItem(M.html,`<img src='${Xb}'>`);return Za}hHd(){const Za=this.ha.Ra.dc;this.xpb.hHd(ic.a.Arb(Za.floatingObject),ic.a.W5g(Za.lu))}shouldWaitForCopyToComplete(){e.ULS.sendTraceTag(537167890,
0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0}onDeferredPasteStarted(Za){this.iU.onDeferredPasteStarted(Za)}onDeferredPasteCompleted(Za){this.iU.onDeferredPasteCompleted(Za)}deserialize(Za){var Xb=L(Za),ib=null;let Rb=null;var lc=!1;if(!Xb){ib=Za.copyContextSnapshot;Rb=ib.sourceItem;if(!Rb)return Promise.reject(new W.a(10));lc=Rb.isFromCurrentSession(this.$)}var nc=this.kmg(Za,!0);if(0!==nc)return Promise.reject(new W.a(Xb?18:lc?19:20,void 0,void 0,void 0,nc));if(Xb)return this.Brc(Za);
if(!lc&&!Hd.Hni(Rb))return Za=`User attempted to paste art of type [${Rb.type}] between sessions.`,e.ULS.sendTraceTag(537167889,0,50,Za),Promise.reject(new W.a(11,void 0,void 0,Za));if(ib.isAsyncSerializeFailed)return Promise.reject(new W.a(16,void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));let Oc;try{const Ib=Za.clipboardItems.getItem(M.shadowWorkbook);Oc=JSON.parse(Ib)}catch(Ib){return Za=copyPasteInfra.getStringifiedError(Ib),e.ULS.sendTraceTag(537167888,
0,10,`ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: ${Za}`),Promise.reject(new W.a(12,void 0,Ib))}Oc.floatingObjectId!==Rb.activeFloatingObjectControlId?e.ULS.sendTraceTag(537167887,0,10,`ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Rb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Oc.floatingObjectId}]`):e.ULS.sendTraceTag(537167886,0,50,`ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[${Rb.activeFloatingObjectControlId}], shadowWorkbookPayload.FloatingObjectId=[${Oc.floatingObjectId}]`);
if(!Oc||!Oc.shadowWorkbookBase64)return Promise.reject(new W.a(13,void 0,void 0,`shadowWorkbookPayload is null = ${!Oc}`));Za.isShadowWorkbookParsedSuccessfully=!0;Za.shadowWorkbookPayloadSize=Jc(Oc);Za.shadowWorkbookSizeExceedsLimit=zc(Oc);Za.payloadOrigin=lc?wc.D0f:wc.EJe;Za.payloadType=da.Wpg;if(zc(Oc))return Za=`Shadow workbook size [${Za.shadowWorkbookPayloadSize}] is over the limit [${y.a.Tmc}]. ShadowWorkbookSizeExceedsLimit: ${Oc.shadowWorkbookSizeExceedsLimit}`,e.ULS.sendTraceTag(36304156,
0,15,`ArtCopyPasteHandler.Deserialize: ${Za}`),Promise.reject(new W.a(1,void 0,void 0,Za));ib=Xb=null;Y.h(this.$).ha.Ke&326?ib=Y.h(this.$).ha.Ra.activeFloatingObjectControlId:Xb=this.$.na&&this.$.na.activeCell?G.v(this.$.na.activeCell,this.$):G.v(G.K(Za.commandParameters.originalDestinations),this.$);lc=null;if(this.xpb.A8f(Rb))try{lc=this.xpb.a9c()}catch(Ib){nc=copyPasteInfra.getStringifiedError(Ib),e.ULS.sendTraceTag(537167885,0,10,`ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: ${nc}`)}return this.H4i.bai(new vd(Za.commandParameters.ribbonCommandInfo,
Xb,ib,Za.commandParameters.commandType,[Za.commandParameters.stopwatch],Oc,Rb,Za,lc))}Brc(Za){Za.wasLastCopyExternal=!0;if(Za.clipboardItems.getItem("image/png")){const Xb=Za.commandParameters.stopwatch.Bc;Za.payloadType=da.eWg;return qa.b(this.$.Yc(1403967063,Za.commandParameters.ribbonCommandInfo.method,Za.commandParameters.ribbonCommandInfo.Ve,{["dataUrl"]:Za.clipboardItems.getItem("image/png")})).then(ib=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Xb;return ib?Promise.resolve(null):
Promise.reject(new W.a(15))},()=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-Xb;return Promise.reject(new W.a(15))})}e.ULS.shipAssertTag(537167884,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");return super.Brc(Za)}ivi(){const Za=Y.h(this.$).ha;return Za.Ra.activeFloatingObjectControlId&&Za.Ra.dc&&Za.Ra.dc.floatingObject?Za.Ra.dc.floatingObject.sXd():!1}Pfd(Za,Xb,ib){return new Promise((Rb,lc)=>{const nc=Za.commandParameters.stopwatch.Bc;e.ULS.sendTraceTag(41562516,
0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");this.SZa.pah(new md(Xb.activeFloatingObjectControlId,Za.commandParameters,Oc=>{Za.requestTelemetryData=Oc.RequestTelemetryData;Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-nc;if(yb.a.Wf(Oc.Errors))if(yb.a.Xga(Oc.Errors))Za.encounteredDeploymentErrors=!0,Oc=yb.a.nc(Oc.Errors),e.ULS.sendTraceTag(537167879,0,15,`ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Oc}`);
else{var Ib=yb.a.nc(Oc.Errors);e.ULS.sendTraceTag(36229122,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ib}`);lc(new dd(4,Oc.Errors))}else if(e.ULS.sendTraceTag(537167883,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[${Xb.activeFloatingObjectControlId}].`),Za.markForCancellation)lc(new dd(3,Oc.Errors));else{if(yb.a.qq(Oc.Errors)){var gc=yb.a.nc(Oc.Errors);e.ULS.sendTraceTag(537167882,0,50,
`ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: ${gc}`)}if(gc=Oc.Result){gc=this.bJe(gc);gc.floatingObjectId=Xb.activeFloatingObjectControlId;Za.shadowWorkbookPayloadSize=Jc(gc);Za.shadowWorkbookSizeExceedsLimit=zc(gc);try{Ib=JSON.stringify(gc)}catch(Fc){lc(new W.a(14,void 0,Fc,`Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [${Za.shadowWorkbookPayloadSize}], shadowWorkbookPayload.FloatingObjectId: [${gc.floatingObjectId}]`));return}e.ULS.shipAssertTag(537167881,
0,!!ib,"Expecting syncClipboardItems to be defined");ib.setItem(M.shadowWorkbook,Ib);1===Za.commandParameters.commandType&&(this.i8i(Xb.type,Xb.activeFloatingObjectControlId,Oc.StateId),this.deleteFloatingObject(Xb.activeFloatingObjectControlId,Xb.type));this.Y4c.setValue(Xb,ib);Za.asyncClipboardItemsKeys=fa(ib);Rb(ib)}else e.ULS.sendTraceTag(537167880,0,50,`ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: ${Xb.activeFloatingObjectControlId}`),Rb(this.Y4c.Kva(Xb))}},
Za.commandParameters.commandType,Xb.type,Oc=>{Za.serverRequestTimeInMs=Za.commandParameters.stopwatch.Bc-nc;Oc=ab.a.Pe(Oc.data);1===Za.commandParameters.commandType&&this.SZa.cYj(Xb.type,Xb.activeFloatingObjectControlId);const Ib=yb.a.nc(Oc);e.ULS.sendTraceTag(537167878,0,10,`ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: ${Ib}`);lc(new dd(4,Oc))},[Za.commandParameters.stopwatch]))})}deleteFloatingObject(Za,Xb){Za=Pd.a.Yy(Xb,Za);if(Za=cd.a(this.$).pr(Za))cd.a(this.$).deleteFloatingObject(Za,
14,!0),Y.h(this.$).ha.Ra.zA=null}i8i(Za,Xb,ib){const Rb=this.$.da.Aa(277);if(Rb){let nc=null;Za=Pd.a.Yy(Za,Xb);Za=cd.a(this.$).pr(Za);if(null===Za||void 0===Za?0:Za.Li)nc=Za.Li.block;if(nc){var lc=Za.floatingObject.Fg();Rb.m_b(()=>!nc.zi.hb(lc),ib,"CutArt")}}}static Hni(Za){return 1===Za.type||5===Za.type}}Object(c.a)(Hd,"ArtCopyPasteHandler",gd,[]);var he=a(59);class Lb extends ub{constructor(Za,Xb,ib,Rb){super(Za);this.isFromCurrentSession=!1;this.left=this.top=0;this.isFromCurrentSession=Xb;this.top=
ib;this.left=Rb}}Object(c.a)(Lb,"MacroRecorderPasteArtPayload",ub,[]);class Ic{constructor(Za,Xb){this.$=Za;this.xpb=Xb}zfi(Za,Xb,ib,Rb,lc,nc=null,Oc=null){const Ib=this.$.oa.xa.Wb();let gc=null;const Fc={CopyPasteTargetType:2};Fc.FloatingObjectId=Za;Fc.CopyOperationId=ib.id;ib.floatingObjectType=Xb;Fc.UploadToClipService=ib.uploadToClipService;Fc.PKey=ib.pKey;Fc.ClipServiceDataCenter=ib.clipServiceDataCenter;let Vc=0;2===lc?(lc=505,Vc=16,gc=(ed,Sd,Zd)=>lb(this.$.oa.xa,Fc,ma.b(ed,Rb),nc?ma.a(Sd,nc):
Sd,Zd,ib.ribbonCommandInfo,Ib,Oc)):(lc=179,gc=(ed,Sd,Zd)=>{this.Foh(Xb,Za);this.$.py();return db(this.$.oa.xa,Fc,ma.b(ed,Rb),nc?ma.a(Sd,nc):Sd,Zd,ib.ribbonCommandInfo,Ib,Oc)});this.$.userOperationManager.Jc(new za.a(lc,0,gc,Vc|64),ib.ribbonCommandInfo)}Foh(Za,Xb){var ib=Pd.a.Yy(Za,Xb);(ib=cd.a(this.$).pr(ib))?(Y.h(this.$).ha.Ra.SG(ib),ib.isVisible=!1):e.ULS.sendTraceTag(537167876,0,50,`ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : ${Za}, FloatingObjectId: ${Xb}`)}cYj(Za,
Xb){Za=Pd.a.Yy(Za,Xb);if(Za=cd.a(this.$).pr(Za))Za.isVisible=!0}pah(Za){this.zfi(Za.floatingObjectId,Za.nah,Za.commandParameters,Za.Kt,Za.Vih,Za.xaa,Za.vQb)}agi(Za,Xb,ib,Rb,lc,nc,Oc,Ib=null,gc=!0){return new Promise((Fc,Vc)=>{const ed=nc.commandParameters.stopwatch.Bc;this.xQd(Za,lc,Xb,ib,Sd=>{nc.requestTelemetryData=Sd.RequestTelemetryData;nc.serverRequestTimeInMs=nc.commandParameters.stopwatch.Bc-ed;if(yb.a.Xga(Sd.Errors))nc&&(nc.encounteredDeploymentErrors=!0),Sd=yb.a.nc(Sd.Errors),e.ULS.sendTraceTag(537167875,
0,15,`ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: ${Sd}`);else if(yb.a.Wf(Sd.Errors)){var Zd=yb.a.nc(Sd.Errors);e.ULS.sendTraceTag(36459652,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${Zd}`);Vc(new W.a(9,Sd.Errors))}else Sd.Result?(Zd=Sd.Result,e.ULS.sendTraceTag(537167874,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded."),this.v8i(Oc,Zd.FloatingObjectId,Sd.StateId),Fc(Ic.hnd(Zd.FloatingObjectId))):(e.ULS.sendTraceTag(537167873,
0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),Vc(new W.a(9,Sd.Errors)))},Sd=>{nc.serverRequestTimeInMs=nc.commandParameters.stopwatch.Bc-ed;Sd=ab.a.Pe(Sd.data);e.ULS.sendTraceTag(537167872,0,10,`ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: ${yb.a.nc(Sd)}`);Vc(new W.a(9,Sd))},Rb,Ib,gc)})}v8i(Za,Xb,ib){const Rb=this.$.da.Aa(277);if(Rb){const lc=Pd.a.Yy(Za,Ic.hnd(Xb));Rb.m_b(()=>!!cd.a(this.$).pr(lc),ib,"PasteArt")}}u_d(Za,Xb){Xb&&this.xpb.u_d(Za,Pd.a.Yy(Za.type,
Xb))}eMf(Za){return this.agi(Za.ribbonCommandInfo,Za.destination,Za.ALe,Za.vQb,Za.u0,Za.pasteContext,Za.item.type,Za.iDe,Za.item.isFromCurrentSession(this.$)).then(Xb=>Xb,Xb=>{this.u_d(Za.item,Za.iDe);return Promise.reject(Xb)})}aQd(Za,Xb,ib){Za||(Za=G.v(Y.h(this.$).ha.qa.activeCell,this.$));Y.h(this.$).mjc(G.D(Za),1)?cd.a(this.$).tna(ib,Xb,!0):Y.h(this.$).ha.Ra.qHa(Za,Xb,ib).continueWith(Rb=>{Rb.result?e.ULS.sendTraceTag(537167843,5,50,`ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [${Xb}]`):
e.ULS.sendTraceTag(537167842,5,10,`ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [${Xb}]`)})}xQd(Za,Xb,ib,Rb,lc,nc,Oc,Ib,gc=!0){const Fc=this.$.oa.xa.Wb(),Vc={};Vc.ShadowWorkbookBase64=Xb.shadowWorkbookBase64;Vc.FloatingObjectId=Rb;Vc.DestinationRanges=ib?G.s(ib):null;Vc.CopyPasteTargetType=2;Vc.ClientEstimationFloatingObjectId=Ib;ib=new za.a(503,0,(ed,Sd,Zd)=>{Ib||this.$.py();return Pa(this.$.oa.xa,Vc,ma.b(ed,lc),ma.a(Sd,nc),Zd,null,Fc,Oc)},void 0,()=>{if(gc){let ed;
ed=he.a.Xh(he.a.Dc(Vc));ed.FloatingObjectId=Xb.floatingObjectId;Vc.DestinationRanges||(ed.DestinationRanges=G.p(this.$.va.na.sheetName,"",0,0,0,0));return new Lb(ed,gc,0,0)}return new Lb(Vc,gc,0,0)});ib.flags=65;this.$.userOperationManager.Jc(ib,Za)}static hnd(Za){return`${Za.length+2}.{${Za.toUpperCase()}}`}}Object(c.a)(Ic,"ArtCopyPasteUtils",null,[795]);var Ob=a(198);class Kc{constructor(Za){this.W4c=this.hta=null;this.yab=15;this.$=Za}hHd(Za,Xb){this.hta=Za;this.W4c=Xb}a9c(){if(!this.hta||!this.W4c)return e.ULS.sendTraceTag(537167841,
0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),"";const Za=ic.a.Arb(new Pd.a(this.hta));Za.Id=Ic.hnd(k.a.create().toString());Za.Version=-1;Za.Name="";Za.IsClientEstimation=!0;var Xb=this.rhi(Za);if(!Xb)return null;const ib=new Pd.a(Za);Xb.block.zi.add(ib);ib.FKb();const Rb=cd.a(this.$);Rb.J5b(ib,Xb);Xb=Rb.pr(Pd.a.BWh(Za));!Xb||Xb.floatingObject.CMa||Xb.floatingObject.$Ma||Xb.URa(this.W4c);
Rb.tna(Za.Type,Za.Id,!0);return Za.Id}A8f(Za){return m.EwaSettings.ra(205)&&Za.isFromCurrentSession(this.$)&&!Y.h(this.$).rtl&&!Y.h(this.$).ib.fj}u_d(Za,Xb){this.A8f(Za)&&(Za=cd.a(this.$).pr(Xb))&&(e.ULS.sendTraceTag(537167840,5,50,`ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [${Xb}] of type [${Za.floatingObject.type}]`),cd.a(this.$).deleteFloatingObject(Za,15,!0),Za.Li&&Za.fcb(Za.Li,!1))}rhi(Za){if(!Za)return e.ULS.sendTraceTag(537167839,
0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(Y.h(this.$).ha.Ra.activeFloatingObjectControlId){var Xb=Y.h(this.$).ha.Ra.zA.floatingObject;Za.OriginDeltaX=Xb.offsetX+this.yab;Za.OriginDeltaY=Xb.offsetY+this.yab;Za.AbsoluteLeft+=this.yab;Za.AbsoluteTop+=this.yab;Za.AbsoluteRight+=this.yab;Za.AbsoluteBottom+=this.yab;Za.ZOrder=Xb.LB+1;return Y.h(this.$).ha.Ra.zA.Li}if(!this.$.na||!this.$.na.activeCell)return e.ULS.sendTraceTag(537167838,
0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var ib=this.$.na.activeCell;Xb=Y.h(this.$).W0(ib);if(!Xb)return e.ULS.sendTraceTag(537167837,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range ${ib.toString()} is null.`),null;const Rb=nb.HelperMethods.Bxb(Xb.domElement,Xb.$i.domElement);ib=Xb.gridView.xg(ib,2);if(!Rb||!ib)return e.ULS.sendTraceTag(537167836,0,15,`ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: ${!Rb}. cellPositionRelativeToGridOrigin is null: ${!ib} .`),
null;Za.OriginDeltaX=ib.topLeft.x-Rb.x;Za.OriginDeltaY=ib.topLeft.y-Rb.y;Za.AbsoluteLeft=ib.topLeft.x;Za.AbsoluteTop=ib.topLeft.y;Za.AbsoluteRight=Za.AbsoluteLeft+Math.abs(this.hta.AbsoluteRight-this.hta.AbsoluteLeft);Za.AbsoluteBottom=Za.AbsoluteTop+Math.abs(this.hta.AbsoluteBottom-this.hta.AbsoluteTop);Za.ZOrder=this.hta.ZOrder+100;return new Ob.a(Xb.gridView.Ca.zl(Xb.hashCode),Xb.hashCode)}}Object(c.a)(Kc,"ArtPasteClientEstimation",null,[794]);class Ac{create(){const Za=window.clipboardPlatform;
return Za?Za.createClipboardItems():null}}Object(c.a)(Ac,"ClipboardItemsFactory",null,[793]);class Yc{}Yc.undefined="Undefined";Object(c.a)(Yc,"CCPTelemetryConsts",null,[]);class td{}td.cells="Cells";td.floatingObject="FloatingObject";td.unknown="Unknown";Object(c.a)(td,"ActiveSelection",null,[]);class $d{}$d.Rnh="DisplayNotInvoked";$d.U8c="Displayed";$d.E8i="PrerequisitesNotReady";Object(c.a)($d,"PasteIndicationDisplayStatus",null,[]);var be=a(114);class ke{constructor(Za){this.zHc=this.CRc=null;
this.$=Za}get kJd(){if(!this.CRc){const Za=this.$.da.Aa(254,!0);Za&&(this.CRc=new jd(this.$,Za,new Ac))}return this.CRc}get yZc(){if(!this.zHc&&this.$.da.Aa(254,!0)){const Za=new Kc(this.$);this.zHc=new Hd(this.$,new Ac,new Ic(this.$,Za),Za)}return this.zHc}getCopyFlowHandler(Za){const Xb=this.vSh(Y.h(this.$).Ke);Za.commandParameters.copyPasteHandlerName=Xb.name;return Xb}getPasteFlowHandler(Za){var Xb=Za.copyContextSnapshot;Xb=aa(Za)?this.yZc:L(Za)?this.kJd:(null===Xb||void 0===Xb?0:Xb.sourceItem)&&
Object.getType(Xb.sourceItem)===U?this.yZc:this.kJd;Za.commandParameters.copyPasteHandlerName=Xb.name;return Xb}initializePasteContext(Za){if(Za&&(Za.isSameSession=!1,Za.isShadowWorkbookParsedSuccessfully=!1,Za.pasteResult=Yc.undefined,Za.payloadOrigin=Yc.undefined,Za.payloadType=Yc.undefined,Za.encounteredDeploymentErrors=!1,Za.shadowWorkbookSizeExceedsLimit=!1,Za.originalSourceRangesCountExceedsLimit=!1,Za.activeSelectionType=this.bOh(),Za.indicationDisplayScheduled=!1,Za.pasteDestinationHasMergedCells=
!1,Za.pasteIndicationDisplayStatus=$d.Rnh,Za.copyContextSnapshot)){var Xb=Za.copyContextSnapshot;const Oc=E(Xb.sourceItem);var ib=Xb.sourceItem;var Rb=!!ib&&Object.getType(ib)===U;ib=0;var lc=!1;Oc?(lc=Xb.sourceItem,Za.isSameSession=lc.isFromCurrentSession(this.$),ib=1,lc=this.isi(lc,Za)):Rb&&(Za.isSameSession=Xb.sourceItem.isFromCurrentSession(this.$),ib=2);if(Za.copyContextSnapshot.commandParameters){const Ib=-1985798686===Xb.commandParameters.ribbonCommandInfo.command;Rb=Za.commandParameters;var nc=
this.$;Xb?nc&&nc.ya?Xb=Xb.sessionId===nc.ya.UserSessionId:(e.ULS.shipAssertTag(537166211,0,!1,"ewaControl shouldn't be null"),Xb=!1):(e.ULS.shipAssertTag(537166212,0,!1,"copyContext shouldn't be null"),Xb=!1);Rb.clearSystemClipboard=Xb&&Ib&&Oc&&!lc;Za.commandParameters.copyPasteTargetType=ib}}}getSessionId(){return this.$.ya.UserSessionId}isi(Za,Xb){const ib=be.b(Za.ranges,Rb=>Rb.Rg)&&be.b(Xb.commandParameters.originalDestinations,Rb=>1!==Rb.top);return be.b(Za.ranges,Rb=>Rb.isRow)&&be.b(Xb.commandParameters.originalDestinations,
Rb=>1!==Rb.left)||ib}vSh(Za){switch(Za){case 1:return this.kJd;case 64:case 4:case 2:case 256:return this.yZc;default:throw Error.invalidOperation("Unsupported selection");}}bOh(){return Y.h(this.$).ha.Ke&470?td.floatingObject:1===Y.h(this.$).ha.Ke?td.cells:td.unknown}getDialogResponse(){}}Object(c.a)(ke,"ExcelCopyPasteApplicationHost",null,[775]);var Pe=a(160);class Dd extends v.a{constructor(Za,Xb){super(Za);this.jt=null;this.iji=(ib,Rb)=>{1===ib?(ib=Dd.cnh[Rb[Dd.bnh]],e.ULS.sendTraceTag(537167683,
0,50,`InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = ${0===ib?"Horizontal":"Vertical"}`),this.jt.setResult(ib)):(e.ULS.sendTraceTag(537167682,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),this.jt.rs())};this.ig(Xb)}get kc(){return"InsertCopiedCutCellsDialog"}ig(Za){this.jt=new Pe.a;const Xb=C.a.instance.ga(16);Za=this.HM(Za);this.initializeAndShow(Xb,this.iji,Za)}HM(Za){return{[Dd.it]:this.kc,
[Dd.Nti]:Za}}}Dd.bnh="direction";Dd.Nti="isRtl";Dd.cnh={["Vertical"]:1,["Horizontal"]:0};Object(c.a)(Dd,"InsertCopiedCutCellsDialog",v.a,[]);class ge{L5b(Za,Xb){return(new Dd(Za,Xb)).jt.task}}Object(c.a)(ge,"InsertCopiedCutCellsDialogFactory",null,[774]);var ne=a(89),ce=a(48),we=a(44);class ve{constructor(Za){this.I6b="";this.c2=this.Vs=null;this.zsc=!1;this.Zbf=(Xb=null,ib=null)=>{this.hide(Xb,ib)};this.gridView=Y.h(Za);this.gridView.ha.eC(this.Zbf)}NNe(){this.zsc||(e.ULS.sendTraceTag(537167680,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.Vx(Za=>{Za.Jaa(0).then(()=>{this.zsc=!0})}))}ltj(Za){var Xb=Za.commandParameters.id;e.ULS.sendTraceTag(537167651,0,50,`PasteIndicationManager.ScheduleDisplay: pasteCommandId = ${Xb}, cancelCtx is null = ${!this.Vs}, PrerequisitesDownloaded = ${this.zsc}`);this.NNe();this.I6b=Xb;Xb=!this.xxf();if(!this.Vs||Xb)this.rAe(),this.Vs=ce.a.instance.create(()=>{this.Qnh(Za)},void 0===Za.timeoutToShowSpinnerInMs||
null===Za.timeoutToShowSpinnerInMs?100:Za.timeoutToShowSpinnerInMs,we.a.N4i);this.c2=Za.commandParameters.originalDestinations}Qnh(Za){this.zsc?(this.display(Za.commandParameters.originalDestinations),Za.pasteIndicationDisplayStatus=$d.U8c):(e.ULS.sendTraceTag(537167650,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),Za.pasteIndicationDisplayStatus=$d.E8i)}display(Za){e.ULS.sendTraceTag(537167649,0,50,"PasteIndicationManager.Display: started");
this.gridView.Cb.zB(Yb.a.ITa(La.d(this.gridView.$.na),Za),ve.Crc,!0);this.gridView.Cb.Qq(ve.Crc)}Xld(Za){e.ULS.sendTraceTag(537167648,0,50,`PasteIndicationManager.HideForPasteId: pasteCommandId = ${Za}, currentPasteCommandId = ${this.I6b}`);Za&&X.a.equals(Za,this.I6b,!1)&&this.hide()}hide(Za=null){this.c2&&Za&&this.xxf()&&e.ULS.sendTraceTag(537167647,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");this.I6b=
"";this.rAe();this.c2=null;this.gridView.Cb.Nj(ve.Crc);this.gridView.Cb.wk(null,ve.Crc)}xxf(){return G.Q(this.gridView.ha.qa.selectedRanges,this.c2)}rAe(){this.Vs&&(ne.a.Ja(this.Vs),this.Vs=null)}dispose(){this.hide();this.gridView.ha.vB(this.Zbf)}}ve.Crc=[30];Object(c.a)(ve,"PasteIndicationManager",null,[773,2]);var Re=a(999),rf=a(51),We=a(712);class Ye extends f.a{constructor(Za){super();this.$=Za;this.cm=C.a.instance;this.Db()}create(){const Za=rf.a.ZQ([74,75],4,this.Xa,void 0,void 0,void 0,Ye.Ana),
Xb=Fa.GetServiceTaskFactory.create(this.$.da,18,this.$.la,this.Xa);ka.TaskExtensions.za(ka.TaskExtensions.Fd([Xb,Za],this.la),()=>{const ib=new Re.a;let Rb=null;this.N8g(ib).then(lc=>{Rb=lc.mDe;const nc=copyPasteInfra.createCopyPasteInfra(Rb,new ke(this.$),ib,this.$);e.ULS.shipAssertTag(537167762,0,!!this.$.ya,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");e.ULS.shipAssertTag(537167761,0,!!this.$.ya&&!!this.$.ya.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");
const Oc=Rb.getMetadataManager();var Ib=Object(We.a)(this.$.da,254,()=>new Ha(this.$,Oc,Xb.result,nc,new Qb(this.$,Y.h(this.$)),new ge,this.$.ya.DocumentHostInfo.UserId,Rb.getInitializationError()));this.nb(Ib);if(lc.v0a){Ib=Ha.Ebc();const gc=JSON.stringify(lc.v0a.dataClipboardCapabilities),Fc=lc.v0a.clipboardStrategiesToInitialize[0].clipboardStrategyType===lc.v0a.dataClipboardStrategyType,Vc=void 0===window.bsqmXLSPageLoadStartTime||null===window.bsqmXLSPageLoadStartTime?"-1":(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString();
e.ULS.sendTraceTag(41731933,0,50,`CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName=${Ib}, StrategyType=${lc.v0a.dataClipboardStrategyType}, StrategyCapabilities=${gc}, IsBestStrategyTypeInitialized=${Fc}, InfraLoadTimeMS=${Vc}`)}else e.ULS.shipAssertTag(537167760,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},lc=>{const nc=Ha.Ebc();lc=lc?copyPasteInfra.getStringifiedError(lc):"null";e.ULS.shipAssertTag(38847436,
0,!1,`CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: ${nc} error: ${lc}`)})},this.la,3)}dispose(){super.dispose()}N8g(Za){let Xb=null;var ib=window.clipboardPlatform;ib&&(Xb=ib.getClipboardPlatformEnvironment());if(!Xb)return e.ULS.shipAssertTag(537167759,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);ib=this.$.ya;const Rb=[ib.OfficeOnlineChromeExtensionId,ib.ChromeClipboardAccessExtensionId],lc=this.cm.Ta(5);var nc=this.$.$d.get(57);let Oc=!nc&&this.$.$d.get(5);const Ib=this.$.ea.$b;Ib&&(Ib.inWebPart||Ib.inViewerFromWebPart||Ib.isDivSyndicated)&&(Oc=!1);nc=this.rRh(Oc,!nc);e.ULS.shipAssertTag(537167758,0,!!ib.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return Xb.init(this.$,
Za,Rb,ib.SharedClipboardHostingApp,ib.SharedClipboardHostingApps,ib.SharedClipboardHostingEnvironments,ib.SharedClipboardOverrideOrigin,ib.SharedClipboardSchemaVersion,ib.SharedClipboardExpirationInMinutes,ib.ClipboardPromiseTimeoutInMinutes,lc,ib.MachineCluster,new Wb(this.$),nc,ib.DocumentHostInfo.UserId,ib.ClipboardTtlInMS,m.EwaSettings.ra(273),ib.UserSessionId,ib.BulsEndpointUrl).then(gc=>Object(b.a)(new Ya,{mDe:Xb,v0a:gc}),gc=>Promise.reject(gc))}rRh(Za,Xb){const ib=[];Za&&Xb&&ib.push(this.vhh());
Xb&&(ib.push(this.K6c(7)),ib.push(this.K6c(0)));Za&&ib.push(this.iIe());ib.push({clipboardStrategyType:4});const Rb=ib?ib.map(lc=>JSON.stringify(lc)).join(","):"[]";e.ULS.sendTraceTag(39978242,0,50,`CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed=${Za}, isSystemClipboardAllowed=${Xb}, result = ${Rb}`);return ib}iIe(){const Za=this.$.ya,Xb={clipboardStrategyType:5};Xb.sessionId=Za.UserSessionId;Xb.useSharedClipboardIframe=
!0;Xb.sharedClipboardHostingApp=Za.SharedClipboardHostingApp;Xb.sharedClipboardHostingApps=Za.SharedClipboardHostingApps;Xb.sharedClipboardHostingEnvironments=Za.SharedClipboardHostingEnvironments;Xb.sharedClipboardOverrideOrigin=Za.SharedClipboardOverrideOrigin;Xb.sharedClipboardSchemaVersion=Za.SharedClipboardSchemaVersion;Xb.sharedClipboardExpirationInMinutes=Za.SharedClipboardExpirationInMinutes;Xb.wacCluster=Za.MachineCluster;return Xb}vhh(){const Za={clipboardStrategyType:6};Za.localStorageStrategyParameters=
this.iIe();Za.systemClipboardStrategyParameters=this.K6c(0);return Za}K6c(Za){const Xb={};Xb.clipboardStrategyType=Za;Xb.skipFilesIfPlainTextExists=!0;return Xb}static ka(Za){Za.da.Ha(373,new ve(Za));Za.da.Ha(Ye.Ana,new Ye(Za))}}Ye.Ana=255;Object(c.a)(Ye,"CopyPasteInfrastructureFactory",f.a,[]);var bf=a(9);a.d(F,"a",function(){return Ve});const Ve=()=>{bf.a.Fa(Za=>{Ye.ka(Za)})}},1178:function(r,F,a){r=a(0);var c=a(15),b=a(697),e=a(553),f=a(85),d=a(84),h;(function(fa){fa[fa.applicationFeatureHelperHandler=
0]="applicationFeatureHelperHandler";fa[fa.cloudPolicySettings=1]="cloudPolicySettings";fa[fa.alternateAuthToken=2]="alternateAuthToken"})(h||(h={}));Object(r.b)("ApplicationFeatureHelperRequestType",h);class l{constructor(){this.message=null;this.M5a=0}}Object(r.a)(l,"HttpRequstToPromiseRejectData",null,[]);var k=a(99),t=a(79),n=a(241),z=a(30);class w{constructor(fa,ua){this.mb=fa;this.ph=ua}Z5c(fa,ua,Fa,ca=null,ka=null,Ca=null,fb=null,yb=null){const mb=h[Fa],nb=mb+"RequestFailure";k.Health.instance.recordKpiUsage(nb,
0,"jpittsdirects",null);return new Promise((X,R)=>{c.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",mb);const wa=null!=fb?fb:this.mb.vd("ApplicationFeatureHelperRequestQueueTimeout",15E3),na=null!=yb?yb:this.mb.vd("ApplicationFeatureHelperRequestSentTimeout",3E4);this.ph.Jga(fa,1,null,this.MWh(Fa,ca),Ca,!1,1,Ba=>{c.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",
mb);try{if(void 0===Ba||null===Ba||void 0===Ba.data||null===Ba.data||void 0===Ba.data.de||null===Ba.data.de){k.Health.instance.recordKpiFailure(nb,"Invalid RequestSucceededEventArgs",!1,!0,null);let qa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",mb);R(this.Txb(qa,Ba))}else if(Ba.data.httpStatus!==n.a.IO){k.Health.instance.recordKpiFailure(nb,"HttpStatusCode_"+Ba.data.httpStatus.toString(),!1,!0,
null);let qa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",Ba.data.httpStatus,mb);R(this.Txb(qa,Ba))}else{void 0!==ka&&null!==ka&&void 0!==Ba.data.responseHeaders&&null!==Ba.data.responseHeaders&&ka(Ba.data.responseHeaders);var Ra=ua(Ba.data.de);if(Ra)c.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",
mb),X(Ra);else{k.Health.instance.recordKpiFailure(nb,"Parse Failure",!1,!0,null);let qa=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",mb);R(this.Txb(qa,Ba))}}}catch(qa){k.Health.instance.recordKpiFailure(nb,"Unexpected Failure",!1,!0,null),Ra=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",qa,mb),R(this.Txb(Ra,Ba))}},Ba=>{if(Ba.data){k.Health.instance.recordKpiFailure(nb,"HttpStatusCode_"+
Ba.data.httpStatus.toString(),!1,!0,null);var Ra=z.a.Mid(Ba.data.de||"No Data");Ra=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",Ba.data.httpStatus,Ra,mb)}else k.Health.instance.recordKpiFailure(nb,"Invalid RequestFailedEventArgs",!1,!0,null),Ra=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",mb);R(this.Txb(Ra,Ba))},null,void 0,
void 0,wa,na)})}Txb(fa,ua){const Fa=new l;Fa.message=fa;Fa.M5a=ua&&ua.data?ua.data.httpStatus:-1;return Fa}MWh(fa,ua){const Fa={};Fa["x-UserDataSignature"]=this.mb.Wa("UserDataSignature");Fa["x-LicensingIsEnabled"]=this.mb.pa("LicensingIsEnabled").toString();Fa["x-CacheIsEnabled"]=this.mb.pa("LicensingRedisIsEnabled").toString();Fa["x-OcpsIsEnabled"]=this.mb.pa("OcpsIsEnabled").toString();Fa["x-LicensingAADIdIsEnabled"]=this.mb.pa("LicensingAadIdIsEnabled").toString();0===fa&&(Fa["x-LicenseCheckOnTenantEnabled"]=
"true",Fa["x-SupportUserConsentDependentFeatures"]="true",Fa["x-AFHUserConsentGroupValue"]="0",Fa["x-UseShellServiceForUserConsentGroup"]="true",Fa["x-SMBUserLicensingEnabled"]="true",Fa["x-AFHPIPLComplianceEnabled"]=t.a.Ux(window.location.href,"wd_afhpipl")||"false");if(ua)for(let ca of ua.keys)Fa[ca]=ua.ma(ca);return Fa}}Object(r.a)(w,"HttpRequestToPromiseUtility",null,[]);var m=a(4),u;(function(fa){fa[fa.loki=0]="loki";fa[fa.augloopACLP=1]="augloopACLP"})(u||(u={}));Object(r.b)("AlternateAuthSupportApp",
u);var y=a(556),v=a(39);class C{constructor(){this.Token=null;this.ExpirationTime=0}}Object(r.a)(C,"WacAlternateAuthToken",null,[]);class x{constructor(fa,ua){this.STj=3E5;if(void 0===fa||null===fa||void 0===ua||null===ua)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.mb=fa;this.NRb=new b.a(e.a.Oi());this.Ojb=new w(fa,ua);void 0!==y.OAuthManagerSettings.wxd&&null!==y.OAuthManagerSettings.wxd&&void 0!==y.OAuthManagerSettings.kmc&&null!==y.OAuthManagerSettings.kmc&&0<y.OAuthManagerSettings.kmc&&
(fa=new C,fa.Token=y.OAuthManagerSettings.wxd,fa.ExpirationTime=y.OAuthManagerSettings.kmc,this.NRb.ia("loki",fa))}POh(){let fa=null;this.NRb.hb(u[0])&&(fa=this.NRb.ma(u[0]));return void 0===fa||null===fa||this.Htd(fa)?this.EFh():Promise.resolve(fa.Token)}Htd(fa){return fa.ExpirationTime-Date.now()<this.STj}EFh(){const fa=new b.a(e.a.Oi());fa.ia("X-AlternateAuthApp",u[0]);return this.Ojb.Z5c(this.jva("/afhs/AlternateAuthHelperHandler.ashx"),Object(f.a)(this,this.Y3i,"parseAlternateAuthTokenResponse"),
2,fa).then(ua=>{c.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",u[0]);this.NRb.ia(u[0],ua);return ua.Token},ua=>{ua=Object(d.a)(l,ua);c.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",ua.message,ua.M5a);return null})}Y3i(fa){let ua=null;({ht:ua}=v.d(fa));c.ULS.sendTraceTag(545821457,3004,ua?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",
fa);return ua}jva(fa){return String.format("{0}{1}?{2}",this.mb.Wa("WebServiceBase"),fa,m.AFrameworkApplication.vi)}}Object(r.a)(x,"AlternateAuthHelper",null,[227]);var B=a(460);class H{constructor(fa,ua,Fa){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=fa;this.isEnabled=ua;this.tierName=Fa}}Object(r.a)(H,"FeatureStateChangeArgs",null,[]);var I=a(137),U=a(255),S=a(27),G=a(111),D=a(174),E;(function(fa){fa[fa.Enabled=0]="Enabled";fa[fa.Disabled=1]="Disabled"})(E||(E={}));
Object(r.b)("FeatureState",E);var N=a(83),M=a(25),L=a(194);class aa{constructor(fa,ua,Fa=null,ca=null,ka=null){this.zua=this.oXb=this.bie=this.Fqa=this.pYb=null;this.Ojb=new w(fa,ua);this.mb=fa;this.aAg=fa.vd("LicensingMaxRetryAttempts",0);this.VUb=fa.pa("IsO365ConsumerHost");this.GNc=fa.pa("IsO365CommercialHost");this.RUb=fa.pa("PremiumUpsellIsEnabled");this.OOc=0;this.y6d=Fa;this.qme=ca;this.Ma=ka;this.Eqa=fa.pa("LicensingIsEnabled");this.FEa=fa.pa("OcpsIsEnabled")&&this.GNc;this.ZUc=fa.pa("ShowPrivacyDialog")&&
!!ca;this.UMc=fa.pa("IsAnonymousUser");this.Zbd=new Promise(Ca=>{Ca(!1)});this.LBa=new Promise(Ca=>{Ca(!0)});this.yua=new b.a(e.a.Oi());this.dZb=!0;this.qde=this.mYh();this.Krd()&&!this.UMc?(void 0!==m.AFrameworkApplication.sa&&null!==m.AFrameworkApplication.sa&&(this.pYb=m.AFrameworkApplication.sa.HD,void 0!==this.pYb&&null!==this.pYb&&(this.Fqa=this.pYb.zg("WebServiceCall","ApplicationFeatureHelperService"))),this.zua=this.b_d()):this.zua=new Promise(Ca=>{Ca({})});this.zua.catch(Ca=>{Ca=Object(d.a)(l,
Ca);c.ULS.sendTraceTag(42513088,3004,10,"ApplicationFeatureHelper initialization failed, HttpStatus={0}",Ca?Ca.M5a.toString():"Unknown")});this.dZb&&(this.RUb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(Ca=>{this.RUb=this.mb.pa("PremiumUpsellIsEnabled")&&Ca;return null}))}mYh(){const fa=this.mb.Gp("AllLicensedFeatures")?this.mb.kw("AllLicensedFeatures"):[],ua=new B.a;for(let Fa=0;Fa<fa.length;Fa++)ua.add(fa[Fa]);return ua}Krd(){return this.GNc||this.VUb}b_d(fa=0,ua=!1){c.ULS.sendTraceTag(51185368,
3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",ua);const Fa=I.a.Pr();Fa&&(Fa.set("retryAttempt",fa.toString()),Fa.set("forceRefresh",ua.toString()),Fa.set("isO365ConsumerHost",this.VUb.toString()),Fa.set("isO365CommercialHost",this.GNc.toString()),Fa.set("isFreemiumUpsellSettingEnabled",this.RUb.toString()));k.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest","waclicensing",Fa);k.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",
1,"waclicensing",Fa);void 0!==this.Fqa&&null!==this.Fqa&&this.Fqa.start();let ca=null;ua&&(ca=new b.a(e.a.Oi()),ca.ia("x-LicensingForceRefresh","true"));this.bie=new Date;return(this.Eqa?this.Ojb.Z5c(this.jva("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(f.a)(this,this.a4i,"parseApplicationFeatureHelperResponse"),0,ca,Object(f.a)(this,this.w9i,"processApplicationFeatureHelperResponseHeaders"),["Date"]):Promise.resolve({})).then(ka=>{const Ca=Object.assign(new L.a,{durationMs:this.Ubg()});Ca.extendedProperties=
Fa;Ca.extendedProperties&&ka&&(Ca.extendedProperties.set("featureCount",G.a.count(ka).toString()),Ca.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in ka).toString()),Ca.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in ka).toString()),"FreemiumUpsell"in ka&&Ca.extendedProperties.set("isFreemiumUpsellEnabled",ka.FreemiumUpsell.toString()),this.oXb&&Ca.extendedProperties.set("fromCache",(this.oXb<this.bie).toString()));k.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
Ca);return ka},ka=>{const Ca=Object.assign(new L.a,{durationMs:this.Ubg()}),fb=Object(d.a)(l,ka);if(!fb)return c.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),k.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,Ca),new Promise((yb,mb)=>{mb(ka)});Ca.extendedProperties=Fa;Ca.extendedProperties&&Ca.extendedProperties.set("status",fb.M5a.toString());k.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest",
"RequestFailed",!1,!0,Ca);return 408===fb.M5a&&++fa<=this.aAg?this.b_d(fa):new Promise((yb,mb)=>{mb(fb)})})}a4i(fa){(fa=v.b(fa))?(c.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),c.ULS.sendTraceTag(50938594,3004,50,"{0}",fa)):c.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");return fa.Features}jva(fa){var ua=String.format("{0}{1}",this.mb.Wa("WebServiceBase"),
fa);this.mb.Gp("ApplicationFeatureHelperHttpCachingEnabled")&&this.mb.pa("ApplicationFeatureHelperHttpCachingEnabled")&&(fa=aa.Lcc(this.mb))&&0<fa.length&&(this.dZb&&(fa+="ucbf"),ua=new U.QueryStringBuilder(ua),ua.Zi("afhskey",fa),ua=ua.toString());return ua}isFeatureEnabled(fa,ua){if(!this.FEa&&!this.ZUc&&!this.Eqa)return this.LBa;c.ULS.sendTraceTag(42513091,3004,50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",fa);if("ConnectedServices"===fa){var Fa=
this.FEa?this.y6d.CM("ControllerConnectedServicesEnabled"):this.LBa;const Ca=this.ZUc?this.qme.getSettings().then(fb=>2!==fb.fu,()=>ua):this.LBa;return Fa.then(fb=>fb?Ca:this.Zbd)}Fa=null;Fa=this.FEa?this.y6d.isFeatureEnabled(fa):this.LBa;let ca=null;ca=this.Eqa?this.Soi(fa,ua):this.LBa;let ka=null;ka=this.ZUc?this.qme.isFeatureEnabled(fa):this.LBa;return Fa.then(Ca=>Ca?ka.then(fb=>fb?ca:this.Zbd):this.Zbd).then(Ca=>{this.Mrf(fa,Ca,!0);return Ca},()=>{this.Mrf(fa,ua,!1);return ua})}Mrf(fa,ua,Fa){c.ULS.sendTraceTag(526713106,
3004,50,"FeatureName={0}, IsEnabled={1}, IsSuccess={2}",fa,ua,Fa)}getFeatureTier(fa,ua){if(!this.Eqa)return new Promise(Fa=>{Fa(2)});c.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",fa);return this.zua.then(Fa=>this.Idc(fa,Fa,ua),()=>ua)}isFreemiumUpsellEnabled(){const fa=this.RUb&&this.VUb&&!this.UMc;if(fa&&2!==this.OOc||!fa&&1!==this.OOc)c.ULS.sendTraceTag(509728161,3004,20,"ApplicationFeatureHelper_IsFreemiumUpsellEnabled: isO365ConsumerHost={0}, isAnonymousUser={1}, isFreemiumUpsellEnabled={2}",
this.VUb.toString(),this.UMc.toString(),fa.toString()),this.OOc=fa?2:1;return fa}launchUpsellExperience(fa,ua=null){c.ULS.sendTraceTag(594564814,3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",fa));var Fa=I.a.Pr();Fa&&(Fa.set("experienceId",fa),ua&&Fa.set("campaignId",ua));k.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",Fa);if(Fa=N.a.instance.mg("Common.IInProductMessagingUIManager")){const ca=Object(f.a)(this,
this.e9h,"handleDimeTaskComplete");Fa.Rpf(fa,ca,ua)}else c.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),k.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),this.Ma.Vd(M.a.Zac,2,{["experience"]:fa})}Oza(fa,ua){if(!this.Eqa)return null;if(!fa||!ua)return c.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;const Fa=D.a.create().toString();this.yua.hb(fa)||
this.yua.ia(fa,new b.a(e.a.Oi()));this.yua.ma(fa).add(Fa,ua);c.ULS.sendTraceTag(594564812,3004,50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",Fa,fa));return Fa}mLd(fa,ua){this.Eqa&&(fa&&this.yua.hb(fa)?ua&&D.a.isValid(ua)?this.yua.ma(fa).hb(ua)?(c.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",ua,fa)),this.yua.ma(fa).remove(ua)):
c.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",ua,fa)):c.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",ua,fa)):c.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",fa)))}Idc(fa,ua,Fa){return this.dZb?
fa in ua?ua[fa].LicenseTier:Fa:fa in ua?this.x4i(ua[fa],Fa):Fa}x4i(fa,ua){switch(fa.toLowerCase()){case "unknown":return 0;case "basic":return 1;case "premium":return 2;default:return ua}}e9h(){c.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.zua.then(fa=>{this.CTf(fa)}).catch(()=>{this.CTf({})})}CTf(fa){c.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");const ua=this.b_d(0,!0);ua.then(Fa=>{this.zua=
ua;G.a.count(Fa)>G.a.count(fa)?k.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",null):k.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(let ca of this.yua.keys)if(ca in Fa){const ka=this.Idc(ca,Fa,0);ca in fa?this.Idc(ca,fa,0)!==ka&&this.pBd(ca,!0,ka):this.pBd(ca,!0,ka)}else ca in fa&&this.pBd(ca,!1,this.Idc(ca,fa,0))}).catch(Fa=>{k.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);c.ULS.sendTraceTag(594051086,
3004,10,JSON.stringify(Fa))})}pBd(fa,ua,Fa){c.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",fa,ua,Fa);ua=new H(fa,ua,Fa);Fa=this.yua.ma(fa);for(let ca of Fa)try{ca.value(ua)}catch(ka){c.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",fa,ca.key,ka.message))}}Pd(fa,
ua){if(this.Eqa){const Fa=this.qde.contains(fa);let ca=!0,ka="",Ca=!1;return this.zua.then(fb=>{fa in fb?(fb=fb[fa],ka=E[fb.FeatureState],ca=1!==fb.FeatureState):ca=!Fa;this.Vrf(fa,Fa,ka,Ca,ua,ca);return ca},()=>{Ca=!0;Fa&&(ca=ua);this.Vrf(fa,Fa,ka,Ca,ua,ca);return ca})}return this.LBa}Vrf(fa,ua,Fa,ca,ka,Ca){c.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",fa,ua,ca,Fa,ka,Ca)}Soi(fa,ua){if(this.dZb)return this.Pd(fa,
ua);if(this.Eqa){if(this.qde.contains(fa))return this.zua.then(Fa=>fa in Fa,()=>ua);c.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",fa)}return this.LBa}w9i(fa){try{fa&&"Date"in fa&&(this.oXb=new Date(fa.Date),c.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",this.oXb.toString()))}catch(ua){c.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",
ua)}}Ubg(){if(void 0!==this.Fqa&&null!==this.Fqa){const fa=this.Fqa.Bc;this.Fqa.stop();return fa}return null}static Lcc(fa){try{if(S.a.eQj){const ua=fa.Wa("UserDataSignature").split(".");if(1<ua.length){const Fa=window.self.atob(ua[1]),ca=JSON.parse(Fa).LocalStorageKey;if(void 0!==ca&&null!==ca&&0<ca.length)return ca}}}catch(ua){c.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",ua.toString())}return null}}Object(r.a)(aa,"ApplicationFeatureHelper",null,[228]);var V=a(192);
class P{constructor(fa,ua){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=fa.PolicySettings;fa=new Date;fa.setMinutes(fa.getMinutes()+ua);this.ExpirationTime=fa.getTime()}}Object(r.a)(P,"CloudPolicySettingsCacheData",null,[]);var ba=a(798),Y=a(380),Z=a(231);class ea{static bag(){return m.AFrameworkApplication.fa.pa("SideCarIsEnabled")?ea.Xwc&&ea.gqd?new Promise(fa=>{fa(!0)}):new Promise((fa,ua)=>{ea.Xwc=Z.a.create(m.AFrameworkApplication.fa.Wa("SideCarUrl"));Y.a.yia(ea.Xwc);ea.Xwc.x9((Fa,
ca)=>{(ea.gqd=ca.succeeded)?fa(ca.succeeded):ua(ca.succeeded)})}):new Promise(fa=>{fa(!1)})}}ea.gqd=!1;ea.Xwc=null;Object(r.a)(ea,"SideCarLoader",null,[]);class ra{constructor(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}}Object(r.a)(ra,"CloudPolicySettingsData",null,[]);class O{constructor(fa,ua){this.BIc=0;this.o4b=null;this.Ojb=new w(fa,ua);this.mb=fa;ua=fa.Wa("HostAuthType");this.FEa=fa.pa("OcpsIsEnabled")&&fa.pa("IsO365CommercialHost")&&!(void 0===ua||null===ua)&&"aad"===
ua.toLowerCase();this.zfe=v.b(fa.Wa("OcpsDefaultSettings")||"{}");this.Gkb=this.Lcc();ua=this.mb.Gp("ServicesControlsMicrosoftControllerServicesList")?this.mb.kw("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.OSb=new B.a;for(let Fa=0;Fa<ua.length;Fa++)this.OSb.add(ua[Fa]);this.FEa&&!fa.pa("IsAnonymousUser")&&fa.pa("SideCarIsEnabled")?this.o4b=this.TWj():this.o4b=this.Hoa(this.FEa,this.jva("/afhs/CloudPolicySettings.ashx"),Object(f.a)(this,this.b4i,"parseCloudPolicySettingsResponse"));
this.o4b.then(()=>null).catch(Fa=>{Fa=Object(d.a)(l,Fa);c.ULS.sendTraceTag(50622685,3004,10,"CloudPolicySettingsHelper initialization failed, HttpStatus={0}",Fa?Fa.M5a.toString():"Unknown")})}CM(fa,ua=!0){if(!this.FEa){const Ca=this;return new Promise(fb=>{fb(Ca.Axb(fa))})}let Fa=this,ca=this;const ka=this.o4b.then(Ca=>{try{let fb=null;Ca.PolicySettings&&"unknown"in Ca.PolicySettings&&(fb=Ca.PolicySettings.unknown);if(fb){if(fa in fb&&void 0!==fb[fa]&&null!==fb[fa])return new Promise(mb=>{mb("0"!==
fb[fa])});const yb=fa.toLowerCase();if(yb in fb&&void 0!==fb[yb]&&null!==fb[yb])return new Promise(mb=>{mb("0"!==fb[yb])});c.ULS.sendTraceTag(51512667,3004,50,"Policy"+fa+" not found, using default");return new Promise(mb=>{mb(Fa.Axb(fa))})}return new Promise(yb=>{yb(Fa.Axb(fa))})}catch(fb){return c.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+fa+" policy value. Error Message: {0}",fb.message),Fa.handleError(fb.toString(),ua,Fa.Axb(fa))}},Ca=>ca.handleError(Ca,ua,ca.Axb(fa)));ka.then(Ca=>{c.ULS.sendTraceTag(50651667,
3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",fa,Ca);return null});return ka}isFeatureEnabled(fa,ua=!0){if(this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.Uoi(fa,ua);let Fa=new Promise(ka=>{ka(!0)}),ca="";this.OSb.contains(fa)&&(ca="ControllerConnectedServicesEnabled",Fa=this.CM(ca,ua));Fa.then(ka=>{c.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",
fa,ka,ca);return null});return Fa}Uoi(fa,ua=!0){let Fa=new Promise(ka=>{ka(!0)}),ca="";"mso_sendASmile"===fa?ca="Enabled":"Survey"===fa||"FloodgateSurvey"===fa?ca="SurveyEnabled":this.OSb.contains(fa)&&(ca="ControllerConnectedServicesEnabled");""!==ca&&(Fa=this.CM(ca,ua));Fa.then(ka=>{c.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",fa,ka,ca);return null});return Fa}handleError(fa,ua,Fa){return ua?new Promise(ca=>
{ca(Fa)}):new Promise((ca,ka)=>{ka(fa)})}Hoa(fa,ua,Fa){if(!fa)return Promise.resolve(new ra);let ca=!1,ka=null;k.Health.instance.recordKpiUsage("GetCloudPolicySettings",1,"jpittsdirects",null);let Ca=this.u5c("GetCloudPolicySettings");return(new Promise((fb,yb)=>{if(void 0!==this.Gkb&&null!==this.Gkb&&0<this.Gkb.length){const mb=this.CWj();if(void 0!==mb&&null!==mb){ca=!0;fb(mb);return}}this.Ojb.Z5c(ua,Fa,1,null,Object(f.a)(this,this.B9i,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],
this.mb.vd("CloudPolicySettingsRequestQueueTimeout",15E3),this.mb.vd("CloudPolicySettingsRequestSentTimeout",3E4)).then(mb=>{c.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");this.sXj(mb);fb(mb);return mb},mb=>{yb(mb);return null})})).then(fb=>{({stopwatch:Ca,returnValue:ka}=this.WAc(Ca));var yb=I.a.Pr();yb&&yb.set("FromCache",ca.toString());yb=Object.assign(new L.a,{durationMs:ka,extendedProperties:yb});k.Health.instance.recordKpiSuccess("GetCloudPolicySettings",
yb);return fb})}TWj(){return ea.bag().then(()=>{c.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");return sidecar.cloudPolicy.GetCloudPolicySettingsData()})}jva(fa){return String.format("{0}{1}",this.mb.Wa("WebServiceBase"),fa)}b4i(fa){let ua=null;({ht:ua}=v.d(fa));fa=!!ua;c.ULS.sendTraceTag(50622687,3004,fa?50:10,"ParseCloudPolicySettingsResponse: Success={0}",fa);return ua}B9i(fa){try{if(void 0!==fa&&null!==fa&&"CheckIn-Interval"in
fa){const ua=parseInt(fa["CheckIn-Interval"]);void 0!==ua&&null!==ua&&0<ua&&(this.BIc=ua)}}catch(ua){c.ULS.sendTraceTag(51662934,3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",ua)}}Axb(fa){return fa in this.zfe?"0"!==this.zfe[fa]:!0}CWj(){try{const fa=ba.a.instance.getItem(this.Gkb);if(void 0===fa||null===fa)return c.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;c.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",
fa);const ua=JSON.parse(fa);if(void 0===ua||null===ua)return c.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===ua.ExpirationTime||null===ua.ExpirationTime)return c.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(ua.ExpirationTime)).getTime()<Date.now())return c.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),
null;const Fa=new ra;Fa.PolicySettings=ua.PolicySettings;Fa.ControllerConnectedServicesFeatureNames=new V.a;this.mb.Gp("ServicesControlsMicrosoftControllerServicesList")&&this.mb.kw("ServicesControlsMicrosoftControllerServicesList");for(let ca of this.OSb)Fa.ControllerConnectedServicesFeatureNames.add(ca);c.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return Fa}catch(fa){return c.ULS.sendTraceTag(51662942,3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",
fa.toString()),null}}sXj(fa){try{if(void 0===fa||null===fa||void 0===fa.PolicySettings||null===fa.PolicySettings)c.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.BIc)c.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{const ua=new P(fa,this.BIc),Fa=JSON.stringify(ua);c.ULS.sendTraceTag(51662946,3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",Fa);ba.a.instance.setItem(this.Gkb,
Fa);c.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(ua){c.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",ua.toString())}}Lcc(){const fa=aa.Lcc(this.mb);return fa&&0<fa.length?"OCPS"+fa:null}u5c(fa){const ua=N.a.instance.mg("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==ua&&null!==ua?ua.Gc("WebServiceCall",fa):null}WAc(fa){if(void 0!==fa&&null!==fa){const ua=fa.Bc;fa.stop();return{returnValue:ua,
stopwatch:null}}return{returnValue:null,stopwatch:fa}}}Object(r.a)(O,"CloudPolicySettingsHelper",null,[225]);class da{constructor(){this.HNe=this.Elg=this.fu=0;this.INe=this.Flg=this.VHa="";this.LTc=this.Iea=2}clone(){const fa=new da;fa.fu=this.fu;fa.Elg=this.Elg;fa.HNe=this.HNe;fa.VHa=this.VHa;fa.Flg=this.Flg;fa.INe=this.INe;fa.Iea=this.Iea;fa.LTc=this.src;return fa}get src(){return this.LTc}serialize(fa=null){const ua={};if(!fa||fa.contains(da.EOa))ua[da.EOa]=this.fu;if(!fa||fa.contains(da.FFb))ua[da.FFb]=
this.VHa;if(!fa||fa.contains(da.GFb))ua[da.GFb]=this.Iea;return JSON.stringify(ua)}static create(fa,ua=null){const Fa=new da;Fa.LTc=fa;void 0!==ua&&null!==ua&&(da.EOa in ua&&(Fa.fu=ua[da.EOa]),da.FFb in ua&&(Fa.VHa=ua[da.FFb]),da.GFb in ua&&(Fa.Iea=ua[da.GFb]));return Fa}static deserialize(fa,ua){try{const Fa=JSON.parse(fa);if(void 0!==Fa&&null!==Fa)return da.create(ua,Fa);c.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",fa);throw Error.argument("settingsData");
}catch(Fa){throw c.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",Fa.toString()),Fa;}}}da.EOa="CCS";da.FFb="CCSTime";da.GFb="OfficePrivacyRoamedNoticeShown";Object(r.a)(da,"UserPrivacySettings",null,[]);var xa=a(133);class ia{constructor(fa,ua){if(void 0===fa||null===fa||void 0===ua||null===ua)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.mb=fa;this.ph=ua;this.cTc=this.ke=null}jva(fa){var ua=String.format("{0}RoamingServiceHandler.ashx?action=",
this.mb.appSettings.RoamingServiceHandlerWebServiceBase||"");ua=new Sys.StringBuilder(ua);ua.append(fa);ua.append("&");ua.append(m.AFrameworkApplication.vi);return ua.toString()}executeRequest(fa,ua,Fa,ca=null){return this.ph.fob(fa,ua,ca,null,Fa,"33",!1,null,6E4)}saveSettings(fa){return new Promise((ua,Fa)=>{try{if(void 0===this.ke||null===this.ke||void 0===fa||null===fa)c.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),Fa("Can't determine setting changes to save");
else{var ca=this.ke.fu!==fa.fu;if(2===this.ke.src&&ca)this.Gsj(fa),ua(!0);else{var ka=this.zwj(fa);if(void 0===ka||null===ka||!ka.length)c.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),Fa("No changes to save");else if(1===this.ke.src)ua(this.phg(ka));else if(0===this.ke.src){c.ULS.sendTraceTag(51258444,3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",ka);const Ca=this.executeRequest(this.jva("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",
ka);Ca.continueWith(()=>{if(Ca.kh||Ca.Hf)c.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),ua(!1);else{var fb=Ca.result;void 0!==fb.Cg&&null!==fb.Cg&&void 0!==fb.Cg.data&&null!==fb.Cg.data&&fb.Cg.data.httpStatus===n.a.IO?(c.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),ua(!0)):(c.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),ua(!1))}})}}}}catch(Ca){c.ULS.sendTraceTag(50860930,
3004,10,"SaveUserPrivacySettings: Exception = {0}",Ca.toString()),ua(!1)}})}zwj(fa){if(void 0===this.ke||null===this.ke||void 0===fa||null===fa)throw Error.invalidOperation("User Privacy settings have not been initialized");const ua=new V.a;0===fa.src?(this.ke.fu!==fa.fu&&(ua.add(da.EOa),ua.add(da.FFb)),this.ke.Iea!==fa.Iea&&ua.add(da.GFb)):1===fa.src&&this.ke.fu!==fa.fu&&ua.add(da.EOa);return ua.count?fa.serialize(ua):(c.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),
null)}getSettings(){if(!this.cTc){const fa=this;this.cTc=new Promise(ua=>{try{fa.ke?ua(fa.ke.clone()):fa.LWj().then(Fa=>{fa.ke=Fa;ua(fa.ke.clone());return null},()=>{fa.JWj().then(Fa=>{fa.ke=Fa;ua(fa.ke.clone());return null},()=>{fa.KWj().then(Fa=>{fa.ke=Fa;ua(fa.ke.clone());return null},()=>{c.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");fa.ke=new da;ua(fa.ke.clone());return null});return null});return null})}catch(Fa){c.ULS.sendTraceTag(50860932,
3004,10,"UserPrivacySettings GetSettings: Exception = {0}",Fa.toString()),fa.ke=new da,ua(fa.ke.clone())}})}return this.cTc}LWj(){return new Promise((fa,ua)=>{try{const ca=-1!==window.location.href.indexOf("&wd_pn=2");if(this.mb.pa("PrivacyDialogShouldCheckRoaming")||ca){var Fa=this.executeRequest(this.jva("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");Fa.continueWith(()=>{try{if(Fa.kh||Fa.Hf)c.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");
else{const ka=Fa.result;if(ka&&ka.Cg&&ka.Cg.data)if(ka.Cg.data.httpStatus!==n.a.IO)c.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",ka.Cg.data.httpStatus);else{if(ka.Cg.data.de){fa(ia.parse(ka.Cg.data.de,0));c.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",ka.Cg.data.de);return}c.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else c.ULS.sendTraceTag(50860935,
3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");ua("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(ka){c.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",ka.toString()),ua("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else c.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),ua("Roaming should not be used")}catch(ca){c.ULS.sendTraceTag(50860939,
3004,10,"TryGetSettingsFromRoaming Exception = {0}",ca.toString()),ua("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})}JWj(){return new Promise((fa,ua)=>{try{const Fa=xa.a.get("WacUPToggleState");let ca=null;void 0!==Fa&&null!==Fa&&0<Fa.length&&(ca=decodeURIComponent(Fa));if(void 0!==ca&&null!==ca&&0<ca.length){const ka=ia.parse(ca,1);c.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",ka.toString());fa(ka)}else{const ka=da.create(1),
Ca=new V.a;Ca.add(da.EOa);const fb=ka.serialize(Ca);this.phg(fb)?(c.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",fb),fa(ka)):(c.ULS.sendTraceTag(51258450,3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",fb),ua("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(Fa){c.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",
Fa.toString()),ua("UserPrivacySettings TryGetSettingsFromCookie Eception")}})}KWj(){return new Promise(fa=>{try{var ua=-1!==window.location.href.indexOf("&wdccsoff=1");let Fa=da.create(2);ua?(Fa.fu=2,m.AFrameworkApplication.mMe(),c.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",Fa.toString())):(Fa.fu=1,c.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",Fa.toString()));fa(Fa)}catch(Fa){c.ULS.sendTraceTag(50967431,
3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",Fa.toString()),ua=da.create(2),ua.fu=1,fa(ua)}})}Gsj(fa){c.ULS.sendTraceTag(51258453,3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===fa.fu?m.AFrameworkApplication.mMe():m.AFrameworkApplication.Yrh();c.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",fa)}phg(fa){try{c.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",fa);const ua=
this.mb.Wa("PrivacyCookieDomain")||"";if(!ua||!ua.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");c.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",fa);return xa.a.BSd("WacUPToggleState",fa,xa.a.m_,"/",ua)}catch(ua){return c.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",ua.toString()),!1}}isFeatureEnabled(fa){return this.getSettings().then(ua=>{const Fa=this.mb.Gp("ServicesControlsMicrosoftControllerServicesList")?
this.mb.kw("ServicesControlsMicrosoftControllerServicesList"):[],ca=new B.a;for(let ka=0;ka<Fa.length;ka++)ca.add(Fa[ka]);return ca.contains(fa)?2!==ua.fu:!0},()=>{c.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",fa);return!0})}static parse(fa,ua){try{return c.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",fa,ua),da.deserialize(fa,ua)}catch(Fa){throw c.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",Fa.toString()),
Fa;}}}Object(r.a)(ia,"UserPrivacySettingsHelper",null,[226]);var Ma=a(251);class Ta{constructor(){this.$a=null}get name(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}Bh(fa){this.$a=fa;this.$a.register(225,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").qc().yc(()=>new O(m.AFrameworkApplication.fa,m.AFrameworkApplication.Bd));this.$a.register(226,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").qc().yc(()=>new ia(m.AFrameworkApplication.fa,
m.AFrameworkApplication.Bd));this.$a.register(227,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").qc().yc(()=>new x(m.AFrameworkApplication.fa,m.AFrameworkApplication.Bd));this.$a.register(228,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").qc().yc(()=>new aa(m.AFrameworkApplication.fa,m.AFrameworkApplication.Bd,this.$a.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),this.$a.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),
m.AFrameworkApplication.rb))}init(){m.AFrameworkApplication.fa.ru(()=>{const fa=this.$a.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");m.AFrameworkApplication.fa.pa("LicensingIsEnabled")&&(fa.isFeatureEnabled("LicensingTestFeature",!1).then(ua=>{c.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",ua,m.AFrameworkApplication.fa.Wa("IsAnonymousUser"));return null}),fa.getFeatureTier("LicensingTestFeature",
0).then(ua=>{c.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",ua,m.AFrameworkApplication.fa.Wa("IsAnonymousUser"));return null}));this.$a.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");this.CRj()})}dispose(){}CRj(){try{m.AFrameworkApplication.fa.pa("SideCarIsEnabled")&&ea.bag().then(fa=>{c.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",
fa);return fa})}catch(fa){}}static main(){Ma.a.instance.ii(new Ta)}}Object(r.a)(Ta,"ApplicationFeatureHelperPackage",null,[3,4]);a.d(F,"a",function(){return Da});const Da=()=>{Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Ta.main()}},1181:function(r,F,a){var c=a(9);r=a(0);var b=a(226),e=a(15),f=a(1387),d=a(641),h=a(549),l=a(27),k=a(89),t=a(30),n=a(160),z=a(237),w=a(8),m=a(59),u=a(157),y=a(347),v=a(48),C=a(44),x=a(29),B=a(1),H=a(22),I=a(13),U=a(106),
S=a(84),G=a(85),D=a(150),E=a(4),N=a(14),M=a(97),L=a(46),aa=a(1096);class V extends D.a{constructor(Zb,qb=!0){super(!1,!1,V.Iu);this.sXa=null;this.t9d=!1;this.an=[];this.Gj=null;this.YYb=Zb;this.GDg=qb;this.ax=this.ble=!1;this.sga=null;this.KKc=!1;this.og=this.Hmh;this.pe="InsertFileDialog";this.tc(1,this.uZb);V.Iu?(this.sXa={["id"]:this.pe,["bodyControls"]:{["uploadButtonProps"]:{["label"]:CommonUIStrings.l_DialogChooseFile,["onExecute"]:Object(G.a)(this,this.d1i,"onUploadButtonClick")}},["uploadStatusLabel"]:CommonUIStrings.l_DialogNoFileChosen,
["onFrameReady"]:Object(G.a)(this,this.OSi,"onFrameReady")},this.initializeAndShow(this.titleText,Object(G.a)(this,this.wgc,"insertDialogHandler"),this.sXa),this.pTb=!0):(this.showDialog(this.titleText,Object(G.a)(this,this.wgc,"insertDialogHandler")),qb&&this.L6f(),(Zb=this.KJ(1))&&this.an.push(Zb),(Zb=this.KJ(0))&&this.an.push(Zb),this.bkg(),this.pTb=!1)}get a3j(){return this.YYb}validate(){this.Gj.ME||e.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.Gj.ME.value?
!0:(V.Nz(CommonUIStrings.l_FileUploadNoFileSpecified),!1)}OSi(Zb){this.GDg&&(this.Gj=this.K6f(Zb,this.YYb))}d1i(){this.Gj&&this.Gj.ME&&(this.t9d||(this.Gj.vgj(Object(G.a)(this,this.bDd,"onFileChosen")),this.t9d=!0),this.Gj.mXe())}bDd(Zb){this.sXa.uploadStatusLabel=Zb;this.dUa(this.titleText,Object(G.a)(this,this.wgc,"insertDialogHandler"),this.sXa)}wgc(Zb){1===Zb&&this.isEnabled()?V.Iu&&this.Gj.ME&&!this.Gj.ME.value?(this.sXa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,this.dUa(this.titleText,
Object(G.a)(this,this.wgc,"insertDialogHandler"),this.sXa)):(this.gzb(),this.YYb.finalizeUpload(this.Gj,Object(G.a)(this,this.dispose,"dispose"))):0===Zb&&this.hide()}L6f(){this.KKc=!1;this.Gj=this.K6f(document.getElementById("uploadFrameContainer"),this.YYb);E.AFrameworkApplication.fa.pa("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.sga=Object(G.a)(this,this.PEd,"onUploadFrameLoad"),L.a.addHandler(this.Gj.iFrame,"load",this.sga));this.Gj.ME||e.ULS.sendTraceTag(25798092,322,15,"UploadFrame.FileInputElement is null");
this.vPf()}PEd(){this.vPf()}vPf(){if(this.Gj&&!this.KKc){var Zb=this.Gj.ME;Zb&&(L.a.addHandler(Zb,N.a.Sb,Object(G.a)(this,this.onKeyDown,"onKeyDown")),Zb=[Zb],this.an=Zb.concat.apply(Zb,this.an),this.bkg(),this.KKc=!0)}}dispose(){if(this.Gj&&!V.Iu){const Zb=this.Gj.ME;Zb&&L.a.removeHandler(Zb,N.a.Sb,Object(G.a)(this,this.onKeyDown,"onKeyDown"));this.sga&&L.a.removeHandler(this.Gj.iFrame,"load",this.sga)}this.Gj=null;super.dispose()}bkg(){if(0<this.an.length){const Zb=new aa.a(this.an),qb=M.FocusManager.instance().nQ();
qb&&(this.an[0].focus(),qb.ef=Zb,qb.i_=!0)}}onKeyDown(Zb){4!==M.FocusManager.instance().yPf(Zb)&&Zb.preventDefault()}static get Iu(){return E.AFrameworkApplication.sa.Qa.tv&&E.AFrameworkApplication.sa.Qa.xlf}static Nz(Zb){const qb=document.getElementById("errorText");qb.innerText=Zb;qb.style.display="inline-block"}}Object(r.a)(V,"InsertFileDialog",D.a,[]);class P{static get og(){return D.a.zq(P.Ll,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}P.Ll="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(r.a)(P,"InsertImageDialogHtml",null,[]);class ba extends V{constructor(Zb,qb=!0){super(Zb,qb)}get uZb(){return CommonUIStrings.l_ImageUploadButtonText}get titleText(){return CommonUIStrings.l_ImageUploadingTitle}get Hmh(){return P.og}validate(){this.Gj.ME||e.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");const Zb=Object(S.a)(f.a,this.a3j),qb=Zb.img(this.Gj.ME.value);return 0!==qb?(V.Nz(Zb.H2e(qb)),!1):!0}}Object(r.a)(ba,"InsertImageDialog",V,[]);var Y=a(554);const Z=
(Zb,qb,Ha)=>{if(Zb){var Ya=0;do{try{Zb();break}catch(Gb){if(e.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",Ya,Ha,Gb.message,Gb.stack),Ya>=qb)break}Ya++}while(1)}};var ea=a(109),ra=a(88),O=a(39),da=a(255),xa=a(175),ia=a(79),Ma=a(465),Ta=a(174);class Da{constructor(Zb,qb,Ha,Ya,Gb,Ja,Na,Qa,Oa=!0,bb=null,Ga=!1){this.tXe="FileUpload.ashx";this.Xn=null;this._initialized=!1;this.Bg=this.ijb=this.JKc=this.sga=this.OTb=this.Uq=this.Fs=
null;this.Gm=!1;this.RD=this.PTb=this.VUc=null;this._parent=Zb;this.vyg=qb;this.WCg=Ha;this.$9d=Gb;this.$Sc=Na;this.g4d=Qa;this.c6d=bb;this.UUc=!1;this.Tyg=Ya.pa("CanaryRenewalForFileUploadIsEnabled");this.ulg=!1;(this.Uqa=Ga)||this.mbh(Ja);Oa&&this.$ef()}get QZf(){return this.WCg}get sessionId(){return this.$Sc}get iFrame(){return this.Xn}get ME(){return this.Uq}get M9a(){return E.AFrameworkApplication.fa?E.AFrameworkApplication.fa.pa("NativeFileOpenDialogIsEnabled"):!1}get nXe(){return E.AFrameworkApplication.fa?
E.AFrameworkApplication.fa.pa("FileInputDescriptionAccessibilityIsEnabled"):!1}get Tqi(){return this.Uqa?!1:xa.b(this.Xn.contentWindow.location.pathname,this.tXe,0)}get YQg(){return!l.a.Pka&&E.AFrameworkApplication.fa.pa("AllowMultipleImageInsertFromLocalDevice")}$ef(){this.RD=Ta.a.create().toString();this.Uqa?this.x$c():this.aSg()}mbh(Zb){this.Xn=document.createElement("iframe");this.Xn.className=Zb;this.Xn.id=Zb;this.$9d&&(this.Xn.style.visibility="visible",this.Xn.style.height="30px",this.Xn.setAttribute("frameborder",
"0"));this.sga=Object(G.a)(this,this.PEd,"onUploadFrameLoad");L.a.addHandler(this.Xn,"load",this.sga)}r8b(Zb=null){E.AFrameworkApplication.sa.wsc();if(!this.Uq)return e.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";L.a.addHandler(this.Uq,"change",()=>{this.XFh(Zb)});Z(Object(G.a)(this,this.mXe,"fileInputClick"),1,"DoFileOpenDialog");return this.Uq.value}XFh(Zb){Zb&&Zb(this.Uq.value)}YFh(){this.OTb&&(this.OTb.innerText=this.b4e())}vgj(Zb){L.a.addHandler(this.Uq,"change",()=>{Zb(this.b4e())})}b4e(){let Zb=
null;if(this.Uq.value){const qb=this.Uq.value,Ha=qb.lastIndexOf("\\");0<Ha&&(Zb=qb.substring(Ha+1,qb.length))}return Zb?Zb:""}mXe(){try{e.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.Uq.click()}catch(Zb){throw e.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",Zb.message),Zb;}}rPj(){this.mui()?this.Hcg():(this.T0d(),this.Fs.submit())}mui(){return(this.Tyg||this.Uqa)&&!(void 0===window.self.FormData||null===window.self.FormData)}c3f(Zb){if(Zb){const qb=
this.TGe();this.Bg=new XMLHttpRequest;this.Bg.open("POST",qb);this.Bg.setRequestHeader("X-CorrelationId",this.RD);this.ECi(Zb);this.Bg.onreadystatechange=Object(G.a)(this,this.Soa,"uploadResponseReceived");this.Bg.send(Zb)}}ECi(Zb){if(!l.a.Pka&&Zb.get){var qb=Zb.get("ImageId");Zb=window.self.navigator;qb={["CorrelationId"]:this.RD,["Canary"]:E.AFrameworkApplication.canary,["ImageNodeId"]:qb};Zb&&(Zb=Zb.connection?Zb.connection:Zb.mozConnection?Zb.mozConnection:Zb.webkitConnection?Zb.webkitConnection:
null)&&(qb.effectiveType=Zb.effectiveType,qb.downlink=Zb.downlink,qb.type=Zb.type,qb.rtt=Zb.rtt);e.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",qb)}}Hcg(){try{this.T0d();e.ULS.sendTraceTag(594888409,322,50,"SubmitFormWithRequest is preparing to send an upload request");const Zb=new (Type.parse("FormData"))(this.Fs);this.c3f(Zb)}catch(Zb){e.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Zb.message),this.X$a(null)}}Gcg(Zb){try{if(this.T0d(),
e.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.U4j(Zb)){this.PTb=Zb;this.Fs.contains(this.Uq)&&this.Fs.removeChild(this.Uq);var qb=new (Type.parse("FormData"))(this.Fs);qb.append("applicationfileInput",Zb.blob,Zb.filename);this.c3f(qb)}else this.X$a(null)}catch(Ha){e.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+Ha.message),this.X$a(null)}}U4j(Zb){return Zb&&void 0!==Zb.blob&&null!==Zb.blob&&
void 0!==Zb.filename&&null!==Zb.filename&&""!==Zb.filename?void 0===window.self.FormData||null===window.self.FormData?(e.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(Zb=Zb?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",void 0===Zb.blob||null===Zb.blob,void 0===Zb.filename||null===Zb.filename||""===Zb.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",e.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",
Zb)),!1)}Soa(){if(4===this.Bg.readyState)if(200===this.Bg.status){e.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.RD);const Zb=this.Bg.getResponseHeader("X-NewKey"),qb=this.Jmi(this.Bg);let Ha=!1;if(void 0!==Zb&&null!==Zb&&qb&&(Ha=this.I4j(Zb),!this.UUc&&Ha)){e.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.RD);this.UUc=!0;void 0!==this.PTb&&
null!==this.PTb?this.Gcg(this.PTb):this.Hcg();return}e.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.UUc,qb,!(void 0===Zb||null===Zb),Ha,this.RD);this.X$a(this.Bg.responseText)}else e.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Bg.status,this.Bg.responseText?!1:!0,this.RD),this.X$a(null)}Jmi(Zb){try{const qb=
O.a(Zb.responseText).Responses;if(void 0!==qb&&null!==qb&&1===qb.length){const Ha=qb[0];if(void 0!==Ha&&null!==Ha&&2===Ha.length&&28===Ha[1].StatusCode)return!0}}catch(qb){}return!1}I4j(Zb){Ma.a.ajg(Zb);return E.AFrameworkApplication.canary!==Zb?!1:!0}T0d(){this.VUc||(this.VUc=new Date)}dispose(){this.Gm||(this.Uqa?this._parent.removeChild(this.Fs):(this._parent.removeChild(this.Xn),L.a.removeHandler(this.Xn,"load",this.sga),this.sga=null),this.JKc&&(L.a.removeHandler(this.Uq,"change",this.JKc),this.JKc=
null),this.nXe&&(this.ijb&&(L.a.removeHandler(this.Uq,"change",this.ijb),this.ijb=null),this.OTb=null),this.Uq=this.Fs=this._parent=this.Xn=null,this.Gm=!0,this.VUc=null,e.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))}delayedDispose(){this.dispose()}Tdh(Zb){if(this.Fs){var qb;(qb=this.Fs.querySelector("input[name=__REQUESTDIGEST]"))?qb.value=Zb:(qb=this.b6c(),qb.type="hidden",qb.id="__REQUESTDIGEST",qb.name="__REQUESTDIGEST",qb.value=Zb,this.Fs.appendChild(qb))}}b6c(){return this.Uqa?
document.createElement("input"):this.Xn.contentWindow.document.createElement("input")}PEd(){try{if(!this.Xn.contentWindow.document.body)return}catch(qb){this.Lai();return}if(!(this._initialized||this.M9a&&l.a.iF))this.x$c();else if(!this.M9a||!l.a.iF||this.Tqi){let qb;qb=l.a.sv?this.Xn.contentWindow.document.body.innerText:this.ulg?this.Xn.contentWindow.document.body.firstChild.innerText:this.Xn.contentWindow.document.body.firstChild.innerHTML;var Zb=this.Xn.contentWindow.document.body.innerText.toLowerCase();
const Ha=0<=Zb.indexOf("responses")||0<=Zb.indexOf("wopisrc");Zb=0<=Zb.indexOf("http error");!Ha&&Zb&&e.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.Xn.contentWindow.document.body.innerText);this.X$a(qb)}}x$c(){if(!this._initialized){var Zb=this.ga("uploadForm");const qb=this.ga("fileInput"),Ha=this.TGe();this.ydh();this.Fs.id=Zb;this.Fs.method="post";this.Fs.encoding="multipart/form-data";this.Fs.action=Ha;this.Uq.type="file";this.g4d&&(this.Uq.accept=
this.g4d,this.c6d&&(this.Uq.capture=this.c6d));this.Uq.id=qb;this.Uq.name=qb;this.YQg&&(this.Uq.multiple=!0);!this.nXe||l.a.sv||l.a.uH||(this.ijb=Object(G.a)(this,this.YFh,"fileInputChangedHandleAccessibility"),L.a.addHandler(this.Uq,"change",this.ijb),this.OTb=ra.a.aue(this.Fs,this.Uq,"InputFileDescription"));this.$9d&&(this.Uqa||(Zb=this.Xn.contentWindow.document.body,Zb.style.margin="0",Zb.style.overflow="hidden"),Zb=E.AFrameworkApplication.sa,this.Uq.style.fontFamily=Zb.N0,this.Uq.style.fontSize=
Zb.hDc,this.Uq.style.margin="0");(Zb=document.getElementById("__REQUESTDIGEST"))&&this.Tdh(Zb.value);this.Fs.appendChild(this.Uq);this._initialized=!0;this.vyg(this)}}ydh(){if(this.Uqa)this.Fs=document.createElement("form"),this._parent.appendChild(this.Fs),this.Uq=document.createElement("input");else{this.Fs=this.Xn.contentWindow.document.createElement("form");const Zb=this.Xn.contentWindow.document;Zb.body.appendChild(this.Fs);this.Uq=Zb.createElement("input")}}aSg(){this._parent.appendChild(this.Xn);
this.M9a&&l.a.iF&&this.x$c()}TGe(){var Zb=new da.QueryStringBuilder(this.tXe);E.AFrameworkApplication.JYa(Zb);this.mxj(Zb);Zb=Zb.toString();if(l.a.Cf||l.a.iF||l.a.uH)Zb=ia.a.Ned(Zb);return Zb}Eoe(){const Zb=new ea.a(2,1,0,Object(G.a)(this,this.delayedDispose,"delayedDispose"),4);E.AFrameworkApplication.ji.fg(Zb)}}Object(r.a)(Da,"UploadFrame",null,[2]);var fa=a(41),ua=a(113),Fa=a(21);class ca extends Da{constructor(Zb,qb,Ha,Ya,Gb,Ja,Na=!1){super(Zb,qb,Ha,Ya,Gb,"UploadFrame",Ja.ea.sessionId,"image/*",
!1,null,Na);this.$=Ja;this.ulg=!0;this.$ef()}ga(Zb){return Zb}mxj(Zb){e.ULS.shipAssertTag(526399105,0,!!this.sessionId,"SessionId shouldn't be null.");ua.a.VYc(Zb,this.$.ya);Zb.t9(w.a.sessionId,this.sessionId);var qb=Fa.h(this.$).ha;qb=fa.o(qb.qa.W3,this.$);Zb.t9(w.a.N$i,this.$.va.na.name);Zb.t9(w.a.M$i,qb.FirstRow.toString());Zb.t9(w.a.L$i,qb.FirstColumn.toString())}Lai(){this.QZf("ServerUploadError")}X$a(Zb){this.QZf(Zb)}static Qoi(Zb){return!Zb||H.a.equals(Zb,"ServerUploadError",!1)}}Object(r.a)(ca,
"UploadFrameWrapper",Da,[]);class ka extends ba{constructor(Zb,qb,Ha,Ya){super(Zb,!1);this.ZP=null;this.kBa=!1;this.htmlSanitizationHelper=null;this.apc=()=>{this.d0d("");this.xDc();return!1};this.$=qb;this.IEc=Zb;this.FQ=Y.a.instance;this.fa=Ha;this.htmlSanitizationHelper=Ya;this.L6f();this.Znd();this.$.qb.uv=!0}K6f(Zb,qb){return new ca(Zb,Object(G.a)(qb,qb.bHb,"onUploadFrameInitialized"),Object(G.a)(qb,qb.Soa,"uploadResponseReceived"),this.fa,!0,this.$)}dispose(){this.xDc();this.FQ=this.IEc=null;
super.dispose()}hide(){super.hide();this.$.qb.uv=!1}validate(){var Zb=this.IEc.B1d(this.Gj.ME.value,this.IEc.Vgg(this.Gj));return 0!==Zb?(Zb=this.IEc.pgd(Zb).Description,this.d0d(Zb),this.gXd(),!1):!0}isEnabled(){return!0}d0d(Zb){B.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&B.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")&&this.htmlSanitizationHelper?this.htmlSanitizationHelper.J4f(this.ZP,Zb):this.ZP.innerHTML=Zb}Znd(){this.ZP=
document.getElementById("errorText");this.ZP.style.display="inline-block";this.kBa=!1;this.d0d("");this.IIa.style.maxWidth=this.IIa.currentStyle.minWidth}gXd(){this.FQ.ta(N.a.click,this.Gj.ME,this.apc);this.FQ.ta(N.a.Sb,this.Gj.ME,this.apc);this.kBa=!0}xDc(){this.kBa&&(this.FQ.Ba(N.a.click,this.Gj.ME,this.apc),this.FQ.Ba(N.a.Sb,this.Gj.ME,this.apc),this.kBa=!1)}}Object(r.a)(ka,"InsertImageDialogWrapper",ba,[]);var Ca=a(52),fb=a(55),yb=a(50),mb=a(37);class nb extends f.a{constructor(Zb,qb,Ha,Ya,Gb=
!0){super(null,qb,Ha);this.Lia=this.Kt=null;this.b8a=!1;this.rGd=null;this.Soa=Ja=>{this.u2d.stop();this.z1b.cancel();if(ca.Qoi(Ja))this.wCc?this.q$e(4):(Ja=new d.a(0,2,null,null,!1,null,null,null),Ja.status=8,this.HZd(new h.a(Ja),null,"InsertPictureWebMethod")),e.ULS.sendTraceTag(526399121,0,50,`Http Error occurred, isTimeoutError: ${this.wCc}`);else{const Na=nb.$4j(Ja);0!==Na?(e.ULS.sendTraceTag(526399122,0,50,`Server returned error, response: ${Ja}`),this.q$e(Na)):this.yai(Ja)}this.Kqc();this.dispose()};
this.fSi=Ja=>{this.fCa(Ja,this.Gj)&&this.finalizeUpload(this.Gj,null)};this.bHb=Ja=>{e.ULS.sendTraceTag(526399120,0,50,"Upload frame initialized");this.Gj=Ja;if(!this.S1a){if(this.a1d){if(this.aAe()||this.M9a&&l.a.iF){Ja.r8b(this.fSi);return}const Na=Ja.r8b(null);if(!this.fCa(Na,Ja))return}this.finalizeUpload(Ja,null)}};this.y0i=()=>{this.wCc=!0};this.jb=Zb;this.u2d=Zb.Jb.zg("WebServiceCall","InsertPictureOperation");this.z1b=v.a.instance.create(this.y0i,1E5,C.a.EVg,!1);this.wCc=!1;this.Pmc=this.$.ya.InsertPictureMaxFileSizeBytes;
Ya&&(this.b8a="TestOnly"in Ya);Gb&&this.showDialog()}get $(){return this.jb}get aHi(){return this.Pmc/1024/1024}dispose(){k.a.Ja(this.z1b);this.Gj&&this.Gj.Eoe();this.Gj=this.z1b=this.jb=null}ydj(Zb){if(!this.$)return e.ULS.sendTraceTag(526399119,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),fb.Task.Sa(!0);if(!this.$.zba)return fb.Task.Sa(!0);const qb=new n.a,Ha=new FileReader;Zb=Zb.ME.files[0];const Ya=()=>{qb.Ww(!0)};Ha.onload=()=>{this.rGd=Ha.result;qb.Ww(!0)};Ha.onerror=Ya;Ha.onabort=Ya;
Ha.readAsDataURL(Zb);return qb.task}Vgg(Zb){let qb=-1;Zb=Zb.ME;(null===Zb||void 0===Zb?0:Zb.files)&&0<Zb.files.length&&(qb=Zb.files[0].size);return qb}B1d(Zb,qb){let Ha=nb.fah(f.a.fCa(Zb));0===Ha?-1!==qb&&(e.ULS.sendTraceTag(526399118,0,50,`Validating picture, pictureSize: ${qb}, maxAllowedSize: ${this.Pmc}, remainingWorkbookSize: ${this.$.ea.wpf}`),qb>this.Pmc?Ha=3:qb>this.$.ea.wpf&&(Ha=7)):6===Ha&&this.MEi(Zb);e.ULS.sendTraceTag(526399117,0,50,`Validated file on client, validation result: ${Ha}`);
return Ha}fCa(Zb,qb){Zb=this.B1d(Zb,this.Vgg(qb));return 0!==Zb?(this.S1a||1===Zb||this.RUd(Zb),!1):!0}ngg(Zb){Zb.rPj()}pgd(Zb){let qb=0,Ha=1,Ya=-1100324317,Gb="InsertPictureUnknownError",Ja=null;switch(Zb){case 1:qb=1757;Ha=0;Ya=940870981;Gb="InsertPictureNoFileSelected";break;case 3:Ha=0;Ya=1250467391;Gb="InsertPicturePictureTooBig";Ja=String.format(I.a.instance.ob(181),this.aHi.toLocaleString());break;case 6:qb=1761;Ha=0;Ya=1380041209;Gb="InsertPictureUnsupportedFormat";break;case 7:qb=1758;Ha=
0;Ya=-903115058;Gb="InsertPictureExceedWorkbookSize";break;case 4:qb=1759;Ha=0;Ya=1218352119;Gb="InsertPictureUploadTimeout";break;case 5:qb=1760,Ha=0,Ya=1979899005,Gb="InsertPictureServiceNonDeterministicError"}Zb=nb.ed(qb,Ha,Ya,Gb);Ja&&(Zb.Description=Ja);return Zb}showDialog(){if(this.aAe())this.S1a=!1,this.Gj=new ca(this.$.domElement,this.bHb,this.Soa,this.fa,!1,this.$,!0);else if(e.ULS.sendTraceTag(526399115,0,50,"Showing Insert Picture dialog"),!this.b8a&&(l.a.sw||l.a.iF&&72>l.a.nCe))this.S1a=
!1,this.Gj=new ca(this.$.domElement,this.bHb,this.Soa,this.fa,!1,this.$);else{this.S1a=!0;const Zb=B.EwaSettings.isChangeGateEnabled("OfficeVSO:6296544_ReduceInnerHTMLUsage")&&B.EwaSettings.isChangeGateEnabled("OfficeVSO:7073924_CleanUpInnerHtmlInInsertImageDialogWrapper")?yb.GetServiceTaskFactory.Oa(this.$.da,498,499,0):z.a.Sa(null);mb.TaskExtensions.za(Zb,()=>{this.Gj=(new ka(this,this.$,this.fa,Zb.result)).Gj},this.$.la,3)}}yai(Zb){let qb={};try{if(qb=m.a.Xh(Zb),Ca.b().cC(this.u2d.id,qb.ServerCorrelationId,
"actions","ServerActions"),!x.a.Wf(qb.Errors)&&qb.Result){this.$.ea.YW(qb.StateId,"BasePictureUploaderWrapper.UploadResponseReceived");const Ha=qb.Result;U.a(this.$).tna(1,Ha);const Ya=this.$.da.Aa(277);Ya&&Ya.JWc(this.$,1,qb.Result,qb,"InsertPicture");e.ULS.sendTraceTag(526399114,0,50,"Insert picture completed successfully :)")}}catch(Ha){e.ULS.sendTraceTag(526399113,0,50,`BasePictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: ${Zb?Zb.length:-1}, errror: ${Ha}`)}this.XCc(qb,
null,"InsertPictureWebMethod")}q$e(Zb){Zb=this.pgd(Zb);const qb={};qb.Errors=[Zb];this.XCc(qb,null,"InsertPictureWebMethod")}XCc(Zb,qb,Ha){this.Kt(Zb,qb,Ha)}HZd(Zb,qb,Ha){this.Lia(Zb,qb,Ha)}RUd(Zb){Zb=this.pgd(Zb);B.EwaSettings.mz()?new y.a(this.$,Zb):(new u.ErrorDialog(this.$,Zb)).kg()}MEi(Zb){const qb=this.$.ya.InsertPicturUnsupportedExtensionsForLogging;Zb=t.a.Yk(Zb);for(let Ha=0;Ha<qb.length;++Ha)if(Zb.endsWith(qb[Ha])){e.ULS.sendTraceTag(526399112,0,50,`Insert picture blocked invalid extension: ${qb[Ha]}`);
break}}static $4j(Zb){return!Zb||H.a.equals(Zb,w.a.insertPictureUnknownError,!0)?2:H.a.equals(Zb,w.a.insertPictureNoFileSelectedError,!0)?1:H.a.equals(Zb,w.a.sji,!0)?3:H.a.equals(Zb,w.a.tji,!0)?5:0}static ed(Zb,qb,Ha,Ya){return x.a.ed(1,0,0,Zb,qb,Ha,Ya)}static fah(Zb){switch(Zb){case 1:return 1;case 2:return 6}return 0}aAe(){return this.b8a||void 0===window.self.FormData||null===window.self.FormData?!1:!0}}Object(r.a)(nb,"BasePictureUploaderWrapper",f.a,[2]);class X extends nb{constructor(Zb,qb,Ha,
Ya,Gb,Ja=!0){super(Zb,qb,Ha,Ya,!1);this.cGh=Gb;this.W$b=Zb.Jb.zg("LoadResource","FileReaderUploaderLoadResource");Ja&&this.showDialog()}SIj(){this.Pmc=28E5;this.RUd(3)}ycd(Zb){e.ULS.sendTraceTag(526399111,0,50,"FileReaderUploaderWrapper.finalizeUploadImpl - Start function.");const qb=new FileReader;Zb=Zb.ME.files;if(0==Zb.length)e.ULS.sendTraceTag(526399110,0,15,"FileReaderUploaderWrapper.finalizeUploadImpl - No image file found.");else{var Ha=Zb[0];qb.onload=()=>{this.W$b.stop();this.cGh.T_i(qb.result,
this);e.ULS.sendTraceTag(526399109,0,50,`FileReaderUploaderWrapper.finalizeUploadImpl - End function. Type:${Ha.type}, Size:${Ha.size.toString()}`)};qb.onerror=()=>{this.W$b.stop();e.ULS.sendTraceTag(526399108,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Can't read image. Type:${Ha.type}, Size:${Ha.size.toString()}`)};qb.onabort=()=>{this.W$b.stop();e.ULS.sendTraceTag(526399107,0,10,`FileReaderUploaderWrapper.finalizeUploadImpl - Aborted read image. Type:${Ha.type}, Size:${Ha.size.toString()}`)};
this.W$b.start();qb.readAsDataURL(Ha)}}finalizeUpload(Zb,qb){this.ycd(Zb,qb)}}Object(r.a)(X,"FileReaderUploaderWrapper",nb,[749]);var R=a(376),wa=a(193);class na{constructor(Zb,qb){this.dataUri=this.sheetName=null;this.sheetName=Zb;this.dataUri=qb}getSheetName(){return this.sheetName}}Object(r.a)(na,"MacroRecorderPictureInsertedPayload",null,[162]);class Ba extends nb{constructor(Zb,qb,Ha,Ya,Gb,Ja=!0){super(Zb,Ha,Ya,Gb,!1);this.Sd=qb;Ja&&this.showDialog()}ycd(Zb,qb){super.finalizeUpload(Zb,qb);R.a(this.$.userOperationManager,
(Ha,Ya)=>{this.Kt=Ha;this.Lia=Ya;this.u2d.start();this.z1b.Yp();this.wCc=!1;this.ngg(Zb);return this.ydj(Zb)},Ha=>{const Ya={};this.$.ak(Ya);const Gb=Ya.SheetName;Ha=new wa.a(510,0,Ha,72,()=>new na(Gb,this.rGd?this.rGd:""));Ha.HAa(()=>!0);Ha.Sd=this.Sd;return Ha},this.Sd)}finalizeUpload(Zb,qb){this.ycd(Zb,qb)}}Object(r.a)(Ba,"PictureUploaderWrapper",nb,[]);class Ra{constructor(Zb,qb){this.filename=Zb;this.blob=qb}}Object(r.a)(Ra,"UploadBlobParameters",null,[]);class qa extends Ba{constructor(Zb,qb,
Ha,Ya,Gb,Ja,Na){super(Zb,qb,Ha,Ya,Gb,!1);this.a1d=!1;this.tI=Na;this.Qfc=qa.ZLh(Ja);Zb=this.B1d(this.Qfc.name,this.Qfc.size);0!==Zb?(this.RUd(Zb),this.tI.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),this.dispose()):this.Gj=new ca(this.$.domElement,this.bHb,this.Soa,Ya,!1,this.$)}HZd(Zb,qb,Ha){super.HZd(Zb,qb,Ha);this.tI.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))}XCc(Zb,qb,Ha){super.XCc(Zb,qb,Ha);x.a.Wf(Zb.Errors)?
this.tI.setException(Error.create(`DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: ${x.a.nc(Zb.Errors)}`)):this.tI.setResult(!0)}ngg(Zb){const qb=new Ra(this.Qfc.name,this.Qfc);Zb.Gcg(qb)}static ZLh(Zb){var qb=Zb.split(",");Zb=qb[0].includes("base64")?window.self.atob(qb[1]):window.self.decodeURI(qb[1]);qb=qb[0].split(":")[1].split(";")[0];const Ha=new Uint8Array(Zb.length);for(let Ya=0;Ya<Zb.length;Ya++)Ha[Ya]=Zb.charCodeAt(Ya);Zb=new Blob([Ha],{type:qb});
Zb.name="Image.png";return Zb}}Object(r.a)(qa,"DataUrlUploaderWrapper",Ba,[]);class La{constructor(){}dii(Zb,qb,Ha,Ya,Gb){new Ba(Zb,qb,Ha,Ya,Gb,!0)}dhi(Zb,qb,Ha,Ya,Gb,Ja){new qa(Zb,null,qb,Ha,Ya,Gb,Ja)}ohi(Zb,qb,Ha,Ya,Gb){new X(Zb,qb,Ha,Ya,Gb,!0)}}Object(r.a)(La,"UploaderCreator",null,[691]);class Yb extends b.a{constructor(Zb){super();this.$=Zb;this.Db()}static ka(Zb){Zb.da.Ha(485,new Yb(Zb))}create(){var Zb;this.nb(null!==(Zb=this.$.da.Aa(484))&&void 0!==Zb?Zb:this.$.da.Ha(484,new La))}}Object(r.a)(Yb,
"UploaderCreatorFactory",b.a,[]);a.d(F,"a",function(){return mc});const mc=()=>{c.a.Fa(Zb=>{Yb.ka(Zb)})}},1214:function(r,F,a){var c=a(9);r=a(0);var b=a(709),e=a(160),f=a(104),d=a(4),h=a(189),l=a(15),k=a(1387),t=a(30),n=a(99),z=a(83),w=a(558),m=a(174),u=a(41),y=a(376),v=a(193),C=a(284),x=a(29),B=a(249),H=a(11),I=a(13),U=a(282),S=a(106),G=a(21),D=a(150),E=a(88),N=a(97),M=a(168),L=a(185),aa=a(90),V=a(157),P=a(347),ba=a(1),Y=a(1263),Z=a(79);class ea extends Y.a{constructor(Ca,fb){super(Ca,Z.a.Uaa(fb))}Vtc(Ca,
fb){this.isEnabled()&&this.RFa(this.targetOrigin)&&(this.$n(Ca),this.Dl(Ca,fb))}}Object(r.a)(ea,"InsertMediaCrossDocumentMessenger",Y.a,[741,284,2]);var ra=a(7);class O{}Object(r.a)(O,"OnlineMediaSearchResult",null,[]);var da=a(316);class xa extends D.a{constructor(Ca,fb,yb,mb,nb,X){super();this.qic=!1;this.Qvd=this.rR=this.owa=null;this.$Oi=()=>{this.xua(this.y_a)};this.Jud=R=>{R.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==R.target.id||R.shiftKey?"KeepFocusStartDiv"===R.target.id&&R.shiftKey&&(R.preventDefault(),
document.getElementById("KeepFocusDiv").focus()):(R.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};this.kWi=()=>{this.Xob&&(this.Xob.launchUpsellExperience("stockimages"),l.ULS.sendTraceTag(537155807,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};this.el=X;this.$=Ca;this.nff=fb;this.Xob=yb;this.uAa=[];this.Cvf=mb;this.Imh=nb;this.Zse=this.$.ya.InsertOnlinePictureMaxCountOfImagesToInsert;this.og=this.geh()}rJj(Ca){this.qic=!1;this.showDialog(this.el,null);this.owa=
document.getElementById(this.Fh("InsertMediaFrame"));if(!this.owa)throw this.xua(this.y_a),Error.invalidOperation("Couldn't get InsertMediaIframe.");var fb=document.getElementById(this.Fh("WACDialogPanel"));fb&&fb.setAttribute(E.a.Cd,E.a.PZa);fb=document.createElement("div");fb.id="KeepFocusStartDiv";fb.tabIndex=0;fb.className="keep-focus-start";this.owa.parentNode.insertBefore(fb,this.owa.parentNode.firstChild);fb=document.createElement("div");fb.id="KeepFocusDiv";fb.tabIndex=0;fb.className="keep-focus";
this.owa.parentNode.appendChild(fb);$addHandler(this.IIa,"keydown",this.Jud);this.owa.src=this.nff;this.owa.frameBorder="0";fb=document.getElementById(this.Fh("WACDialogButtonPanel"));if(!fb)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");fb.className="display-none";fb=document.getElementById(this.Fh("WACDialogTitleText"));if(!fb)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");fb.className="display-none";2===this.Cvf&&(document.getElementById(this.Fh("WACDialogTitlePanel")).className=
"display-none",document.getElementById(this.Fh("WACDialogBodyPanel")).className="padding-zero");N.FocusManager.instance().nQ().scope.gN=!0;this.rR=new ea(this.owa.contentWindow,this.nff);this.rR.Vtc(M.a.xJg,yb=>{this.ONi(yb,Ca.Soa)});this.rR.Vtc(M.a.insert,()=>{this.xVi(Ca.Soa)});this.rR.Vtc(M.a.e1c,this.$Oi);2===this.Cvf&&0===this.Imh&&(this.rR.Vtc(M.a.hzi,this.kWi),this.Qvd=this.Xob.Oza("MsoPremiumStockImages",yb=>{l.ULS.sendTraceTag(537155811,0,50,"OnCompleteM365Upsell: Upsell completed from stock images");
yb.isEnabled?this.rR.jj(M.a.V2j,{["LicenseTier"]:yb.toString()}):l.ULS.sendTraceTag(537155810,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))}dispose(){this.uAa=null;this.Xob&&this.Qvd&&this.Xob.mLd("MsoPremiumStockImages",this.Qvd);this.rR&&(this.rR.dispose(),this.rR=null);super.dispose()}hide(){super.hide();aa.a.lyc(this.$)}get X3(){return L.a.N7b+"/InsertMediaDialog"}get qY(){return!1}ONi(Ca,fb){Ca=Ca&&Ca.Values?(Ca=Ca.Values)?Object(ra.a)(new O,{Action:Ca.action||
"",Caption:Ca.caption||"",ContentType:Ca.contentType||"",FileExtension:Ca.extension||"",PageUrl:Ca.pageUrl||"",SourceUrl:Ca.sourceUrl||"",ThumbnailUrl:Ca.thumbnailUrl||"",LicenseUrl:Ca.licenseUrl||"",LicenseDisplayName:Ca.licenseDisplayName||"",Height:Ca.height||0,Width:Ca.width||0}):null:null;Ca&&(this.uAa.push(Ca),this.qic&&(l.ULS.sendTraceTag(537155809,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),fb(this.uAa),this.qic=!1,this.xua(this.y_a)))}xVi(Ca){this.uAa&&0<this.uAa.length?
this.uAa.length<=this.Zse?(Ca(this.uAa),this.xua(this.y_a)):(this.Nz(),l.ULS.sendTraceTag(537155808,0,10,"OnInsert : Tried to insert more than allowed limit of items."),this.uAa.length=0):this.qic=!0}geh(){const Ca=document.createElement("div");Ca.id="InsertMediaDialog";Ca.className=ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";const fb=document.createElement("div");fb.id="InsertMediaPanel";
fb.className=ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",!0)?"insert-media-panel":"insert-media-panel-old";const yb=document.createElement("iframe");yb.id="InsertMediaFrame";yb.className="insert-media-frame";Ca.appendChild(fb);fb.appendChild(yb);return da.b(Ca)}Nz(){const Ca=x.a.ed(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");Ca.Description=String.format(I.a.instance.ob(206),this.Zse.toLocaleString());ba.EwaSettings.mz()?new P.a(this.$,
Ca):(new V.ErrorDialog(this.$,Ca)).kg()}}Object(r.a)(xa,"InsertMediaDialog",D.a,[]);var ia=a(383),Ma=a(290);class Ta extends k.a{constructor(Ca,fb,yb,mb,nb,X){super(null,yb,mb);this.btf=0;this.Soa=R=>{if(R){var wa=Array(R.length);for(var na=0;na<R.length;na++){const qa=R[na];wa[na]={};wa[na].SourceUrl=qa.SourceUrl;t.a.Vwa(qa.LicenseUrl)&&t.a.Vwa(qa.PageUrl)&&(wa[na].LicenseUrl=qa.LicenseUrl,wa[na].LicenseDisplayName=qa.LicenseDisplayName,wa[na].PageUrl=qa.PageUrl);wa[na].AltText=-2053056795===this.Sd.command?
qa.Caption:""}var Ba=-2009825598===this.Sd.command?"bing":"M365";na=G.h(this.$);var Ra=u.o(na.ha.qa.activeCell,this.$);y.a(this.$.userOperationManager,(qa,La,Yb)=>C.s(this.$.oa.xa,Ra,wa,Ba,U.b(qa,this.UXi),U.a(La,this.TXi),Yb,null),qa=>new v.a(595,0,qa),this.Sd);H.HelperMethods.RZ?(na=new Map,na.set("MediaProvider",Ba),na.set("ImagesCount",R.length.toString()),na.set("TimeTakenToOpenDialog",this.btf.toString()),n.Health.instance.recordKpiUsage(Ma.a.pji,1,ia.a.ceg,na)):l.ULS.sendTraceTag(537155805,
0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.Kqc()}else l.ULS.sendTraceTag(537155806,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};this.UXi=R=>{B.a(R)?l.ULS.sendTraceTag(537155799,0,10,`OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: ${x.a.nc(R.Errors)}`):(l.ULS.sendTraceTag(537155801,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),R.Result?
S.a(this.$).tna(1,R.Result):l.ULS.sendTraceTag(537155800,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};this.TXi=()=>{l.ULS.sendTraceTag(537155798,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};this.$=Ca;this.Sd=fb;this.tI=X;this.Ite=z.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");this.showDialog()}dispose(){this.$=null}showDialog(){let Ca=null;Ca=this.$.Jb.Gc("UserAction","showOnlineImagesDialogTimeStopwatch");
switch(this.Sd.command){case -2009825598:this.BIj();break;case -2053056795:this.Ite.execute(fb=>{fb.isFeatureEnabled("MsoPremiumStockImages",!1).catch(yb=>l.ULS.sendTraceTag(557200643,0,10,`OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: ${yb}`)).then(yb=>{this.CIj(yb);return null})})}Ca.stop();this.btf=Ca.Bc}BIj(){let Ca=this.$.ya.BingPictureEndpoint;const fb=w.a.NJ(d.AFrameworkApplication.lcid),yb=m.a.create();Ca?(Ca=0<Ca.search(RegExp("insertmedia.bing.office.net",
"gi"))?String.format(Ca,1,1):String.format(Ca,1,d.AFrameworkApplication.lcid,fb?fb.name:"en-us",d.AFrameworkApplication.buildVersion,yb.toString(),1,this.$.ya.DocumentHostInfo.LoggableUserId),this.L5b(Ca,1,-1,I.a.instance.ga(1763))):(l.ULS.sendTraceTag(537155804,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.tI.setException(Error.create("Failed to access the Bing service endpoint")))}CIj(Ca){var fb=this.$.ya.M365PictureEndpoint,yb=m.a.create();
if(fb){var mb=this.$.ya.DocumentHostInfo.UserId;mb=mb?t.a.Yu(mb).toString():"0";var nb=this.Ite.instance.isFreemiumUpsellEnabled();Ca=Ca?1:nb?0:-1;yb=yb.toString();nb=w.a.NJ(d.AFrameworkApplication.lcid).name;fb=String.format(fb,d.AFrameworkApplication.lcid,nb,d.AFrameworkApplication.buildVersion,yb,1,mb,Ca,1);this.L5b(fb,2,Ca,I.a.instance.ga(1762))}else l.ULS.sendTraceTag(537155803,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.tI.setException(Error.create("Failed to access the M365 service endpoint"))}L5b(Ca,
fb,yb,mb){try{(new xa(this.$,Ca,z.a.instance.mg("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),fb,yb,mb)).rJj(this),this.tI.setResult(!0)}catch(nb){l.ULS.sendTraceTag(537155802,0,10,`OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : ${nb}] [MediaProvider : ${fb}] [DialogLicenseTier : ${yb}]`),this.tI.setException(nb)}}}Object(r.a)(Ta,"OnlinePictureUploaderWrapper",k.a,[2]);var Da=a(55);class fa{constructor(Ca,fb){this.$=Ca;this.uploaderCreator=fb}executeCommand(Ca,
fb,yb){Ca=fb.command;switch(Ca){case 1403967063:if(yb&&"dataUrl"in yb)return fb=new e.a,this.uploaderCreator&&this.uploaderCreator.dhi(this.$,f.a.instance,d.AFrameworkApplication.fa,yb,yb.dataUrl,fb),fb.task;this.uploaderCreator&&this.uploaderCreator.dii(this.$,fb,f.a.instance,d.AFrameworkApplication.fa,yb);return Da.Task.Sa(!0);case -2053056795:case -2009825598:return Ca=new e.a,new Ta(this.$,fb,f.a.instance,d.AFrameworkApplication.fa,yb,Ca),Ca.task;default:return h.a(Ca)}}wc(Ca,fb){if(Ca=this.$.isEditMode)switch(fb.command){case 1403967063:Ca=
!0;break;case -2053056795:Ca=!0;break;case -2009825598:Ca=!0;break;default:Ca=!1}return Ca}Nc(){return!1}Hc(){return!1}}Object(r.a)(fa,"PictureCommandHandler",null,[222]);var ua=a(37),Fa=a(50);class ca extends b.a{constructor(Ca){super(Ca)}hd(){ua.TaskExtensions.za(Fa.GetServiceTaskFactory.Oa(this.$.da,484,485,1),Ca=>{this.$c([new fa(this.$,Ca.result)])},this.$.la,3)}static ka(Ca){b.a.Md(90,new ca(Ca))}}Object(r.a)(ca,"PictureCommandHandlerFactory",b.a,[]);a.d(F,"a",function(){return ka});const ka=
()=>{c.a.Fa(Ca=>{ca.ka(Ca)})}},1240:function(r,F,a){var c=a(9);r=a(0);var b=a(226),e=a(15),f=a(512),d=a(38),h=a(4),l=a(60);class k{}k.Igd="GetFontPreviewData";Object(r.a)(k,"FontWebServiceMethods",null,[]);const t=(H,I,U,S,G=null)=>{const D=k.Igd;G=H.Na(5,G);G.locale=h.AFrameworkApplication.uiCulture;return l.g(H,D,G,I,U,S,null,644)};var n=a(11),z=a(1),w=a(42),m=a(113),u=a(29);const y={xlyellow:"xlyellow"};class v extends d.a{constructor(H,I){super();this.$=H;this.jv=I;this.Lua={};this.nO={};this.lve=
!1;this.styles=null;this.ISi=(U,S,G)=>{e.ULS.sendTraceTag(520710152,1,50,`FontServiceManager.onFontPreviewRequestComplete: Attempt to request FontUrl method: ${G} has succeeded.`);this.k8i(U);this.lve=!0;e.ULS.sendTraceTag(512340116,1,50,"FontServiceManager.onFontPreviewRequestComplete: timeFromAppInteractive to fonts download {0} ms",w.PageLoadTrackingInfo.instance.Cva(new Date));this.dbj()};this.JSi=(U,S,G)=>{U=m.a.Pe(U.data);U=u.a.nc(U);e.ULS.sendTraceTag(520710151,1,10,`FontServiceManager.onFontPreviewRequestFailed: Encountered errors: ${U} for method: ${G}`)};
this.doj=()=>{this.jl&&this.Igd(this.ISi,this.JSi)};this.jl=z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.FontServiceIntegration",!1);this.doj()}k8i(H){if(this.swi(H)){var I=n.HelperMethods.gR(()=>{const U=H.Result;this.styles=`@font-face{font-family:"msofpNew";font-style:normal;font-weight:normal;src:url('${U.PreviewUrl}') format('truetype')}`;const S=U.FontFacePropertiesList;let G,D,E;U.FontNameList.forEach((N,M)=>{this.Lua[N]=S[M].Codepoint;let L=`https://fs.microsoft.com/fs/${U.CatalogVersion}/rawguids/${S[M].FontGuid}`;
this.styles=this.$te(this.styles,N,L,S[M].FontWeight);this.nO[N]=S[M].LocalizedFontName;"Segoe UI Semibold"===N&&(G=S[M].FontFamily,D=L,E=S[M].FontWeight)});G&&(this.styles=this.$te(this.styles,G,D,E));f.a.Bi(this.styles)});10<I&&e.ULS.sendTraceTag(520710159,1,50,`FontServiceManager.prepareFontCodepointMap: Duration for prepareFontCodepointMap the model, duration=${I}`)}}swi(H){if(!H.Result)return e.ULS.sendTraceTag(520710158,1,15,"FontServiceManager.isValidFontPreviewData: Result in EwaResult is Null."),
!1;H=H.Result;return H?H.PreviewUrl?H.FontFacePropertiesList?H.FontNameList?0===H.FontFacePropertiesList.length||H.FontFacePropertiesList.length!==H.FontNameList.length?(e.ULS.sendTraceTag(520710153,1,15,"FontServiceManager.isValidFontPreviewData: Mismatch in length of FontFacePropertiesList and FontNameList in fontListPreviewData."),!1):!0:(e.ULS.sendTraceTag(520710154,1,15,"FontServiceManager.isValidFontPreviewData: FontNameList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710155,
1,15,"FontServiceManager.isValidFontPreviewData: FontFacePropertiesList in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710156,1,15,"FontServiceManager.isValidFontPreviewData: PreviewUrl in fontListPreviewData is Null."),!1):(e.ULS.sendTraceTag(520710157,1,15,"FontServiceManager.isValidFontPreviewData: fontListPreviewData is Null."),!1)}$te(H,I,U,S){return H+`@font-face{font-family:"${I}";src:url('${U}');font-weight:${S};}`}Igd(H,I){return t(this.jv,H,I,null,this.jv.Wb())}dbj(){this.Xhc&&
this.raiseEvent(v.rZe)}get tBc(){return this.nO}get DJh(){return this.Lua}get Xhc(){return this.lve}isFontSupported(H){return this.jl&&this.nO&&(!!this.nO[H]||!!y[H.replace(/\s/g,"").toLowerCase()])}nre(H){this.addHandler(v.rZe,H)}}v.rZe="fsmFD";Object(r.a)(v,"FontServiceManager",d.a,[243]);var C=a(712);class x extends b.a{constructor(H){super();this.$=H;this.Db()}static ka(H){H.da.Ha(505,new x(H))}create(){this.nb(Object(C.a)(this.$.da,504,()=>new v(this.$,this.$.oa.jv)))}}Object(r.a)(x,"FontServiceManagerFactory",
b.a,[]);a.d(F,"a",function(){return B});const B=()=>{c.a.Fa(H=>{x.ka(H)})}},1277:function(r,F,a){r=a(0);var c=a(110),b=a(226),e=a(15),f=a(14),d=a(38),h=a(94),l=a(1),k=a(21),t=a(5);class n extends d.a{constructor(y,v,C){super();this.statusBarManager=null;this.tMe=()=>{this.Y7b()};this.knh=()=>{this.Y7b()};this.sMe=x=>{10===x&&this.Y7b()};this.onKeyDown=x=>13===x.Ea.keyCode?(x=new h.a(237279923,1,2,6,null),this.$.Ia.Hb(x,{[t.a.skipClipboardAccess]:!0,[t.a.vQe]:!0}),!0):!1;this.$=y;this.to=v;this.Dm=
C;this.K$c=!1;(this.$8f=l.EwaSettings.isChangeGateEnabled("OfficeVSO:7568646_PressEnterToPaste"))&&this.$.da.gb(29,x=>{this.statusBarManager=x;x.$I(this)})}dispose(){this.Sj();this.Dm=this.to=this.$=null;this.statusBarManager&&(this.statusBarManager.yF(this),this.statusBarManager=null)}un(){return this.$8f}Tr(y,v){if("QueryPasteShortcutEnabledLabel"!==y&&!n.BOj.includes(y))return!1;const C=this.ro();"QueryPasteShortcutEnabledLabel"===y?(v.Visible=C,e.ULS.sendTraceTag(537167636,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${C} for commandId ${y}`)):
(v.Visible=!C,e.ULS.sendTraceTag(537167635,0,100,`PasteShortcutManager.ExecuteRootCommand: Setting visible to ${!C} for commandId ${y}`));return!0}csh(){this.Aj();this.raiseEvent("pasteShortcutStatusChanged")}Y7b(){this.Sj();this.raiseEvent("pasteShortcutStatusChanged")}ro(){return this.K$c}pq(y){this.addHandler("pasteShortcutStatusChanged",y)}Lq(y){this.removeHandler("pasteShortcutStatusChanged",y)}Aj(){if(!this.ro()){this.K$c=!0;k.h(this.$).ni.xl(this.tMe);this.Dm.ka("blur",this.knh);const y=this.$.da.Aa(65);
y&&y.CY&&y.CY.registerForCommentEvents(this.sMe);this.to.ms(f.a.Sb,this.$.eu,this.onKeyDown,!0)}}Sj(){if(this.ro()){this.K$c=!1;k.h(this.$).ni.nl(this.tMe);this.Dm.detach("blur");const y=this.$.da.Aa(65);y&&y.CY&&y.CY.unregisterForCommentEvents(this.sMe);this.to.ys(f.a.Sb,this.$.eu,this.onKeyDown,!0)}}}n.BOj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(r.a)(n,"PasteShortcutManager",d.a,[686,200,201,2]);var z=a(131);class w extends b.a{constructor(y){super();this.$=y;this.Db()}create(){const y=
this.$;this.nb(y.da.Aa(478)||this.$.da.Ha(478,new n(y,c.KeyInputManager.instance,z.a.instance.NG())))}static ka(y){y.da.Ha(479,new w(y))}}Object(r.a)(w,"PasteShortcutManagerFactory",b.a,[]);var m=a(9);a.d(F,"a",function(){return u});const u=()=>{m.a.Fa(y=>{w.ka(y)})}},1278:function(r,F,a){var c=a(9);r=a(0);var b=a(110),e=a(226),f=a(131),d=a(7),h=a(15),l=a(4),k=a(1425),t=a(14),n=a(5),z=a(920),w=a(48),m=a(28),u=a(21),y=a(1),v=a(41),C=a(65),x=a(345),B=a(37),H=a(50),I=a(33);class U{constructor(D,E,N,
M){this.recoveryUI=null;this.ogg=(L="Paste")=>{var aa=C.d(this.$.va.na);aa=new x.a(this.pasteRange,aa);this.ZCc(aa,L)};this.tkg=()=>{this.recoveryUI&&(this.g2d=m.a.Ya.ue.m,this.hide(),w.a.instance.create(()=>{this.E1j()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};this.GMe=L=>{10===L&&this.Pta()};this.Bnh=()=>{if(this.recoveryUI){const L=document.getElementById("PasteRecoveryUI");L&&n.a.Uj===L.getAttribute(n.a.xT)&&L.click();this.documentHidden=!0;this.Pta()}};this.HMe=()=>{this.Pta()};
this.IMe=()=>{this.Pta()};this.onKeyUp=L=>{if(this.recoveryUI){if(this.d_)return!1;if(17===L.Ea.keyCode&&this.w$b){L=document.getElementById("PasteRecoveryUI");if(!L)return h.ULS.shipAssertTag(537154070,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;const aa=L.getAttribute(n.a.xT)||"";if(n.a.rq===aa)return L.click(),!0}}return!1};this.onKeyDown=L=>{if(this.recoveryUI){this.w$b=!1;this.d_=L.ctrlKey;L=L.Ea.keyCode;if(27===L)return this.Pta(),y.EwaSettings.isChangeGateEnabled("OfficeVSO:6022397_ClearStateWhileHidingRecoveryUI")&&
(L=this.$.da.Aa(254))&&L.fr("RecoveryUIController.onKeyDown",!0,!0).catch(()=>{}),!0;if(17===L)return this.w$b=!0}return!1};this.iR=(L,aa)=>{this.RCb=L=aa.Sd;if(y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.OptimizeCellTableBigHammerSlowOperationsTeachingCallout",!1)){switch(L.command){case -1027730316:case -1059615499:if(aa.properties&&aa.properties.launcherId===this.u4e())return;break;case -847286761:if(aa.properties&&(13===aa.properties.CalloutName||18===aa.properties.CalloutName))return}this.Pta()}else-1027730316!==
L.command&&-1059615499!==L.command?this.Pta():(aa=aa.properties)&&aa.launcherId!==this.u4e()&&this.Pta()};this.$=D;this.stc=E;this.to=N;this.Dm=M;this.alc=this.RCb=this.Qud=null;this.d_=this.w$b=this.c8b=this.ffc=!1;this.g2d=0;this.documentHidden=!1;this.grid=u.h(this.$);this.pasteRange=null;y.EwaSettings.cl()||this.$.da.Ha(406,this)}dispose(){this.kig();this.qig();this.alc=this.Qud=this.recoveryUI=this.Dm=this.to=this.stc=this.$=null;this.g2d=0}dWg(D){this.recoveryUI=D;this.Qud=D.QPg;this.alc=D.Gej}Pta(){this.recoveryUI&&
(this.pasteRange=v.K(this.recoveryUI.BWe),this.oMj(),this.hide(),this.kig(),this.recoveryUI=null)}oMj(){const D=[1868184698,-1985798686,753331043,2137617149,237279923,1804571062,1766348718,42074747,-875588320,-958589048,-185374993,-111689794,-1502853784,-1096627081,1441131127,-1027730316,-847286761];l.AFrameworkApplication.Tp("XLS-SmartView-OnPasteEnabled-Control;XLS-SmartView-OnPasteEnabled-Treatment");y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.OnPasteEnabled",!1)&&this.pasteRange&&
(h.ULS.sendTraceTag(523622037,0,50,"RecoveryUIController:smartViewOnPaste RecoveryUI is being dismissed."),null!=this.RCb&&D.includes(this.RCb.command)?(h.ULS.sendTraceTag(526758984,306,50,`RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. Last command was ${z.a[this.RCb.command]}`),this.RCb=null):y.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SmartView.PasteCoOccurrence",!1)?h.ULS.sendTraceTag(509723927,306,50,"RecoveryUIController:smartViewOnPaste Format as table prompt already triggered with the paste recovery UI."):
this.documentHidden?(h.ULS.sendTraceTag(523833603,306,50,"RecoveryUIController:smartViewOnPaste Table hand raise is not triggered. User clicked outside of document."),this.documentHidden=!1):this.q$a(()=>{this.ogg("Paste")}))}Qwa(){return this.grid.Ca.PQ(4,this.$.na)}q$a(D){if(this.Qwa())D();else{h.ULS.sendTraceTag(520725721,306,50,"RecoveryUIController:smartViewOnPaste Grid is not in consistent state.");const E=()=>{this.Qwa()&&(D(),this.grid.Nuc(E))};this.grid.M_b(E)}}hti(){return!!this.recoveryUI&&
this.stc.epi}nKj(D){l.AFrameworkApplication.Tp("XLS-SmartView-PasteCoOccurrence-Treatment;XLS-SmartView-PasteCoOccurrence-Control");I.a.Oui()&&(this.pasteRange=v.K(this.recoveryUI.BWe),this.q$a(()=>{this.ogg("PasteCoOccurrence")}));this.recoveryUI?this.show(D):h.ULS.shipAssertTag(537154072,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")}u4e(){return this.recoveryUI?this.recoveryUI.yzi:null}show(D){const E=this.recoveryUI.OTh();E?(this.stc.showFloatie(Object(d.a)(new k.a,{x:E.x,y:E.y}),
this.recoveryUI.qKa(),D),this.Aj()):h.ULS.sendTraceTag(537154071,0,100,"RecoveryUIController.Show: point is null.")}hide(){this.hti()&&this.stc.GC();this.qig()}Aj(){if(!this.c8b){var D=u.h(this.$);D.view.Ps(this.tkg);D.ni.xl(this.HMe);this.Dm.ka("blur",this.Bnh);this.$.Ia.YFa(this.iR);this.$.va.Vf(this.IMe);(D=this.$.da.Aa(65))&&D.CY&&D.CY.registerForCommentEvents(this.GMe);this.c8b=!0}this.ffc||(this.to.ms(t.a.Sb,this.$.domElement,this.onKeyDown,!0),this.to.ms(t.a.Ld,this.$.domElement,this.onKeyUp,
!0),this.ffc=!0)}kig(){if(this.c8b){var D=u.h(this.$);D.view.Mq(this.tkg);D.ni.nl(this.HMe);this.Dm.detach("blur");this.$.Ia.Vza(this.iR);this.$.va.sg(this.IMe);(D=this.$.da.Aa(65))&&D.CY&&D.CY.unregisterForCommentEvents(this.GMe);this.c8b=!1}}qig(){this.ffc&&(this.to.ys(t.a.Sb,this.$.domElement,this.onKeyDown,!0),this.to.ys(t.a.Ld,this.$.domElement,this.onKeyUp,!0),this.ffc=this.d_=this.w$b=!1)}E1j(){this.recoveryUI&&250<=m.a.Ya.ue.m-this.g2d&&this.show(-1)}ZCc(D,E){B.TaskExtensions.za(H.GetServiceTaskFactory.Oa(this.$.da,
426,427,1),N=>{void N.result.vea(D,E);h.ULS.sendTraceTag(523622036,0,50,"RecoveryUIController.triggerTableInvitationHandRaise: IntelligentMetadataOverlayManager is triggered.")},this.$.la,3)}}Object(r.a)(U,"RecoveryUIController",null,[246,2]);class S extends e.a{constructor(D){super();this.$=D;this.Db()}create(){if(y.EwaSettings.cl())this.YKi();else{const D=this.$;D.Vx(E=>{E.bgc().then(N=>{this.nb(this.$.da.Aa(406)||new U(D,N,b.KeyInputManager.instance,f.a.instance.NG()))})})}}YKi(){const D=this.$;
let E=this.$.da.Aa(406);E?this.nb(E):D.Vx(N=>{N.bgc().then(M=>{E=new U(D,M,b.KeyInputManager.instance,f.a.instance.NG());this.$.da.Ha(406,E);this.nb(E)})})}static ka(D){D.da.Ha(405,new S(D))}}Object(r.a)(S,"RecoveryUIControllerFactory",e.a,[]);a.d(F,"a",function(){return G});const G=()=>{c.a.Fa(D=>{S.ka(D)})}},1319:function(r,F,a){r=a(0);var c=a(15),b=a(255);class e{constructor(h,l){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=
0;this.browserResourceTiming=null;this.testIteration=0;this.testName=h;this.caller=l;this.reset()}reset(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null}}Object(r.a)(e,"NetworkTestResult",null,[]);var f=a(581);a.d(F,"a",function(){return d});class d{constructor(h,l,k,t,n){this.url="";this.b6a=!1;this.C7=-1;this.testIteration=0;this.baseUrl=k;this.jBf=t;this.vmd=l;this.result=new e(l,n)}runTest(){try{if(this.b6a)return c.ULS.sendTraceTag(537155206,
0,50,`NetworkTestReq.RunTest: a test for the host ${this.vmd} is already mid way, not starting a new one.`),!1;this.reset();this.b6a=!0;this.result.startTimeMs=Date.now();const h=new b.QueryStringBuilder(this.baseUrl);h.t9("tid",this.result.startTimeMs.toString());this.url=h.toString();this.hvj();this.testIteration++;this.result.testIteration=this.testIteration;return!0}catch(h){return this.qvb("Exeption: "+h.message),!1}}reset(){this.url="";this.result.reset();this.b6a=!1;this.C7=-1}clearTimeout(){-1!==
this.C7&&(window.clearTimeout(this.C7),this.C7=-1)}hvj(){try{const h=new XMLHttpRequest;h.onreadystatechange=()=>{4===h.readyState&&(200===h.status?this.THh():this.qvb(`Error when downloading resource. status code: ${h.status}, status text: ${h.statusText}`,h.status.toString()))};h.onerror=()=>{this.qvb(`Client error when attempting to download resource. status code: ${h.status}, response: ${h.statusText}`)};this.C7=window.setTimeout(()=>{this.C7=-1;this.qvb("Request timeout")},1E4);h.open("GET",
this.url,!0);h.send(null)}catch(h){this.qvb("Exeption: "+h.message)}}THh(){this.b6a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=f.a(this.url),this.result.isSuccess=!0,this.I4b())}qvb(h,l=null){this.b6a&&(this.clearTimeout(),this.result.errorMessage=h,this.result.isSuccess=!1,this.result.errorStatusCode=l,this.I4b())}I4b(){this.b6a=!1;this.jBf&&this.jBf(this.result,this.vmd)}}Object(r.a)(d,"NetworkTestReq",null,[])},1387:function(r,
F,a){r=a(0);var c=a(15),b=a(85);a(109);var e=a(27);class f{constructor(z,w,m){this.Gj=this.OEd=null;this.aFa=this.d9=0;this.QTb=null;this.AS=z;this.he=w;this.mb=m;this.S1a=!1;this.a1d=!0;this.Toj();this.M9a=this.fa.pa("NativeFileOpenDialogIsEnabled")}get context(){return this.AS}get fa(){return this.mb}get retryCount(){return this.d9}get COd(){return this.aFa}bHb(z){this.Gj=z;if(!this.S1a){if(this.a1d){if(this.M9a&&e.a.iF){this.QTb=z.r8b(Object(b.a)(this,this.bDd,"onFileChosen"));return}this.QTb=
z.r8b(null);if(!this.fCa(this.QTb,z))return}this.finalizeUpload(z,null)}}bDd(z){if(this.fCa(z,this.Gj)){if(e.a.iF||e.a.Cf)this.QTb=z;this.finalizeUpload(this.Gj,null)}}Kqc(){this.OEd&&this.OEd()}Toj(){this.d9=0;this.aFa=this.fa.vd("Box4UploadRetryDelayStart",200);this.Gj&&(this.Gj.dispose(),this.Gj=null)}}Object(r.a)(f,"FileUploader",null,[]);var d=a(4),h=a(321),l=a(794),k=a(135),t=a(30);a.d(F,"a",function(){return n});class n extends f{constructor(z,w,m){super(z,w,m);this.CWb=this.Dra=null}get mO(){return d.AFrameworkApplication.sa.HD}H2e(z){switch(z){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;
case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}}img(z){return n.fCa(z,this.z6h())}z6h(){return n.tme}fCa(z,w=null){z=this.img(z);return 0!==z?(w&&w.Eoe(),2===z&&this.kj(0,this.H2e(z)),!1):!0}finalizeUpload(z,w){c.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.OEd=w;this.zJj();h.a.mark(5576);this.CWb=this.mO.Gc("LoadResource","PictureUploadTime")}kj(z,w){const m=new k.StandardDialog;m.Ob=0;m.Nz(z,CommonUIStrings.l_ImageUploadFailedTitle,w,null)}Kqc(){c.ULS.sendTraceTag(36783361,
322,50,"PictureUploader.OnUploadComplete");super.Kqc();this.CWb&&(this.CWb.stop(),this.CWb=null);this.e6g()}zJj(){this.Dra=(new l.a).create();this.Dra.message=CommonUIStrings.l_ImageUploadWait;this.Dra.Ob=5;this.Dra.pt=!1;this.Dra.ZAa(null,null,null)}e6g(){this.Dra&&(this.Dra.close(),this.Dra=null)}static Ubi(z,w){z=t.a.Yk(z);for(let m=0;m<w.length;++m)if(z.endsWith(w[m]))return!0;return!1}static fCa(z,w=null){w||(w=n.tme);return z?n.Ubi(z,w)?0:2:1}}n.tme=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");
Object(r.a)(n,"PictureUploader",f,[])},1460:function(r,F,a){a.r(F);var c=a(1178),b=a(0),e=a(15),f=a(4),d=a(121),h=a(401);class l extends h.a{constructor(pa){super(pa)}get A5b(){return!1}createElement(){const pa=document.createElement("link");pa.setAttribute("rel","stylesheet");pa.setAttribute("type","text/css");pa.setAttribute("href",this.Ft);return pa}X5c(){return null}huc(){this.element.setAttribute("href","");this.element.setAttribute("href",this.Iz.Ft)}}Object(b.a)(l,"CssResource",h.a,[]);var k=
a(380),t=a(231),n=a(30),z=a(55);class w{constructor(){this.IWb=this.UTb=null}HAi(){this.UTb||(e.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.UTb=z.Task.WAA(w.MAi(),w.DAi()),this.UTb.continueWith(pa=>{e.ULS.sendTraceTag(21030599,324,10,"{0}",n.a.qgd(pa.exception))},5));return this.UTb}JAi(){if(!this.IWb)try{e.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.IWb=z.Task.WAA(w.p$c(t.a.create(f.AFrameworkApplication.fa.Wa("DimeUrl"),
null,null))),this.IWb.continueWith(pa=>{e.ULS.sendTraceTag(39978391,324,10,"{0}",n.a.qgd(pa.exception))},5)}catch(pa){e.ULS.sendTraceTag(594874951,324,10,"{0}",n.a.qgd(pa))}return this.IWb}static MAi(){var pa=w.Kdc("inproductmessaging.js");pa=t.a.create(pa,null,null);return w.p$c(pa)}static DAi(){var pa=w.Kdc("inproductmessaging.css");pa=new l(pa);return w.p$c(pa)}static Kdc(pa){return d.a.F4b(String.format("ipm/{0}",pa))}static p$c(pa){k.a.yia(pa);return pa.Y8a}}Object(b.a)(w,"DependencyDownloader",
null,[772]);class m{}m.h3i="inProductMessagingOverlayDiv";m.b6i="PlayButtonImage";m.Smj="ReplayButtonImage";Object(b.a)(m,"Constants",null,[]);class u{constructor(){this.hke=this.Eee=this.f5d=!0;this.Tmj=this.c6i=null;this.$Ji=!1;this.locale=null;this.Ghg={}}get Kwe(){return this.f5d}set Kwe(pa){this.f5d=pa}get kwf(){return this.Eee}set kwf(pa){this.Eee=pa}get d$f(){return this.hke}set d$f(pa){(this.hke=pa)&&this.OAj()}OAj(){this.Ype(m.b6i,this.c6i);this.Ype(m.Smj,this.Tmj)}Ype(pa,zb){zb&&(this.Ghg[pa]=
zb)}}Object(b.a)(u,"FirstRunExperienceUISettings",null,[771]);class y{constructor(){this.completed=this.Ahj=!1}}Object(b.a)(y,"FirstRunExperienceViewData",null,[770]);var v=a(85),C=a(178),x=a(108),B=a(25);class H{constructor(pa,zb,Vb){this.Ma=pa;this.Ye=zb;this.AUb=Vb}Ag(){this.Ma.Oe(B.a.qIh,x.a.frame,Object(v.a)(this,this.oIh,"firstRunExperienceHandler"),64);this.Ma.Nb(B.a.zYe,x.a.frame,Object(v.a)(this,this.Mei,"inProductMessagingTabHandler"));this.Ma.Nb(B.a.yYe,x.a.frame,Object(v.a)(this,this.Lei,
"inProductMessagingShiftTabHandler"));this.Ma.Nb(B.a.Ymh,x.a.frame,Object(v.a)(this,this.Zmh,"dimeLaunchHandler"));this.Ma.Nb(B.a.fYf,x.a.frame,C.ActionManager.gg);this.Ma.Nb(B.a.qnj,x.a.frame,C.ActionManager.gg);this.Ma.Nb(B.a.rnj,x.a.frame,C.ActionManager.gg);this.Ye&&this.Ye.updateCommandUI()}oIh(pa,zb,Vb,xc,Sc){2===Vb&&this.AUb.fzi(Sc);return 32}Zmh(pa,zb,Vb,xc,Sc){2===Vb&&this.AUb.czi(Sc);return 32}Mei(pa,zb,Vb){return 2===Vb?this.AUb.Pzd():32}Lei(pa,zb,Vb){return 2===Vb?this.AUb.Nzd():32}}Object(b.a)(H,
"InProductMessagingActor",null,[]);var I=a(84);class U{constructor(){this.CUf=this.HZf=this.Odg=this.qlc=this.instance=null}}Object(b.a)(U,"DimeExperienceUISettings",null,[]);var S=a(146),G=a(467);class D{constructor(pa,zb,Vb,xc,Sc){this.Yac=!1;this.Itb=null;this.Ma=pa;this.tFa=zb;this.lXb=Vb;this.b1=xc;this.rHc=Sc}Dhi(pa){S.b("getHeaderApi")?pa.isFeatureEnabled("MsoPremiumBadge",!0).then(zb=>{const Vb=pa.isFreemiumUpsellEnabled();Vb&&(appChrome.getHeaderApi().then(xc=>{xc.updatePremiumStatus(zb,
Vb);return null}),pa.Oza("MsoPremiumBadge",xc=>{appChrome.getHeaderApi().then(Sc=>{Sc.updatePremiumStatus(xc.isEnabled,Vb);return null})}));return null}):e.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")}fzi(pa){this.lXb.HAi().continueWith(()=>{this.tFa.OKj(pa)})}czi(pa){let zb="gopremium",Vb=null,xc=()=>{};pa?(pa.experience&&""!==Object(I.a)(String,pa.experience)&&(zb=Object(I.a)(String,pa.experience)),pa.onTaskComplete&&(xc=pa.onTaskComplete),pa.campaignId&&""!==Object(I.a)(String,
pa.campaignId)&&(Vb=Object(I.a)(String,pa.campaignId))):e.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.Rpf(zb,xc,Vb)}Rpf(pa,zb,Vb=null){if(this.Yac&&this.Itb){const xc={};xc.experience=pa||"gopremium";xc.campaignId=Vb||G.b(this.b1,this.rHc,Object(I.a)(String,xc.experience),!0);this.Ma.processAction(B.a.fYf,2);e.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+xc.experience);try{const Sc=Object.assign(new U,{instance:this.Itb,qlc:xc,Odg:zb||
(()=>{}),HZf:Jd=>{e.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+Jd.status)},CUf:()=>{e.ULS.sendTraceTag(51675406,324,10,"Dime launch error");this.Yac=!1;this.Itb=null}});this.tFa.cJj(Sc)}catch(Sc){e.ULS.sendTraceTag(51675407,324,10,"Dime launch error: "+Sc.message),this.Yac=!1,this.Itb=null,this.Ma.Vd(B.a.Zac,2,{["experience"]:xc.experience})}}else e.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),this.Ma.Vd(B.a.Zac,2,{["experience"]:pa})}Iqf(){this.lXb.JAi().continueWith(()=>
{try{var pa=n.a.Yk(f.AFrameworkApplication.uiCulture);const xc=G.c(this.b1);if(xc){var zb={};zb.partnerId=xc;zb.language=pa;zb.sessionId=f.AFrameworkApplication.userSessionId;zb.authHint=f.AFrameworkApplication.fa.Wa("UserPrincipalName");var Vb=f.AFrameworkApplication.fa.Wa("Puid")||"";""!==Vb&&(pa={},pa.puid=Vb,zb.userInfo=pa);this.Itb=new Dime(zb);this.Yac=!0;e.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else e.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(xc){e.ULS.sendTraceTag(51675410,
324,10,"FreemiumUpsellDialogDependencies failed: "+xc.message)}},3)}Pzd(){return this.tFa.Pzd()}Nzd(){return this.tFa.Nzd()}}Object(b.a)(D,"InProductMessagingUIManager",null,[769]);class E{constructor(){this.Jle=0;this.SWa=Array(5);this.SWa[0]=10;this.SWa[1]=15;this.SWa[2]=50;this.SWa[3]=100;this.SWa[4]=200}Init(pa){this.Jle=pa}SendTrace(pa,zb){e.ULS.sendTraceTag(34182235,this.Jle,this.SWa[pa],"{0}",zb)}}Object(b.a)(E,"DefaultNetworkingManager",null,[787]);var N=a(264),M=a(317),L=a(97);class aa{constructor(pa){this.Zb=
pa}OKj(pa){pa&&(InProductMessaging.Networking.NetworkingMgr=new E,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(pa.d$f,pa.kwf,pa.Kwe,pa.$Ji,pa.locale,Object(v.a)(this,this.mRi,"onDismissFirstRunExperience"),pa.Ghg),this.ZRa(m.h3i,!0))}cJj(pa){if(pa&&pa.instance&&pa.qlc){let zb=document.getElementById("wacDimeContainer");zb||(zb=document.createElement("div"),zb.id="wacDimeContainer",document.body.appendChild(zb));f.AFrameworkApplication.fa.pa("DimeFocusManagerIsEnabled")&&
this.ZRa("wacDimeContainer",!1);pa.qlc.parentElementId="wacDimeContainer";pa.instance.launch(pa.qlc,pa.Odg).then(Vb=>{this.DJb();document.body.removeChild(zb);pa.HZf(Vb)}).catch(Vb=>{this.DJb();document.body.removeChild(zb);pa.CUf(Vb)})}else throw Error.argument("DimeExperienceUISettings");}ZRa(pa,zb){if(this.Zb&&pa&&(pa=document.getElementById(pa),this.vhi(pa),pa=this.Zb.IM("InProductMessagingFocusId"))){const Vb=this.Zb.Uh;Vb&&"InProductMessagingFocusId"===Vb.name||this.Zb.sR("InProductMessagingFocusId",
!1);zb&&this.FSf(pa.scope)}}vhi(pa){var zb=this.Zb.pi("InProductMessagingFocusId");zb.parent=N.AFrame.wT;const Vb=new M.DOMFocusListing(()=>pa);Vb.ecb=!1;Vb.ao(3);Vb.ao(2);Vb.ao(4);zb=this.Zb.Asa(()=>pa,zb,Vb);zb.wJb();zb.i_=!0;zb.NHa=!0}FSf(pa){pa.yk(L.FocusManager.instance().S1);pa.yk(L.FocusManager.instance().T1);pa.bindAction(L.FocusManager.instance().S1,B.a.zYe);pa.bindAction(L.FocusManager.instance().T1,B.a.yYe)}DJb(){this.Zb&&(this.Zb.Wca("InProductMessagingFocusId"),this.Zb.EQa("InProductMessagingFocusId"))}mRi(pa,
zb){this.DJb();pa=Object.assign(new y,{completed:pa,Ahj:zb});f.AFrameworkApplication.rb.Vd(B.a.nIh,2,pa)}Pzd(){const pa=document.activeElement,zb=this.Zb.nQ();return pa&&zb&&zb.ef&&pa===zb.ef.xw?(zb.ef.Fl(pa),zb.hya()?32:8):4}Nzd(){const pa=document.activeElement,zb=this.Zb.nQ();return pa&&zb&&zb.ef&&pa===zb.ef.firstElement?(zb.ef.Fl(pa),zb.vOa()?32:8):4}}Object(b.a)(aa,"InProductMessagingUIWrapper",null,[767]);var V=a(136),P=a(251),ba=a(27);class Y{constructor(){this.$a=null}get name(){return"Common.App.InProductMessaging"}Bh(pa){pa.register(w,
"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").qc().yc(()=>new w);pa.register(aa,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").qc().yc(()=>new aa(L.FocusManager.instance()));pa.register(D,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").qc().yc(()=>new D(f.AFrameworkApplication.rb,pa.resolve("Common.IInProductMessagingUIWrapper"),
pa.resolve("Common.App.InProductMessaging.IDependencyDownloader"),f.AFrameworkApplication.sa.Qa.Oj,f.AFrameworkApplication.sa.Qa.sca));pa.register(H,"Common.App.InProductMessaging.InProductMessagingActor").qc().yc(()=>new H(f.AFrameworkApplication.rb,f.AFrameworkApplication.sa,pa.resolve("Common.IInProductMessagingUIManager")));pa.register(u,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").qc().yc(()=>new u);pa.register(y,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").qc().yc(()=>
new y);this.$a=pa}init(){this.$a.resolve("Common.App.InProductMessaging.InProductMessagingActor").Ag();f.AFrameworkApplication.fa.ru(()=>{f.AFrameworkApplication.sa.Qa.gs&&V.a.get_instance().Lj(15,()=>{this.$a.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(pa=>{this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Dhi(pa)})});f.AFrameworkApplication.fa.pa("FreemiumUpsellShowDialogIsEnabled")&&G.a()&&!ba.a.Pka&&1!==f.AFrameworkApplication.sa.Qa.Oj&&
this.$a.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(pa=>{pa.isFeatureEnabled("MsoPremiumBadge",!0).then(zb=>{!zb&&pa.isFreemiumUpsellEnabled()&&this.$a.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").Iqf();return null})})})}dispose(){}static main(){P.a.instance.ii(new Y)}}Object(b.a)(Y,"InProductMessagingPackage",null,[3,4]);var Z=a(192),ea=a(39);class ra{constructor(pa,zb,Vb,xc=null,Sc=null){this.Qv=pa;this.TDa=zb;this.Ajb=Vb;this.ahe=xc;this.Llb=
Sc}p$b(pa){const zb=new Sys.StringBuilder(this.Qv.$Kb);zb.append("RoamingServiceHandler.ashx?action=");zb.append("getFirstRunExperienceSettings");zb.append("&");zb.append(this.nid(pa));zb.append("&");zb.append(f.AFrameworkApplication.vi);f.AFrameworkApplication.Bd.Jm(zb.toString(),1,null,null,!0,2,Object(v.a)(this,this.e4,"getRequestSuccessCallback"),Object(v.a)(this,this.JM,"getRequestFailureCallback"),null)}a3a(pa){var zb=new Sys.StringBuilder(this.Qv.$Kb);zb.append("RoamingServiceHandler.ashx?action=");
zb.append("saveFirstRunExperienceSettings");zb.append("&");zb.append(f.AFrameworkApplication.vi);zb=zb.toString();pa=ea.c(pa);f.AFrameworkApplication.Bd.Jm(zb,2,pa,null,!0,4,Object(v.a)(this,this.F7i,"postRequestSuccessCallback"),Object(v.a)(this,this.HN,"postRequestFailureCallback"),null)}e4(pa){let zb=!1,Vb=null;try{if(0<pa.data.de.length){const xc=Object(I.a)(Object,ea.a(pa.data.de)),Sc=xc?xc[this.Qv.QYc]:null;Sc&&(Vb=Object(I.a)(Object,ea.a(Sc.toString())))}zb=!0}catch(xc){this.JM(null)}zb&&this.TDa&&
this.TDa(pa.data,Vb)}JM(pa){this.Ajb&&this.Ajb(pa?pa.data:null)}F7i(pa){this.ahe&&this.ahe(pa?pa.data:null)}HN(pa){this.Llb&&this.Llb(pa?pa.data:null)}nid(pa){const zb=new Sys.StringBuilder("requestedsettings=");for(let Vb=0;Vb<pa.count;Vb++)zb.append(pa.ma(Vb)),Vb<pa.count-1&&zb.append(";");return zb.toString()}}Object(b.a)(ra,"FirstRunExperienceRequestHandler",null,[]);var O=a(234),da=a(83);class xa{constructor(){this.qjb=this.VTb=this.Qv=null}LUd(pa){pa?(this.Qv=pa,this.jri()&&(e.ULS.sendTraceTag(51675532,
306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),pa=new Z.a,pa.add(this.Qv.QYc),this.VTb=new ra(this.Qv,Object(v.a)(this,this.e4,"getRequestSuccessCallback"),Object(v.a)(this,this.JM,"getRequestFailureCallback"),null,Object(v.a)(this,this.HN,"postRequestFailureCallback")),this.VTb.p$b(pa)),(this.Qv.b8a||f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.MUd()):e.ULS.sendTraceTag(51675531,306,
10,"Invalid launcherSettings")}jri(){try{if(this.Qv.b8a)return!0;if(!f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||f.AFrameworkApplication.fa.pa("IsAnonymousUser"))return!1;if(this.Qv.Uni||this.Qv.e8a||f.AFrameworkApplication.fa.pa("IsO365ConsumerHost"))return!0;const pa=f.AFrameworkApplication.fa.Wa("FlightId");return-1!==(pa?pa.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(pa){e.ULS.sendTraceTag(576582624,306,
10,"Error checking setting {0}",pa?pa.toString():null)}return!1}V0f(pa){const zb={},Vb={};Vb.FREDisplayedDate=(new Date).toUTCString();Vb.VersionDisplayed=pa;Vb.RemindMeLater=!1;zb[this.Qv.QYc]=ea.c(Vb);e.ULS.sendTraceTag(51675533,306,50,"Initiating call to save FRE data for current user from Roaming Settings Service");this.VTb&&this.VTb.a3a(zb)}e4(pa,zb){pa=pa?+pa.Y2-+pa.cF:-1;pa>this.Qv.I_f?e.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",
pa,this.Qv.I_f):zb?this.QHj(zb)?(e.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",this.Qv.dwf),this.MUd()):(this.P8c(!1),e.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required.")):(e.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.MUd())}JM(pa){this.P8c(!1);
e.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",pa?pa.httpStatus:-1)}HN(pa){e.ULS.sendTraceTag(51675542,306,10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",pa?pa.httpStatus:-1)}MUd(){this.P8c(!0);var pa=da.a.instance.mg("Common.ISystemInitiatedFeedback");pa?this.S9f(pa):(e.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),f.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",
!0)&&((pa=da.a.instance.Tb("Common.ISystemInitiatedFeedback"))?pa.execute(zb=>{this.S9f(zb)}):e.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))}S9f(pa){if(pa){var zb=this.Qv.CIh;zb&&(f.AFrameworkApplication.Kxa(zb),f.AFrameworkApplication.Tp(zb));e.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",zb);pa.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.qjb=Object(v.a)(this,this.oSi,"onFirstRunExperienceCampaignEvent"),
window.addEventListener("FGWebSurfaceEvent",this.qjb,!0),window.addEventListener("FRELaunchedEvent",this.qjb,!0)):(e.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.V0f(this.Qv.currentVersion))}else e.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")}oSi(pa){if(pa){var zb=pa.detail;pa=pa.type;var Vb=this.Qv&&this.Qv.campaignId?this.Qv.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===pa||Vb&&zb&&zb.id&&-1!==zb.id.indexOf(Vb))zb.success&&
(e.ULS.sendTraceTag(51675546,306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.V0f(this.Qv.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.qjb,!0),window.removeEventListener("FRELaunchedEvent",this.qjb,!0))}}QHj(pa){if("RemindMeLater"in pa&&"FREDisplayedDate"in pa){if("true"===pa.RemindMeLater.toString()&&(+new Date-+new Date(pa.FREDisplayedDate.toString()))/36E5>this.Qv.dwf)return!0}else if(f.AFrameworkApplication.fa.pa("WacShowVersionBasedFREToAllUsers")&&
"VersionDisplayed"in pa&&pa.VersionDisplayed<this.Qv.currentVersion)return e.ULS.sendTraceTag(528262853,306,50,"Current version is higher so FRE V2 UI should be displayed again."),!0;return!1}P8c(pa){f.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.DispatchFREDecisionEvent")&&O.a.dispatch("FREDecisionEvent",{["show"]:pa})}}Object(b.a)(xa,"FirstRunExperienceLauncher",null,[669]);class ia{constructor(){this.$a=null}get name(){return"Common.App.FirstRunExperienceLauncher"}Bh(pa){this.$a=
pa;this.$a.register(669,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").qc().yc(()=>new xa)}init(){}dispose(){}static main(){P.a.instance.ii(new ia)}}Object(b.a)(ia,"FirstRunExperienceLauncherPackage",null,[3,4]);var Ma=a(1134),Ta=a(1135),Da=a(1162),fa=a(1277),ua=a(9),Fa=a(226);class ca{constructor(pa){this.$=pa}get QYc(){return"Excel"}get campaignId(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}get version(){return 1}get currentVersion(){return 0}get Uni(){return this.isEnabled()&&
this.$.ra(295)}get e8a(){return this.isEnabled()&&this.$.ra(297)}get b8a(){return this.$.ra(296)}get CIh(){return null}get dwf(){return 24}get I_f(){return 4E3}get $Kb(){return this.$.ya.WebServiceBase||""}isEnabled(){if(f.AFrameworkApplication.fa?f.AFrameworkApplication.fa.pa("IsAnonymousUser"):1)return!1;const pa=f.AFrameworkApplication.Rb?Object(I.a)(String,f.AFrameworkApplication.Rb.AudienceGroup):"";return"Unknown"!==pa&&"Automation"!==pa}}Object(b.a)(ca,"FirstRunExperienceLauncherSettings",
null,[689]);class ka{constructor(pa,zb){this.AYe=pa;this.pIh=zb}LUd(){this.AYe&&this.AYe.LUd(this.pIh)}}Object(b.a)(ka,"FirstRunExperienceManager",null,[688]);var Ca=a(712);class fb extends Fa.a{constructor(pa){super();this.$=pa;this.Db()}create(){const pa=Object(Ca.a)(this.$.da,311,()=>this.rdh());this.nb(pa)}rdh(){var pa=new ca(this.$);pa=new ka(da.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),pa);pa.LUd();return pa}static ka(pa){pa.da.Ha(312,new fb(pa))}}
Object(b.a)(fb,"FirstRunExperienceManagerFactory",Fa.a,[]);var yb=a(56);class mb extends Fa.a{constructor(pa){super();this.qnd=null;this.$=pa;this.Db()}create(){const pa=Object(Ca.a)(this.$.da,361,()=>this.eeh());this.nb(pa)}eeh(){this.qnd=da.a.instance.mg("Common.IInProductMessagingUIManager");yb.a.pg.gs?V.a.get_instance().Lj(16,()=>{this.cff()}):this.cff();return this.qnd}cff(){da.a.instance.Tb("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(pa=>{pa.isFeatureEnabled("MsoPremiumBadge",
!0).then(zb=>{!zb&&pa.isFreemiumUpsellEnabled()&&this.qnd.Iqf();return null})})}static ka(pa){pa.da.Ha(362,new mb(pa))}}Object(b.a)(mb,"InProductMessagingManagerFactory",Fa.a,[]);var nb=a(1214),X=a(1137),R=a(48),wa=a(421),na=a(81),Ba=a(1),Ra=a(529),qa=a(21),La=a(577);class Yb extends Ra.a{constructor(pa){super(1);this.yfa=!1;this.zAf=()=>{this.refresh()};this.AAf=()=>{this.refresh()};this.gridView=qa.h(pa);this.gridView.Vb.xl(this.AAf);this.gridView.Vb.Km(this.zAf);this.refresh()}get NH(){return this.inc(this.yfa)}GSd(pa){this.yfa!==
pa&&(this.yfa=pa,this.NIb())}get name(){return La.a.cellEdit}dispose(){this.gridView.Vb.nl(this.AAf);this.gridView.Vb.$l(this.zAf);this.gridView=null;super.dispose()}NIb(){this.gJd(this.yfa)}refresh(){this.GSd(!this.gridView.fb)}}Object(b.a)(Yb,"CellEditSafeStatePublisher",Ra.a,[]);var mc=a(38),Zb=a(114);class qb{constructor(pa,zb){this.handler=null;this.publisher=pa;this.NH=zb}}Object(b.a)(qb,"SafeStatePublisherState",null,[]);var Ha=a(615);const Ya=pa=>pa?`${pa.Current} / ${pa.Pending} @${pa.SuspensionStartTimestamp}`:
null,Gb=pa=>(null===pa||void 0===pa?void 0:pa.SuspensionStartTimestamp)&&pa.Pending>pa.Current;class Ja extends mc.a{constructor(pa,zb){super();this.ypf=null;this.H8a=!1;this.wGb=(Vb,xc)=>{3===xc.Qvf&&this.H8a&&e.ULS.sendTraceTag(520480204,0,15,"ClientStateMonitor.onMergeDidntOccur: Aborted merge occurred after another aborted merge.");this.H8a=!0;this.xbb()};this.qRa=new Z.a;this.dya=pa;this.Bma=zb;this.FAb=Ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);
this.J7a=Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout");this.FAb&&(this.Bma.$Ya(this.Iya.bind(this)),this.J7a?this.dya.ere(this.wGb):this.dya.LNg(this.sFf.bind(this)))}get gZj(){return Zb.f(Zb.c(this.qRa.toArray(),pa=>0!=pa.NH),pa=>pa.publisher.name)}b0b(pa){this.addHandler(Ja.pRa,pa)}avc(pa){this.removeHandler(Ja.pRa,pa)}Rza(pa,zb){const Vb=new qb(pa,zb);this.qRa.add(Vb);zb=(xc,Sc)=>{Vb.NH=Sc.NH;this.xbb()};pa.b0b(zb);Vb.handler=zb;this.xbb()}I_d(pa){let zb=
null;for(let Vb of this.qRa)if(Vb.publisher===pa){this.Hig(Vb);zb=Vb;break}zb&&(this.qRa.remove(zb),this.xbb())}dispose(){for(let pa of this.qRa)this.Hig(pa);this.qRa.clear();this.FAb&&(this.Bma.ucb(this.Iya.bind(this)),this.J7a?this.dya.JWf(this.wGb):this.dya.Kkj(this.sFf.bind(this)));super.dispose()}xbc(){let pa=ec.xbc(this.qRa.toArray().map(zb=>zb.NH));return this.H8a&&1===pa?2:pa}Hig(pa){pa.publisher.avc(pa.handler)}xbb(){const pa=this.xbc();pa!==this.ypf&&(this.raiseEvent(Ja.pRa,new Ha.a(pa)),
this.ypf=pa)}sFf(){this.H8a&&e.ULS.sendTraceTag(523317957,0,15,"ClientStateMonitor.onMergeWasAborted: Aborted merge occurred after another aborted merge.");this.H8a=!0;this.xbb()}Iya(pa,zb){pa=zb.kca;(zb=!Gb(pa))||(zb=this.xyi,zb=(null===pa||void 0===pa?void 0:pa.SuspensionStartTimestamp)!==(null===zb||void 0===zb?void 0:zb.SuspensionStartTimestamp));zb&&(this.H8a=!1);this.xyi=pa;this.xbb()}}Ja.pRa="SSC";Object(b.a)(Ja,"ClientStateMonitor",mc.a,[]);var Na=a(6),Qa=a(73);class Oa extends Ra.a{constructor(pa,
zb=null){super(1);this.yfa=!1;this.tN=()=>{this.refresh()};this.FBf=()=>{this.refresh()};this.$=pa;this.Y$d=zb||Qa.a(pa).kQ(Na.a.idle);Qa.a(pa).nXc(this.FBf);this.S5a.pq(this.tN);this.refresh()}get NH(){return this.inc(this.yfa)}GSd(pa){pa!==this.yfa&&(this.yfa=pa,this.NIb())}get name(){return La.a.S5a}get S5a(){return this.Y$d}dispose(){Qa.a(this.$).Guc(this.FBf);this.S5a.Lq(this.tN);this.Y$d=null;super.dispose()}NIb(){this.gJd(this.yfa)}refresh(){this.GSd(1===this.S5a.nu||Qa.a(this.$).Th===this.S5a)}}
Object(b.a)(Oa,"IdleActivitySafeStatePublisher",Ra.a,[]);var bb=a(318),Ga=a(3),tb=a(22);class wb extends na.a{constructor(){super()}Hc(){return!1}executeCommand(){return z.Task.Sa(!0)}wc(pa,zb){return 1905775613===zb.command}Nc(){return!1}}Object(b.a)(wb,"ToggleMergeSuspensionSafeState",na.a,[222]);class lb extends mc.a{constructor(pa,zb){super();this.statusBarManager=null;this.PAd=!1;this.Iya=(Vb,xc)=>{Vb=`${xc.kca.Current===xc.kca.Pending?"\u26ad":"\u26ae"}${xc.kca.Current}`;tb.a.equals(this.Qnc,
Vb,!1)||(this.Qnc=Vb,this.rz())};this.gPa=(Vb,xc)=>{Vb=0==xc.NH;this.PAd!==Vb&&(this.PAd=Vb,this.rz())};this.mergeSuspensionManager=zb;this.mergeSuspensionManager.Bma.$Ya(this.Iya);this.Qnc="";bb.a.r9(1905775613,Ga.a.oc,0,1);this.Ia=pa.Ia;this.kPb=new wb;pa.da.gb(29,Vb=>{this.mergeSuspensionManager&&(this.statusBarManager=Vb,Vb.$I(this),this.mergeSuspensionManager.Bha.b0b(this.gPa))});this.Ia.h2(this.kPb)}pq(pa){this.addHandler(lb.pzd,pa)}Lq(pa){this.removeHandler(lb.pzd,pa)}rz(){this.raiseEvent(lb.pzd)}un(pa){return pa===
lb.W$i&&!!this.mergeSuspensionManager}Tr(pa,zb){if(!this.un(pa))return!1;this.mergeSuspensionManager&&(zb.LabelText=this.Qnc,zb.On=this.PAd);return!0}dispose(){this.kPb&&(this.Ia.hcb(this.kPb),this.kPb.dispose(),this.kPb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.Bma.ucb(this.Iya),this.mergeSuspensionManager.Bha.avc(this.gPa),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.yF(this),this.statusBarManager=null);this.Qnc=null;super.dispose()}}lb.pzd=
"MSMSC";lb.W$i="QueryMergeSuspensionStatus";Object(b.a)(lb,"MergeSuspensionIndicatorManager",mc.a,[200,201,2]);var db=a(7),Pa=a(895);class ja extends Sys.EventArgs{constructor(pa){super();this.axa=pa}}Object(b.a)(ja,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);class Ka{}Object(b.a)(Ka,"SuspensionState",null,[]);class ub extends Ka{constructor(pa){super();this.Xse=!1;this.Xse=pa}}Object(b.a)(ub,"ReadyForPendingMergeState",Ka,[]);const Kb=new Ka,W=new Ka,za=new ub(!1),Sa=new ub(!0);
var Wa=a(896);class ab extends Wa.a{constructor(pa,zb,Vb){super(pa);this.ZQg=zb;this.yLj=Vb}}Object(b.a)(ab,"ReadyForPendingMergesUpdatedEventArgs",Wa.a,[]);class ma extends mc.a{constructor(pa,zb,Vb){super();this.Iya=(xc,Sc)=>{xc=this.getState();const Jd=this.n_;this.n_=Sc.kca;Sc=this.getState();this.DDi(xc,Sc,Jd);this.raiseEvent(ma.kzd);this.kYe(xc,Sc)};this.gPa=(xc,Sc)=>{xc=this.getState();this.NH=Sc.NH;Sc=this.getState();this.kYe(xc,Sc)};this.wGb=(xc,Sc)=>{this.J7a&&4===Sc.Qvf&&(e.ULS.sendTraceTag(520480203,
0,50,"MergeSuspensionStateHandler.onMergeDidntOccur: Retry DoPendingMerge after bailout. Current merge counter: {0}, Response merge counter: {1}",Ya(this.n_),Ya(Sc.n_)),this.$Qf(this.getState(),!0))};this.FAb=Ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DoPendingMergeWhenUnsafe",!1);this.J7a=Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout");this.Bha=pa;this.Bha.b0b(this.gPa);this.Bma=zb;this.Bma.$Ya(this.Iya);this.J7a&&(this.dya=Vb,this.dya.ere(this.wGb));
this.n_=Object(db.a)(new Pa.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});this.NH=this.Rfi()}Rfi(){return Object(wa.a)(Ja,this.Bha)?Object(I.a)(Ja,this.Bha).xbc():1}f0b(pa){this.addHandler(ma.XYd,pa)}evc(pa){this.removeHandler(ma.XYd,pa)}xOg(pa){this.addHandler(ma.QJd,pa)}mlj(pa){this.removeHandler(ma.QJd,pa)}KNg(pa){this.addHandler(ma.kzd,pa)}Jkj(pa){this.removeHandler(ma.kzd,pa)}Ubj(){this.dJd(this.getState()===W)}dispose(){this.Bha.avc(this.gPa);this.Bha=null;this.Bma.ucb(this.Iya);this.Bma=
null;this.J7a&&(this.dya.JWf(this.wGb),this.dya=null);super.dispose()}Chd(){return Object(db.a)(new Pa.a,{Current:this.n_.Current,Pending:this.n_.Pending,SuspensionStartTimestamp:this.n_.SuspensionStartTimestamp})}getState(){return Gb(this.n_)?0==this.NH?Sa:this.FAb&&1==this.NH?za:W:Kb}kYe(pa,zb){pa!==zb&&(zb===W?this.dJd(!0):pa===W&&this.dJd(!1));this.$Qf(zb)}$Qf(pa,zb=!1){pa instanceof ub&&this.raiseEvent(ma.QJd,new ab(this.n_,pa.Xse||!this.FAb,zb))}DDi(pa,zb,Vb){pa===Kb&&zb!==Kb?(pa=zb===W,zb=
zb===za,e.ULS.sendTraceTag(252760283,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: ${zb} publisher: ${zb||pa?this.Bha.gZj.join(","):""} counter: ${Ya(this.n_)} isBlockingAllMerges: ${pa}`)):pa!==Kb&&zb===Kb&&e.ULS.sendTraceTag(252760284,0,50,`MergeSuspensionStateHandler.LogPendingMergesStatusChanged: No pending changes. counter: ${Ya(Vb)}`)}dJd(pa){this.raiseEvent(ma.XYd,new ja(pa))}}ma.XYd="TPMBBC";ma.QJd="RFPMU";ma.kzd="MCC";Object(b.a)(ma,"MergeSuspensionStateHandler",
mc.a,[]);class ha extends mc.a{constructor(pa){super();this.C1=null;this.Wkc=0;this.CEb=(zb,Vb)=>{(null===Vb||void 0===Vb?0:Vb.kca)&&this.ZOa(Vb.kca,ha.x2d)};this.Pxc=()=>{this.vZf();this.QQf(this.C1,ha.Loj)};this.w$a=(zb,Vb)=>{Vb.Rrb&&this.C1.SuspensionStartTimestamp&&e.ULS.sendTraceTag(17318084,0,50,`PendingMergeMonitor.OnEditCellEnded: committed with counter ${Ya(this.C1)}`)};this.vZf();this.$=pa;this.$.ea.Jj(this.Pxc);this.$.ea.TL(this.Pxc);qa.h(this.$).Vb.Km(this.w$a);this.$.da.gb(292,zb=>{zb.$Ya(this.CEb);
e.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")})}$Ya(pa){this.addHandler("MCU",pa)}ucb(pa){this.removeHandler("MCU",pa)}get n_(){return this.C1}ZOa(pa,zb=""){const Vb=this.C1.Current<pa.Current||this.C1.Pending<pa.Pending;if(pa.SuspensionStartTimestamp&&this.Wkc!==pa.SuspensionStartTimestamp){if(this.Wkc>pa.SuspensionStartTimestamp){Vb&&e.ULS.sendTraceTag(553736149,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via ${zb}. S: ${ha.BEb(pa)}, C: ${ha.BEb(this.C1)}`);
return}Vb||e.ULS.sendTraceTag(553736148,0,50,`PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: ${ha.BEb(pa)}, C: ${ha.BEb(this.C1)}`)}else if(!Vb)return;this.C1=pa;this.QQf(pa,zb)}dispose(){this.$.ea.ik(this.Pxc);this.$.ea.yR(this.Pxc);qa.h(this.$).Vb.$l(this.w$a);const pa=this.$.da.Aa(292);pa&&pa.ucb(this.CEb);super.dispose()}QQf(pa,zb=""){Gb(pa)&&pa.SuspensionStartTimestamp>this.Wkc&&(e.ULS.sendTraceTag(537155416,0,50,`PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: ${Ya(pa)}, Origin: ${zb}`),
this.Wkc=pa.SuspensionStartTimestamp);this.raiseEvent("MCU",new Wa.a(pa))}vZf(){e.ULS.sendTraceTag(588276808,0,50,`PendingMergeMonitor.ResetMergeCounter : Last counter was ${ha.BEb(this.C1)}`);this.C1=Object(db.a)(new Pa.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})}static BEb(pa){return pa?`(${pa.Current}/${pa.Pending} @${pa.SuspensionStartTimestamp})`:"null"}}ha.x2d="PMM.RTC";ha.P8b="PMM.EwaResult";ha.Loj="PMM.resetMergeCounter";Object(b.a)(ha,"PendingMergeMonitor",mc.a,[]);class eb{}Object(b.a)(eb,
"ClientRevisions",null,[]);var ta=a(44),ya=a(60);const sb=(pa,zb,Vb,xc,Sc,Jd,ye,pe=null)=>{pe=pa.Na(1,pe);pe.viewportState=zb;pe.allowViewAdjustment=Vb;return ya.g(pa,"DoPendingMerge",pe,xc,Sc,Jd,ye,0)},Qb=(pa,zb,Vb,xc,Sc,Jd,ye=null)=>{ye=pa.Na(1,ye);ye.suspensionStartTimestamp=zb;return ya.g(pa,"KeepBlockingPendingMerges",ye,Vb,xc,Sc,Jd,0)};class oc extends mc.a{constructor(pa,zb,Vb,xc){super();this.QIa=null;this.GCb=0;this.HCb=this.u8a=null;this.cHf=(Sc,Jd)=>{this.QIa.CUg(Jd.kca,Jd.ZQg,Jd.yLj)};
this.ZGb=(Sc,Jd)=>{Jd.axa?this.MNj():this.$Ac()};this.rFf=()=>{this.GCb=0};this.U2f=()=>{const Sc=this.N5.Chd();Qb(this.xa,null!=Sc.SuspensionStartTimestamp?Sc.SuspensionStartTimestamp:0,null,()=>{this.XVi(Sc)},null,null,this.xa.Wb())};this.oCa=(Sc,Jd)=>{if(Jd){Jd.Pob.MergeCount=this.N5.Chd();let ye;({min:Sc,max:ye}=qa.h(this.$).KIi());Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?Jd.Pob.ClientRevisions=Object(db.a)(new eb,{Min:Sc,Max:ye,MaxFromBlockCache:qa.h(this.$).Ca.ovf}):
Jd.Pob.ClientRevisions=Object(db.a)(new eb,{Min:Sc,Max:ye})}};this.$=pa;this.VZa=Vb;this.N5=zb;this.N5.xOg(this.cHf);this.N5.f0b(this.ZGb);this.N5.KNg(this.rFf);this.$.oa.Oga(this.oCa);this.xa=this.$.oa.xa;this.BNd=this.$.ya.MergeSuspensionRequestThrottlingTimeInMs;this.Rxi=this.$.ya.KeepBlockingPendingMergesRequestIntervalMs;this.QIa=xc;e.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")}dispose(){this.$.oa.cna(this.oCa);this.$Ac();this.N5.mlj(this.cHf);this.N5.evc(this.ZGb);this.N5.Jkj(this.rFf);
this.N5=null;super.dispose()}MNj(){this.$Ac();if(this.fMe()){const pa=this.N5.Chd();e.ULS.sendTraceTag(537155414,0,50,`RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter ${Ya(pa)} fail count: ${this.GCb}`)}else this.HCb=this.VZa.create(this.U2f,this.BNd,ta.a.HCb),this.u8a=this.VZa.yC(this.U2f,this.Rxi,ta.a.u8a)}$Ac(){this.u8a&&(this.HCb.cancel(),this.u8a.cancel(),this.u8a=this.HCb=null)}XVi(pa){let zb;
zb=" fail count: "+this.GCb;this.GCb++;this.fMe()&&this.$Ac();e.ULS.sendTraceTag(542229773,0,10,`RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed ${Ya(pa)}${zb}`)}fMe(){return this.GCb>oc.sHi}}oc.sHi=5;Object(b.a)(oc,"RequestController",mc.a,[]);var kb=a(160),jb=a(202),Wb=a(28),wc=a(282);class Jc extends Sys.EventArgs{constructor(pa,zb){super();this.Qvf=pa;this.n_=zb}}Object(b.a)(Jc,"MergeDidntOccurEventArgs",Sys.EventArgs,[]);class zc extends mc.a{get aMa(){return 0<this.VEd}constructor(pa,
zb,Vb=null,xc=null,Sc=null){super();this.Vkc=null;this.VEd=0;this.documentVisibilityObserver=null;this.Nof=!1;this.gnc=null;this.xa=pa;this.BNd=zb.ya.MergeSuspensionRequestThrottlingTimeInMs;const Jd=zb.ya.GetRangeContentPrefetchDelayForMergeInMs;this.py=()=>{zb.C1f(Jd)};this.uh=Vb||Wb.a.Ya;this.Nlg=0;this.jL=xc;this.vAa=Sc;zb.da.gb(291,ye=>{this.documentVisibilityObserver=ye})}LNg(pa){this.addHandler(zc.qzd,pa)}Kkj(pa){this.removeHandler(zc.qzd,pa)}ere(pa){this.addHandler(zc.lzd,pa)}JWf(pa){this.removeHandler(zc.lzd,
pa)}get isDocumentHidden(){return!!this.documentVisibilityObserver&&this.documentVisibilityObserver.Wh}CUg(pa,zb,Vb=!1){this.nNb(pa,zb,Vb)?(new kb.a).setResult(!0):(zb=this.e5i(pa,zb),this.Vkc=pa,this.VEd++,zb.continueWith(()=>{this.qRi()},0,jb.a.none,this.jL))}e5i(pa,zb){this.Nlg=this.uh.Jea;this.Nof=zb;e.ULS.sendTraceTag(554767493,0,50,`DoPendingMergeSender.performDoPendingMergeInternal: Sending DoPendingMerge ${pa.Current} / ${pa.Pending} @${pa.SuspensionStartTimestamp}. allowSelectionAdjustment: ${zb}`);
this.isDocumentHidden||this.py();return this.qvj(zb,pa)}nNb(pa,zb,Vb=!1){if(this.vAa&&!zb&&!this.vAa.Yui())return e.ULS.sendTraceTag(523317956,0,50,"DoPendingMergeSender.shouldThrottle: We can't retrieve selection and selection adjustments are disallowed."),!0;if(!this.Vkc||pa.SuspensionStartTimestamp>this.Vkc.SuspensionStartTimestamp)return this.aMa&&e.ULS.sendTraceTag(523551556,0,50,`DoPendingMergeSender.shouldThrottle: Allowing request for new suspension while previous is ongoing, new counter: ${pa.Current} / ${pa.Pending} @${pa.SuspensionStartTimestamp}`),
!1;if(this.aMa)return!0;if(Vb)return!1;Vb=this.Vkc;const xc=this.uh.Jea-this.Nlg<this.BNd;zb=this.Nof===zb;return(pa||Vb?pa&&Vb?pa.Current===Vb.Current&&pa.Pending===Vb.Pending&&pa.SuspensionStartTimestamp===Vb.SuspensionStartTimestamp:!1:!0)&&xc&&zb}qvj(pa,zb){const Vb=this.xa.Wb(),xc=()=>{e.ULS.sendTraceTag(588276806,0,10,`DoPendingMergeSender.sendDoPendingMergeRequest: request failed ${zb.Current} / ${zb.Pending} @${zb.SuspensionStartTimestamp}`)};return this.vAa?this.vAa.Urj(this.RTh(pa,xc,Vb)):
this.Lze(null,!0,void 0,xc,Vb)}RTh(pa,zb,Vb){return(xc,Sc,Jd)=>{let ye=void 0;e.ULS.shipAssertTag(523317955,0,null!=xc||pa,"!allowSelectionAdjustment requires a non-null initialViewportState.");ye=this.rRi.bind(this);Sc&&(ye=wc.b.call(null,pe=>{const re=pe.Result;let He=null===re||void 0===re?void 0:re.AdjustedViewportState;3===(null===re||void 0===re?void 0:re.MergeResultState)&&(He=void 0);Sc(He,pe.StateId)},ye));Jd&&(zb=wc.a.call(null,Jd,zb));return this.Lze(xc,pa,ye,zb,Vb)}}Lze(pa,zb,Vb,xc,Sc){return sb(this.xa,
pa,zb,Vb,xc,null,null,Sc)}rRi(pa){var zb=pa.Result;void 0!=zb&&(zb=zb.MergeResultState,Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7464389_RetryDoPendingMergeAfterBailout")&&2!==zb?this.gnc=[zb,pa.MergeCount]:3===zb&&(e.ULS.sendTraceTag(523317954,0,50,"DoPendingMergeSender.onDoPendingMergeSucceeded: Aborted merge."),this.sbj()))}sbj(){this.raiseEvent(zc.qzd,new Sys.EventArgs)}rbj(pa,zb){this.raiseEvent(zc.lzd,new Jc(pa,zb))}qRi(){this.VEd--;if(this.gnc){const pa=this.gnc;this.gnc=null;this.rbj(...pa)}}}
zc.qzd="MWA";zc.lzd="MDO";Object(b.a)(zc,"DoPendingMergeSender",mc.a,[715,716]);class gd{constructor(pa=!1){this.divergenceOnResponse=this.adjustedDidntChangeWithDivergence=this.editBoxDivergence=this.differentSheetAdjust=this.parallel=this.errors=this.nonContinuous=this.divergenceOnViewportReady=this.adjusted=this.adjustedDidntChange=0;this.Jei=pa}get reportName(){return this.Jei?"SelectionAdjustInHiddenDocument":"SelectionAdjust"}}Object(b.a)(gd,"SelectionAdjustSessionEndsReport",null,[596]);var Va=
a(41);class Eb{constructor(pa,zb,Vb,xc,Sc,Jd){this.jb=pa;this.dG=zb;this.f9=Vb;this.SXb=xc;this.q4d=Sc;this.GL=Jd}get activeCell(){return this.dG}get selectedRanges(){return this.f9}get es(){let pa=!1;if(null===this.GL||void 0===this.GL)pa=!0;else if(this.GL>=this.selectedRanges.length||!this.selectedRanges[this.GL].contains(this.activeCell))e.ULS.sendTraceTag(521200010,0,50,`SelectionState.indexOfActiveRange: the index of the adjusted active range has changed. indexOfActiveRange: ${this.GL}, selectedRangesLength: ${this.selectedRanges.length}`),
pa=!0;pa&&(this.GL=this.v0g());return this.GL}get activeRange(){return 0>this.es?this.activeCell:this.selectedRanges[this.es]}get sheetName(){return this.SXb}get activeItemName(){return this.q4d}get gqg(){return 1===this.selectedRanges.length}Wmg(pa){let zb=this.selectedRanges.map(Vb=>this.zWj(Vb,this.q4d));for(let Vb of zb)if(Vb)for(let xc of Vb)if(xc.uk&&xc.ae.Revision<pa)return!1;return!0}wTj(){var pa;return{SheetName:this.sheetName,ActiveCell:null===(pa=this.activeCell)||void 0===pa?void 0:pa.toString(),
TopLeft:void 0,SelectedRanges:Va.r(this.selectedRanges,this.jb)}}toString(){var pa,zb;return`active cell: ${null!==(zb=null===(pa=this.activeCell)||void 0===pa?void 0:pa.toString())&&void 0!==zb?zb:"null"} selection: ${Zb.f(this.selectedRanges,Vb=>{var xc;return null!==(xc=null===Vb||void 0===Vb?void 0:Vb.toString())&&void 0!==xc?xc:"null"}).join(",")}`}equals(pa){return pa?this.activeCell.equals(pa.activeCell)&&Va.Q(this.selectedRanges,pa.selectedRanges)&&this.sheetName===pa.sheetName:!1}v0g(){for(let [pa,
zb]of this.selectedRanges.entries())if(null===zb||void 0===zb?0:zb.contains(this.activeCell))return pa;return-1}zWj(pa,zb){var Vb;const xc=qa.h(this.jb).Ca.c4a(pa,zb);xc||e.ULS.sendTraceTag(522803340,0,50,`SelectionState.tryGetBlockCacheItemsFromRange: no items found. range: ${null!==(Vb=null===pa||void 0===pa?void 0:pa.toString())&&void 0!==Vb?Vb:"null"} ; activeItemNameIsDefined: ${!!zb}`);return xc}}Object(b.a)(Eb,"SelectionState",null,[]);var hc=a(218),Ab=a(753);class Bb{constructor(pa){this.UAc=
0;this.AG=this.$E=null;this.F4d=new gd;this.G4d=new gd(!0);this.EH=0;this.HRj=!1;this.OIi=1E4;this.dd=()=>{this.ZIe()};this.vj=()=>{this.RZc(!0,!1)};this.n$a=()=>{this.RZc(!1,!1)};this.$=pa;this.gridView=qa.h(this.$);this.gridView.Ca.Tv(this.vj);this.gridView.Ca.Ns(this.n$a);this.gridView.Ca.lqe(this.n$a);this.gridView.Ca.v9(this.n$a);this.$.Lk(this.dd);this.ZIe()}Urj(pa){let zb=null,Vb=null,xc=()=>{this.RNi()};this.ygf()?(this.jP.parallel++,e.ULS.sendTraceTag(526390086,0,15,`SelectionAdjustManager.runRequestWithSelectionAdjust: Skipping parallel request. Current adjustedSelection is defined : ${!!this.AG}`)):
(zb=(Sc,Jd)=>{this.SNi(Sc,Jd)},Vb=this.UAj());return null===pa||void 0===pa?void 0:pa(Vb,zb,xc)}Yui(){return!this.ygf()&&this.Oaa().gqg}UAj(){var pa;e.ULS.shipAssertTag(525135961,0,0===this.EH,"SelectionAdjustManager.setPreRequestState: unexpected state");this.AG&&(this.jP.errors++,e.ULS.sendTraceTag(526960090,0,10,`SelectionAdjustManager.setPreRequestState: About to ignore a defined Adjusted selection: ${this.AG.toString()}`));this.AG=null;this.$E=this.Oaa();let zb=null;const Vb=null===(pa=this.$E)||
void 0===pa?void 0:pa.wTj();Vb&&(zb={ActiveSheetName:this.$E.sheetName,SheetViewportStateChanges:[Vb]});this.EH=1;return zb}RNi(){e.ULS.shipAssertTag(525135960,0,1===this.EH,"SelectionAdjustManager.onAdjustedRequestFailed: unexpected state");this.jP.errors++;this.EH=2;this.fr()}SNi(pa,zb){try{e.ULS.shipAssertTag(525135959,0,1===this.EH,"SelectionAdjustManager.onAdjustedSelectionReady: unexpected state"),this.UAc=zb,zb=2,this.$E?pa?(this.AG=this.rEj(pa))?(zb=7,this.$E.equals(this.AG)?this.$E.equals(this.Oaa())?
(this.jP.adjustedDidntChange++,zb=4):(this.jP.adjustedDidntChangeWithDivergence++,zb=5):this.$E.sheetName!=this.AG.sheetName?(this.jP.differentSheetAdjust++,zb=10):this.$E.equals(this.Oaa())||(this.jP.divergenceOnResponse++,zb=6,this.aYf())):this.jP.errors++:(this.jP.errors++,e.ULS.sendTraceTag(537155412,0,15,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted returned null, initialSelection: ${this.$E.toString()}`)):(this.jP.errors++,e.ULS.sendTraceTag(537155413,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: Adjusted selection results returned when not waiting for them, adjusted:  ActiveCell: ${null===
pa||void 0===pa?void 0:pa.ActiveCell}`)),this.EH=zb}catch(Vb){this.EH=12,e.ULS.sendTraceTag(525135958,0,10,`SelectionAdjustManager.OnAdjustedSelectionReady: caught Exception ${Vb}`)}finally{7!=this.EH?this.fr():this.RZc(!1,!0)}}dispose(){this.gridView.Ca.Nw(this.vj);this.gridView.Ca.Kq(this.n$a);this.gridView.Ca.WVf(this.n$a);this.gridView.Ca.GQa(this.n$a);this.$.pl(this.dd)}ygf(){return 1===this.EH||7===this.EH}rEj(pa){let zb;if(!({range:zb}=Va.Y(pa.ActiveCell,this.$.va)).returnValue)return e.ULS.sendTraceTag(537155411,
0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: Unable to extract active cell ${pa.ActiveCell}`),null;let Vb=[];const xc=this.$.na,Sc=!!xc&&2===xc.JF;if(pa.SelectedRanges)Vb=Va.g(pa.SelectedRanges.Ranges);else if(!Sc)return e.ULS.sendTraceTag(522826913,0,10,`SelectionAdjustManager.sheetViewportStateToSelectionState: SelectedRanges is null, active sheet exists: ${!!xc}`),null;return new Eb(this.$,zb,Vb,pa.SheetName,this.$E.activeItemName,this.$E.es)}Oaa(){const pa=this.$.na;if((null===
pa||void 0===pa?0:pa.activeCell)&&pa.selectedRanges&&pa.sheetName)return new Eb(this.$,pa.activeCell,pa.selectedRanges,pa.sheetName,this.$.activeItemName,pa.es);e.ULS.sendTraceTag(525135957,0,15,`SelectionAdjustManager.getCurrentSelection: invalid activeItem. activeItem null: ${!pa}, activeCell null: ${!(null===pa||void 0===pa?0:pa.activeCell)}, selectedRanges null: ${!(null===pa||void 0===pa?0:pa.selectedRanges)}, sheetName null: ${!(null===pa||void 0===pa?0:pa.sheetName)}`);return null}ZIe(){this.$.da.gb(276,
()=>{const pa=hc.a(this.$);pa.eY(this.F4d);pa.eY(this.G4d)})}RZc(pa,zb){var Vb;if(this.cti(pa))if(8===this.EH)e.ULS.sendTraceTag(523106438,0,15,"SelectionAdjustManager.attemptAdjustSelection: skipping as was already adjusted");else{zb&&e.ULS.sendTraceTag(524039250,0,50,"SelectionAdjustManager.attemptAdjustSelection: viewport ready on response");try{e.ULS.shipAssertTag(525135956,0,7===this.EH,"SelectionAdjustManager.attemptAdjustSelection: unexpected state"),this.$E.equals(this.Oaa())?(null===(Vb=
this.gridView)||void 0===Vb?0:Vb.fb)?(this.jP.editBoxDivergence++,this.EH=11):(pa=0,pa=this.AG.es,-1==pa?(this.jP.errors++,e.ULS.sendTraceTag(522826912,0,10,"SelectionAdjustManager.attemptAdjustSelection: invalid indexOfActiveRange")):(this.jP.adjusted++,this.EH=8,this.gridView.ha.ty(this.AG.selectedRanges,pa,this.AG.activeCell,0,void 0,"SelectionAdjust"))):(this.jP.divergenceOnViewportReady++,this.aYf(),this.EH=9)}catch(xc){this.EH=12,e.ULS.sendTraceTag(525135955,0,10,`SelectionAdjustManager.attemptAdjustSelection: caught Exception ${xc}`)}finally{this.fr()}}}cti(pa){if(!this.AG)return!1;
if(!this.$E)return e.ULS.sendTraceTag(537155409,0,10,`SelectionAdjustManager.attemptAdjustSelection: initialSelection is null while adjustedSelection isn't null, adjustedSelection: ${this.AG.toString()}`),!1;if(qa.h(this.$).Ca.ovf<this.UAc)return!1;if(pa||this.HRj)e.ULS.sendTraceTag(528590295,0,15,"SelectionAdjustManager.attemptAdjustSelection: got to blockCacheConsistent while pending for selection adjust");else if(!this.$E.Wmg(this.UAc)||!this.AG.Wmg(this.UAc))return!1;return!0}fr(){this.$E=this.AG=
null;this.EH=0}aYf(){const pa=this.Oaa();e.ULS.sendTraceTag(537155408,0,50,`SelectionAdjustManager.ReportDivergence: initial: ${this.$E.toString()} current: ${pa?pa.toString():""} adjusted: ${this.AG.toString()} sheetSameBetweenInitialAndAdjusted: ${this.$E.sheetName===this.AG.sheetName} sheetSameBetweenInitialAndCurrent: ${this.$E.sheetName===(pa?pa.sheetName:null)}`)}get jP(){return Ab.a.rH(this.OIi)?this.G4d:this.F4d}}Object(b.a)(Bb,"SelectionAdjustManager",null,[714,2]);class ec extends na.a{constructor(pa,
zb,Vb=null){super();this.aDa=this.Zfc=this.T5a=this.d0a=null;e.ULS.sendTraceTag(537155417,0,50,"MergeSuspensionManager.ctor started");this.$=pa;this.kXa=new ha(pa);this.vAa=new Bb(this.$);this.QIa=new zc(this.$.oa.xa,this.$,void 0,void 0,this.vAa);this.lgi(pa,Vb);this.Hfa=new ma(this.aDa,this.kXa,this.QIa);this.uNd=new oc(pa,this.Hfa,zb,this.QIa);Ba.EwaSettings.ra(230)&&(this.Zfc=new lb(pa,this));e.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created")}f0b(pa){this.Hfa.f0b(pa)}evc(pa){this.Hfa&&
this.Hfa.evc(pa)}get Bha(){return this.aDa}get Bma(){return this.kXa}get N5(){return this.Hfa}Rza(pa,zb){this.aDa.Rza(pa,zb)}I_d(pa){this.aDa.I_d(pa)}ZOa(pa,zb=""){this.kXa.ZOa(pa,zb)}dispose(){this.Zfc&&(this.Zfc.dispose(),this.Zfc=null);this.vAa&&this.vAa.dispose();this.QIa.dispose();this.uNd&&(this.uNd.dispose(),this.uNd=null);this.Hfa&&(this.Hfa.dispose(),this.Hfa=null);this.kXa.dispose();this.kXa=null;this.aDa.dispose();this.aDa=null;this.d0a&&(this.d0a.dispose(),this.d0a=null);this.T5a&&(this.T5a.dispose(),
this.T5a=null);this.$=null;super.dispose()}NIb(){this.Hfa.Ubj()}static xbc(pa){let zb=0;for(let Vb of pa){if(2==Vb)return 2;1==Vb&&(zb=1)}return zb}lgi(pa,zb){this.aDa=new Ja(this.QIa,this.kXa);zb?Object(wa.a)(Oa,zb)?this.Rza(zb,Object(I.a)(Oa,zb).NH):Object(wa.a)(Yb,zb)?this.Rza(zb,Object(I.a)(Yb,zb).NH):this.Rza(zb,0):(this.d0a=new Yb(pa),this.T5a=new Oa(pa),this.Rza(this.d0a,this.d0a.NH),this.Rza(this.T5a,this.T5a.NH))}}Object(b.a)(ec,"MergeSuspensionManager",na.a,[685,2]);class Qd extends Fa.a{constructor(pa){super();
this.Pc=pa;this.Db()}create(){e.ULS.sendTraceTag(537155419,0,50,"MergeSuspensionFactory.Create");this.nb(this.Pc.da.Aa(343)||this.Pc.da.Ha(343,new ec(this.Pc,R.a.instance)))}static ka(pa){e.ULS.sendTraceTag(537155418,0,50,"MergeSuspensionFactory.Attach");pa.da.Ha(344,new Qd(pa))}}Object(b.a)(Qd,"MergeSuspensionFactory",Fa.a,[]);var dc=a(50),dd=a(37),jd=a(89),md=a(99),vd=a(59),wd=a(13);class Pd{}Pd.tAi=3;Pd.connected=0;Object(b.a)(Pd,"ConnectionStateConstants",null,[]);var ic=a(112),cd=a(120),Hd=a(45);
class he{constructor(pa,zb,Vb){var xc;this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.jAf=(Sc,Jd)=>{this.blockedOperationsCount++;Sc=`${Jd.componentName}_${Jd.actionName}_${Jd.details})`;
this.blockedActions[Sc]=this.blockedActions[Sc]?this.blockedActions[Sc]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};this.REd=Sc=>{this.durationUntilUserInactive=ic.getElapsedSeconds(this.startTime,Wb.a.Ya.Ub);Sc.AMd(this.REd)};this.GV=()=>{this.hasTabbedOut=!0};this.Ica=(Sc,Jd)=>{Jd.ZLf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=cd.a(Wb.a.Ya,this.startTime),this.toastRaiser=Jd.toastRaiser,this.isToastShown=!0)};this.startTime=pa;this.durationUntilToastShownMs=
0;this.blockedActions={};this.isToastShown=Vb;if(null===(xc=zb.ea)||void 0===xc?0:xc.Be)this.wasUserActiveOnPIStart=zb.ea.Be.rr;this.Aj(zb);this.isDialogShown=0<zb.qb.oR;pa=zb.da.Aa(183);this.isTaskPaneShown=!!pa&&pa.isVisible&&!pa.isCollapsed;this.isTaskPaneCollapsed=!!pa&&pa.isVisible&&pa.isCollapsed}I4f(){this.durationMs=cd.a(Wb.a.Ya,this.startTime)}$Dd(pa){var zb;this.I4f();Hd.a(pa).Zuc(this.jAf);Hd.a(pa).Sf.$uc(this.Ica);pa.da.gb(291,Vb=>{Vb.ocb(this.GV)});if(null===(zb=pa.ea)||void 0===zb?0:
zb.Be)pa.ea.Be.AMd(this.REd),this.wasUserActiveOnPIEnd=pa.ea.Be.rr}Aj(pa){Hd.a(pa).Y_b(this.jAf);this.isToastShown?this.toastRaiser="Immediate":Hd.a(pa).Sf.FXc(this.Ica);pa.da.gb(291,zb=>{this.hasTabbedOut=zb.Wh;zb.ZFa(this.GV)});this.wasUserActiveOnPIStart&&pa.ea.Be.Ure(this.REd)}}Object(b.a)(he,"PartialInteractivityData",null,[]);var Lb=a(1140);class Ic extends he{constructor(pa,zb,Vb,xc,Sc,Jd){super(pa,zb,xc);this.swappedOffline=this.swappedByOffline=!1;this.lastFailedRequestToOnlineTimeGapSec=
this.longestDurationBetweenFailedRequestsSec=this.averageDurationBetweenFailedRequestsSec=0;this.errorDataDuringConnectivityIssuesMode=this.disconnectionSource=null;this.failedRequests=[];this.triggeringRequest=null;this.type=4;this.swappedOffline=Vb;this.disconnectionSource=Enum.toString(Lb.a,Sc);this.triggeringRequest=Jd}nQi(pa,zb){this.swappedByOffline=zb;this.$Dd(pa)}Hyj(pa){this.errorDataDuringConnectivityIssuesMode=pa}jej(pa){10>this.failedRequests.length&&(pa=pa+"_"+ic.getElapsedSeconds(this.startTime,
Wb.a.Ya.Ub).toString(),this.failedRequests.push(pa))}}Object(b.a)(Ic,"ConnectivityIssuesData",he,[]);var Ob=a(165),Kc=a(129),Ac=a(115);class Yc{}Yc.cqh="DuringWork";Yc.connectivityIssues="ConnectivityIssues";Yc.offline="Offline";Object(b.a)(Yc,"UnavailabilityTypes",null,[]);var td=a(52);class $d{constructor(pa){this.Pkc=this.data=null;this.Wbd=0;this.KFe=null;this.tBf=(zb,Vb)=>{Vb.OL?(this.data=new Ic(Wb.a.Ya.Ub,this.$,5===Vb.poa,0!==Vb.poa,this.$.Qe.disconnectionSource,this.KFe),this.Pkc=this.$.Qe.Gpf,
this.Wbd=1,this.$.oa.Qe.xPg(this.wm),Ob.a(this.$).oXc(this.T0f)):(this.data.nQi(this.$,5===Vb.poa),this.$.oa.Qe.fXf(this.wm),this.data.lastFailedRequestToOnlineTimeGapSec=ic.getElapsedSeconds(this.Pkc,Wb.a.Ya.Ub),Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?td.b().VLb(557682689,0,50,Yc.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",vd.a.Dc(this.data)):
e.ULS.sendTraceTag(557682689,0,50,`ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: ${vd.a.Dc(this.data)}`),this.data&&this.data.isToastShown&&md.Health.instance.recordQosError(Kc.a.A5g,[Ac.a.Alc],!0,!1,!1,!1,null),Ob.a(this.$).ULd(this.T0f),this.data=null)};this.T0f=(zb,Vb)=>{this.data.Hyj(Vb.xU)};this.wm=(zb,Vb)=>{this.data.jej(Vb.context.methodName);zb=Wb.a.Ya.Ub;Vb=ic.getElapsedSeconds(this.Pkc,zb);this.Pkc=zb;Vb>this.data.longestDurationBetweenFailedRequestsSec&&
(this.data.longestDurationBetweenFailedRequestsSec=Vb);this.Wbd++;this.data.averageDurationBetweenFailedRequestsSec=this.i0g(Vb)};this.qBf=(zb,Vb)=>{this.KFe=Vb.XVj};this.$=pa;Hd.a(this.$).Sf.uqe(this.tBf);this.$.Qe.tqe(this.qBf)}dispose(){this.$&&(Hd.a(this.$).Sf.fWf(this.tBf),this.$.Qe&&this.$.Qe.eWf(this.qBf));this.data&&this.$.oa.Qe.fXf(this.wm);this.$=null}i0g(pa){const zb=this.Wbd-1;return(this.data.averageDurationBetweenFailedRequestsSec*(zb-1)+pa)/zb}}Object(b.a)($d,"ConnectivityIssuesTelemetryManager",
null,[2]);var be=a(871),ke=a(8),Pe=a(1139),Dd=a(1138);class ge{constructor(pa){this.U_f=null;this.Yud=this.zzd=this.zFb=this.AFb=0;this.XTd=!1;this.d4c=this.SSa=this.vAc=this.R9a=null;this.r4c=0;this.lvj=()=>{if(12E4>this.$.ea.Be.yfb)for(let zb of this.vAc)zb.runTest();else this.RWd("UserInactive")};this.Onj=zb=>{zb=Sys.Serialization.JavaScriptSerializer.serialize(zb);e.ULS.sendTraceTag(388821830,0,50,zb)};this.enj=zb=>{if(zb){var Vb=this.d4c[zb.testIteration.toString()];Vb?Vb.push(zb):(Vb=[zb],this.d4c[zb.testIteration.toString()]=
Vb);if(Vb.length===this.U_f.length){Vb=Sys.Serialization.JavaScriptSerializer.serialize(Vb);if(this.$&&this.$.Qe){if(zb.EstimatedLatency=this.$.Qe.Pwe,this.$.Qe.Pwe>this.$.Wu.ExcelRountripThresholdMs){e.ULS.sendTraceTag(570712144,0,50,`Periodic ping tests results when network is slow: ${Vb}, consequtive slow ping iteration #: ${this.r4c++}`);return}}else e.ULS.sendTraceTag(537155209,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");e.ULS.sendTraceTag(570712142,
0,50,`Periodic ping tests results: ${Vb}`);this.r4c=1}}};this.eh=(zb,Vb)=>{zb=Vb.context.methodName;if(zb===ke.a.Mxb||zb===ke.a.Bva)this.zFb++,zb=Date.now(),this.ZFj(zb)&&(this.zFb=0,this.Yud=zb,this.dOj())};this.Hca=()=>{this.tWd("OnThrottledUserActivity")};this.GV=()=>{this.RWd("OnDocumentHidden")};this.TH=()=>{this.tWd("OnDocumentUnhidden")};this.$=pa;if(this.YTd=this.S3g())this.U_f=[Dd.a.aGc],this.r4c=1,this.d4c={},this.$.ea.Be.A9(this.Hca),this.$.da.gb(291,zb=>{zb.ZFa(this.GV);zb.Xra(this.TH)})}dispose(){this.$&&
(this.XTd&&this.$.oa&&0<this.R9a.count&&this.$.oa.ps(this.eh),this.YTd&&(this.RWd("Dispose"),this.$.ea.Be.Yza(this.Hca)))}Qfi(){Ba.EwaSettings.ra(199)&&this.$7i();this.YTd&&this.a8i()}mgi(){this.zFb=this.AFb;this.Yud=0;var pa={};if(!this.R9a){this.R9a=new Z.a;const zb=Pe.a.Fed(this.Onj,"InitSampleMeasurement",this.$);for(const Vb of zb)pa[Vb.vmd]=Vb.baseUrl,this.R9a.add(Vb)}pa=Sys.Serialization.JavaScriptSerializer.serialize(pa);e.ULS.sendTraceTag(537155210,0,50,`Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: ${this.AFb}, numberOfRequestFromTheLastNetworkMeasurement: ${this.zFb}, testParams: ${pa} `);
0<this.R9a.count&&this.$.oa.$q(this.eh)}dOj(){for(let pa of this.R9a)pa.runTest()}tWd(pa){this.SSa&&this.SSa.gp||(e.ULS.sendTraceTag(537155208,0,50,`NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: ${pa}`),this.SSa=R.a.instance.yC(this.lvj,5E3,ta.a.$Lj),this.SSa.eV())}RWd(pa){this.SSa&&this.SSa.gp&&(e.ULS.sendTraceTag(537155207,0,50,`NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: ${pa}`),this.SSa.cancel())}ZFj(pa){return this.zFb>=this.AFb&&pa-this.Yud>
this.zzd}S3g(){return ge.K_f(this.$.ya.SlowNetworkMeasurementsSamplePercentage)}$7i(){this.AFb=this.$.ya.NumberOfRequestToWaitPerNetworkMeasurement;this.zzd=1E3*this.$.ya.MinTimeBetweenNetworkMeasurementInSec;const pa=this.$.ya.NetworkMeasurementsSamplePercentage;0<this.AFb&&0<this.zzd&&(this.XTd=ge.K_f(pa))&&this.mgi()}a8i(){if(!this.vAc){this.vAc=new Z.a;const pa=Pe.a.Fed(this.enj,"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[Dd.a.aGc]);for(const zb of pa)this.vAc.add(zb);this.$.ea.Be.rr&&
this.tWd("PrepareAndInitSlowNetworkTests")}}static K_f(pa){return 100*Math.random()<pa}}Object(b.a)(ge,"NetworkMeasurement",null,[2]);var ne=a(131),ce=a(799);class we{constructor(pa){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=[];this.sessionID=pa}get count(){return this._count}get cU(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}D_j(){this.cU&&
this.cU.I4f()}ZJg(pa){this.allOfflinePartialInteractivitiesDataInSession.push(pa);this._count++}}Object(b.a)(we,"OfflinePartialInteractivitiesDataForLog",null,[]);class ve extends he{constructor(pa,zb,Vb){super(pa,zb,Vb);this.timeFromLastOffline=0;this._errorDataDuringOfflineMode=null;this.timeFromLastOffline=-1;this.type=5}mCj(pa){this.timeFromLastOffline=pa}Iyj(pa){this._errorDataDuringOfflineMode=pa}}Object(b.a)(ve,"OfflinePartialInteractivityData",he,[]);class Re{constructor(pa,zb){this.FOa=this.cU=
null;this.OHd=-1;this.Ivb=null;this.Apf=z.Task.delay(0);this.M$a=(Vb,xc)=>{xc.OL?this.zXi(xc.poa):this.AXi()};this.Ica=(Vb,xc)=>{5===xc.ZLf&&this.t3a()};this.U0f=(Vb,xc)=>{this.cU.Iyj(xc.xU)};this.t3a=()=>{this.FOa.D_j();this.Lsj(Re.RFd,Sys.Serialization.JavaScriptSerializer.serialize(this.FOa))};this.Enj=Vb=>{if(Vb=Vb.result)this.nng=!0,e.ULS.sendTraceTag(576811915,0,50,`OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: ${Vb}`)};
this.Xhj=()=>{this.nng&&(this.$?dd.TaskExtensions.za(this.indexedDB.o8c(Re.RFd),()=>{e.ULS.sendTraceTag(537155204,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.la):e.ULS.sendTraceTag(537155203,0,10,"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};this.KOa=()=>{if(this.FOa&&0<this.FOa.count){const Vb=Sys.Serialization.JavaScriptSerializer.serialize(this.FOa);
e.ULS.sendTraceTag(560791644,0,50,`OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: ${Vb}`)}};this.$=pa;this.indexedDB=zb;this.nng=!1;this.indexedDB.Fe()&&(this.indexedDB.initialize(Re.Hzb,Re.Izb),this.$mj(),this.FOa=new we(this.$.ya.UserSessionId),Hd.a(this.$).Sf.zXc(this.M$a));this.Dm=ne.a.instance.NG();this.Dm.ka("beforeunload",this.KOa)}dispose(){this.$&&Hd.a(this.$)&&Hd.a(this.$).Sf.gMd(this.M$a);jd.a.Ja(this.Ivb);this.$=this.Ivb=null}zXi(pa){this.cU=
new ve(Wb.a.Ya.Ub,this.$,0!==pa);this.cU.mCj(-1!==this.OHd?window.performance.now()-this.OHd:-1);this.FOa.ZJg(this.cU);Hd.a(this.$).Sf.FXc(this.Ica);this.t3a();this.Ivb=R.a.instance.yC(this.t3a,Re.XIh,ta.a.t3a);Ob.a(this.$).oXc(this.U0f)}AXi(){this.cU.$Dd(this.$);this.t3a();jd.a.Ja(this.Ivb);this.Ivb=null;this.OHd=window.performance.now();Hd.a(this.$).Sf.$uc(this.Ica);Ob.a(this.$).ULd(this.U0f);this.fnj()}Lsj(pa,zb){this.$?this.Apf=dd.TaskExtensions.za(this.Apf,()=>{this.indexedDB.jdb(new ce.a(pa,
zb))},this.$.la):e.ULS.sendTraceTag(537155205,0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")}$mj(){const pa=this.$.la;dd.TaskExtensions.za(dd.TaskExtensions.za(this.indexedDB.zKa(Re.RFd),this.Enj,pa),this.Xhj,pa)}fnj(){if(this.cU){const pa=Sys.Serialization.JavaScriptSerializer.serialize(this.cU);Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?td.b().VLb(560791645,0,50,Yc.offline,this.cU.durationMs,
"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",pa):e.ULS.sendTraceTag(560791645,0,50,`OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: ${pa}`)}this.cU&&this.cU.isToastShown&&md.Health.instance.recordQosError(Kc.a.B3j,[Ac.a.Alc],!0,!1,!1,!1,null)}}Re.Hzb="NetworkAvailability";Re.Izb="NetworkAvailabilityData";Re.RFd="partialInteractivityData";Re.XIh=3E3;Object(b.a)(Re,
"OfflineModeTelemetryManager",null,[2]);var rf=a(1319);const We=pa=>{pa.isSuccess||(pa=Sys.Serialization.JavaScriptSerializer.serialize(pa),e.ULS.sendTraceTag(509669840,0,10,pa))};class Ye{constructor(pa,zb){this.Nla=this.BAd=this.czf=null;this.$=pa;Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&ba.a.Cf||(this.czf=new Re(pa,zb));Ba.EwaSettings.ra(199)&&(this.BAd=new ge(this.$),this.BAd.Qfi());!Ba.EwaSettings.ra(483)||Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&
ba.a.Cf||(this.Nla=new be.NetworkConnectionHealthChecker(this.$));this.l9g=new $d(this.$);Ba.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.1CdnDarkTestEnabled",!1)&&(pa=this.$,zb=Ba.EwaSettings.getStringFeatureGate("Microsoft.Office.Excel.1CdnDarkTestTargetUrl",""),""!==zb&&(new rf.a(pa,"1CDN",zb,We,"runOneCdnNetworkTest")).runTest())}dispose(){jd.a.Ja(this.czf);jd.a.Ja(this.BAd);jd.a.Ja(this.Nla);jd.a.Ja(this.l9g);this.$=null}}Object(b.a)(Ye,"NetworkConnectionTelemetryManager",null,[2]);
class bf extends he{constructor(pa,zb,Vb,xc){super(pa,zb,Vb);this.wasInteruptedByOfflineMode=!1;this.type=xc;this.wasInteruptedByOfflineMode=!1}M$a(){this.wasInteruptedByOfflineMode=!0}}Object(b.a)(bf,"SilentReopenData",he,[]);class Ve{constructor(pa){this.r7=null;this.WIf=(zb,Vb)=>{this.TIf(Vb,3)};this.lFf=(zb,Vb)=>{this.TIf(Vb,2)};this.$=pa;this.Sf=Hd.a(this.$).Sf;this.Sf.bre(this.lFf);this.Sf.bPg(this.WIf)}dispose(){this.Sf.GWf(this.lFf);this.Sf.Nlj(this.WIf);this.r7=this.Sf=this.$=null}TIf(pa,
zb){pa.OL?this.r7=new bf(Wb.a.Ya.Ub,this.$,0!==pa.poa,zb):(5===pa.poa&&(this.r7.wasInteruptedByOfflineMode=!0),3!==pa.poa&&2!==pa.poa||e.ULS.sendTraceTag(537155202,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),this.r7.$Dd(this.$),2===zb?Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?td.b().WLb(571289604,0,50,Yc.offline,this.r7.durationMs,this.r7):
e.ULS.sendTraceTag(571289604,0,50,vd.a.Dc(this.r7)):Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?td.b().WLb(542782150,0,50,Yc.cqh,this.r7.durationMs,this.r7):e.ULS.sendTraceTag(542782150,0,50,vd.a.Dc(this.r7)),this.r7=null)}}Object(b.a)(Ve,"SilentReopenPartialInteractivityTelemetryManager",null,[2]);class Za extends mc.a{constructor(pa,zb,Vb=!0){super();this.x0=this.V4b=this.GOa=this.aoa=this.NSa=null;this.lxf=0;this.duc=this.bcb=this.ccb=!1;this.mxf=
this.documentVisibilityObserver=null;this.tqa=!1;this.snd=this.A7=0;this.NBb=!1;this.kag=0;this.PTd=!1;this.I0=null;this.XFf=()=>{e.ULS.sendTraceTag(537155219,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");this.snc(1,!1)};this.TH=()=>{this.Hka||this.XDb?window.setTimeout(()=>{this.WYd()},this.lxf):this.WYd();this.documentVisibilityObserver.Wza(this.TH);this.NBb=!1};this.$f=()=>{e.ULS.sendTraceTag(537155218,0,50,`NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:${this.XDb}, IsInDuringWorkSilentReopenMode:${this.lmc&&
!this.tqa}`);this.XDb&&this.sne();this.lmc&&!this.tqa&&this.pne();qa.h(this.$).mc.$l(this.$f);this.ccb=this.bcb=!1};this.YFf=()=>{e.ULS.sendTraceTag(537155213,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.snc(1,!0);this.bcb&&!this.ccb&&qa.h(this.$).mc.$l(this.$f);this.bcb=!1};this.Hca=(xc,Sc)=>{this.snd=this.A7;this.A7=Sc.rCc};this.VIf=()=>{this.$&&(this.duc||(Qa.a(this.$).kQ(Na.a.sPa).JMg(this.gGf),this.$.Lk(this.dd),this.duc=!0),this.tqa=this.gmi(),this.snc(2,
!1))};this.gGf=()=>{var xc=Qa.a(this.$).Th;const Sc=xc.USg();xc=Zb.f(xc.Ds.gd.errors,Jd=>Jd.MessageIdName);e.ULS.sendTraceTag(545842889,0,50,`NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:${Sc}, IsB2W:${this.tqa}, Errors: ${vd.a.Dc(xc)}`);Sc&&(this.NSa?(this.tqa=!1,this.uKe(),this.uDc()):this.aoa&&(this.vKe(),this.uDc()))};this.dd=()=>{this.$?(e.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.tqa=
!1,this.x0&&this.x0.gp&&(jd.a.Ja(this.x0),this.x0=null),this.I0&&this.I0.gp&&(jd.a.Ja(this.I0),this.I0=null),this.snc(2,!0),this.uDc()):e.ULS.sendTraceTag(537155212,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};this.rBf=()=>{this.lwf(!0)};this.sBf=()=>{this.lwf(!1)};this.KXb=Pd.tAi;this.n4c=Pd.connected;this.$=pa;this.Qe=pa.oa.Qe;Vb&&(this.mxf=new Ye(pa,zb));this.$.da.gb(291,xc=>{this.documentVisibilityObserver=xc});this.lxf=this.$.ya.ExcelNetworkCheckAfterTabActivationDelayMs;
this.Qe.hre(this.XFf);this.Qe.rob(this.YFf);this.Qe.tqe(this.rBf);this.Qe.pMg(this.sBf);new Ve(this.$,this);this.Usf=this.$.ya.LongInactivityTimePeriodSeconds;this.$.ea.VXc(this.VIf);this.$.ea.Be.A9(this.Hca);this.kag=this.$.ya.SilentReopenDuringWorkDelayMs}get moi(){return this.tqa}get XDb(){return!(this.KXb&1)}get lmc(){return!(this.KXb&2)}get Hka(){return!!(this.n4c&2)}dispose(){this.Qe&&(this.Qe.MWf(this.XFf),this.Qe.ZJb(this.YFf),this.Qe.eWf(this.rBf),this.Qe.Cjj(this.sBf));this.NBb&&this.documentVisibilityObserver&&
(this.documentVisibilityObserver.Wza(this.TH),this.NBb=!1);this.$&&(this.duc&&this.uDc(),this.$.ea&&(this.$.ea.XWf(this.VIf),this.$.ea.Be&&this.$.ea.Be.Yza(this.Hca)));this.I0&&(this.I0.dispose(),this.I0=null);jd.a.Ja(this.mxf);this.$=null;super.dispose()}MGi(){this.PTd=!0}pne(){this.aoa||(this.aoa=Hd.a(this.$).Sf.zYa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))}gmi(){if(this.PTd)return this.PTd=!1,!0;const pa=this.A7>this.Usf||this.snd>this.Usf&&10>this.A7;
e.ULS.sendTraceTag(537155223,0,50,`NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:${this.A7}, Time gap between last two activities: ${this.snd}. return value:${pa}`);return pa}Rnj(){this.I0=R.a.instance.create(()=>{md.Health.instance.recordQosError(Kc.a.eMj,[Ac.a.Alc],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0)}EHg(){this.aoa||this.x0?e.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):
this.x0=R.a.instance.create(()=>{this.$?this.aoa?e.ULS.sendTraceTag(537155221,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):qa.h(this.$).fb?(this.bcb||(qa.h(this.$).mc.Km(this.$f),e.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),this.ccb=
!0,e.ULS.sendTraceTag(537155220,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):this.pne():e.ULS.sendTraceTag(537155222,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.kag,ta.a.bLj,void 0,!0)}lwf(pa){this.n4c=this.rze(2,pa,!0);this.rse()}snc(pa,zb){this.KXb=this.rze(pa,zb,!1);this.rse()}rze(pa,
zb,Vb){Vb=Vb?this.n4c:this.KXb;return zb?Vb|pa:Vb&~pa}WYd(){const pa=!!this.GOa,zb=!!this.NSa,Vb=!!this.aoa,xc=!!this.V4b;this.XDb&&!pa?this.DHg():!this.XDb&&pa&&this.Jjh();!this.lmc||zb||Vb?this.lmc||(zb?this.uKe():(Vb||this.x0&&this.x0.gp)&&this.vKe()):this.tqa?this.BHg():this.x0||this.EHg();this.Hka&&!xc?this.pfg(!0):!this.Hka&&xc&&this.pfg(!1)}DHg(){this.$?this.GOa?e.ULS.sendTraceTag(537155215,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):
qa.h(this.$).fb?(this.ccb||(qa.h(this.$).mc.Km(this.$f),e.ULS.sendTraceTag(537155217,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),this.bcb=!0,e.ULS.sendTraceTag(537155216,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.sne():e.ULS.sendTraceTag(537155214,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")}sne(){this.GOa||
(this.GOa=Hd.a(this.$).Sf.zYa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))}Jjh(){this.GOa&&(jd.a.Ja(this.GOa),this.GOa=null)}uKe(){this.NSa&&(jd.a.Ja(this.NSa),this.NSa=null);this.I0&&this.I0.gp&&this.I0.cancel();this.I0=null}vKe(){this.aoa&&(jd.a.Ja(this.aoa),this.aoa=null);this.x0&&(jd.a.Ja(this.x0),this.x0=null);this.ccb&&!this.bcb&&qa.h(this.$).mc.$l(this.$f);this.ccb=!1}BHg(){this.NSa||(this.NSa=Hd.a(this.$).Sf.zYa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",
void 0,wd.a.instance.ga(2189)));this.Rnj()}pfg(pa){pa?(this.V4b=Hd.a(this.$).Sf.zYa(4,"NetworkConnectionStateManager.ConnectivityIssues"),this.X$i()):(jd.a.Ja(this.V4b),this.V4b=null)}X$i(){if(this.$&&this.$.oa){const pa=this.$.oa.xa.Wb();ya.I(this.$.oa.xa,null,null,null,pa)}}uDc(){Qa.a(this.$).kQ(Na.a.sPa).Lq(this.gGf);this.$.pl(this.dd);this.duc=!1}rse(){this.documentVisibilityObserver||e.ULS.sendTraceTag(537155211,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");
this.documentVisibilityObserver&&this.documentVisibilityObserver.Wh?this.NBb||(this.documentVisibilityObserver.Xra(this.TH),this.NBb=!0,e.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.WYd()}}Object(b.a)(Za,"NetworkConnectionStateManager",mc.a,[765,2]);var Xb=a(105),ib=a(187);class Rb extends Fa.a{constructor(pa){super();this.$=pa;this.Db()}create(){Ba.EwaSettings.isChangeGateEnabled("OfficeVSO:7476522_IDBNewService2")?
void ib.a.resolve(Xb.i,{Tl:this.Xa}).then(pa=>{let zb=Object(Ca.a)(this.$.da,400,()=>new Za(this.$,pa));this.nb(zb)}):dd.TaskExtensions.za(dc.GetServiceTaskFactory.Oa(this.$.da,395,396,this.Xa),pa=>{let zb=Object(Ca.a)(this.$.da,400,()=>new Za(this.$,pa.result));this.nb(zb)},this.$.la,3)}static ka(pa){pa.da.Ha(401,new Rb(pa))}}Object(b.a)(Rb,"NetworkConnectionStateManagerFactory",Fa.a,[]);var lc=a(1278),nc=a(1181),Oc=a(1240),Ib=a(122),gc=a(109),Fc=a(151),Vc=a(324);class ed{constructor(pa){this.dOa=
this.fyd=this.gOa=this.xmc=0;this.Zxd=this.euf=null;pa?(this.Fmc=pa,this.rtb=Date.now,this.Bfh(),this.Bgj()):e.ULS.sendTraceTag(520955213,209,10,"Can not initialize PenMinutesManager because TaskManager is null")}HAj(){this.euf="Office.Excel.Online.Data.Activity.PenMinutes"}Bgj(){window.document.body.addEventListener("pointerenter",Object(v.a)(this,this.gqc,"onPointerEnter"));window.document.body.addEventListener("pointerleave",Object(v.a)(this,this.Fca,"onPointerLeave"));da.a.instance.Tb("Common.App.VisibilityManagement.IVisibilityManager").execute(pa=>
{pa.vre(Object(v.a)(this,this.wyb,"handleVisibilityChange"))})}gqc(pa){"pen"!==pa.pointerType||this.gOa||(this.gOa=Math.floor(this.rtb()/1E3),this.gOa<=this.xmc&&(this.gOa=this.xmc),this.fyd=0)}Fca(){this.Z$e()}Z$e(){const pa=Math.ceil(this.rtb()/1E3);this.gOa&&pa>this.xmc&&(this.fyd=pa,this.dOa+=this.fyd-this.gOa);this.xmc=pa;this.gOa=0}wyb(pa,zb){0!==zb.newState&&this.Z$e()}Bfh(){this.Zxd=new gc.a(4,2,6E4,Object(v.a)(this,this.CDi,"logPenUsage"));this.Fmc.fg(this.Zxd)}CDi(){0<this.dOa&&this.$2f(this.dOa);
this.dOa=0}$2f(pa){const zb=new Vc.a;zb.name=this.euf;const Vb=[];(pa=Ib.a.jh("PenInputSec",pa.toString(),3))&&Array.add(Vb,pa);zb.dataFields=Vb;Fc.a.sendActivityEvent(zb)}dispose(){0<this.dOa&&this.$2f(this.dOa);this.Fmc.Uo(this.Zxd)}}Object(b.a)(ed,"PenMinutesManager",null,[298]);class Sd{constructor(){this.WQc=this.$a=null}get name(){return"Common.App.PenMinutesManager"}Bh(pa){this.$a=pa;const zb=f.AFrameworkApplication.ji;this.$a.register(298,"Common.App.PenMinutesManager.IPenMinutesManager").qc().yc(()=>
new ed(zb))}init(){this.WQc=this.$a.resolve("Common.App.PenMinutesManager.IPenMinutesManager")}dispose(){this.WQc&&this.WQc.dispose()}static main(){P.a.instance.ii(new Sd)}}Object(b.a)(Sd,"PenMinutesManagerPackage",null,[3,4]);class Zd extends Fa.a{constructor(pa){super();this.$=pa;this.Db()}static ka(pa){pa.da.Ha(514,new Zd(pa))}create(){this.nb(Object(Ca.a)(this.$.da,513,()=>{Type.registerNamespace("Common.App.PenMinutesManager");Sd.main();const pa=da.a.instance.resolve("Common.App.PenMinutesManager.IPenMinutesManager");
pa.HAj();return pa}))}}Object(b.a)(Zd,"PenMinutesFactory",Fa.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");Type.registerNamespace("_Ewa");Object(c.a)();Object(Ma.a)();Object(Ta.a)();Object(Da.a)();Object(fa.a)();Object(nb.a)();Object(X.a)();Object(Oc.a)();Type.registerNamespace("Common.App.InProductMessaging");Y.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");ia.main();(()=>{ua.a.Fa(()=>{ua.a.Fa(fb.ka)})})();(()=>{ua.a.Fa(()=>{ua.a.Fa(mb.ka)})})();
ua.a.Fa(Qd.ka);ua.a.Fa(Rb.ka);(()=>{ua.a.Fa(pa=>{Zd.ka(pa)})})();Object(lc.a)();Object(nc.a)()},871:function(r,F,a){a.r(F);r=a(0);var c=a(7),b=a(15),e=a(322),f=a(29),d=a(11),h=a(265);class l{constructor(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}}Object(r.a)(l,"ConnectionErrorLogInfo",null,[]);var k=a(1138),t=a(1139);class n{constructor(w){this.Fmd=[k.a.Log,k.a.aGc];this.en=(m,u)=>{this.UN[u]=m;this.Ibi()&&this.Jnj("OnNetworkDownImmediatePing"===m.caller)};this.Nla=
w;this.$=w.$;this.UN={}}Qyi(){const w=t.a.Fed(this.en,"OnNetworkDownImmediatePing",this.$,this.Fmd);for(const m of w)m.runTest()}Ibi(){for(const w of this.Fmd)if(void 0===this.UN[w]||null===this.UN[w])return!1;return!0}Jnj(w){const m=this.$.Qe.Z4;w&&this.cPj(m);for(var u of this.Fmd)this.UN[u]=Sys.Serialization.JavaScriptSerializer.serialize(this.UN[u]);w=Date.now();u=this.Nla.xjd(a(871).NetworkConnectionHealthChecker.eFb).returnValue;const y=this.Nla.xjd(a(871).NetworkConnectionHealthChecker.YLb).returnValue;
this.UN.isOfflineMode=m;this.UN.networkDownBBAge=-1===u?u:w-u;this.UN.transientServerCommunicationFailuresBBAge=-1===y?y:w-y;this.Nla.businessBar?(this.UN.isNetworkDownBBShown=this.Nla.businessBar.JG(56).toString(),this.UN.isServerErrorBBShown=this.Nla.businessBar.JG(21).toString()):(this.UN.isNetworkDownBBShown="unknown",this.UN.isServerErrorBBShown="unknown");b.ULS.sendTraceTag(537155224,0,50,`ConnectionHealthTestsRunner.ReportPingResults: ${Sys.Serialization.JavaScriptSerializer.serialize(this.UN)}`)}cPj(w){const {NetworkConnectionHealthChecker:m}=
a(871),u={};for(const y of Object.keys(this.UN)){const v=this.UN[y];u[v.testName]=v.isSuccess}u.isOfflineMode=w;this.Nla.YWd(m.m4c,Sys.Serialization.JavaScriptSerializer.serialize(u))}}Object(r.a)(n,"ConnectionHealthTestsRunner",null,[]);a.d(F,"NetworkConnectionHealthChecker",function(){return z});class z{constructor(w){this.businessBar=this.E8a=null;this.KOi=(m,u)=>{u.U8c?this.MOi(u):this.LOi(u)};this.eh=(m,u)=>{m=u.context.methodName;this.E8a&&m===this.E8a&&(b.ULS.sendTraceTag(537155230,0,50,`NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "${this.E8a}" has now succeeded. Querying local storage for BB showings.`),
this.c9a(z.YLb,!0),this.E8a=null);this.isf(!1);this.U4b=!1};this.wm=(m,u)=>{f.a.dh(u.errors,[-1387426400])&&!this.U4b&&(this.U4b=!0,this.x8f()&&window.performance.mark(z.bzf),(new n(this)).Qyi())};this.Jf=()=>{this.isf(!0);this.c9a(z.eFb,!1);this.c9a(z.YLb,!1)};this.Jya=()=>{b.ULS.sendTraceTag(537155225,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");this.c9a(z.eFb,!0)};this.$=w;this.oa=this.$.oa;this.localStorage=new h.a;
this.U4b=!1;this.$.ea.Dk(this.Jf);this.oa.Qe.rob(this.Jya);this.oa.$q(this.eh);this.$.da.gb(5,m=>{this.businessBar=m;m.VLg(this.KOi)});this.oa.rx(this.wm)}dispose(){this.$&&(this.$.ea&&this.$.ea.Cn(this.Jf),this.oa&&(this.oa.Qe.ZJb(this.Jya),this.oa.ny(this.wm),this.oa.ps(this.eh)))}MOi(w){const m={};m.Timestamp=Date.now().toString();switch(w.G_a){case 21:this.E8a=w.data.FailedMethod;m.FailedMethod=this.E8a;this.YWd(z.YLb,JSON.stringify(m));break;case 56:this.YWd(z.eFb,JSON.stringify(m))}}LOi(w){switch(w.G_a){case 21:this.c9a(z.YLb,
!0);break;case 56:this.c9a(z.eFb,!0)}}YWd(w,m){try{this.localStorage.Fe()&&this.localStorage.setItem(w,m)}catch(u){b.ULS.sendTraceTag(537155231,0,15,`NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: ${u.message||"Unknown"}`)}}xjd(w){if(this.localStorage.Fe()&&(w=this.localStorage.GKa(w))&&"null"!==w){var m=JSON.parse(w);w=parseInt(m.Timestamp,10);m=Sys.Serialization.JavaScriptSerializer.serialize(m);return{returnValue:w,rawData:m}}return{returnValue:-1,
rawData:null}}isf(w){if(this.localStorage.Fe()){const m=this.localStorage.GKa(z.m4c);if(m&&"null"!==m){let u=-1;this.U4b&&(u=this.dUh(z.bzf,z.uNi));b.ULS.sendTraceTag(537155229,0,50,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: ${Sys.Serialization.JavaScriptSerializer.serialize(m)}, Period offline: ${u}, New session: ${w}`);this.localStorage.removeItem(z.m4c)}}}dUh(w,m){if(!this.x8f())return-1;window.performance.measure(m,w);w=window.performance.getEntriesByName(m);
return w.length&&w[w.length-1]?w[w.length-1].duration:(b.ULS.sendTraceTag(537155228,0,10,`NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name ${m} returned no measures.`),-1)}c9a(w,m){try{let u;const y=({rawData:u}=this.xjd(w)).returnValue;if(-1!==y){const v=Object(c.a)(new l,{timeElapsed:Date.now()-y,scenario:w,isNewSession:!m,rawData:u});b.ULS.sendTraceTag(537155227,0,50,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: ${JSON.stringify(v)}`)}this.localStorage.removeItem(w)}catch(u){b.ULS.sendTraceTag(537155226,
0,15,`NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: ${u.message||"Unknown"}`)}}x8f(){return d.HelperMethods.X_c&&e.a.kqb}}z.eFb="NetworkDownBBShown";z.YLb="ServerCommunicationFailureBBShown";z.m4c="ConnectionHealthPingRsults";z.bzf="offMoStMa";z.uNi="offMoDuMea";Object(r.a)(z,"NetworkConnectionHealthChecker",null,[2])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.pi.js.map/1f17b0b329546f039882af276ae14052/EwaDSEsNext.pi.js.map