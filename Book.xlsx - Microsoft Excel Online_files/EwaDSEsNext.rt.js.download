'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[25],{1141:function(r,F,a){a.d(F,"a",function(){return b});var c=a(512);const b=()=>{c.a.Bi(".ewa-excelLive-meetingPill-container{height:24px;transition:height 400ms cubic-bezier(.8,0,.2,1) 0s;position:absolute;width:100%;bottom:0;pointer-events:none;z-index:992}.ewa-excelLive-meetingPill-container-hidden{height:0 !important;overflow:hidden;transition:height 400ms cubic-bezier(.8,0,.2,1) 0s}.ewa-excelLive-meetingBoundary-container{position:fixed;z-index:992}")}},
1164:function(r,F,a){var c=a(9);r=a(0);var b=a(709),e=a(37),f=a(162),d=a(189);class h{constructor(ha,eb){this.$=ha;this.excelLiveManager=eb}Hc(){return!1}wc(ha,eb){switch(eb.command){case 1491932557:return f.h(this.$)&&2===this.excelLiveManager.wab.Tk;default:return!1}}executeCommand(ha,eb){ha=e.TaskExtensions.Tj();const ta=eb.command;switch(eb.command){case 1491932557:this.excelLiveManager.BBc();break;default:ha=d.a(ta)}return ha}Nc(){return!1}}Object(r.a)(h,"ExcelLiveCommandHandler",null,[222]);
class l extends b.a{constructor(ha){super(ha)}hd(){this.$.da.gb(473,ha=>{this.$c([new h(this.$,ha)])})}static ka(ha){b.a.Md(469,new l(ha))}}Object(r.a)(l,"ExcelLiveCommandHandlerFactory",b.a,[]);var k=a(15),t=a(226),n=a(84),z=a(8),w=a(49),m=a(24),u=a(41),y=a(21),v=a(223),C=a(34),x=a(5);const B=(ha,eb)=>{ha=document.getElementById(ha.Bb+x.a.E1a);return{TQb:ha.clientWidth/eb,PQb:ha.clientHeight/eb}};var H=a(48),I=a(270),U=a(608),S=a(11),G;(function(ha){ha[ha.complete=0]="complete";ha[ha.nonComplete=
1]="nonComplete";ha[ha.unknown=2]="unknown"})(G||(G={}));Object(r.b)("FollowerViewState",G);var D;(function(ha){ha[ha.none=0]="none";ha[ha.selection=1]="selection";ha[ha.scroll=2]="scroll";ha[ha.zoom=4]="zoom";ha[ha.default=0]="default"})(D||(D={}));Object(r.b)("UpdateType",D);var E=a(59),N;(function(ha){ha[ha.presenter=0]="presenter";ha[ha.follower=1]="follower";ha[ha.explorer=2]="explorer";ha[ha.unknown=3]="unknown"})(N||(N={}));Object(r.b)("ParticipantRole",N);class M{constructor(){this.average=
0;this.max=Number.MIN_SAFE_INTEGER;this.min=Number.MAX_SAFE_INTEGER;this.recordsCount=this.last=0}ZH(ha){ha=parseFloat(ha.toFixed(4));this.min=ha<this.min?ha:this.min;this.max=ha>this.max?ha:this.max;++this.recordsCount;this.average=parseFloat(((ha+this.average*(this.recordsCount-1))/this.recordsCount).toFixed(4));this.last=ha}toString(){return`{average: ${this.average}, min: ${this.min}, max: ${this.max}, last: ${this.last}, recordsCount: ${this.recordsCount}}`}}Object(r.a)(M,"Aggregates",null,[]);
class L{constructor(ha){this.dM=[25,50,100,250,500,1E3,2E3,5E3];this.lqb={};this.Jse=new M;this.dM=null!==ha&&void 0!==ha?ha:this.dM;for(ha=0;ha<=this.dM.length;ha++){let eb=Number.NEGATIVE_INFINITY,ta=Number.POSITIVE_INFINITY;0<ha&&(eb=this.dM[ha-1]+1);ha<this.dM.length&&(ta=this.dM[ha]);this.lqb[ha]={bucketId:`[${eb}-${ta}]`,count:0}}}ZH(ha,eb){const ta=this.fHh(eb);-1===ta?k.ULS.sendTraceTag(509442069,0,15,`BucketAggregates.record: could not find bucket for value: ${eb}, caller: ${ha}.`):(++this.lqb[ta].count,
this.Jse.ZH(eb))}toString(){const ha={};ha.Aggregates=this.Jse;let eb={};for(let ta=0;ta<=this.dM.length;ta++)1>this.lqb[ta].count||(eb[this.lqb[ta].bucketId]=this.lqb[ta].count);0<Object.keys(eb).length&&(ha.Buckets=eb);return E.a.Dc(ha)}fHh(ha){let eb=0,ta=this.dM.length-1;var ya=this.dM[eb];const sb=this.dM[ta];if(ha<=ya||ha>sb)return ha<=ya?0:this.dM.length;for(;eb<=ta;){ya=Math.floor((eb+ta)/2);if(ha===this.dM[ya]||0!==ya&&ha<this.dM[ya]&&ha>this.dM[ya-1])return ya;ha<this.dM[ya]?ta=ya-1:eb=
ya+1}return-1}}Object(r.a)(L,"BucketAggregates",null,[]);const aa=(ha,eb)=>{k.ULS.sendTraceTag(523015437,0,50,`${eb} = ${ha}`)};class V{constructor(ha,eb,ta){this.FWe=this.myf=this.lyf=this.Add=this.pZe=this.Xmg=this.oFc=this.Mbd=this.EWe=this.JHb=0;this.jlc=void 0;this.T2d=this.LXd=0;this.Qnf=!1;this.Ssc=this.Xkc=this.upf=this.sac=this.Wcd=this.Wab=this.lnc=0;this.$=ha;this.JHb=eb;this.kwc=new Map;this.kwc[N[ta]]=1;this.sIa=ta;this.Ssc=eb;this.ROd=new Map;this.lwc=new Map;this.Vvf=new M;this.Uvf=
new M;this.Xeg=new M;this.NDb(300)}dispose(){this.$=null}f9a(){var ha=S.HelperMethods.Kb();const eb={};eb.FollowerViewState=0<this.Add?"Hybrid":G[this.jlc];eb.FollowerViewStateTransitions=this.Add;eb.FollowerZoomInOppositeDirectionCount=this.pZe;eb.ExplorerConsumptionTrends=0<this.FWe?"WorkbookEdited":"WorkbookViewed";eb.ExplorerNSVModeTrends=this.lyf;eb.ExplorerNSVSwitchTrends=this.myf;eb.ViewportChangesInNonCompleteViewCount=this.Xmg;eb.ParticipantSessionInitTimestamp=this.JHb;eb.FirstMessageIdReceived=
this.Wcd;eb.LastMessageIdReceived=this.upf;eb.FirstMessageReceivedTimestamp=this.sac;eb.LastMessageReceivedTimestamp=this.Xkc;eb.TimeSinceLastMessageReceivedInMs=ha-this.Xkc;eb.TotalMessagesReceived=this.lnc;eb.MessagesReceptionLatencyAggregates=this.Vvf;eb.MessagesProcessSynchronousLatencyAggregates=this.Uvf;eb.timeToSyncViewportAggregates=this.Xeg;eb.PresenterIdentifiedTimestamp=this.Wab;eb.PresenterID=this.pza;eb.TimeToIdentifyPresenterFromCreationInMs=this.Wab-this.JHb;eb.PresenterIdentifyingFunction=
this.uOf;eb.CurrentRole=this.sIa;eb.TimeInCurrentRole=ha-this.Ssc;eb.PreviousRole=this.RHd;eb.RoleSwitchCounts=this.kwc;eb.RoleSwitchDurationsInMs=this.ROd;eb.RoleSwitchDurationsTrackerAggregates=this.lwc;ha=E.a.Dc(eb);this.$.sendBeaconTraceTag(523015447,50,!1,`ExcelLiveFollowerOrExplorer.logSessionTelemetry: ${ha}`)}bsf(){2E3>S.HelperMethods.Kb()-this.oFc&&(++this.Xmg,aa(S.HelperMethods.Kb()-this.oFc,"ExcelLiveFollowerOrExplorer.logNonCompleteViewStateTelemetry: TimeElapsedSinceLastViewportChange"),
this.oFc=0)}CUj(ha,eb){this.jlc&&ha!==this.jlc&&++this.Add;this.jlc=ha;aa(S.HelperMethods.Kb()-eb,"ExcelLiveFollowerOrExplorer.trackAndLogFollowerViewStateTransitions: TimeTakenToSyncFollowerViewport")}HUj(ha,eb){eb=S.HelperMethods.Kb()-eb;this.Uvf.ZH(eb);this.Xeg.ZH(Date.now()-ha)}BUj(ha,eb){this.Mbd=S.HelperMethods.Kb();++this.EWe;1===this.EWe&&aa(S.HelperMethods.Kb()-this.JHb,"ExcelLiveFollowerOrExplorer.trackAndLogExplorerTransitions: TimeToFirstExplorerTransition");k.ULS.sendTraceTag(523015444,
0,50,`ExcelLiveFollowerOrExplorer.trackAndLogExplorerTransitions: Last Update Type from Presenter Was = ${D[ha]}. Current View State = ${y.h(this.$).uja().RC(!0)}. Explorer role transition caused by = ${eb}`)}DUj(ha){this.Pnf(ha,C.a(this.$).zoom)!==this.Qnf&&(ha=S.HelperMethods.Kb()-this.T2d,1E4>ha&&(aa(ha,"ExcelLiveFollowerOrExplorer.trackAndLogFollowerZoomTrends: TimeToZoomChangeInOppositeDirection"),this.T2d=0),this.JUj())}JUj(){S.HelperMethods.Kb()<this.JHb+12E4&&++this.pZe}yEi(){const ha=S.HelperMethods.Kb()-
this.Mbd;5E3>ha&&aa(ha,"ExcelLiveFollowerOrExplorer.logSyncBackToPresenterTelemetry: TimeElapsedToSyncBackSinceBecomingExplorer");this.Mbd=0}xEi(ha=!1,eb,ta){aa(S.HelperMethods.Kb()-this.LXd,`ExcelLiveFollowerOrExplorer.logSyncBackToPresenterTelemetry: Synced via Presence Notification = ${ha}, IsSyncBack = ${eb}, Retries = ${ta} TimeElapsedInSyncingExplorerBackToPresenter`);this.LXd=0}KUj(ha){typeof ha===typeof U.a?++this.lyf:++this.myf}Pnf(ha,eb){return eb>ha?!0:eb==ha?void 0:!1}OUj(){this.LXd=S.HelperMethods.Kb()}PUj(){this.oFc=
S.HelperMethods.Kb()}QUj(ha,eb){this.T2d=S.HelperMethods.Kb();this.Qnf=this.Pnf(ha,eb)}IUj(){++this.FWe}FUj(ha,eb){var ta;const ya=S.HelperMethods.Kb();var sb=Date.now();0===this.Wcd&&(this.Wcd=ha,this.sac=ya);this.upf=ha;++this.lnc;eb=sb-eb;1<this.lnc&&this.Vvf.ZH(eb);sb=ya-(null!==(ta=this.Xkc)&&void 0!==ta?ta:this.sac);this.Xkc=ya;k.ULS.sendTraceTag(523015443,0,50,`ExcelLiveFollowerOrExplorer.trackAndLogMessageReceived: Received message number [${this.lnc}] MessageID: [${ha}] Time since last message: [${sb}]ms with reception latency: [${eb}]ms`)}NDi(){const ha=
S.HelperMethods.Kb(),eb=this.pza;this.pza=void 0;k.ULS.sendTraceTag(509682772,0,15,`ExcelLiveFollowerOrExplorer.logPresenterRemoval: Presenter removed/reset at [${ha}] after [${ha-this.Wab}]ms since last identification. Previous presenter ID: [${eb}]`)}Ywd(ha,eb="PresenterUpdate"){this.Wab=S.HelperMethods.Kb();this.pza=ha;this.uOf=eb;k.ULS.sendTraceTag(523015442,0,50,`ExcelLiveFollowerOrExplorer.logPresenterIdentified: Presenter identified at [${this.Wab}] after [${this.Wab-this.sac}]ms since first valid message with clientId=[${this.pza}] via [${this.uOf}]`)}NUj(ha){var eb,
ta;if(this.sIa!==ha){var ya=S.HelperMethods.Kb(),sb=N[this.sIa],Qb=N[ha];this.kwc[Qb]=1+(null!==(eb=this.kwc[Qb])&&void 0!==eb?eb:0);eb=ya-this.Ssc;this.ROd[sb]=eb+(null!==(ta=this.ROd[sb])&&void 0!==ta?ta:0);this.lwc.has(sb)||(this.lwc[sb]=new M);this.lwc[sb].ZH(eb);this.Ssc=ya;this.RHd=this.sIa;this.sIa=ha;this.f9a()}}NDb(ha){const eb=()=>{this.f9a();H.a.instance.create(eb,1E3*ha,"ExcelLiveFollowerOrExplorer.logSessionTelemetryAtSpecifiedInterval",void 0,!0)};eb.call(this)}}Object(r.a)(V,"ExcelLiveFollowerOrExplorerTelemetryHelper",
null,[2]);class P extends Sys.EventArgs{constructor(ha,eb){super();this.htb=ha;this.O8i=eb}}Object(r.a)(P,"ExcelLiveViewStateChangedArgs",Sys.EventArgs,[]);class ba extends Sys.EventArgs{constructor(ha,eb){super();this.UQe=ha;this.kOe=eb}}Object(r.a)(ba,"ExcelLiveMeetingPresenceStateUpdatedArgs",Sys.EventArgs,[]);var Y=a(38),Z=a(1);class ea extends Y.a{constructor(ha,eb){super();this.statusBarManager=null;this.htb=2;this.wOf=null;this.bKf=(ta,ya)=>{this.htb=ya.htb;this.wOf=ya.O8i.toString();this.rz()};
this.$=ha;this.$.da.gb(29,ta=>{this.statusBarManager=ta;ta.$I(this)});this.lr=eb;this.lr.Vre(this.bKf)}pq(ha){this.addHandler("followerViewStateInfoChanged",ha)}Lq(ha){this.removeHandler("followerViewStateInfoChanged",ha)}rz(){this.un("QueryExcelLiveViewState")&&this.raiseEvent("followerViewStateInfoChanged")}Tr(ha,eb){return"QueryExcelLiveViewState"!==ha?!1:this.N$h(eb)}un(){return Object(f.h)(this.$)&&Z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ShowExcelLiveViewStateInStatusBar",
!1)}dispose(){this.statusBarManager&&(this.statusBarManager.yF(this),this.statusBarManager=null);this.lr.eXf(this.bKf);this.$=this.lr=null;super.dispose()}N$h(ha){if(!this.$)return!1;ha.Value=`View State: ${G[this.htb]} | Presenter Visible Range: ${this.wOf}`;return!0}}Object(r.a)(ea,"ExcelLiveStatusBarManager",Y.a,[2,200,201]);var ra=a(68);const O=new Set("ZoomManager.ZoomFitToScreen ApplicationZoom ExcelLiveFollowerOrExplorerApp.SyncViewportToMatchOrigin ExcelLiveFollowerOrExplorer.syncViewportForNonCompleteViewState GridView.OnActiveItemChanged GridView.TryContinueGotoProcessing".split(" ")),
da=ha=>{ha=ha.endsWith("_Vacs")?ha.split("_",1)[0]:ha;return!O.has(ha)},xa=ha=>Object(f.h)(ha)&&Z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelityTracker",!1);class ia{constructor(ha,eb,ta,ya,sb=null){this.Rud=this.tza=this.statusBarManager=null;this.zUa=2;this.eZ=this.zIb=0;this.cXe=10;this.dXe=1E3;this.eXe=3E4;this.PMa=!1;this.lr=null;this.c2d=.98;this.zwa=this.w6a=this.nqd=this.Khc=this.kqd=this.HAb=this.cNa=this.Bqd=!1;this.rvd=null;this.Ird=!1;this.tqi=Z.EwaSettings.isChangeGateEnabled("OfficeVSO:7396411_InitializeRoleOnlyIfNotSame");
this.K6a=Z.EwaSettings.isChangeGateEnabled("OfficeVSO:7451504_DependOnUserListChangedEventForPresenterDetails");this.QAb=f.f();const Qb=S.HelperMethods.Kb();k.ULS.sendTraceTag(509642590,0,50,"ExcelLiveFollowerOrExplorer:Ctor");this.controller=ta;this.realtimeChannel=eb;this.Gxa=sb;this.lr=ya;this.$=ha;this.gridView=y.h(ha);this.Fn=new V(this.$,Qb,3);this.statusBarManager=new ea(this.$,this.lr);this.c2d=this.$.ya.ExcelLiveViewportRoundOffFactor;this.cXe=this.$.ya.FetchPresenterNavigationStateMaxRetries;
this.dXe=this.$.ya.FetchPresenterNavigationStateRetryBaseInMs;this.eXe=this.$.ya.FetchPresenterNavigationStateRetryMaxDelayInMs;this.NGa();this.aUg();2===this.realtimeChannel.connectionState?this.DOb():this.realtimeChannel.n2(this.mR)}dispose(){this.Slh();2!==this.controller.Tk&&(this.HLe(),this.FLe());this.PMa&&(this.controller.xcb(this.A_),this.PMa=!1);this.Rud=this.wvd=this.T8a=this.rvd=this.tza=null;this.P1a();this.$=this.gridView=this.controller=this.realtimeChannel=this.lr=null}rQa(ha){this.P1a();
this.realtimeChannel=ha;this.mwe()}BBc(){this.Fn.OUj();this.DOb(!0)}mwe(){var ha;null===(ha=this.realtimeChannel)||void 0===ha?void 0:ha.cZa(this.Mpc)}P1a(){var ha,eb;null===(ha=this.realtimeChannel)||void 0===ha?void 0:ha.L6(this.mR);null===(eb=this.realtimeChannel)||void 0===eb?void 0:eb.JQa(this.Mpc)}DOb(ha=!1,eb=null){var ta;ha&&this.Fn.yEi();if(eb)this.COb(eb)||this.zwa?this.cod(ha):k.ULS.sendTraceTag(527496925,0,15,"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Could not sync to presenter from presence update"),
this.eZ=0;else if(++this.eZ,this.eZ>this.cXe)k.ULS.sendTraceTag(527496924,0,10,`ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Presenter Nav State not available after ${this.eZ-1} retries.`),this.Bqd=!0,this.eZ=0;else{if(1===this.eZ){const ya=null!==(ta=this.Rud)&&void 0!==ta?ta:this.tza;if(null!==ya&&(this.COb(ya,!0)||this.zwa)){this.cod(ha,!0,this.eZ);this.eZ=0;return}}(ta=this.kcd())&&(this.COb(ta)||this.zwa)?(this.cod(ha,!0,this.eZ),this.eZ=0):1!==this.controller.Tk&&(this.hUa(3,
"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry"),k.ULS.sendTraceTag(527496923,0,15,`ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry: Retry
           ${this.eZ} - Presenter Nav State not available.`),H.a.instance.create(()=>{this.DOb(ha,eb)},I.a.PKa(this.eZ,this.dXe,this.eXe,!0),"ExcelLiveFollowerOrExplorer::syncToPresenterInternalWithRetry",void 0,!0))}}cod(ha=!1,eb=!1,ta=0){this.tqi&&1===this.controller.Tk||(this.hUa(1,"ExcelLiveFollowerOrExplorer::initializeFollower"),this.$Tg(),this.XTg(),this.Bqd=!1,ha&&this.Fn.xEi(eb,ha,ta),this.controller.Omf&&this.controller.NVe.KZd())}NGa(){this.Mpc=this.Mpc.bind(this);this.Dw=this.Dw.bind(this);
this.lD=this.lD.bind(this);this.tf=this.tf.bind(this);this.fHb=this.fHb.bind(this);this.Ri=this.Ri.bind(this);this.wj=this.wj.bind(this);this.Dqc=this.Dqc.bind(this);this.Jpc=this.Jpc.bind(this);this.OOa=this.OOa.bind(this);this.onScroll=this.onScroll.bind(this);this.p6=this.p6.bind(this);this.uc=this.uc.bind(this);this.L$a=this.L$a.bind(this);this.spc=this.spc.bind(this);this.Ud=this.Ud.bind(this);this.Lqc=this.Lqc.bind(this);this.mR=this.mR.bind(this);this.K6a&&(this.A_=this.A_.bind(this))}aXe(){let ha=
this.kcd();return this.COb(ha)}kcd(ha=null){const eb=null!==ha&&void 0!==ha?ha:this.realtimeChannel.cfd();if(eb)for(var ta in eb){var ya=ta;ha=eb[ta];if(!ha)break;if(ha.NavigationState&&ha.MeetingInfo&&(ha.MeetingInfo.MeetingId===this.$.ya.MeetingId||f.e()))return this.Fn.FUj(ha.MeetingInfo.MessageId,ha.NavigationState.MessageBroadcastTime),this.QAb&&this.K6a?this.controller.eve?ha.NavigationState.DurationSinceFirstBroadcast&&(ta=S.HelperMethods.Kb(),this.lr.bJd(new ba(ta,ha.NavigationState.DurationSinceFirstBroadcast))):
this.controller.y1d(ya,"ExcelLiveFollowerOrExplorer:extractNavigationStateFromMeetingPresence")?(this.Fn.Ywd(ya),this.PMa&&(this.PMa=!1,this.controller.xcb(this.A_))):this.PMa||(this.controller.xob(this.A_),this.PMa=!0):this.controller.Cz&&this.controller.Cz===ya?ha.NavigationState.DurationSinceFirstBroadcast&&(ta=S.HelperMethods.Kb(),this.lr.bJd(new ba(ta,ha.NavigationState.DurationSinceFirstBroadcast))):this.controller.y1d(ya,"ExcelLiveFollowerOrExplorer:extractNavigationStateFromMeetingPresence")&&
this.Fn.Ywd(ya),ha.NavigationState}return null}A_(){k.ULS.sendTraceTag(509616403,0,50,"ExcelLiveFollowerOrExplorer::onPresenterDetailsSaved invoked");this.Fn.Ywd(this.controller.Cz,"UserListChanged");this.controller.xcb(this.A_);this.PMa=!1}hUa(ha,eb){var ta,ya;this.Fn.NUj(ha);this.controller.hUa(ha,eb);2===ha?null===(ta=this.Gxa)||void 0===ta?void 0:ta.dGi():1===ha&&(null===(ya=this.Gxa)||void 0===ya?void 0:ya.eGi())}COb(ha,eb=!1){const ta=S.HelperMethods.Kb(),ya=this.B8g(ha,this.tza,eb);if(0===
ya)return this.Y0f(ya,ha),!0;if(!this.aXj(ha.SheetID))return!1;ya&4&&this.setZoom(this.tza,ha);eb=this.rFe(ha);this.xQj(ha,ya,eb);this.Y0f(ya,ha);ha=u.D(ha.VisibleAreaRange);this.zUa!==eb&&(this.zUa=eb,this.lr.IQf("syncFollowerViewportWithPresenter",new P(this.zUa,ha)));this.Fn.CUj(this.zUa,ta);return!0}xQj(ha,eb,ta){this.HAb=!0;0===ta?this.udg(eb,ha):this.yQj(eb,ha)}Y0f(ha,eb){this.tza=eb;this.zIb=ha}aXj(ha){ha=this.$.va.getItemByName(ha);let eb=this.$.va.na;this.rvd=ha;if(!ha)return this.zwa=!0,
!1;if(ha!==eb){if(!ha.visible)return!1;this.cNa=!0;ha.activate();eb=ha}if(!eb.Zd.hK&&!eb.Zd.kz)return!0;this.$.Yc(1690118309,ra.a.zb,0,{[f.b]:!0}).continueWith(()=>!0);return!0}setZoom(ha,eb){ha&&ha.SheetID===eb.SheetID&&(eb=(eb.ZoomLevel-ha.ZoomLevel)/ha.ZoomLevel*100,ha=C.a(this.$).zoom,eb=ha+ha*eb/100,C.a(this.$).mog(eb),this.Fn.QUj(eb,ha))}udg(ha,eb){ha&2&&(ha=u.D(eb.VisibleAreaRange),this.T8a=m.Range.Mc(ha.top,ha.left),this.wvd=new w.a(eb.TopLeftCellOffsets.X,eb.TopLeftCellOffsets.Y),eb=v.a(this.T8a,
this.wvd,this.gridView.Cp,this.gridView.ib,0,0,this.$,this.gridView.rZ()),this.gridView.v0b(eb,this.T8a,"ExcelLiveFollowerOrExplorerApp.SyncViewportToMatchOrigin",60,this.T8a))}yQj(ha,eb){const ta=u.D(eb.SelectedRanges[eb.IndexOfActiveRange]),ya=ha!==this.zIb,sb=u.D(eb.VisibleAreaRange);ha&1?(this.Y5j=this.gridView.uja(),this.gridView.pv(ta,64,"ExcelLiveFollowerOrExplorer.syncViewportForNonCompleteViewState",!0),{nL:this.T8a,hD:this.wvd}=this.gridView.Qja(),ya&&(this.Ird=!0)):ha&2&&(!sb.zd(ta)||this.zIb&
2||this.zIb&4)&&(this.udg(ha,eb),ya&&this.Fn.bsf());this.Fn.PUj()}Vbi(ha){const eb=this.gridView.uja();return eb.zd(ha)&&ha.zd(eb)?!0:!1}B8g(ha,eb,ta=!1){if(!ha)return 0;if(!eb&&ha)return 7;if(ta){if(!Z.EwaSettings.isChangeGateEnabled("OfficeVSO:7532554_NonCompleteViewSyncBackFix"))return 7;eb=u.D(ha.SelectedRanges[ha.IndexOfActiveRange]);return u.D(ha.VisibleAreaRange).zd(eb)?5:6}ta=u.D(ha.SelectedRanges[ha.IndexOfActiveRange]);var ya=u.D(eb.SelectedRanges[eb.IndexOfActiveRange]),sb=u.D(ha.VisibleAreaRange),
Qb=u.D(eb.VisibleAreaRange);if(eb.SheetID===ha.SheetID&&(eb.SheetID!==ha.SheetID||eb.ZoomLevel===ha.ZoomLevel&&ta.equals(ya)&&sb.equals(Qb)&&eb.TopLeftCellOffsets.X===ha.TopLeftCellOffsets.X&&eb.TopLeftCellOffsets.Y===ha.TopLeftCellOffsets.Y))return 0;ya=u.D(ha.VisibleAreaRange);ta=u.D(ha.SelectedRanges[ha.IndexOfActiveRange]);ya=m.Range.Mc(ya.top,ya.left);sb=new w.a(ha.TopLeftCellOffsets.X,ha.TopLeftCellOffsets.Y);var oc=u.D(eb.VisibleAreaRange);Qb=u.D(eb.SelectedRanges[eb.IndexOfActiveRange]);oc=
m.Range.Mc(oc.top,oc.left);const kb=new w.a(eb.TopLeftCellOffsets.X,eb.TopLeftCellOffsets.Y);let jb=0;ha.SheetID!==eb.SheetID?jb|=3:(Qb.equals(ta)||(jb|=1),ha.ZoomLevel!==eb.ZoomLevel&&(jb|=4),sb.equals(kb)&&ya.equals(oc)||(jb|=2));return jb}rFe(ha){const {TQb:eb,PQb:ta}=B(this.$,C.a(this.$).zoom);return eb<ha.ViewportWidth*this.c2d||ta<ha.ViewportHeight*this.c2d?1:0}$Tg(){this.$.ea.oA(this.Dw);this.$.ea.WYa(this.lD);this.$.da.gb(419,ha=>{ha.$Xc(this.p6);ha.Xre(this.p6)})}HLe(){this.$&&(this.$.ea.uB(this.Dw),
this.$.ea.rcb(this.lD),this.$.da.gb(419,ha=>{ha.CMd(this.p6);ha.hXf(this.p6)}))}p6(){this.Fn.DUj(this.tza.ZoomLevel);if(xa(this.$)){const ha=this.rFe(this.tza),eb=u.D(this.tza.VisibleAreaRange);this.zUa!==ha&&(this.zUa=ha,this.lr.IQf("onZoomChangedByUser",new P(this.zUa,eb)))}}Dw(){this.$.ea.se!==z.a.oe&&this.$.ea.Xb&&(this.zwa&&this.$.ea.$t(this.tf),this.w6a=!0)}tf(){(this.w6a||this.zwa)&&this.aXe()&&(this.$.ea.Av(this.tf),this.zwa=this.w6a=!1)}mR(ha,eb){if(2===eb.newState||2===this.realtimeChannel.connectionState)this.DOb(),
this.realtimeChannel.L6(this.mR)}lD(){this.cNa?this.cNa=!1:this.w6a&&this.aXe()&&(this.w6a=!1)}XTg(){this.gridView.view.sPg(this.Lqc);this.gridView.qXc(this.spc);this.gridView.Vb.xl(this.Ri);this.$.da.gb(65,ha=>{ha.UNg(this.Dqc)})}FLe(){this.gridView&&(this.gridView.view.$lj(this.Lqc),this.gridView.XLd(this.spc),this.gridView.Vb.nl(this.Ri));const ha=this.$.da.Aa(65);ha&&ha.Rkj(this.Dqc)}fHb(){this.Khc?this.Khc=!1:this.nqd||this.cNa||this.HAb||this.Jwi()||(this.kqd?this.kqd=!1:this.SOa("OnViewportChanged"))}Lqc(){this.SOa("OnUserInitiatedDirectScroll")}spc(ha,
eb){1!==this.controller.Tk||da(eb.gotoCaller)||k.ULS.sendTraceTag(523015448,0,50,"ExcelLiveFollowerOrExplorer.onGoToEnded: Function called for viewport sync action");da(eb.gotoCaller)?this.SOa("OnGoToEnded"):this.Ird&&this.Vbi(this.Y5j)&&(this.Fn.bsf(),this.Ird=!1)}Jwi(){let ha;({nL:ha}=this.gridView.Qja());return this.rvd===this.$.na&&ha.equals(this.T8a)?!0:!1}Ri(){this.SOa("OnEditStarted")}wj(){this.Khc=!0}OOa(){this.nqd=!1}onScroll(ha){this.HAb&&1===this.controller.Tk&&(this.HAb=!1,this.kqd=!0);
ha.stopPropagation()}Dqc(){this.SOa("OnTextInput")}SOa(ha){this.bpj();this.Fn.BUj(this.zIb,ha);this.hUa(2,"ExcelLiveFollowerOrExplorer::onExploreActionsObserved");this.HLe();this.FLe();this.controller.Omf&&this.controller.NVe.KZd()}aUg(){this.mwe();this.$.ea.are(this.Jpc);this.$.nj(this.uc);this.$.na.Zd.aZa(this.L$a);this.$.na.Zd.T_b(this.L$a);this.$.va.Vf(this.Ud)}Slh(){this.P1a();null!==this.$&&(this.$.ea.Ekj(this.Jpc),this.$.ol(this.uc),this.$.na.Zd.YJb(this.L$a),this.$.na.Zd.dMd(this.L$a),this.$.va.sg(this.Ud))}Mpc(ha,
eb){ha=S.HelperMethods.Kb();this.G9i(eb.caa);this.i$i(eb.pL,ha)}G9i(ha){!ha||1>ha.length||2===this.controller.Tk||ha.forEach(eb=>{eb===this.controller.Cz&&(this.controller.CLd(),this.Fn.NDi(),this.hUa(3,"ExcelLiveFollowerOrExplorer:processDisconnectedClients"))})}i$i(ha,eb){!ha||1>ha.length||(ha=this.kcd(ha),null!==ha&&(this.Rud=ha,2!==this.controller.Tk&&(3===this.controller.Tk?this.DOb(this.Bqd,ha):(this.COb(ha),this.Fn.HUj(ha.MessageOriginTime,eb)))))}bpj(){this.zwa=this.HAb=this.cNa=this.Khc=
this.nqd=!1}Jpc(){1!==this.controller.Tk||this.cNa?this.Fn.IUj():this.SOa("OnLocalUserEditHappened")}L$a(ha,eb){this.Fn.KUj(eb)}Ud(){this.cNa||this.w6a||this.SOa("OnActiveItemChanged")}uc(ha,eb){eb.Bf||this.Fn.f9a()}}Object(r.a)(ia,"ExcelLiveFollowerOrExplorer",null,[]);class Ma{constructor(ha){this.Usb=this.HRa=this.vOf=0;this.Scd=Number.MAX_SAFE_INTEGER;this.OCb=Number.MIN_SAFE_INTEGER;this.FEb=0;this.$=ha;this.vOf=S.HelperMethods.Kb();this.zYd=new M;this.NDb(300)}dispose(){this.zYd=this.$=null}GUj(ha){var eb=
y.h(this.$).ha.qa.activeRange;ha=ha.zd(eb)?!0:!1;eb=S.HelperMethods.Kb();if(!ha&&0===this.HRa)this.HRa=eb;else if(0<this.HRa){const ta=eb-this.HRa;this.Usb+=ta;this.HRa=eb;ha&&aa(ta,"ExcelLivePresenter.trackAndLogSelectionVisibility: Selection was outside presenter Viewport. TimeSpentWithoutSelectionVisible")}}f9a(){var ha=S.HelperMethods.Kb();const eb=ha-this.vOf;let ta=0;0<this.HRa&&(ta=ha-this.HRa,this.Usb+=ta);const ya={};ya.PercentageTimeSelectionVisible=(eb-this.Usb)/eb*100;ya.TimeSpentWithoutSelectionVisibleSinceLastBroadcast=
ta;ya.FirstMessageBroadcastTimestamp=this.Scd;ya.LastMessageBroadcastTimestamp=this.OCb;ya.TotalMessagesBroadcasted=this.FEb;ya.TimeSinceLastBroadcastInMs=ha-this.OCb;ya.TimeToCreateNavigationStateAggregatesInMs=this.zYd;ha=E.a.Dc(ya);this.$.sendBeaconTraceTag(523015439,50,!1,`ExcelLivePresenter.logSessionTelemetry: ${ha}`)}EUj(ha){++this.FEb;const eb=S.HelperMethods.Kb();this.Scd=Math.min(this.Scd,eb);const ta=eb-this.OCb;this.OCb=Math.max(this.OCb,eb);k.ULS.sendTraceTag(523015438,0,50,`ExcelLivePresenter.trackAndLogMessageBroadcasted: Sent message number [${ha}] after [${eb-
this.ixf}]ms of viewport change by presenter and after [${ta}]ms of sending previous message`)}LUj(){this.ixf=S.HelperMethods.Kb()}sDi(){const ha=S.HelperMethods.Kb()-this.ixf;aa(ha,"ExcelLivePresenter.getCurrentViewportNavigationState: TimeToCreateNavigationState");this.zYd.ZH(ha)}NDb(ha){const eb=()=>{this.f9a();H.a.instance.create(eb,1E3*ha,"ExcelLivePresenter.logSessionTelemetryAtSpecifiedInterval",void 0,!0)};eb.call(this)}}Object(r.a)(Ma,"ExcelLivePresenterTelemetryHelper",null,[2]);class Ta{constructor(ha,
eb,ta,ya,sb=null){this.controller=this.dD=null;this.MKi=1E4;this.FEb=0;this.wxc=null;this.i1b=Z.EwaSettings.isChangeGateEnabled("OfficeVSO:7396010_SessionReopenFixes");this.lr=this.Gxa=null;this.Vcd=0;this.Cbi=()=>null!==this.wxc;k.ULS.sendTraceTag(509642586,0,50,"ExcelLivePresenter:Ctor");this.$=ha;this.gridView=y.h(this.$);this.Fn=new Ma(this.$);this.realtimeChannel=eb;this.Gxa=sb;this.controller=ta;this.lr=ya;this.NGa();this.byj();2===this.realtimeChannel.connectionState?this.DWd():this.realtimeChannel.n2(this.mR)}dispose(){var ha;
this.Wlh();this.P1a();this.i1b&&(null===(ha=this.wxc)||void 0===ha?void 0:ha.cancel(),this.wxc=null);this.$=this.gridView=this.controller=this.realtimeChannel=this.lr=null}rQa(ha){this.P1a();this.realtimeChannel=ha;this.Cbi?this.mIb():this.DWd()}NGa(){this.upc=this.upc.bind(this);this.Tva=this.Tva.bind(this);this.oec=this.oec.bind(this);this.uc=this.uc.bind(this);this.mR=this.mR.bind(this)}P1a(){var ha;null===(ha=this.realtimeChannel)||void 0===ha?void 0:ha.L6(this.mR)}DWd(){this.mIb(!0);this.yUg()}mR(ha,
eb){if(2===eb.newState||2===this.realtimeChannel.connectionState)this.DWd(),this.realtimeChannel.L6(this.mR)}yUg(){this.$.va.aJ(this.oec);this.gridView.Bob(this.Tva);this.gridView.ha.UL(this.Tva);this.$.nj(this.uc)}Wlh(){this.$&&(this.$.va.KK(this.oec),this.$.ol(this.uc));this.gridView&&(this.gridView.iKb(this.Tva),this.gridView.ha.zR(this.Tva))}oec(){this.gridView.iKb(this.Tva);this.gridView.oT(this.upc)}upc(){this.mIb();this.gridView.QN(this.upc);this.gridView.Bob(this.Tva)}Tva(){this.$.va&&this.$.va.tgf||
this.mIb()}uc(ha,eb){eb.Bf||this.Fn.f9a()}PSh(){const ha=Date.now();this.Fn.LUj();let eb=this.gridView.uja();if(null===eb)return null;let ta;({hD:ta}=this.gridView.Qja());const ya={};ya.MessageOriginTime=ha;ya.SheetID=this.$.na?this.$.na.sheetName:null;ya.ZoomLevel=C.a(this.$).zoom;ya.SelectedRanges=u.k(this.gridView.ha.qa.selectedRanges,this.$);ya.IndexOfActiveRange=this.gridView.ha.qa.es;ya.VisibleAreaRange=u.v(eb,this.$);ya.TopLeftCellOffsets={};ya.TopLeftCellOffsets.X=ta.x;ya.TopLeftCellOffsets.Y=
ta.y;const {TQb:sb,PQb:Qb}=B(this.$,ya.ZoomLevel);ya.ViewportHeight=Qb;ya.ViewportWidth=sb;this.Fn.GUj(eb);this.Fn.sDi();return ya}byj(){this.dD={};this.dD.MeetingId=this.$.ya.MeetingId;this.dD.IsPresenter=!0}mIb(ha=!1){var eb;ha&&(this.wxc=H.a.instance.create(()=>{this.mIb(ha)},this.MKi+this.x8g(),"ExcelLivePresenter::postViewportUpdatesToMeetingParticipants",void 0,!0));if(2!==this.realtimeChannel.connectionState)k.ULS.sendTraceTag(521195807,0,15,`ExcelLivePresenter:postViewportUpdatesToMeetingParticipants RTC connection state is not connected. Current state:[${this.realtimeChannel.connectionState}]`);
else{var ta=this.PSh();if(null===ta)k.ULS.sendTraceTag(527962826,0,15,"ExcelLivePresenter:postViewportUpdatesToMeetingParticipants CurrentViewportNavigationState is null");else{var ya={};ya.MeetingInfo=this.dD;ya.MeetingInfo.MessageId=++this.FEb;ya.NavigationState=ta;ya.NavigationState.MessageBroadcastTime=Date.now();xa(this.$)&&(ta=S.HelperMethods.Kb(),0===this.Vcd&&(this.Vcd=ta),ya.NavigationState.DurationSinceFirstBroadcast=ta-this.Vcd);this.realtimeChannel.d3f(ya);ya.NavigationState.DurationSinceFirstBroadcast&&
(ta=S.HelperMethods.Kb(),this.lr.bJd(new ba(ta,ya.NavigationState.DurationSinceFirstBroadcast)));null===(eb=this.Gxa)||void 0===eb?void 0:eb.k3f(ya.NavigationState);this.Fn.EUj(this.FEb)}}}x8g(){return 6001*Math.random()+-3E3}}Object(r.a)(Ta,"ExcelLivePresenter",null,[]);var Da=a(894);class fa{constructor(ha,eb){this.Mmc=this.Z_f=0;this.Eld=!1;this.Mmc=S.HelperMethods.Kb();this.$=ha;this.vua=eb;this.YOd=new Map;this.fLb=new Map;this.vwc=new Map;this.g0f=this.Mmc;this.NDb(300)}dispose(){this.vua=this.$=
null}AUj(ha,eb){var ta,ya;const sb=S.HelperMethods.Kb(),Qb=sb-this.g0f;this.Eld=this.Eld||2==eb;2!==eb&&this.Eld&&++this.Z_f;k.ULS.sendTraceTag(523015441,0,50,`ExcelLiveManagerTelemetryHelper::trackAndLogConnectionStateChanged: Recorded ConnectionState change from [${ha}] to [${eb}] after [${Qb}]ms with current participant role [${this.vua.Tk}]`);ha=Da.a[ha];eb=Da.a[eb];this.fLb.has(ha)||(this.fLb[ha]=1);this.fLb[eb]=1+(null!==(ta=this.fLb[eb])&&void 0!==ta?ta:0);this.YOd[ha]=Qb+(null!==(ya=this.YOd[ha])&&
void 0!==ya?ya:0);this.vwc.has(ha)||(this.vwc[ha]=new M);this.vwc[ha].ZH(Qb);this.g0f=sb;this.gxd()}gxd(){var ha={};ha.RTCDisconnects=this.Z_f;ha.RTCConnectionStateCounts=this.fLb;ha.RTCConnectionStateDurationsInMs=this.YOd;ha.RTCConnectionStateDurationsAggregatesInMs=this.vwc;ha.MeetingID=this.$.ya.MeetingId;ha.AmIPresenter=this.$.ya.IsMeetingPresenter;ha.MeetingManagerCreated=this.Mmc;ha.SessionDurationInMs=S.HelperMethods.Kb()-this.Mmc;ha=E.a.Dc(ha);this.$.sendBeaconTraceTag(523015440,50,!1,`ExcelLiveManagerTelemetryHelper.logSessionTelemetry: ${ha}`)}NDb(ha){const eb=
()=>{this.gxd();H.a.instance.create(eb,1E3*ha,"ExcelLiveManagerTelemetryHelper.logSessionTelemetryAtSpecifiedInterval",void 0,!0)};eb.call(this)}}Object(r.a)(fa,"ExcelLiveManagerTelemetryHelper",null,[]);var ua=a(163);class Fa{constructor(ha,eb,ta,ya){this.Ycd=null;this.zZd=!1;this.omg=0;this.IQb=[];this.x$b=0;this.G1d=new L;this.Iod=new L([50,75,90,95,98,100]);this.fh=ha;this.NXd=eb;this.lr=ya;this.x7=ta;this.NGa();this.lm()}dispose(){this.Y$();this.iOb("ExcelLiveSyncFidelityTracker.dispose");this.lr=
this.Iod=this.G1d=null;this.NXd.dispose();this.fh=this.NXd=null}JWd(){!this.zZd&&this.Ycd&&(this.zZd=!0,this.ogf(this.e0e(this.x7.F1d)),this.ggf(this.e0e(this.x7.Rsf)))}iOb(ha){var eb,ta;k.ULS.sendTraceTag(509616465,0,50,`ExcelLiveSyncFidelityTracker:stopTracking: stopping sync fidelity tracking. caller: ${ha}`);this.nxd();this.prf();null===(eb=this.E1d)||void 0===eb?void 0:eb.cancel();this.E1d=null;null===(ta=this.vxd)||void 0===ta?void 0:ta.cancel();this.vxd=null;this.x$b=0;this.zZd=!1}ogf(ha){this.E1d=
ua.AsyncMethodContext.o6c(()=>{const eb=this.wOh(1E3*this.x7.F1d);this.x$b=S.HelperMethods.Kb()+eb;this.ogf(eb)},ha,"ExcelLiveSyncFidelityTracker.invokeValidation",this.E1d);this.J4j()}J4j(){var ha=this.vOh();if(ha=this.NXd.validate(ha))++this.omg,this.Iod.ZH("ExcelLiveSyncFidelityTracker.intersectionPercentageAggregates",ha.s9j),ha.isValid||(10<=this.IQb.length&&this.nxd(),this.IQb.push(ha))}ggf(ha){this.vxd=ua.AsyncMethodContext.o6c(()=>{this.ggf(1E3*this.x7.Rsf)},ha,"ExcelLiveSyncFidelityTracker.invokeLogging",
this.vxd);this.nxd();this.prf()}nxd(){var ha;1>(null===(ha=this.IQb)||void 0===ha?void 0:ha.length)||(ha=E.a.Dc(this.IQb),k.ULS.sendTraceTag(509616464,0,15,`ExcelLiveSyncFidelityTracker.logValidationReport: ${ha}, TotalValidationReportsInSession: ${this.omg}`),this.IQb=[])}prf(){k.ULS.sendTraceTag(509616463,0,50,`ExcelLiveSyncFidelityTracker.validationTriggerDelayAggregates: ${this.G1d.toString()}`);k.ULS.sendTraceTag(509616466,0,50,`ExcelLiveSyncFidelityTracker.intersectionPercentageAggregates: ${this.Iod.toString()}`)}vOh(){let ha=
0;const eb=this.w2e();0<eb&&(ha=Math.floor(eb/(1E3*this.x7.F1d)));return ha}e0e(ha){var eb=this.w2e();let ta=ha;0<eb&&(eb/=1E3*ha,ta=(Math.ceil(eb)-eb)*ha);return 1E3*ta}wOh(ha){var eb=S.HelperMethods.Kb();let ta=ha;0!==this.x$b&&(eb-=this.x$b,ta=(Math.floor(eb/ha)+1)*ha-eb,this.G1d.ZH("ExcelLiveSyncFidelityTracker.validationTriggerDelayAggregates",eb));return ta}w2e(){return S.HelperMethods.Kb()-this.Ycd}NGa(){this.qma=this.qma.bind(this);this.vGb=this.vGb.bind(this)}lm(){this.jwe();this.lr.JNg(this.vGb)}Y$(){this.MLe();
this.lr.HWf(this.vGb)}jwe(){this.fh.n2(this.qma)}MLe(){this.fh.L6(this.qma)}qma(ha,eb){eb.oldState!==eb.newState&&(0===eb.newState?this.iOb("ExcelLiveSyncFidelityTracker.onRealTimeChannelConnectionStateChanged"):2===eb.newState&&this.JWd())}rQa(ha){this.MLe();this.fh=ha;this.jwe();this.JWd()}vGb(ha,eb){eb.kOe&&eb.UQe&&(this.Ycd=eb.UQe-eb.kOe,this.JWd(),this.lr.HWf(this.vGb))}}Object(r.a)(Fa,"ExcelLiveSyncFidelityTracker",null,[2]);class ca{constructor(ha,eb,ta){this.$=ha;this.fh=eb;this.x7=ta}dispose(){this.$=
this.fh=null}rQa(ha){this.fh=ha}nkc(ha){return ha?!0:(k.ULS.sendTraceTag(509616461,0,15,`ExcelLiveSyncFidelityValidator:isVisibleAreaRangeValid: skipping validation
        as visibleAreaRange is not valid: ${ha}`),!1)}a9e(ha){const eb=this.fh.cfd();if(!eb)return k.ULS.sendTraceTag(509616460,0,15,"ExcelLiveSyncFidelityValidator:getVisibleAreaRangeAndSheetIdFromRtc: skipping validation due to null presence data from rtc"),null;ha=eb[ha];return ha&&ha.NavigationState?{sheetId:ha.NavigationState.SheetID,lCa:u.D(ha.NavigationState.VisibleAreaRange)}:(k.ULS.sendTraceTag(509616459,0,15,"ExcelLiveSyncFidelityValidator:getVisibleAreaRangeAndSheetIdFromRtc: skipping validation as presenter update is not available in presence data"),
null)}b9e(ha,eb,ta){let ya=0;ha=ha.we(eb);null!==ha&&(ya=ha.height*ha.width*100/ta);return Math.round(ya)}T_e(ha,eb,ta,ya,sb,Qb,oc,kb){var jb;ha={["id"]:ha,["isValid"]:eb,["zoom"]:null===(jb=C.a(this.$))||void 0===jb?void 0:jb.zoom,["intersectionPercentage"]:ta,["isSheetSameAsExpected"]:ya,["actualVisibleArea"]:sb.toString(),["expectedVisibleArea"]:Qb.toString()};void 0!==oc&&(ha.viewState=oc,ha.hasFollowerUpdatedZoomPostSync=kb);return ha}}Object(r.a)(ca,"ExcelLiveSyncFidelityValidator",null,[2]);
class ka extends ca{constructor(ha,eb,ta,ya){super(ha,ta,ya);this.gridView=y.h(ha);this.controller=eb}dispose(){super.dispose();this.gridView=this.controller=null}validate(ha){var eb;if(0!==this.controller.Tk)return k.ULS.sendTraceTag(509616462,0,10,"ExcelLivePresenterSyncFidelityValidator:validate: skipping validation as the role is not presenter"),null;const ta=this.a9e(this.fh.clientId),ya=this.gridView.uja();if(!this.nkc(null===ta||void 0===ta?void 0:ta.lCa)||!this.nkc(ya))return null;let sb=
!1,Qb=!1,oc=0;ta.sheetId===(null===(eb=this.$.na)||void 0===eb?void 0:eb.sheetName)&&(sb=!0,oc=this.b9e(ya,ta.lCa,this.qjd(ta.lCa)),oc>=this.x7.N8i&&(Qb=!0));return this.T_e(ha,Qb,oc,sb,ya,ta.lCa)}qjd(ha){return ha.height*ha.width}}Object(r.a)(ka,"ExcelLivePresenterSyncFidelityValidator",ca,[]);class Ca extends ca{constructor(ha,eb,ta,ya,sb){super(ha,ta,sb);this.Iac=null;this.Jec=!1;this.epf=0;this.gridView=y.h(ha);this.controller=eb;this.lr=ya;this.lm()}dispose(){this.Y$();this.gridView=this.controller=
this.lr=null;super.dispose()}validate(ha){var eb;if(1!==this.controller.Tk)return null;const ta=this.a9e(this.controller.Cz),ya=this.gridView.uja();if(!this.nkc(null===ta||void 0===ta?void 0:ta.lCa)||!this.nkc(ya))return null;let sb=!1,Qb=!1,oc=0;ta.sheetId===(null===(eb=this.$.na)||void 0===eb?void 0:eb.sheetName)&&(sb=!0,oc=this.b9e(ya,ta.lCa,this.qjd(ta.lCa,ya)),Qb=0===this.Iac?this.V4j(oc):this.W4j(oc),this.epf=oc);return this.T_e(ha,Qb,oc,sb,ya,ta.lCa,this.Iac,this.Jec)}lm(){this.p6=this.p6.bind(this);
this.$.da.gb(419,ha=>{ha.$Xc(this.p6)});this.opc=this.opc.bind(this);this.lr.Vre(this.opc)}Y$(){this.$.da.gb(419,ha=>{ha.CMd(this.p6)});this.lr.eXf(this.opc)}p6(){this.Jec=!0}opc(ha,eb){"syncFollowerViewportWithPresenter"===ha&&(this.Jec=!1);this.Iac=eb.htb}qjd(ha,eb){let ta=ha.height*ha.width;1===this.Iac&&(ta=Math.min(ha.height,eb.height)*Math.min(ha.width,eb.width));return ta}V4j(ha){let eb=!0;ha<this.x7.wEh&&(eb=!1);return eb}W4j(ha){let eb=!0;ha<this.x7.BEh&&(eb=!1,this.Jec&&ha>this.x7.zEh&&
ha>this.x7.xEh/100*this.epf&&(eb=!0));return eb}}Object(r.a)(Ca,"ExcelLiveFollowerSyncFidelityValidator",ca,[]);class fb extends Y.a{constructor(){super()}Vre(ha){this.addHandler("FollowerViewStateChanged",ha)}eXf(ha){this.removeHandler("FollowerViewStateChanged",ha)}IQf(ha,eb){this.raiseEvent("FollowerViewStateChanged",eb,ha)}JNg(ha){this.addHandler("MeetingPresenceStateUpdated",ha)}HWf(ha){this.removeHandler("MeetingPresenceStateUpdated",ha)}bJd(ha){this.raiseEvent("MeetingPresenceStateUpdated",
ha)}}Object(r.a)(fb,"ExcelLiveEventManager",Y.a,[]);class yb{constructor(ha,eb,ta,ya=null){this.nfa=this.Pfa=this.tjb=null;this.i1b=Z.EwaSettings.isChangeGateEnabled("OfficeVSO:7396010_SessionReopenFixes");this.aPc=null;this.vtd=!1;this.Pmb=this.zYb=null;this.xca=(sb,Qb)=>{var oc;sb=Qb.fh;(null===(oc=this.hA)||void 0===oc?void 0:oc.clientId)!==sb.clientId&&(k.ULS.sendTraceTag(509678530,0,50,`ExcelLiveManager::onConnectionCompleted - Updating current RTC instance with client ID: [${this.hA.clientId}]  to RTC instance with client ID: [${sb.clientId}]`),
this.NLe(),this.hA=sb,this.lwe(),f.g(this.$)?this.Pfa.rQa(this.hA):this.tjb.rQa(this.hA),this.vtd&&(this.zYb.rQa(this.hA),this.Pmb.rQa(this.hA)))};k.ULS.sendTraceTag(509642589,0,50,"ExcelLiveManager:Ctor");this.$=ha;this.VWb=eb;this.Fn=new fa(this.$,ta);this.hA=Object(n.a)(343,this.Bn.fh);this.aPc=ya;f.h(this.$)&&(this.uc=this.uc.bind(this),this.$.nj(this.uc),this.qma=this.qma.bind(this),this.lwe(),this.i1b&&(this.xca=this.xca.bind(this),this.VWb.mob(this.xca)));this.vtd=xa(this.$);this.nfa=ta;this.Gfi()}dispose(){var ha,
eb,ta,ya,sb,Qb;null===(ha=this.zYb)||void 0===ha?void 0:ha.dispose();this.zYb=null;null===(eb=this.Pmb)||void 0===eb?void 0:eb.dispose();this.Pmb=null;null===(ta=this.Pfa)||void 0===ta?void 0:ta.dispose();this.Pfa=null;null===(ya=this.tjb)||void 0===ya?void 0:ya.dispose();this.tjb=null;f.h(this.$)&&(this.NLe(),this.i1b&&(null===(sb=this.VWb)||void 0===sb?void 0:sb.Duc(this.xca)),null===(Qb=this.$)||void 0===Qb?void 0:Qb.ol(this.uc));this.$=this.hA=this.VWb=this.nfa=null}get Bn(){return this.VWb}get wab(){return this.nfa.wab}get qZe(){return this.tjb}get presenter(){return this.Pfa}BBc(){this.qZe?
this.qZe.BBc():k.ULS.sendTraceTag(537162880,0,10,"ExcelLiveManager::SyncToPresenter - FollowerOrExplorer object is not available to complete the action")}xob(ha){this.nfa.xob(ha)}xcb(ha){this.nfa.xcb(ha)}lwe(){var ha;null===(ha=this.hA)||void 0===ha?void 0:ha.n2(this.qma)}NLe(){var ha;null===(ha=this.hA)||void 0===ha?void 0:ha.L6(this.qma)}Gfi(){const ha=new fb;f.h(this.$)&&(f.g(this.$)?this.Pfa=new Ta(this.$,this.hA,this.nfa,ha,this.aPc):this.tjb=new ia(this.$,this.hA,this.nfa,ha,this.aPc),this.vtd&&
this.tgi(ha))}tgi(ha){var eb=Z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ValidationIntervalInSec",15);const ta=Z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.LoggingIntervalInSec",300),ya=Z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.PresenterExpectedIntersectionPercent",100),sb=Z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedCompleteViewIntersectionPercent",98),Qb=
Z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedNonCompleteViewIntersectionPercent",98),oc=Z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedMinIntersectionPercent",10),kb=Z.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.ExcelLiveSyncFidelity.ExpectedIntersectionDecreaseAfterZoomPercent",50);eb={F1d:eb,Rsf:ta,N8i:ya,wEh:sb,BEh:Qb,zEh:oc,xEh:kb};this.Pmb=f.g(this.$)?new ka(this.$,this.nfa,this.hA,eb):new Ca(this.$,this.nfa,
this.hA,ha,eb);this.zYb=new Fa(this.hA,this.Pmb,eb,ha)}qma(ha,eb){eb.oldState!==eb.newState&&this.Fn.AUj(eb.oldState,eb.newState)}uc(ha,eb){eb.Bf||this.Fn.gxd()}}Object(r.a)(yb,"ExcelLiveManager",null,[344,2]);class mb{constructor(ha){this.jhe=this.ihe=this.hhe=null;this.yge=void 0;this.$=ha}dispose(){this.$=null}get Tk(){return this.yge}set Tk(ha){this.yge=ha}get Cz(){return this.hhe}set Cz(ha){this.hhe=ha}get $ca(){return this.ihe}set $ca(ha){this.ihe=ha}get Yab(){return this.jhe}set Yab(ha){this.jhe=
ha}c1f(ha,eb,ta){k.ULS.sendTraceTag(527171654,0,50,`ExcelLiveFollowerOrExplorer:${ta} Setting presenter information to CID: ${ha} from CID: ${this.Cz}`);this.Cz=ha;this.$ca=null===eb||void 0===eb?void 0:eb.User.UserName;this.Yab=null===eb||void 0===eb?void 0:eb.UserColor}CLd(){this.Yab=this.$ca=this.Cz=void 0}}Object(r.a)(mb,"ExcelLiveParticipantModel",null,[2]);var nb=a(250),X=a(12),R=a(263),wa=a(22);class na{constructor(ha,eb=null){this.Eoa=null;this.BZd=this.wYe=!0;this.container=null;this.Tk=
0;this.UPa=this.$ca=null;this.lastUpdateTime=0;this.$=null;this.Iai=()=>{this.BZd||(this.tXf(),this.BZd=!0,this.container.classList.remove("ewa-excelLive-meetingPill-container-hidden"))};eb&&this.initialize(ha,eb);this.$=ha}KMd(ha,eb,ta=null,ya=null){this.h_(ha,eb);this.Tk=eb;this.$ca=ta;this.UPa=ya;this.wYe?(this.wYe=!1,this.tXf()):(this.BZd=!1,this.container.classList.add("ewa-excelLive-meetingPill-container-hidden"))}dispose(){$removeHandler(this.container,"transitionend",this.Eoa);$removeHandler(this.container,
"transitioncancel",this.Eoa);this.container=null}get jc(){return this.container}get Ff(){return!!this.container&&2===this.Tk}get Xd(){return nb.a.Aqf}ag(ha,eb){if(eb)return!1;ha=this.container.querySelectorAll(X.DOMElementExtensions.nr);let ta;for(eb=0;eb<ha.length;eb++){const ya=ha[eb];X.DOMElementExtensions.Ff(ya)&&(ta=ya)}if(!ta)return k.ULS.sendTraceTag(529109852,0,10,"ExcelLiveMeetingPillUtility.SetFocusOnSection: Could not find focusable element in live meeting pill"),!1;ta.focus();return!0}sh(ha){return X.DOMElementExtensions.Af(this.jc,
ha)}rj(){}dk(){}initialize(ha,eb){this.container=document.createElement("div");this.container.id="excelLiveMeetingPillContainer";this.container.classList.add("ewa-excelLive-meetingPill-container");eb.appendChild(this.container);f.d(ha)&&(this.container.style.height="32px",k.ULS.sendTraceTag(529073433,0,50,"ExcelLiveMeetingPillUtility.initialize:Changed the height of meeting pill container for mobile"));this.Eoa=this.Iai;$addHandler(this.container,"transitionend",this.Eoa);$addHandler(this.container,
"transitioncancel",this.Eoa);R.a(ha).Yh(this)}tXf(){const ha={};ha.participantRole=this.Tk;this.$.tw?(k.ULS.sendTraceTag(527991135,0,50,"ExcelLiveMeetingPillUtility.renderMeetingPillInternal: Getting shortened user name for mobile meeting pill"),ha.presenterName=this.H3h(this.$ca)):ha.presenterName=this.$ca;ha.presenterColor=this.UPa;appChrome.renderLiveMeetingPill(this.container,ha)}H3h(ha){if(wa.a.lh(ha))return k.ULS.sendTraceTag(527991134,0,15,"ExcelLiveMeetingPillUtility.getShortenedUserName: Username is null or empty"),
ha;let eb=ha.split(" "),ta=eb.length;return 2>ta||wa.a.lh(eb[ta-1])?ha:eb[0]+" "+eb[ta-1].substring(0,1)}h_(ha,eb){eb=N[eb];if(0===this.lastUpdateTime)k.ULS.sendTraceTag(527766152,0,50,`${ha}::FirstRole - [${eb}]`),this.lastUpdateTime=S.HelperMethods.Kb();else{var ta=N[this.Tk];if(ta===eb)k.ULS.sendTraceTag(523548820,0,15,`${ha}:RoleTransition: Received transition to participant role which is same as current role: [${ta}]`);else{var ya=((S.HelperMethods.Kb()-this.lastUpdateTime)/1E3).toFixed(2);k.ULS.sendTraceTag(528786757,
0,50,`${ha}:RoleTransition: Transition participant role from [${ta}] to [${eb}] after ${ya}s`);this.lastUpdateTime=S.HelperMethods.Kb()}}}}Object(r.a)(na,"ExcelLiveMeetingPillUtility",null,[54,2]);var Ba=a(4);class Ra{get iKh(){let ha;return(ha=this.df?document.getElementById("AdditionalBarsRegion"):document.getElementById(this.$.Bb+x.a.F1a))?ha.clientHeight:0}get g_g(){let ha;return(ha=this.df?document.getElementById("BusinessBar"):document.getElementById(this.$.Bb+x.a.Qye))?ha.clientHeight:0}get pFh(){let ha=
null;this.df&&(ha=document.getElementById("FarPaneRegion"));return ha?ha.clientWidth:0}get DRg(){var ha=f.d(this.$)?(ha=document.getElementById(this.$.Bb+x.a.FHa))?ha.clientHeight:0:this.$.WZ?0:this.$.l0g();return ha}get bEj(){let ha;return(ha=this.df?document.getElementById("Header"):document.getElementById(x.a.isa))?ha.clientHeight:0}get Q2c(){return this.df?document.getElementById("EditorContainer"):this.$.wE}get Wxe(){return this.bEj+this.DRg+this.g_g+this.iKh}get VWg(){return this.Q2c.clientLeft}get XWg(){return this.Q2c.clientWidth+
this.pFh-3}get UWg(){if(this.df){const ha=document.getElementById("StatusBar");return ha.offsetTop+ha.clientHeight-this.Wxe}return this.Q2c.clientHeight}get WWg(){const ha={};ha.participantRole=this.Tk;ha.presenterColor=this.UPa;ha.top=this.Wxe;ha.left=this.VWg;ha.width=this.XWg;ha.height=this.UWg;ha.size=3;return ha}constructor(ha,eb=null,ta=0){this.container=null;this.Tk=0;this.UPa=null;this.df=!1;eb&&(this.$=ha,this.Tk=ta,this.initialize(eb),this.df=Ba.AFrameworkApplication.sa.Qa.df)}kKb(ha,eb=
null){this.Tk=ha;this.UPa=eb;appChrome.renderLiveMeetingBoundary(this.container,this.WWg)}dispose(){this.container=null;this.$.zF(this.Dbb);this.$.zlj(this.Dbb)}initialize(ha){this.NGa();this.container=document.createElement("div");this.container.id="excelLiveMeetingBoundaryContainer";this.container.classList.add("ewa-excelLive-meetingBoundary-container");ha.append(this.container);this.kKb(this.Tk,this.UPa);this.$.dC(this.Dbb);this.$.LOg(this.Dbb)}NGa(){this.Dbb=this.Dbb.bind(this)}Dbb(){this.kKb(this.Tk,
this.UPa)}}Object(r.a)(Ra,"ExcelLiveMeetingBoundaryUtility",null,[2]);var qa=a(136),La=a(44),Yb=a(89);class mc{constructor(ha,eb){this.tJa=this.mqb=null;this.utd=this.RAb=this.hhc=this.ghc=!1;this.$=ha;this.controller=eb;this.RAb=Z.EwaSettings.isChangeGateEnabled("OfficeVSO:6454130_ExcelLiveExplorerBasedSurveyTriggerEnabled");(this.ghc=Z.EwaSettings.isChangeGateEnabled("OfficeVSO:6603003_ExcelLiveBufferBasedSurveyTriggerEnabled"))?this.ebg(this.$.ya.ExcelLiveBufferBasedSurveyTriggerBufferTimeInMs):
this.RAb&&this.ebg(this.$.ya.ExcelLiveMeetingBufferTimeInMs)}dispose(){this.controller=this.$=null;this.tJa&&(Yb.a.Ja(this.tJa),this.tJa=null);this.mqb&&(Yb.a.Ja(this.mqb),this.mqb=null)}ebg(ha){this.mqb=ua.AsyncMethodContext.vq(()=>{this.hhc=!0;this.KZd()},ha,La.a.zXg,this.mqb)}KZd(){this.utd||(this.ghc&&this.hhc?this.BPb(0):1===this.controller.Tk?this.RAb?this.hhc&&this.KCe():this.BPb(this.$.ya.ExcelLiveSurveyTriggerThresholdTimeInMs):2===this.controller.Tk&&(this.RAb?this.hhc&&this.BPb(this.$.ya.ExcelLiveSurveyChangedTriggerThresholdTimeInMs):
this.KCe()))}BPb(ha){this.tJa=ua.AsyncMethodContext.vq(()=>{this.utd||(this.$.Yc(-1404915046,-1,0,null),this.utd=!0,k.ULS.sendTraceTag(520495937,0,50,`ExcelLiveController.TriggerExcelLiveSurvey: ExcelLive survey shown using Buffer based trigger = ${this.ghc}, using Explorer based trigger = ${this.RAb} with trigger threshold = ${ha}`))},ha,La.a.BPb,this.tJa)}KCe(){this.tJa&&this.tJa.cancel()}}Object(r.a)(mc,"ExcelLiveSurveyManager",null,[]);class Zb extends Y.a{constructor(ha){super();this.Y2a=this.Z2a=
this.jq=null;this.Bnf=!1;this.VDb="ExcelLiveController::";this.QAb=f.f();this.K6a=Z.EwaSettings.isChangeGateEnabled("OfficeVSO:7451504_DependOnUserListChangedEventForPresenterDetails");this.mB=()=>{this.y1d(this.jq.Cz,`${this.VDb}onUserListChanged`)&&this.$.ea.O6(this.mB)};this.FCd=()=>{this.dod();this.lvc(`${this.VDb}onCommandUIGenerated`);this.$.ea.aWf(this.FCd)};k.ULS.sendTraceTag(509642591,0,50,"ExcelLiveController:Ctor");this.$=ha;this.Bnf=f.h(this.$);this.ahi();if(this.hEa=Z.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ExcelLiveSurvey",
!1))this.owg=new mc(ha,this)}dispose(){var ha,eb,ta;this.$=null;null===(ha=this.jq)||void 0===ha?void 0:ha.dispose();this.jq=null;null===(eb=this.Z2a)||void 0===eb?void 0:eb.dispose();this.Z2a=null;null===(ta=this.Y2a)||void 0===ta?void 0:ta.dispose();this.Y2a=null;this.QAb&&(this.$.ea.aWf(this.FCd),this.K6a&&this.$.ea.O6(this.mB));this.$=null}get wab(){return this.jq}get Tk(){return this.jq.Tk}get eve(){var ha,eb,ta;return!(null===(ha=this.jq)||void 0===ha||!ha.Cz)&&!(null===(eb=this.jq)||void 0===
eb||!eb.$ca)&&!(null===(ta=this.jq)||void 0===ta||!ta.Yab)}get Cz(){return this.jq.Cz}get NVe(){return this.owg}get Omf(){return this.hEa}hUa(ha,eb){this.jq.Tk&&this.jq.Tk===ha||(this.jq.Tk=ha,this.lvc(eb))}y1d(ha,eb){if(!ha)return k.ULS.sendTraceTag(528086352,0,10,"ExcelLiveController:savePresenterDetails Presenter CID is undefined"),!1;if(this.K6a&&this.eve&&this.jq.Cz===ha)return!0;const ta=this.$.ea.Jjd(ha);if(!ta)return k.ULS.sendTraceTag(528086351,0,10,"ExcelLiveController:savePresenterDetails Failed to get presenter information from sessionStateManager"),
this.QAb&&this.K6a&&this.jq.Cz!==ha&&(this.jq.c1f(ha,null,eb),this.$.ea.B9(this.mB)),!1;this.jq.c1f(ha,ta,eb);this.lvc(`${eb};${this.VDb}${"savePresenterDetails"}`);this.raiseEvent(Zb.xHd);return!0}CLd(){this.jq.CLd()}xob(ha){this.addHandler(Zb.xHd,ha)}xcb(ha){this.removeHandler(Zb.xHd,ha)}ahi(){this.jq=new mb(this.$);Z.EwaSettings.isChangeGateEnabled("OfficeVSO:7345545_InitMeetingUxOnChromeReady")?qa.a.get_instance().Lj(7,()=>{this.Tef()}):this.Tef();const ha=f.g(this.$)?0:3;this.hUa(ha,`${this.VDb}initializeController`)}dod(){const ha=
Ba.AFrameworkApplication.sa.Qa.df?document.getElementById("regionComposerRoot"):this.$.ar;this.Y2a=new Ra(this.$,ha,this.Tk)}Tef(){this.Uhi();this.Bnf&&(this.QAb?this.$.ea.Eka?this.dod():this.$.ea.pqe(this.FCd):this.dod());this.lvc(`${this.VDb}initializeMeetingUx`)}Uhi(){const ha=Ba.AFrameworkApplication.sa.Qa.df?document.getElementById("StatusBarRegion"):this.$.wE;this.Z2a=new na(this.$,ha)}lvc(ha){var eb,ta,ya,sb,Qb,oc;switch(this.jq.Tk){case 2:null===(eb=this.Z2a)||void 0===eb?void 0:eb.KMd(ha,
this.jq.Tk,this.jq.$ca);null===(ta=this.Y2a)||void 0===ta?void 0:ta.kKb(this.jq.Tk);break;case 1:null===(ya=this.Z2a)||void 0===ya?void 0:ya.KMd(ha,this.jq.Tk,this.jq.$ca,this.jq.Yab);null===(sb=this.Y2a)||void 0===sb?void 0:sb.kKb(this.jq.Tk,this.jq.Yab);break;case 3:case 0:null===(Qb=this.Z2a)||void 0===Qb?void 0:Qb.KMd(ha,this.jq.Tk),null===(oc=this.Y2a)||void 0===oc?void 0:oc.kKb(this.jq.Tk)}}}Zb.xHd="PDS";Object(r.a)(Zb,"ExcelLiveController",Y.a,[2]);var qb=a(712),Ha=a(83);class Ya extends t.a{constructor(ha){super();
this.vua=this.Bn=null;this.pvi=f.j();this.Gxa=null;this.dPa=()=>{this.Bn.bKb(this.dPa);k.ULS.sendTraceTag(537162849,0,50,"ExcelLiveManager::OnRealTimeChannelInitialized");const eb=Object(qb.a)(this.$.da,473,()=>new yb(this.$,this.Bn,this.vua,this.Gxa));this.nb(eb)};k.ULS.sendTraceTag(509642588,0,50,"ExcelLiveManagerFactory: Ctor");this.$=ha;this.Db()}create(){this.Ffi()}dispose(){this.Bn&&this.Bn.bKb(this.dPa);this.Bn=null;this.vua&&(this.vua.dispose(),this.vua=null);super.dispose()}Ffi(){k.ULS.sendTraceTag(509642587,
0,50,"ExcelLiveManagerFactory: InitExcelLiveMeeting");this.vua=new Zb(this.$);this.pvi&&(this.Gxa=Ha.a.instance.mg("Common.App.LiveMeeting.ILiveMeetingManager"));this.$.da.gb(26,ha=>{this.Bn=ha;this.f9g()})}f9g(){k.ULS.sendTraceTag(537162850,0,50,"ExcelLiveCommandHandlerFactory::ConnectToRealTimeChannel - attach RealTimeChannelInitialized handler");this.Bn.KXc(this.dPa);this.Bn.k0a()}static ka(ha){k.ULS.sendTraceTag(537162848,0,50,"ExcelLiveManagerFactory::Attach: Begin service registration");ha.da.Ha(474,
new Ya(ha));k.ULS.sendTraceTag(537162847,0,50,"ExcelLiveManagerFactory::Attach: Complete service registration")}}Object(r.a)(Ya,"ExcelLiveManagerFactory",t.a,[]);var Gb=a(98);class Ja extends Sys.EventArgs{constructor(ha){super();this.presenter=ha}}Object(r.a)(Ja,"PresenterIdentifiedEventArgs",Sys.EventArgs,[]);class Na extends Sys.EventArgs{constructor(){super()}}Object(r.a)(Na,"PresenterStateUpdatedEventArgs",Sys.EventArgs,[]);class Qa extends Sys.EventArgs{constructor(ha,eb){super();this.RHd=ha;
this.sIa=eb}}Object(r.a)(Qa,"RoleTransitionEventArgs",Sys.EventArgs,[]);class Oa{constructor(){this.Za=new Gb.a}dispose(){this.Za.dispose()}IXc(ha){this.Za.addHandler("EK_PI",ha)}mMd(ha){this.Za.removeHandler("EK_PI",ha)}MXc(ha){this.Za.addHandler("EK_RT",ha)}pMd(ha){this.Za.removeHandler("EK_RT",ha)}Gbj(ha){this.Za.raiseEvent("EK_PSU",new Na(ha))}Fbj(ha){this.Za.raiseEvent("EK_PI",new Ja(ha))}Mbj(ha,eb){this.Za.raiseEvent("EK_RT",new Qa(ha,eb))}}Object(r.a)(Oa,"LiveMeetingEventHub",null,[318,2]);
var bb=a(85);class Ga{constructor(ha,eb,ta,ya){this.data=ha;this.dD=eb;this.timestamp=ta;this.messageId=ya}}Object(r.a)(Ga,"LiveMeetingData",null,[]);var tb=a(1426),wb=a(39);class lb{constructor(){this.EHc=0;this.B1=-1E8;this.O8=Number.MAX_VALUE;this.Vt=-1E8;this.MRc=0}add(ha){this.O8=ha<this.O8?ha:this.O8;this.B1=ha>this.B1?ha:this.B1;this.EHc=(ha+this.EHc*this.MRc)/++this.MRc;this.Vt=-1E8===this.Vt?ha:this.Vt}reset(){this.EHc=0;this.O8=Number.MAX_VALUE;this.B1=-1E8;this.MRc=0;this.Vt=-1E8}toString(){return wb.c(this)}}
Object(r.a)(lb,"LatencyMetrics",null,[]);var db;(function(ha){ha[ha.unknown=0]="unknown";ha[ha.presenter=1]="presenter";ha[ha.follower=2]="follower";ha[ha.explorer=4]="explorer";ha[ha.default=0]="default"})(db||(db={}));Object(r.b)("ParticipantRole",db);var Pa=a(111),ja=a(100);class Ka{constructor(ha){this.j1=this.dlb=this.Pfa=this.sX=this.EPc=null;this.lVb=this.qVb=this.ukb=this.Bfa=this.v8=this.ojb=this.X8=this.pVb=this.mVb=this.CSb=this.LVb=this.Fie=this.PVb=this.KPc=0;this.Nhb=new ja.a;this.JYb=
new ja.a;this.KYb=new ja.a;this.WWb=new lb;this.yX=ha}get CFg(){return this.currentTime()-this.mVb}get Ble(){return this.currentTime()-this.pVb}get DFg(){return this.currentTime()-this.ukb}get EFg(){return this.currentTime()-this.Bfa}get AFg(){return this.currentTime()-this.LVb}dispose(){k.ULS.sendTraceTag(520647007,230,10,Ka.Dy+"Dispose: Dispose called.");this.HId();this.yX.mMd(Object(bb.a)(this,this.tOf,"presenterIdentifiedEventHandler"));this.yX.pMd(Object(bb.a)(this,this.J_f,"roleTransitionEventHandler"))}qej(ha,
eb){const ta=this.currentTime();this.qVb=this.pVb=this.LVb=ta;this.sX=this.aid(eb);this.EPc=ha;this.yX.IXc(Object(bb.a)(this,this.tOf,"presenterIdentifiedEventHandler"));this.yX.MXc(Object(bb.a)(this,this.J_f,"roleTransitionEventHandler"));k.ULS.sendTraceTag(520722377,230,50,Ka.Dy+"MeetingManagerInitialization: Meeting manager initialized with meeting ID [{0}] and initial role [{1}]",this.EPc,this.sX)}eej(ha,eb){const ta=this.currentTime();this.mVb=this.lVb=this.CSb=ta;this.j1=Da.a[ha];this.Nhb.ia(this.j1,
1);this.dlb=eb;k.ULS.sendTraceTag(520722376,230,50,Ka.Dy+"CommunicationChannelInitialized: Initialized with ConnectionState:[{0}] and Identifier:[{1}]",this.j1,this.dlb)}fej(ha,eb){const ta=this.currentTime();ha=Da.a[ha];eb=Da.a[eb];ha!==this.j1?k.ULS.sendTraceTag(520722375,230,10,Ka.Dy+"RecordCommunicationChannelStateChange: Current state [{0}] not equal to received old state [{1}]",this.j1,ha):this.Wkg(ta);this.j1!==eb&&(k.ULS.sendTraceTag(520722374,230,50,Ka.Dy+"CommunicationChannelStateChange: Recorded ConnectionState change from [{0}] to [{1}] after [{2}]ms with current participant role [{3}]",
ha,eb,this.CFg,this.sX),ha=this.Nhb.hb(eb)?this.Nhb.ma(eb):0,this.Nhb.ia(eb,1+ha),this.j1=eb,this.lVb=this.mVb=ta);this.HId()}cJb(ha){const eb=this.currentTime();this.KPc++;this.ojb=this.ojb?this.ojb:eb;const ta=eb-(this.Bfa?this.Bfa:this.ojb);this.Bfa=eb;k.ULS.sendTraceTag(520722373,230,50,Ka.Dy+"MessageSent: Sent message number [{0}] with message ID [{1}] after [{2}]ms",this.KPc,ha,ta)}uej(ha){this.X8=this.currentTime();this.Pfa=ha;k.ULS.sendTraceTag(520722372,230,50,Ka.Dy+"PresenterIdentified: Presenter identified at [{0}] with identifier:[{1}]",
this.X8,this.Pfa.clientId)}oQa(ha,eb){const ta=this.currentTime(),ya=new Date;this.PVb++;this.v8=this.v8?this.v8:ta;const sb=ta-(this.ukb?this.ukb:this.v8);this.ukb=ta;1!==this.PVb&&this.WWb.add(+ya-+eb);k.ULS.sendTraceTag(520722371,230,50,Ka.Dy+"MessageReceived: Received message number [{0}] with message ID [{1}] after [{2}]ms with current latency distribution: [{3}]",this.PVb,ha,sb,this.WWb)}yej(ha,eb){const ta=this.currentTime();ha=this.aid(ha);eb=this.aid(eb);ha!==this.sX?k.ULS.sendTraceTag(520722370,
230,10,Ka.Dy+"RoleChange: Current participant role [{0}] not equal to received old participant role [{1}]",this.sX,ha):this.Xkg(ta);this.sX!==eb&&(k.ULS.sendTraceTag(520722369,230,50,Ka.Dy+"RoleChange: Recorded ParticipantRole change from [{0}] to [{1}] after [{2}]ms",ha,eb,this.Ble),this.Fie++,this.sX=eb,this.qVb=this.pVb=ta)}aid(ha){return 0===ha?"unknown":Object(tb.a)(db,ha)}get Uga(){return"presenter"===this.sX.toLowerCase()}Xkg(ha=0){ha=ha?ha:this.currentTime();const eb=this.KYb.hb(this.sX)?
this.KYb.ma(this.sX):0;this.KYb.ia(this.sX,eb+(ha-this.qVb));this.qVb=ha}Wkg(ha=0){ha=ha?ha:this.currentTime();const eb=this.JYb.hb(this.j1)?this.JYb.ma(this.j1):0;this.JYb.ia(this.j1,eb+(ha-this.lVb));this.lVb=ha}tOf(ha,eb){this.uej(eb.presenter)}J_f(ha,eb){this.yej(eb.RHd,eb.sIa)}currentTime(){return window.performance.now()}HId(){this.Xkg();this.Wkg();this.B$i();this.C$i()}B6g(){return{["communicationChannelId"]:this.dlb,["currentConnectionState"]:this.j1,["timeToChannelInitializationFromMeetingManagerCreationMs"]:this.CSb-
this.LVb,["lastCommunicationChannelStateChange"]:this.mVb,["channelConnectionStateCounts"]:this.aXd(this.Nhb),["timeInCommunicationChannelStateMs"]:this.aXd(this.JYb),["receivedMessageLatencyMs"]:this.WWb}}B$i(){k.ULS.sendTraceTag(520722368,230,50,Ka.Dy+"CommunicationChannelMetrics: {0}",Pa.a.toJSON(this.B6g()))}F6g(){return{["meetingId"]:this.EPc,["meetingManagerCreated"]:this.LVb,["communicationChannelInitializated"]:this.CSb,["amIPresenter"]:this.Uga,["timeInSession"]:this.AFg,["communicationChannelId"]:this.dlb,
["currentRole"]:this.sX,["lastRoleChanged"]:this.pVb,["totalRoleChangeCount"]:this.Fie,["totalTimeInAllRolesMs"]:this.aXd(this.KYb),["timeInCurrentRoleMs"]:this.Ble,["presenterId"]:this.Uga?this.dlb:this.X8?this.Pfa.clientId:"unidentified",["presenterIdentified"]:this.X8,["timeToIdentifyPresenterFromChannelInitializationMs"]:this.X8-this.CSb,["firstMessageSent"]:this.ojb,["lastMessageSent"]:this.Bfa,["timeSinceLastMessageSentMs"]:this.EFg,["numberOfMessagesSent"]:this.KPc,["firstMessageReceived"]:this.v8,
["lastMessageReceived"]:this.ukb,["receivedMessagedLatenciesMs"]:this.WWb,["timeSinceLastMessageReceivedMs"]:this.DFg,["numberOfMessagesReceived"]:this.PVb}}aXd(ha){const eb=new Sys.StringBuilder;for(let ta of ha.keys)eb.append(String.format('"{0}": {1}',ta,ha.ma(ta)));return"{"+eb.toString(",")+"}"}C$i(){k.ULS.sendTraceTag(520722339,230,50,Ka.Dy+"MeetingMetrics: {0}",Pa.a.toJSON(this.F6g()))}}Ka.Dy="LiveMeetingMetrics::";Object(r.a)(Ka,"LiveMeetingMetrics",null,[2]);class ub{constructor(ha,eb){this.Xab=
ha;this.L5=eb}}Object(r.a)(ub,"MeetingInfo",null,[]);var Kb=a(602),W=a(55);class za{constructor(ha,eb,ta,ya,sb){this.TVb=this.gx=null;this.X8=!1;this.LI=0;this.iee=null;this.Il=eb;this.yX=ta;this.HXa=ha;this.Uga=sb;this.Il.qej(ya,sb?1:0);Ba.AFrameworkApplication.efb(()=>{this.Il.HId()});this.HXa.continueWith(()=>{this.HXa.result?(this.gx=this.HXa.result,this.Il.eej(this.gx.connectionState,this.gx.clientId),this.gx.n2(Object(bb.a)(this,this.mR,"onRtcConnectionStateChanged")),this.iee=new ub(this.jei(),
ya),this.TVb=this.Uga?this.dD.Xab:new Kb.a(this.gx.clientId),2===this.gx.connectionState&&this.qPf()):k.ULS.sendTraceTag(520722385,230,10,za.Dy+"Constructor: Result of rtc task is null.")})}get Xab(){return this.dD.Xab}get dD(){return this.iee}dispose(){k.ULS.sendTraceTag(520647008,230,10,za.Dy+"Dispose: Dispose called.");this.Uga||this.gx.jMd(Object(bb.a)(this,this.$Oa,"onPersistentStateUpdated"));this.gx.L6(Object(bb.a)(this,this.mR,"onRtcConnectionStateChanged"));this.gx=null}IXc(ha){this.yX.IXc(ha)}mMd(ha){this.yX.mMd(ha)}MXc(ha){this.yX.MXc(ha)}pMd(ha){this.yX.pMd(ha)}k3f(ha){if(this.Uga){const eb=
++this.LI;this.gx.zxc(2,new Ga(ha,this.dD,new Date,eb));this.Il.cJb(eb)}else k.ULS.sendTraceTag(520722382,230,10,za.Dy+"SendUpdate: Ignoring the update since session is not for presenter."),W.Task.Sa(null)}dGi(){this.vBe(4)}eGi(){this.vBe(2)}BBc(){}vBe(ha){if(this.Uga)k.ULS.sendTraceTag(520722381,230,10,za.Dy+"ChangeMyRole: Ignoring role change since we are in presenter session.");else{var eb=this.TVb.role;this.TVb.role=ha;this.yX.Mbj(eb,this.TVb.role)}}HOh(){return this.gx.bfd(2)}jei(){return this.Uga?
(this.X8=!0,new Kb.a(this.gx.clientId,void 0,void 0,1)):this.Bdf(this.HOh())}Bdf(ha){for(let ta in ha){var eb=ta;const ya=ha[ta];if(ya&&ya.dD&&ya.dD.L5===this.L5)return this.X8=!0,ha=new Kb.a(eb,void 0,void 0,1),this.yX.Fbj(ha),ha}k.ULS.sendTraceTag(520722380,230,15,za.Dy+"IdentifyPresenter: Unable to identify presenter.");return null}Pni(ha){return!!ha&&ha.L5===this.L5}get pza(){return this.dD.Xab?this.dD.Xab.clientId:null}get L5(){return this.dD.L5}mR(ha,eb){this.Il.fej(eb.oldState,eb.newState);
2===eb.newState&&this.qPf()}qPf(){this.Uga?this.k3f(null):(this.gx.HXc(Object(bb.a)(this,this.$Oa,"onPersistentStateUpdated")),this.APf(this.gx.bfd(2)))}APf(ha){this.X8||(this.dD.Xab=this.Bdf(ha));this.X8&&this.pza in ha?(ha=ha[this.pza],ha=new Ga(ha.data,ha.dD,new Date(ha.timestamp),ha.messageId),this.Pni(ha.dD)?(this.Il.oQa(ha.messageId,ha.timestamp),this.yX.Gbj(ha.data)):k.ULS.sendTraceTag(520722378,230,10,za.Dy+"PersistentStateUpdated: Presenter data is for an unexpected meeting. PresenterId:[{0}], ExpectedMeetingId:[{1}], ActualMeetingId:[{2}]",
this.pza,this.L5,ha.dD?ha.dD.L5:"null")):k.ULS.sendTraceTag(520722379,230,10,za.Dy+"PersistentStateUpdated: Unable to find data related to presenter in the received update.")}$Oa(ha,eb){k.ULS.sendTraceTag(527751173,230,100,"Updated clients: [{0}]",wb.c(eb.pL));2===eb.type&&this.APf(eb.pL)}static createInstance(ha,eb,ta){if(!eb||!eb.trim().length)return k.ULS.sendTraceTag(520722384,230,10,za.Dy+"CreateInstance: Responding with a null instance since meeting ID is null/blank"),null;const ya=new Oa,sb=
new Ka(ya);return new za(ha,sb,ya,eb,ta)}}za.Dy="LiveMeetingManager::";Object(r.a)(za,"LiveMeetingManager",null,[319,2]);var Sa=a(251),Wa=a(519);class ab{constructor(){this.$a=null}get name(){return"Common.App.LiveMeeting"}jV(){return Ba.AFrameworkApplication.jV||Ba.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingSessionOverrideEnabled",!1)}Aic(){return Ba.AFrameworkApplication.Aic||Ba.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.Shared.IsLiveMeetingPresenterOverrideEnabled",
!1)}Bh(ha){this.$a=ha;this.jV()&&(this.$a.register(Oa,"Common.App.LiveMeeting.LiveMeetingEventHub").as("Common.App.LiveMeeting.ILiveMeetingEventHub").qc().yc(()=>new Oa),this.$a.register(Ka,"Common.App.LiveMeeting.LiveMeetingMetrics").qc().yc(()=>new Ka(this.$a.mg("Common.App.LiveMeeting.ILiveMeetingEventHub"))),this.$a.register(za,"Common.App.LiveMeeting.LiveMeetingManager").as("Common.App.LiveMeeting.ILiveMeetingManager").qc().yc(()=>new za(Wa.a.Rq(this.$a.Tb("Common.IRealtimeChannelBasic")),this.$a.mg("Common.App.LiveMeeting.LiveMeetingMetrics"),
this.$a.mg("Common.App.LiveMeeting.ILiveMeetingEventHub"),Ba.AFrameworkApplication.L5,this.Aic())))}init(){Ba.AFrameworkApplication.fa.ru(()=>{this.$a.mg("Common.App.LiveMeeting.ILiveMeetingEventHub");this.$a.mg("Common.App.LiveMeeting.LiveMeetingMetrics");this.$a.mg("Common.App.LiveMeeting.ILiveMeetingManager")})}dispose(){}static main(){Sa.a.instance.ii(new ab)}}Object(r.a)(ab,"LiveMeetingPackage",null,[3,4]);a.d(F,"a",function(){return ma});const ma=()=>{c.a.Fa(ha=>{k.ULS.sendTraceTag(509642592,
0,50,`ExcelLiveBootstrapper.main: Called at ${S.HelperMethods.Kb()}`);f.j()&&(Type.registerNamespace("Common.App.LiveMeeting"),ab.main());Ya.ka(ha);l.ka(ha)})}},1469:function(r,F,a){a.r(F);r=a(1141);F=a(0);var c=a(15),b=a(85);class e extends Sys.EventArgs{constructor(){super()}}Object(F.a)(e,"RtcHostNotificationEventArgs",Sys.EventArgs,[]);var f;(function(ba){ba[ba.notYetStarted=0]="notYetStarted";ba[ba.polling=1]="polling";ba[ba.subscribed=2]="subscribed";ba[ba.blocked=3]="blocked";ba[ba.permanentlyStopped=
4]="permanentlyStopped"})(f||(f={}));Object(F.b)("RtcHostNotificationSubscriptionState",f);var d=a(109);class h extends Sys.EventArgs{constructor(ba,Y,Z,ea){super();this.VHd=ba;this.newState=Y;this.$8i=Z;this.a9i=ea}}Object(F.a)(h,"StateChangedEventArgs",Sys.EventArgs,[]);var l=a(98);class k{constructor(ba){this.Za=new l.a;this.Cke=new Date;this.r7d=ba;this.tKc=0}get currentState(){return this.r7d}get NQe(){return this.tKc}event(ba,Y=null){this.currentState!==ba&&(this.bIh(this.currentState,ba,this.NQe,
Y),this.tKc=0,this.Cke=new Date);this.r7d=ba;this.tKc=this.NQe+1}bIh(ba,Y,Z,ea){ba=new h(ba,Y,Z,this.Cke,ea);this.Za.raiseEvent("c",ba)}XXc(ba){this.Za.addHandler("c",ba)}bXf(ba){this.Za.removeHandler("c",ba)}}Object(F.a)(k,"StateMachine",null,[718]);class t{constructor(ba,Y,Z,ea,ra,O,da,xa,ia){this.Gm=!1;this.LXb=this.uXa=this.eP=this.Xfa=null;this.Kmb=t.tGc;this.Za=new l.a;this.xra=new k(0);this.xra.XXc(Object(b.a)(this,this.N_i,"onStateMachineChanged"));this.pDg=ba;this.vXb=Y;this.oDg=Z;this.wSc=
ea;this.he=ra;this.aT=O;da.execute(Ma=>{this.Gm||(this.uXa=Ma,this.uXa.eZa(Object(b.a)(this,this.Jca,"onUpdateNotificationReceived")),this.start())});xa.execute(Ma=>{this.Gm||(this.LXb=Ma,Ma.uob(Object(b.a)(this,this.mPa,"onTokenRefreshed")))});this.Ale=ia}get ffb(){return this.xra.currentState}get omf(){return!this.aT||this.aT.Hnf}get j5(){return 2===this.ffb&&this.Ale()<this.Kmb}start(){0!==this.ffb?c.ULS.sendTraceTag(573100178,502,15,"HostNotifications: Tried starting poll when in state {0}",f[this.ffb]):
(this.xra.event(1),this.BQd(null))}BQd(){this.Xfa=null;if(this.omf){c.ULS.sendTraceTag(573100181,502,50,"HostNotifications: Send event when connected.  Current state: {0}",f[this.ffb]);let ba=null;this.wSc&&this.wSc.length&&(ba={},ba.etts=this.wSc);this.uXa.Qda(14,ba,!0);this.H1f(this.pDg)}else this.xra.event(3)}H1f(ba){this.Xfa=d.a.d6b(1E3*ba,Object(b.a)(this,this.BQd,"sendSubscribeEvent"),this.vXb,192,"RtcHostNotificationSubscribe");this.he.fg(this.Xfa)}stj(ba){ba=1E3*(ba+this.oDg);const Y=this.Ale().getTime()+
ba;this.Kmb=new Date(Y);ba-=this.vXb;this.eP?this.he.hna(this.eP,ba):(this.eP=d.a.d6b(ba,Object(b.a)(this,this.YUj,"transitionToPollingEvent"),this.vXb/2,194,"RtcHostNotificationTransitionToPolling"),this.he.fg(this.eP))}YUj(){this.eP=null;2===this.ffb&&(this.xra.event(1),c.ULS.shipAssertTag(573100185,502,!!this.Xfa,"Missing task to ensure that we re-subscribe."))}mPa(){this.Q8h()}Q8h(){3===this.ffb&&this.omf&&(this.xra.event(this.j5?2:1),this.BQd(null))}Jca(ba,Y){if(13===Y.type&&(ba=Y.O7,c.ULS.sendTraceTag(573100183,
502,50,"HostNotifications: Subscription status: {0}",{["SerializableHostNotificationSubscription"]:ba,["DurationBeforeExpirationToResubscribeInSec"]:this.vXb}),Y=ba.cts,!this.fXj(Y))){if(ba.sb){var Z=2;this.stj(ba.cts)}else Z=1,this.Kmb=t.tGc,this.eP&&(this.he.Uo(this.eP),this.eP=null);this.xra.event(Z);this.Xfa?this.he.hna(this.Xfa,1E3*Y):this.H1f(Y)}}fXj(ba){if(!isNaN(ba)&&isFinite(ba)&&0<ba)return!1;this.ccg(!1);return!0}ccg(ba){this.Xfa&&(this.he.Uo(this.Xfa),this.Xfa=null);this.eP&&(this.he.Uo(this.eP),
this.eP=null);this.uXa&&(this.uXa.gKb(Object(b.a)(this,this.Jca,"onUpdateNotificationReceived")),this.uXa=null);this.LXb&&(this.LXb.Wuc(Object(b.a)(this,this.mPa,"onTokenRefreshed")),this.LXb=null);ba||this.xra.event(4)}N_i(ba,Y){ba=Y.newState;const Z=Y.VHd,ea={};ea.NewState=f[ba];ea.PreviousState=f[Z];ea.PreviousStateHits=Y.$8i;ea.PreviousStateTransitionTime=Y.a9i.toISOString();ea.IsSubscribed=this.j5;this.Kmb!==t.tGc&&(ea.SubscriptionExpiringTime=this.Kmb.toISOString());c.ULS.sendTraceTag(572346515,
502,4===ba?15:50,"HostNotificationChanged: {0}",ea);this.Za.raiseEvent("HN",new e(Z,ba))}dispose(){this.Gm||(this.Gm=!0,this.ccg(!0),this.eP&&(this.he.Uo(this.eP),this.eP=null))}}t.tGc=new Date(0);Object(F.a)(t,"RtcHostNotificationSubscriptionManager",null,[687,2]);var n=a(4),z=a(251),w=a(650),m=a(83);class u{constructor(){this.dx=this.Gm=!1}get name(){return"RtcHostNotificationSubscription"}Bh(ba){ba.register(t,"Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").as("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager").qc().yc(()=>
{const Y=n.AFrameworkApplication.fa;return new t(Y.vd("RtcHostNotificationRetryIntervalIdeallyInSeconds",1800),Y.vd("RtcHostNotificationRetryIntervalBufferInSeconds",120),Y.vd("RtcHostNotificationSubscriptionLostBufferInSeconds",60),this.G2h(Y),n.AFrameworkApplication.ji,w.SessionStatusManager.instance,ba.Tb("Common.IRealtimeChannelBasic"),ba.Tb("Common.ISessionExpirationManager"),()=>new Date)})}init(){n.AFrameworkApplication.fa.ru(()=>{!this.Gm&&n.AFrameworkApplication.fa.pa("RtcHostNotificationEnabled")&&
(this.dx=!0,m.a.instance.resolve("Common.App.RtcHostNotificationSubscription.IRtcHostNotificationSubscriptionManager"))})}dispose(){this.Gm||(this.Gm=!0,this.dx&&m.a.instance.resolve("Common.App.RtcHostNotificationSubscription.RtcHostNotificationSubscriptionManager").dispose())}G2h(ba){return ba.Gp("RtcEventTypesToSubscribe")?ba.kw("RtcEventTypesToSubscribe"):null}static main(){z.a.instance.ii(new u)}}Object(F.a)(u,"RtcHostNotificationSubscriptionPackage",null,[3,4]);var y=a(108),v=a(25);class C{constructor(ba,
Y){this.Ma=ba;this.UWa=Y}Ag(){this.Ma.Nb(v.a.Bqf,y.a.frame,Object(b.a)(this,this.Cqf,"livePersonaCardActionHandler"))}NPb(){this.Ma.xD(v.a.Bqf,y.a.frame,Object(b.a)(this,this.Cqf,"livePersonaCardActionHandler"))}Cqf(ba,Y,Z,ea,ra){if(!ra||3===Z)return 2;if(1===Z)return this.wYa(this.UWa.kAe(ra.upn||ra.aadObjectId));if(!this.ith(ra))return 8;switch(ra.action){case 0:return this.wYa(this.UWa.wIg(ra));case 1:return this.wYa(this.UWa.vIg(ra));case 2:return this.wYa(this.UWa.xIg(ra));case 3:return this.wYa(this.UWa.openCard(ra));
case 4:return this.wYa(this.UWa.Qhj(ra));default:return 2}}ith(ba){const Y=ba.upn||ba.aadObjectId;return ba.targetElement&&(4===ba.action||Y&&""!==Y)?!0:!1}wYa(ba){return ba?32:8}}Object(F.a)(C,"LivePersonaCardActor",null,[]);var x=a(160),B=a(84);class H{}Object(F.a)(H,"BootstrapperConfig",null,[]);class I{}Object(F.a)(I,"LivePersonaCardInitializerResult",null,[]);class U{}U.Rxe=null;Object(F.a)(U,"LivePersonaCardModule",null,[]);var S=a(558);class G{constructor(ba,Y,Z,ea=null){this.Ck=new x.a;this.wBg=
ba;this.oAg=Y;this.mb=Z;this.Cjb=ea}init(){this.$jf()?this.wBg.SAi().continueWith(Object(b.a)(this,this.HXi,"onPackageLoaded")):this.Ck.setResult(Object.assign(new I,{isInitialized:!1,isEnabled:!1,failureMessage:"LivePersonaCard is not enabled."}));return this.Ck.task}HXi(){const ba=U.Rxe;if(ba){const Y=this.SPh();try{ba.initializeLivePersonaCardAsync(Y).then(()=>{this.Ck.setResult(Object.assign(new I,{isInitialized:!0,isEnabled:!0}))}).catch(Z=>{const ea=Object(B.a)(String,Z);ea?this.Ck.setException(Error.create(ea)):
this.Ck.setException(Error.create(JSON.stringify(Z)))})}catch(Z){this.Ck.setException(Z)}}else this.Ck.setResult(Object.assign(new I,{isInitialized:!1,isEnabled:!0,failureMessage:"LivePersonaCardBootstrapper package is not loaded."}))}SPh(){const ba=S.a.NJ(n.AFrameworkApplication.lcid);return Object.assign(new H,{culture:ba?ba.name.toLocaleLowerCase():"en-us",clientType:this.mb.Wa("LivePersonaCardClientType"),clientContextType:"Generic",clientCorrelationId:n.AFrameworkApplication.userSessionId,complianceEnvironment:this.XRh(),
logMessage:Object(b.a)(this,this.logMessage,"logMessage"),getAuthToken:Object(b.a)(this,this.getAuthToken,"getAuthToken")})}$jf(){if(!this.mb.pa("LivePersonaCardIsEnabled")||!this.xRg())return!1;const ba=this.mb.Wa("SovereignEnvironmentName");return ba&&""!==ba?ba.toLocaleLowerCase()==="USGov".toLocaleLowerCase()||ba.toLocaleLowerCase()==="Blackforest".toLocaleLowerCase()?!0:!1:!0}xRg(){return this.mb.pa("CoauthorGalleryLivePersonaCardIsEnabled")||!!n.AFrameworkApplication.sa&&n.AFrameworkApplication.sa.Qa.sSa}XRh(){return this.mb.Wa("LivePersonaCardComplianceEnvironment")}logMessage(ba,
Y,Z){ba=JSON.stringify({["Log Type"]:ba,["Log Result Type"]:Y,["Message"]:Z});c.ULS.sendTraceTag(50431106,3006,50,ba)}getAuthToken(ba,Y){n.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?this.Cjb.continueWith(Z=>{Z.kh||Z.Hf?Y("LokiTokenManagerTask is either canceled or faulted.",n.AFrameworkApplication.userSessionId):this.Cjb.result.xhd().then(ea=>{ea.isSuccess&&ea.token&&ea.token.length?ba(ea.token,n.AFrameworkApplication.userSessionId):Y(ea.errorMessage,
n.AFrameworkApplication.userSessionId)}).catch(ea=>c.ULS.sendTraceTag(539617039,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(ea)))}):this.oAg.xhd().then(Z=>{Z.isSuccess&&Z.token&&Z.token.length?ba(Z.token,n.AFrameworkApplication.userSessionId):Y(Z.errorMessage,n.AFrameworkApplication.userSessionId)}).catch(Z=>c.ULS.sendTraceTag(50431107,3006,10,"Unexpected exception received from GetLokiToken: {0}",JSON.stringify(Z)))}}Object(F.a)(G,"LivePersonaCardInitializer",null,
[]);class D{}Object(F.a)(D,"Behavior",null,[]);class E{}Object(F.a)(E,"Identifiers",null,[]);class N{}Object(F.a)(N,"LivePersonaCardParameters",null,[]);class M{}Object(F.a)(M,"PersonaInfo",null,[]);class L{constructor(ba){this.wyg=ba}kAe(ba){return this.wyg.$jf()&&ba&&""!==ba?!!window.self.LPC:!1}wIg(ba){return this.FPb("addedPersonaToPageV2",ba,0)}vIg(ba){return this.FPb("addedPersonaToPageV2",ba,1)}xIg(ba){return this.FPb("addedPersonaToPageV2",ba,2)}openCard(ba){return this.FPb("openCard",ba)}Qhj(ba){return this.FPb("removedPersonaFromPage",
ba)}k1g(ba){return!!ba.targetElement&&(this.kAe(ba.upn||ba.aadObjectId)||4===ba.action)}FPb(ba,Y,Z=3){if(!this.k1g(Y))return!1;Z=4!==Y.action?this.xeh(Y,Z):null;const ea=window.self.LPC;if(ea&&ea[ba]){if(Z)ea[ba](Y.targetElement,Z);else ea[ba](Y.targetElement);return!0}return!1}xeh(ba,Y=3){const Z=Object.assign(new E,{PersonaType:"User",Upn:ba.upn,AadObjectId:ba.aadObjectId});return Object.assign(new N,{personaInfo:Object.assign(new M,{identifiers:Z,displayName:ba.name,personaCoinColor:ba.color}),
behavior:Object.assign(new D,{onCardOpen:()=>{c.ULS.sendTraceTag(595067869,3006,100,"LivePersonaCard opened");if(ba.onCardOpen)ba.onCardOpen()},onCardClose:ba.onCardClose,disableClick:2===Y||3===Y,disableHover:0===Y||3===Y})})}}Object(F.a)(L,"LivePersonaCardManager",null,[]);class aa{constructor(ba){this.JDg=ba}SAi(){const ba=n.AFrameworkApplication.$N("midgardbootstrapper.js",5);return this.JDg.owd(ba).continueWith(()=>{U.Rxe=window.self.MidgardBootstrapper})}}Object(F.a)(aa,"LivePersonaCardPackageLoader",
null,[766]);var V=a(519);class P{constructor(){this.$a=null}get name(){return"Common.App.LivePersonaCard"}init(){n.AFrameworkApplication.fa&&n.AFrameworkApplication.fa.ru(Object(b.a)(this,this.lB,"onFullAppSettingsReady"))}dispose(){}Bh(ba){this.$a=ba}lB(){let ba;ba=n.AFrameworkApplication.fa.isChangeGateEnabled("Microsoft.Office.SharedOnline.ChangeGate.LokiFutureObject")?new G(new aa(this.$a.resolve("Common.ISharedDependencyLoader")),null,n.AFrameworkApplication.fa,V.a.Rq(this.$a.Tb("Common.ILokiTokenManager"))):
new G(new aa(this.$a.resolve("Common.ISharedDependencyLoader")),this.$a.resolve("Common.ILokiTokenManager"),n.AFrameworkApplication.fa);ba.init().continueWith(Y=>{Y.Hf&&Y.exception?c.ULS.sendTraceTag(50431108,3006,15,"Failed to initialize LivePersonaCard, exception: [{0}]",Y.exception.message):((Y=Y.result)||c.ULS.sendTraceTag(595067868,3006,15,"LivePersonaCardInitializer did not return a result"),Y.isInitialized?c.ULS.sendTraceTag(50431109,3006,100,"Successfully initialized LivePersonaCard"):c.ULS.sendTraceTag(595067867,
3006,Y.isEnabled?15:100,"Failed to initialize LivePersonaCard, failure message: [{0}]",Y.failureMessage))});(new C(n.AFrameworkApplication.rb,new L(ba))).Ag()}static main(){z.a.instance.ii(new P)}}Object(F.a)(P,"LivePersonaCardPackage",null,[3,4]);a=a(1164);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.ExcelLive");Type.registerNamespace("_Ewa");Object(r.a)();Type.registerNamespace("Common.App.RtcHostNotificationSubscription");u.main();Type.registerNamespace("Common.App.LivePersonaCard.Contracts");
Type.registerNamespace("Common.App.LivePersonaCard");P.main();Type.registerNamespace("AppRealtimeChannel");Object(a.a)()}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.rt.js.map/86e7287ccb2e5882256a6dcaa391ac94/EwaDSEsNext.rt.js.map