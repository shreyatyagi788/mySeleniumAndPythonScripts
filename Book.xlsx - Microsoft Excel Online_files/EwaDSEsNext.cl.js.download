'use strict';(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[9],{1005:function(r,F,a){a.d(F,"a",function(){return c});r=a(0);class c extends Sys.EventArgs{constructor(b,e,f,d){super();this.type=b;this.O7=e;this.rlh=f;this.uoa=d}}Object(r.a)(c,"SendUpdateNotificationEventArgs",Sys.EventArgs,[])},1006:function(r,F,a){a.d(F,"a",function(){return c});r=a(0);class c{}c.$Od="rr";c.yrj="rd";c.wrj="rbp";c.nQd="sa";Object(r.a)(c,"RtcReconnectParams",null,[])},1007:function(r,F,a){a.d(F,
"a",function(){return c});r=a(0);class c{constructor(b,e,f,d){this.zIi=b;this.xBa=e;this.DHi=f;this.O7h=d}}Object(r.a)(c,"ThrottlerManagerSettings",null,[])},1185:function(r,F,a){r=a(0);class c extends Sys.EventArgs{constructor(B,H){super();this.newState=B;this.oldState=H}}Object(r.a)(c,"ChangedConnectionStateEventArgs",Sys.EventArgs,[]);class b extends Sys.EventArgs{constructor(B,H){super();this.D5g=B;this.uoa=H}}Object(r.a)(b,"ClientInfoEventArgs",Sys.EventArgs,[]);class e extends Sys.EventArgs{constructor(B){super();
this.presence=B}}Object(r.a)(e,"MyPresenceUpdatedEventArgs",Sys.EventArgs,[]);class f extends Sys.EventArgs{constructor(B){super();this.V2c=B}}Object(r.a)(f,"PersistentStateClearedEventArgs",Sys.EventArgs,[]);class d extends Sys.EventArgs{constructor(B,H){super();this.type=B;this.pL=H}}Object(r.a)(d,"PersistentStateUpdateEventArgs",Sys.EventArgs,[]);var h=a(1348);class l extends Sys.EventArgs{constructor(B,H=null){super();this.vG=B;this.cGg=H}get type(){return this.vG}get O7(){return this.cGg}}Object(r.a)(l,
"UpdateNotificationEventArgs",Sys.EventArgs,[]);class k extends Sys.EventArgs{constructor(){super()}}Object(r.a)(k,"GotCompletePersistentStateWithMetadataEventArgs",Sys.EventArgs,[]);class t extends Sys.EventArgs{constructor(B,H,I,U,S,G){super();this.Qgb=B;this.o4c=H;this.g9g=I;this.pWe=S;this.w2c=U;this.stopwatch=G}}Object(r.a)(t,"RefreshAllPersistentStateEventArgs",Sys.EventArgs,[]);class n extends Sys.EventArgs{constructor(B){super();this.hubConnection=B}}Object(r.a)(n,"RefreshProxyEventArgs",
Sys.EventArgs,[]);class z extends Sys.EventArgs{constructor(B,H){super();this.errorMessage=H}}Object(r.a)(z,"RtcConnectFailedEventArgs",Sys.EventArgs,[]);class w extends Sys.EventArgs{constructor(B,H,I){super();this.type=B;this.presence=H;this.uoa=I}}Object(r.a)(w,"SendPersistentStateEventArgs",Sys.EventArgs,[]);var m=a(1005);class u extends Sys.EventArgs{constructor(){super()}}Object(r.a)(u,"SessionPropertiesChangedEventArgs",Sys.EventArgs,[]);class y extends Sys.EventArgs{constructor(B){super();
this.V2c=B}}Object(r.a)(y,"UpdatePersistentStateClearedRequestEventArgs",Sys.EventArgs,[]);class v extends Sys.EventArgs{constructor(B,H){super();this.type=B;this.U2j=H}}Object(r.a)(v,"UpdatePersistentStateRequestEventArgs",Sys.EventArgs,[]);var C=a(98);a.d(F,"a",function(){return x});class x{constructor(){this.Za=new C.a}Qaj(B,H){this.Za.raiseEvent("CSC",new c(B,H))}Jbj(B){this.Za.raiseEvent("RP",new n(B))}ntc(B){this.Za.raiseEvent("RC",B)}Lbj(){this.Za.raiseEvent("RMID")}Ibj(B,H,I,U,S,G){this.Za.raiseEvent("RPS",
new t(B,H,I,U,S,G))}oRf(B,H){this.Za.raiseEvent("UPSR",new v(B,H))}YQf(B,H){this.Za.raiseEvent("PU",new h.a(B,H))}tbj(B){this.Za.raiseEvent("MPU",new e(B))}hJd(B,H,I,U){this.Za.raiseEvent("SUN",new m.a(B,H,I,U))}$bj(B,H){this.Za.raiseEvent("UNR",new l(B,H))}gRf(B,H,I){this.Za.raiseEvent("SP",new w(B,H,I))}Dbj(B,H){this.Za.raiseEvent("PSU",new d(B,H))}Cbj(B){this.Za.raiseEvent("PSC",new f(B))}nbj(B){this.Za.raiseEvent("IPSC",new f(B))}acj(B){this.Za.raiseEvent("UPSC",new y(B))}Pbj(B,H){this.Za.raiseEvent("SPC",
new u(B,H))}dRf(B,H){this.Za.raiseEvent("RCF",new z(B,H))}hbj(B){this.Za.raiseEvent("CPSWM",new k(B))}Zbj(B,H){this.Za.raiseEvent("UCI",new b(B,H))}n2(B){this.Za.addHandler("CSC",B)}L6(B){this.Za.removeHandler("CSC",B)}COg(B){this.Za.addHandler("RP",B)}BOg(B){this.Za.addHandler("RC",B)}GOg(B){this.Za.addHandler("RMID",B)}AOg(B){this.Za.addHandler("RPS",B)}pPg(B){this.Za.addHandler("UPSR",B)}cZa(B){this.Za.addHandler("PU",B)}JQa(B){this.Za.removeHandler("PU",B)}mNg(B){this.Za.addHandler("IPU",B)}nPg(B){this.Za.addHandler("UCI",
B)}TOg(B){this.Za.addHandler("SUN",B)}nNg(B){this.Za.addHandler("IUNR",B)}eZa(B){this.Za.addHandler("UNR",B)}gKb(B){this.Za.removeHandler("UNR",B)}HXc(B){this.Za.addHandler("PSU",B)}jMd(B){this.Za.removeHandler("PSU",B)}lNg(B){this.Za.addHandler("IPSU",B)}kNg(B){this.Za.addHandler("IPSC",B)}oPg(B){this.Za.addHandler("UPSC",B)}SOg(B){this.Za.addHandler("SP",B)}VOg(B){this.Za.addHandler("SPC",B)}static getInstance(){return x.La||(x.La=new x)}}x.La=null;Object(r.a)(x,"RtcEventHub",null,[415])},1211:function(r,
F,a){a.r(F);r=a(0);var c=a(15),b=a(85),e=a(192),f=a(894);class d{}d.D9a="throttling_messageDelay";d.EBb="enabled";d.xBa="throttling_timeToWaitForResponse";d.w9a="throttling_maxNumberOfOutstandingMessages";d.A9e="throttling_globalMaxNumberOfOutstandingMessages";d.errorMessage="errorMessage";d.hag="url";d.B6="queryString";d.uC="connectionString";Object(r.a)(d,"RtcFindSessionOutputFieldNameConstants",null,[]);var h=a(4),l=a(79),k=a(40),t=a(465),n=a(699),z=a(111),w=a(30),m=a(174);class u{constructor(){this.B9e=
this.cvf=this.dvf=this.jvf=0;this.Ejc=!1;this.correlationId=this.uC=this.B6=this.p4c=this.errorMessage=null}get k8g(){return this.p4c+"?"+this.B6}}Object(r.a)(u,"FindSessionResponse",null,[]);class y{}y.clientId="ClientId";y.q3j="UserApp";y.userSessionId="usid";y.userType="UserType";y.J3j="UserVersion";y.ctc="qs";y.H5g="clientProtocol";y.pLi="NoAuth";Object(r.a)(y,"RtcFindSessionInputQueryParamConstants",null,[]);class v{constructor(E,N,M,L,aa,V){this.TEa=null;const {FindSessionStrategy:P}=a(1211);
this.qCg=E;E=String.format("{0}={1}",y.clientId,w.a.hf(L));E=String.format("{0}&{1}={2}",E,y.userSessionId,w.a.hf(aa));E=String.format("{0}&{1}={2}",E,y.q3j,w.a.hf(M.toString()));E=String.format("{0}&{1}={2}",E,y.userType,w.a.hf("1"));E=String.format("{0}&{1}={2}",E,y.J3j,w.a.hf(N));E=String.format("{0}&{1}={2}",E,y.H5g,w.a.hf(P.F5g));(N=v.kPh(M,V))&&(E=String.format("{0}&{1}",E,N));this.Rug=E}JTf(){this.TEa=this.qCg()}yed(){this.TEa&&""!==this.TEa||(this.JTf(),c.ULS.sendTraceTag(575784194,500,this.TEa&&
""!==this.TEa?50:15,"Query signature delegate called for refresh returned: {0} ",this.TEa));const E=String.format("{0}={1}",y.ctc,w.a.hf(this.TEa));return String.format("{0}&{1}",E,this.Rug)}static kPh(E,N){return 4===E?String.format("{0}={1}",y.pLi,"1"):N?N.w6h():null}}Object(r.a)(v,"FindSessionQueryStringGenerator",null,[]);var C=a(957),x=a(893),B=a(737),H=a(1007);class I{}I.KHh="FSType";Object(r.a)(I,"RtcFindSessionRequestHeaders",null,[]);class U{}U.vdj="polling";Object(r.a)(U,"RtcFindSessionTypes",
null,[]);var S=a(1006);class G{}G.f5j="RTC-TokenProofkey";G.Lwi="RTC-IsWacJsBootFsRequest";Object(r.a)(G,"RtcRequestHeaders",null,[]);a.d(F,"FindSessionStrategy",function(){return D});class D{constructor(E,N,M,L,aa,V,P,ba,Y,Z,ea,ra,O=null){this.Nce=(new Date(0)).getTime();this.Ude=0;this.CVb=!1;this.zje=null;this.qKd=36E5;this.CVa=D.Cef;this.cjb=0;this.YQa=null;this.Jda=0;this.edb=this.IFe=null;this.UCg=[d.EBb,d.errorMessage,d.hag,d.uC,d.B6,d.A9e,d.w9a,d.xBa,d.D9a];this.TCg=[d.EBb,d.errorMessage];
this.uC=this.jOa=null;this.B9d=new v(ea?ea:()=>h.AFrameworkApplication.vi,aa,V,P,E,N);this.Mhb=ra;this.rh=L;this.ph=N;this.Owg=M;this.em=ba;this.Mg=Y;this.mjb=O;this.C9d=!1;this.kac=9E4;Z&&Z.execute(da=>{da.uob(()=>{c.ULS.sendTraceTag(40768456,500,50,"Connection parameters refresh requested for client [{0}]",this.em);this.B9d.JTf()})});2>=100*Math.random()&&(this.qKd=3E5);C.a.instance&&(C.a.instance.WZe=this.qKd)}vBj(E){this.edb=E}init(){this.Mg.GOg(Object(b.a)(this,this.Ioj,"resetGetMachineIdDelay"));
this.Mg.n2(Object(b.a)(this,this.EV,"onConnectionStateChanged"))}EV(E,N){this.Jda=N.newState;2===N.newState&&(this.cjb=0)}V2e(){let E;E=this.YQa.correlationId;return{returnValue:String.format("{0}&{1}={2}",this.YQa.B6,D.KGe,w.a.hf(E)),correlationId:E}}w2h(E,N,M,L,aa){this.xvj(()=>{L(aa,"GetMachineIdSuccess")&&(c.ULS.sendTraceTag(17956951,500,50,"Successfully retrieved Rtc MachineId [{0}] for [{1}]",this.uC,this.em),E(this.zje),M(this.j5h()))},V=>{L(aa,"GetMachineIdFailure")&&(c.ULS.sendTraceTag(4060129,
500,15,"Failed to retrieve Rtc MachineId for [{0}]",this.em),N(V))},L,aa)}noh(){this.SCe();this.Uei()}xvj(E,N,M,L){c.ULS.sendTraceTag(17956952,500,50,"Retrieving Rtc MachineId from server. Getting from last findsession, connectionString is [{0}]",this.uC);if(this.uC)E();else{var aa=this.u0g();window.setTimeout(()=>{this.sendFindSessionRequestToServerInternal(E,N,M,L)},aa)}}sendFindSessionRequestToServerInternal(E,N,M,L){M(L,"RequestMachineId")&&(this.Nce=(new Date).getTime(),M=k.a.Td(),this.W2e(aa=>
{const V=k.a.Td();this.SLf(aa);this.URd();E();aa=k.a.Td()-V;c.ULS.sendTraceTag(577356039,345,50,"SFSRTS Success - TimeElapsed: {0}",aa)},aa=>{const V=k.a.Td();this.SCe();C.a.instance&&C.a.instance.Zx(2,3);N(aa);aa=k.a.Td()-V;c.ULS.sendTraceTag(577356040,345,50,"SFSRTS Failure - TimeElapsed: {0}",aa)},!1),M=k.a.Td()-M,c.ULS.sendTraceTag(577599296,345,50,"SFSRTS - TimeElapsed: {0}",M))}Uei(){this.CVa+=D.GYh;this.CVa=Math.min(this.CVa,D.oHi)}u0g(){var E=(new Date).getTime();E=this.Nce+this.CVa-E;0>E&&
(E=0);return E}SLf(E){try{this.YQa=E,this.jOa=E.k8g,this.uC=E.uC,this.IFe=E.B6,this.zje=E.p4c}catch(N){c.ULS.sendTraceTag(17956953,500,10,"FindSession response contains invalid fields. Exception {0}, is thrown",N.toString())}}SCe(){this.uC=null;this.TCe()}URd(){this.TCe();this.CVb=!0;this.Ude=window.setTimeout(Object(b.a)(this,this.afj,"refreshMachineId"),this.qKd)}TCe(){this.CVb&&(window.clearTimeout(this.Ude),this.CVb=!1)}afj(){this.CVb=!1;this.W2e(E=>{const N=this.IFe!==E.B6,M=this.uC!==E.uC,L=
this.uC;this.SLf(E);0!==this.Jda&&(M?(c.ULS.sendTraceTag(17956955,500,15,"Recycling RTC connection due to RTC machine id change. old={0}, new={1}",L||"null",E.uC),this.Mg.ntc()):(this.Mg.Pbj(N,M),this.URd()))},()=>{C.a.instance&&C.a.instance.Zx(2,3);this.URd()},!0)}Ioj(){this.CVa=D.Cef}j5h(){return new H.a(this.YQa.jvf,this.YQa.dvf,this.YQa.cvf,this.YQa.B9e)}gVj(E){if(Object.getType(E)!==Object)return null;for(let N in E);return this.odh(E)}odh(E){if(!(d.EBb in E))return null;const N=E[d.EBb];var M=
N?this.UCg:this.TCg;for(const L of M)if(!(L in E))return null;M=Object.assign(new u,{Ejc:E[d.EBb],errorMessage:E[d.errorMessage],correlationId:m.a.create().toString()});N&&(M.p4c=E[d.hag],M.B6=E[d.B6],M.uC=E[d.uC],M.B9e=E[d.A9e],M.cvf=E[d.w9a],M.dvf=E[d.xBa],M.jvf=E[d.D9a]);return M}lVh(E,N){c.ULS.sendTraceTag(50448152,500,50,"Using FindSessionUtils find session response");this.mjb.IHh.continueWith(()=>{this.mjb.IHh.result?(c.ULS.sendTraceTag(50448153,500,50,"FindSessionUtils find Session resulted in success"),
E(this.mjb.JHh)):(c.ULS.sendTraceTag(50448154,500,15,"FindSessionUtils find Session resulted in error"),N(this.mjb.JHh))})}ZYf(E,N,M,L,aa=!1){return V=>{x.a.instance.bJb(0,1);E&&E.stop();this.Mhb=this.edb=null;this.rsf(V.data,!0,N);var P=B.RtcUtils.deserialize(V.data.de,"FindSession",null);if(P)if(P=this.gVj(P)){if(P.Ejc&&P.B6&&P.uC){c.ULS.sendTraceTag(4317446,500,50,"Successfully retrieved MachineId from server for [{0}]",this.em);this.nCi(V.data);M(P);return}N.FindSessionFailureReason="FindSessionInvalidResponse";
N.IsRtcEnabled=P.Ejc;N.IsQueryStringEmpty=!P.B6;N.IsConnectionStringEmpty=!P.uC;c.ULS.sendTraceTag(4290720,500,15,"Response did not contain valid MachineId [ConnectionUrl and/or QueryString] for [{0}]; IsRtcEnabled:{1}; IsQueryStringEmpty:{2}; IsConnectionStringEmpty:{3}",this.em,P.Ejc,!P.B6,!P.uC)}else N.FindSessionFailureReason="FindSessionTranslateServerResponseFailed",c.ULS.sendTraceTag(8745097,500,15,"Could not translate server response to findSession response for [{0}]",this.em);else N.FindSessionFailureReason=
"FindSessionDeserializeServerResponseFailed",c.ULS.sendTraceTag(7372827,500,10,"Could not deserialize response data for [{0}]",this.em);this.eRf(N,aa);L(null)}}TYf(E,N,M,L=!1){return aa=>{x.a.instance.bJb(0,1);E&&E.stop();this.Mhb=this.edb=null;this.rsf(aa.data,!1,N);let V=null;var P="unknown";let ba="unknown";aa.data&&((P=aa.data.responseHeaders)&&D.gLb in P&&(V=P[D.gLb].toString()),P=n.a[aa.data.status],ba=aa.data.httpStatus.toString());N.FindSessionFailureReason="FindSessionRequestFailed";N.HttpErrorCode=
ba;N.HttpErrorStatus=P;N[D.gLb]=V;c.ULS.sendTraceTag(4290721,500,15,"Request for MachineId failed with Status='{0}'; HttpStatus='{1}' for [{2}]; RtcErrorCode='{3}'. Polling: '{4}' '",P,ba,this.em,V,L);this.eRf(N,L);M(ba)}}W2e(E,N,M=!1){let L=null;c.ULS.sendTraceTag(4317445,500,50,"Getting MachineId from server for [{0}]",this.em);const aa={};var V=this.B9d.yed();aa[t.a.EY]=m.a.create().toString();this.edb&&""!==this.edb?V=String.format("{0}&{1}={2}",V,S.a.$Od,this.edb):this.Mhb&&""!==this.Mhb&&(V=
String.format("{0}&{1}={2}",V,S.a.$Od,this.Mhb),aa[G.f5j]="True",aa[G.Lwi]="True");V=this.Owg+"?"+V;M&&(aa[I.KHh]=U.vdj);const P={};P.IsNetworkOfflineBeforeSendRequest=this.ph.s7a;P.HasAvailableConnectionsBeforeSendRequest=this.ph.Aaf;P.MaxConnectionsAllowed=this.ph.Smc;P.IsRefreshMachineId=M;this.mjb&&!this.C9d?(this.lVh(this.ZYf(null,P,E,N,M),this.TYf(null,P,N,M)),this.C9d=!0):(this.rh&&(L=this.rh.Gc("WebServiceCall","GetMachineIdFromTheServer")),C.a.instance&&C.a.instance.Zx(2,0),0>this.ph.Jga(V,
1,null,aa,[D.y5b,D.gLb,D.DFb,D.ZOd,D.Ewf,D.Oyf,D.Nyf],!1,1,this.ZYf(L,P,E,N,M),this.TYf(L,P,N,M),null,null,!1,null,this.kac,"3",null,!0)&&(5<this.cjb&&200>this.cjb&&c.ULS.sendTraceTag(578166985,500,15,"FindSession request not scheduled due to expired token. Manually triggered failure callback {0} times.",this.cjb),window.setTimeout(()=>{this.cjb++;N("-1")},1E3)))}rsf(E,N,M){M||(M={});M.IsNetworkOfflineAfterRequestComplete=this.ph.s7a;M.IsRequestSucceeded=N;E&&(M.EnqueueTime=E.l9b,M.InvokedTime=E.cF,
M.CompletedTime=E.Y2,E.responseHeaders&&(D.y5b in E.responseHeaders&&(M.CorrelationId=E.responseHeaders[D.y5b]),D.DFb in E.responseHeaders&&(M[D.DFb]=E.responseHeaders[D.DFb])));c.ULS.sendTraceTag(38633565,500,N?50:15,B.RtcUtils.f$a(M))}eRf(E,N){E||(E={});E.ConnectionState=f.a[this.Jda];N||this.Mg.dRf(1,E)}nCi(E){try{var N=!1,M=!1,L=E.responseHeaders,aa=l.a.QJ(E.request.get_url());if(L&&D.ZOd in L){const Z=L[D.ZOd].toString().toLocaleLowerCase();M="true"===Z;N="false"===Z}L=!1;const Y=0<=aa.toLocaleLowerCase().indexOf("collab");
M&&!Y?L=!0:N&&Y&&(L=!0);if(L){N={};N.HostName=aa;N.Status=n.a[E.status];N.HttpStatus=E.httpStatus.toString();var V=E.request.get_headers();for(let Z in V){var P=V[Z];(aa=Z)&&0<aa.length&&(M=0,P&&(M=P.toString().length),N["r_"+aa]=M)}if(E.responseHeaders){const Z=new e.a;Z.add(D.y5b);Z.add(D.DFb);Z.add(D.gLb);Z.add(D.Oyf);Z.add(D.Nyf);Z.add(D.Ewf);D.wKg(N,E.responseHeaders,Z)}D.kKg(E.request.get_url(),N);var ba=z.a.toJSON(N);c.ULS.sendTraceTag(559437006,500,15,ba)}}catch(Y){c.ULS.sendTraceTag(559437007,
500,10,"DomainLandingIncorretDC exception[{0}]",Y.toString())}}static createInstance(E,N,M,L,aa,V,P,ba,Y,Z,ea,ra=null){return D.ieh(E,N,M,L,aa,V,P,ba,Y,Z,ea,ra)}static ieh(E,N,M,L,aa,V,P,ba,Y,Z,ea,ra=null){E=E||m.a.create().toString();E=new D(E,N,M,L,aa,V,P,ba,Y,Z,null,ea,ra);E.init();return E}static wKg(E,N,M){for(let L of M)L in N&&(E[L]=N[L])}static kKg(E,N){if(E){var M=E.indexOf("?");if(-1!==M)for(E=E.substr(M+1).split("&"),M=0;M<E.length;++M){var L=E[M].split("=");if(2===L.length){const aa=L[0];
if(aa&&0<aa.length){let V=0;if(L=L[1])V=L.length;N["q_"+aa]=V}}}}}}D.GYh=3E3;D.oHi=3E5;D.F5g="1.0";D.Cef=1E3;D.y5b="X-CorrelationId";D.KGe="corrid";D.gLb="RtcErrorCode";D.DFb="X-OfficeCluster";D.ZOd="X-NewEnv";D.Ewf="X-MSEdge-Ref";D.Nyf="X-OFFICEFD";D.Oyf="X-OfficeFE";Object(r.a)(D,"FindSessionStrategy",null,[921])},1347:function(r,F,a){a.r(F);a.d(F,"RealtimeChannelMetrics",function(){return d});r=a(0);var c=a(15),b=a(241),e=a(111),f=a(737);class d{constructor(){this.tfe=this.ufe=this.vfe=this.rfe=
this.qfe=this.sfe=this.klb=this.oQc=0;this.v8=this.MOc=this.xkb=this.HOc=this.Bfa=this.yOc=this.Bqa=this.skb=this.LWa=this.xOc=this.STb=this.ZVa=null;this.xPc=this.Skb=this.wje=this.s6d=0;this.vee=!1;this.USf=this.ZJd;this.XSf=this.bKd;this.WSf=this.aKd;this.aTf=this.dKd;this.$Sf=this.cKd;this.iKd=this.jKd;this.cJb=this.gKd;this.nQa=this.eKd;this.oQa=this.fKd;this.VSf=this.$Jd;this.fFb=this.AAd;this.Onc=this.CAd}ZJd(){this.oQc++;this.xOc=new Date;this.ZVa||(this.ZVa=new Date)}bKd(){this.klb++;this.Bqa=
new Date;this.STb||(this.STb=this.Bqa);this.xkb=this.Bqa;this.w8g()}aKd(){this.sfe++;this.yOc=new Date}dKd(){this.qfe++;this.LWa=new Date}cKd(){this.rfe++;this.skb=new Date}gKd(){this.Bfa=new Date;this.vfe++}fKd(){this.v8||(this.v8=new Date);this.ufe++}eKd(){this.HOc=new Date;this.tfe++}jKd(){!this.vee&&this.oQc&&(c.ULS.sendTraceTag(39321871,500,15,e.a.toJSON(this.G6g())),this.vee=!0)}$Jd(h){let l,k;({hdf:h,jdf:l,exception:k}=f.RtcUtils.UEh(h));h&&h!==b.a.IO&&(c.ULS.sendTraceTag(40157596,500,15,e.a.toJSON({["HttpErrorCode"]:h,
["HttpErrorStatus"]:l,["Exception"]:k})),b.a.mhf(h)&&this.s6d++,b.a.lmf(h)&&this.wje++)}AAd(){this.MOc=new Date}CAd(){this.LWa=this.xkb=new Date}G6g(){return{["numberOfConnectionAttempts"]:this.oQc,["numberOfSuccessfulConnections"]:this.klb,["numberOfFailedConnections"]:this.sfe,["numberOfDisconnectedConnections"]:this.qfe,["numberOfExplicitDisconnectedConnections"]:this.rfe,["numberOfSentMessages"]:this.vfe,["numberOfReceivedMessages"]:this.ufe,["numberOfLostMessages"]:this.tfe,["firstConnectionAttempt"]:this.ZVa?
this.ZVa:null,["firstMessageReceived"]:this.v8?this.v8:null,["firstConnectionSuccess"]:this.STb?this.STb:null,["lastConnectionAttempt"]:this.xOc?this.xOc:null,["lastConnectionSuccess"]:this.Bqa?this.Bqa:null,["lastConnectionFailure"]:this.yOc?this.yOc:null,["lastMessageSent"]:this.Bfa?this.Bfa:null,["lastMessageLost"]:this.HOc?this.HOc:null,["lastDisconnect"]:this.LWa?this.LWa:null,["lastExplicitDisconnect"]:this.skb?this.skb:null,["lastTimeOnline"]:this.xkb?this.xkb:null,["lastTimeOffline"]:this.MOc?
this.MOc:null,["maxDisconnectedTimeMs"]:this.Skb,["maxExplicitDisconnectedTimeMs"]:this.xPc,["clientConnectionErrors"]:this.s6d,["serverConnectionErrors"]:this.wje}}w8g(){this.ZVa&&1===this.klb&&(this.Skb=Math.max(this.Skb,this.Bqa.getTime()-this.ZVa.getTime()));this.LWa&&1<this.klb&&(this.Skb=Math.max(this.Skb,this.Bqa.getTime()-this.LWa.getTime()));this.skb&&1<this.klb&&(this.xPc=Math.max(this.xPc,this.Bqa.getTime()-this.skb.getTime()))}static createInstance(h){d.La||(d.La=new d,c.ULS.sendTraceTag(39321870,
500,50,"RealtimeChannelMetrics initialized for client {0}",h));return d.La}}d.La=null;Object(r.a)(d,"RealtimeChannelMetrics",null,[922,69])},1348:function(r,F,a){a.d(F,"a",function(){return c});r=a(0);class c extends Sys.EventArgs{constructor(b,e){super();this.pL=b;this.caa=e}}Object(r.a)(c,"PresenceUpdatedEventArgs",Sys.EventArgs,[])},1457:function(r,F,a){a.r(F);var c=a(0),b=a(85);class e{constructor($a,Nb){this.gra=null;this.Elb=$a;this.UBg=Nb}init(){this.Elb.continueWith(()=>{this.gra=this.Elb.result;
this.gra.fZa(Object(b.a)(this,this.CN,"onUsersUpdated"))})}CN(){e.qve(this.gra.Yua())&&(this.gra.BMd(Object(b.a)(this,this.CN,"onUsersUpdated")),this.UBg.IsRealCoauthSession=!0)}static qve($a){let Nb=null;for(const qc of $a)if(qc)if($a=qc.isAnonymous||!qc.email?qc.clientId:qc.email.toUpperCase(),!Nb)Nb=$a;else if(Nb!==$a)return!0;return!1}}Object(c.a)(e,"CoauthTelemetry",null,[338]);var f=a(15),d=a(160),h=a(84),l=a(4),k;(function($a){$a[$a.badStatePreventedTelemetry=0]="badStatePreventedTelemetry";
$a[$a.notImplemented=1]="notImplemented";$a[$a.renderHandled=2]="renderHandled";$a[$a.renderHandledWithVeto=3]="renderHandledWithVeto"})(k||(k={}));Object(c.b)("CoauthorGalleryTelemetryEndResult",k);var t=a(99),n=a(111),z=a(55);class w{constructor($a,Nb,qc,Lc,sd,Fd,Td,ue,Ae){this.Ege=this.C6d=this.ex=null;this.VUa=$a;this.mYb=new d.a;this.mb=qc;this.TIc=Nb;this.dVa=Lc;this.Lg=sd;this.eRc=Fd;this.ara=Td;this.atg=ue;this.y$d=this.v$d=!1;this.LYb=0;this.A6d=1;this.SCa=Ae;this.rme=this.mb.pa("PeoplesWellExtraButtonInfoIsEnabled");
this.cVa=Object(h.a)(String,l.AFrameworkApplication.Rb.Application)||""}get Ibg(){return this.mYb.task}init(){z.Task.WAA.call(null,this.ara,this.TIc,this.eRc).continueWith(()=>{this.ex=this.ara.result;this.C6d=this.TIc.result;this.Ege=this.eRc.result;z.Task.WAA.call(null,this.TIc.result.n3c,this.eRc.result.sCc).continueWith(()=>{this.A6d=this.C6d.n3c.result;this.LYb=this.Ege.sCc.result;this.ex.fZa(Object(b.a)(this,this.Mqc,"onUsersUpdatedEventListener"));this.ex.Yua().length&&this.CN()})})}Mqc(){this.CN()}CN(){this.atg(this.ex.Yua())?
(this.ex.BMd(Object(b.a)(this,this.Mqc,"onUsersUpdatedEventListener")),this.pSi(this.v$d)):this.mYb.Ww(1);this.v$d=!0}pSi($a){this.y$d?this.Ibg.continueWith(()=>{f.ULS.sendTraceTag(42062996,325,15,"We already attempted to log a render of coauthor gallery: {0}",k[this.Ibg.result])}):(this.y$d=!0,this.d$i(0===this.A6d&&!$a))}d$i($a){$a?this.dVa.Lj(4,Object(b.a)(this,this.CDd,"onInteractiveReady")):this.mYb.Ww(1)}CDd(){const $a=this.Lg.QA("AppInitStatus_interactivityReady");f.ULS.shipAssertTag(42259235,
325,!!this.LYb);const Nb=this.LYb-$a,qc={};qc.InteractiveTime=$a;qc.ReactRenderComplete=this.LYb;qc.HadTabSwitch=this.SCa();qc.IsModernGallery=this.rme;f.ULS.sendTraceTag(594883104,325,50,n.a.toJSON(qc));this.rme?(f.ULS.sendTraceTag(42062997,325,15,Nb.toString()),this.mYb.Ww(this.G5j(Nb)?3:2)):f.ULS.sendTraceTag(594883103,325,15,Nb.toString())}G5j($a){const Nb=$a>this.mb.vd("CoauthorGalleryTimeToRenderDurationMs",1E4),qc="Word"===this.cVa;if(this.SCa())return f.ULS.sendTraceTag(50455714,325,50,Nb.toString()),
!1;qc&&t.Health.instance.recordKpiUsage("CoauthGalleryExperienceDegraded",0,"wordcollabrel",null);Nb&&(qc&&t.Health.instance.recordKpiFailure("CoauthGalleryExperienceDegraded","CoauthorGalleryTimeToRenderDurationIsTooLong",!1,!0,null),f.ULS.sendTraceTag(42062998,325,15,$a.toString()));return Nb}}Object(c.a)(w,"CoauthorGalleryTelemetry",null,[337]);class m{constructor($a){this.ex=null;this.ySb={};this.AWb={};this.Rjb=null;this.ara=$a}jdc($a){const Nb=new d.a;this.init().continueWith(()=>{$a in this.ySb?
Nb.Ww(this.ySb[$a]):this.AWb[$a]=Nb});return Nb.task}init(){if(this.Rjb)return this.Rjb.task;this.Rjb=new d.a;this.ara.continueWith(()=>{this.ex=this.ara.result;this.ex.fZa(Object(b.a)(this,this.CN,"onUsersUpdated"));this.skg();this.Rjb.setResult(null)});return this.Rjb.task}skg(){const $a=this.ex.Yua();$a.sort(Object(b.a)(this,this.b8g,"comparePresenceUsers"));this.ySb={};for(let Nb=0;Nb<$a.length&&$a[Nb]&&$a[Nb].gla;Nb++)this.gKg(this.ySb,$a[Nb].clientId,Nb)}gKg($a,Nb,qc){$a[Nb]=qc;Nb in this.AWb&&
(this.AWb[Nb].Ww(qc),delete this.AWb[Nb])}CN(){this.skg()}b8g($a,Nb){return $a.gla>Nb.gla?1:$a.gla<Nb.gla?-1:0}}Object(c.a)(m,"CoauthorPositionFinder",null,[336]);var u=a(648),y=a(553),v=a(697),C=a(192),x=a(174);class B{constructor(){this.wga=null;this.Ehb=Array(32)}xor($a){if(!$a)throw Error.argumentNull("Guid argument cannot be null");const Nb=new B,qc=new Sys.StringBuilder;for(let Lc=0;Lc<$a.Ehb.length;Lc++){const sd=this.Ehb[Lc]^$a.Ehb[Lc];Nb.Ehb[Lc]=sd;qc.append(sd.toString(16));7!==Lc&&11!==
Lc&&15!==Lc&&19!==Lc||qc.append("-")}Nb.wga=x.a.N$(qc.toString());return Nb}toString(){return this.wga.toString()}equals($a){if(!$a)throw Error.argumentNull("Guid argument cannot be null");return this.wga.equals($a.wga)}static ged($a){if(!$a)throw Error.argumentNull("String input cannot be null");const Nb=new B;Nb.wga=x.a.N$($a);const qc=Nb.wga.toString();let Lc=0;for(let Fd=0;Fd<qc.length;Fd++){var sd=$a.charAt(Fd);if(B.Xpi(sd))sd=B.sci(sd,$a.charCodeAt(Fd)),Nb.Ehb[Lc++]=sd;else if(!B.tpi(sd))throw Error.argument("String contains characters not valid in Guids");
}return Nb}static Xpi($a){return"0"<=$a&&"9">=$a||"A"<=$a&&"F">=$a||"a"<=$a&&"f">=$a}static tpi($a){return"{"===$a||"}"===$a||"-"===$a}static sci($a,Nb){if("0"<=$a&&"9">=$a)return Nb-48;if("A"<=$a&&"F">=$a)return Nb-65+10;if("a"<=$a&&"f">=$a)return Nb-97+10;throw Error.argument("Char is not valid hex digit");}}Object(c.a)(B,"Guid",null,[]);class H{constructor($a,Nb,qc,Lc){this.gra=null;this.K7d=this.Pee=!1;this.hde=0;this.Elb=$a;this.fUc=Nb;this.mb=qc;this.dXa=Lc;this.Lsg=l.AFrameworkApplication.userNameUnknown||
l.AFrameworkApplication.limitedEdit;this.Lde=new u.a(y.a.Oi())}get j7c(){return this.mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1)}init(){this.Elb.continueWith(()=>{this.gra=this.Elb.result;this.gra.fZa(Object(b.a)(this,this.CN,"onUsersUpdated"))})}CN(){this.E6g(this.gra.Yua())}E6g($a){var Nb=0;const qc=new v.a(y.a.Oi());for(const Lc of $a)if(Lc&&Lc.isAnonymous){l.AFrameworkApplication.ula("70eb6120;2gfeb930");if(qc.hb(Lc.userName))qc.ma(Lc.userName).add(Lc.clientId);
else{let sd;qc.add(Lc.userName,(sd=new C.a,sd.add(Lc.clientId),sd))}Lc.clientId!==this.dXa?(Nb++,2<=Nb&&!this.Pee&&this.pDi()):!this.K7d&&this.j7c&&"Guest"===Lc.userName&&(f.ULS.sendTraceTag(509726851,302,50,"User was assigned 'Guest' name"),this.K7d=!0)}if(this.j7c&&this.hde!==Nb){f.ULS.sendTraceTag(512553562,302,50,"Total guests updated to: {0}",Nb+(this.Lsg?1:0));this.hde=Nb;for(let Lc of qc.keys)2<=qc.ma(Lc).count&&($a=this.cUh(qc.ma(Lc)),this.Lde.contains($a)||(Nb={},Nb.guestsWithSameName=qc.ma(Lc).count,
Nb.identifier=$a,f.ULS.sendTraceTag(526394833,302,50,"Duplicate guest friendly name detected: {0}",Nb),this.Lde.add($a)))}}pDi(){f.ULS.sendTraceTag(525112603,302,50,"Multiple guests simultaneously coauthoring");this.Pee=!0;this.j7c&&this.fUc&&this.fUc.continueWith(()=>{window.setTimeout(()=>{this.fUc.result.logActivity("MultipleGuestsCoauthoring",null)},15E3)})}cUh($a){if(!$a||1>=$a.count)return"";let Nb=B.ged($a.ma(0));for(let qc=1;qc<$a.count;qc++)Nb=Nb.xor(B.ged($a.ma(qc)));return Nb.toString()}}
Object(c.a)(H,"GuestCoauthTelemetry",null,[]);var I=a(552);class U{constructor(){this.id=null;this.d=this.tp=this.mp=this.st=this.et=0;this.ct=null;this.vc=!1}}Object(c.a)(U,"PL",null,[]);var S=a(39);class G{constructor(){this.ct=this.vt=this.d=0}static n3f($a,Nb,qc){const Lc=new G;Lc.d=$a;Lc.vt=Nb;Lc.ct=qc;return S.c(Lc)}}Object(c.a)(G,"VD",null,[]);var D=a(194);class E{constructor($a,Nb,qc,Lc,sd,Fd,Td,ue,Ae){this.Eje=!1;this._id=$a;this.Ap=Nb;this.BL=qc;this.ZPc=Lc;this.tUc=sd;this.CFa=Fd;this.nDa=
Td;this.oug=ue;this.SCa=Ae;this.cVa=Object(h.a)(String,l.AFrameworkApplication.Rb.Application)||""}veto($a){z.Task.WAA(this.ZPc,this.tUc).continueWith(()=>{if(this.ZPc.result<=this.tUc.result)$a.Ww(!1);else{var Nb=this.BL-this.Ap,qc=new U;qc.id=this._id;qc.et=this.BL;qc.st=this.Ap;qc.d=this.BL-this.Ap;qc.mp=this.ZPc.result;qc.tp=this.tUc.result;qc.ct=this.pRh(this.oug);qc.vc=this.SCa();var Lc=S.c(qc),sd="Word"===this.cVa;f.ULS.sendTraceTag(42078597,302,15,Lc);if(sd){const Fd=new Map;Fd.set("data",
Lc);t.Health.instance.recordKpiUsage("PresenceExperienceDegraded",0,"wordcollabrel",Fd)}Nb>this.CFa.value&&!this.Eje&&!qc.vc&&(this.Eje=!0,$a.Ww(!0),qc=Object.assign(new D.a,{inStaging:!0,extendedProperties:new Map}),qc.extendedProperties.set("data",Lc),sd&&t.Health.instance.recordKpiFailure("PresenceExperienceDegraded","PresenceRenderDurationIsTooLong",!1,!0,qc),Nb<this.nDa.value&&f.ULS.sendTraceTag(42078598,302,15,G.n3f(Nb,this.CFa.value,this.nDa.value)));$a.task.isCompleted||$a.Ww(!1)}})}pRh($a){switch($a){case 2:return"NonWac";
case 0:return"Unknown";case 1:return"Wac";default:return"Unknown"}}}Object(c.a)(E,"PresenceLatencyActivityLogger",null,[]);class N{constructor($a,Nb,qc){this.a6d=this.z6d=this.mSb=this.xSb=this.ZUa=0;this._id=$a;this.CFa=Nb;this.nDa=qc;this.cVa=Object(h.a)(String,l.AFrameworkApplication.Rb.Application)||""}get Dse(){return this.ZUa}set Dse($a){this.ZUa=$a;this.$1c()}get UDe(){return this.xSb}set UDe($a){this.xSb=$a;this.$1c()}get QAe(){return this.mSb}set QAe($a){this.mSb=$a;this.$1c()}get VDe(){return 0!==
this.z6d}get RAe(){return 0!==this.a6d}$1c(){!this.VDe&&this.ZUa&&this.xSb&&(this.z6d=this.veto(this.xSb,"CoauthGalleryLightupDurationTooLong"));!this.RAe&&this.ZUa&&this.mSb&&(this.a6d=this.veto(this.mSb,"CanvasPresenceLightupDurationTooLong"))}veto($a,Nb){const qc=$a-this.ZUa;var Lc=new U;Lc.id=this._id;Lc.et=$a;Lc.st=this.ZUa;Lc.d=qc;var sd=S.c(Lc);$a="Word"===this.cVa;Lc="CanvasPresenceLightupDurationTooLong"===Nb?"PresenceExperienceDegraded":"CoauthGalleryExperienceDegraded";"CanvasPresenceLightupDurationTooLong"===
Nb?f.ULS.sendTraceTag(572289499,302,15,sd):f.ULS.sendTraceTag(571524118,302,15,sd);if($a){var Fd=new Map;Fd.set("data",sd);t.Health.instance.recordKpiUsage(Lc,0,"wordcollabrel",Fd)}return qc>this.CFa.value?(Fd=Object.assign(new D.a,{inStaging:!0,extendedProperties:new Map}),Fd.extendedProperties.set("data",sd),sd=qc<this.nDa.value,Fd.extendedProperties.set("cash",sd?"true":"false"),$a&&t.Health.instance.recordKpiFailure(Lc,Nb,!1,!0,Fd),f.ULS.sendTraceTag(572289500,302,15,G.n3f(qc,this.CFa.value,this.nDa.value)),
sd?2:1):3}}Object(c.a)(N,"PresenceLightupLatencyLogger",null,[]);var M=a(53),L=a(322);class aa{constructor($a,Nb,qc,Lc,sd,Fd,Td=null,ue=null,Ae=null){this.uhe={};this.SIc={};this.nce=new C.a;this.Sjb=this.ex=this.wXb=null;this.Ake=this.zke=0;this.CFa=new I.a(()=>Td.FM("PresenceBootLatencyThreshold",1E4));this.nDa=new I.a(()=>Td.FM("PresenceBootLatencyCutoffThreshold",6E4));this.AGg=new I.a(()=>Td.FM("PresenceLightupLatencyThreshold",2E3));this.qvg=new I.a(()=>Td.FM("PresenceLightupLatencyCutoffThreshold",
1E4));this.XBg=Lc;this.B6d=$a;this.Pie=Nb;this.ara=qc;this.Lg=sd;this.dXa=ue;this.SCa=Fd;this.B$d=Ae;this.v5d=!1;this.init()}rsh($a,Nb,qc=null){qc&&(f.ULS.shipAssertTag(42274970,302,!this.dXa||this.dXa===qc,"_myClientId is already set and you are trying to update it to something different"),this.dXa=qc);const Lc=new d.a;this.init().continueWith(()=>{this.aYi($a);this.ssh(Lc,$a,Nb)})}get Pwf(){return this.dXa||"{"+l.AFrameworkApplication.userSessionId+"}"}init(){if(this.Sjb)return this.Sjb.task;this.Sjb=
new d.a;this.SCa()&&f.ULS.sendTraceTag(50951700,302,15,"TabSwitched Session");this.B6d.continueWith(()=>{const $a=this.B6d.result,Nb=$a.n3c,qc=$a.sJi;qc.continueWith(()=>{Nb.continueWith(()=>{this.B$d&&this.B$d.addQosPillar("RealTimeCoauth");this.gOj(Nb.result,qc.result);this.Sjb.setResult(null)})})});this.Pie.continueWith(()=>{this.wXb=this.Pie.result;this.wXb.n2(Object(b.a)(this,this.iZi,"onRtcConnection"));this.wXb.eZa(Object(b.a)(this,this.$Pi,"onCoauthorBootReceived"))});this.ara.continueWith(()=>
{this.ex=this.ara.result;this.ex.fZa(Object(b.a)(this,this.Mqc,"onUsersUpdatedEventListener"));0<this.ex.Yua().length&&this.CN()});return this.Sjb.task}n1e(){return this.Lg.a3(M.a.oUa)?this.Lg.QA(M.a.oUa):L.a.rP?window.performance.timing.fetchStart:-1}iZi($a,Nb){this.v5d||2!==Nb.newState||($a=Date.now()-this.n1e(),Nb={},Nb.clientId=this.Pwf,Nb.bootTime=$a,this.v5d=!0,this.wXb.Qda(15,Nb))}$Pi($a,Nb){if(15===Nb.type){$a=Date.now();Nb=Nb.O7;var qc=Nb.bootTime;this.uhd(Nb.clientId).Dse=$a-qc}}Mqc(){this.CN()}CN(){const $a=
Date.now();var Nb=this.ex.Yua();const qc=new C.a;for(const Lc of Nb)this.nce.contains(Lc.clientId)||(this.nce.add(Lc.clientId),qc.add(Lc.clientId));if(0<qc.count)for(let Lc of qc)Nb=this.uhd(Lc),Nb.VDe||(Nb.UDe=$a)}aYi($a){$a=this.uhd($a);$a.RAe||($a.QAe=Date.now())}uhd($a){return $a in this.SIc?this.SIc[$a]:this.SIc[$a]=new N($a,this.AGg,this.qvg)}gOj($a,Nb=0){this.zke=$a;this.Ake=Nb?Nb:(new Date).getTime()}ssh($a,Nb,qc){qc=qc?qc.getTime():(new Date).getTime();Nb in this.uhe?$a.Qz():(qc=new E(Nb,
this.c4h(),qc,this.jdc(this.Pwf),this.jdc(Nb),this.CFa,this.nDa,0,this.SCa),this.uhe[Nb]=qc,qc.veto($a))}c4h(){return 1===this.zke?this.Ake:this.n1e()}jdc($a){return this.XBg.jdc($a)}}Object(c.a)(aa,"PresenceBootTelemetry",null,[280]);var V=a(136),P=a(251),ba=a(221),Y=a(83),Z=a(519);class ea{get name(){return"Common.App.CoauthTelemetry"}Bh($a){$a.register(e,"Common.App.CoauthTelemetry.CoauthTelemetry").as("Common.App.CoauthTelemetry.ICoauthTelemetry").qc().yc(()=>new e(Z.a.Rq($a.Tb("Common.IPeopleInfoProvider")),
l.AFrameworkApplication.Ze));$a.register(w,"Common.App.CoauthTelemetry.CoauthorGalleryTelemetry").as("Common.ICoauthorGalleryTelemetry").qc().yc(()=>new w(l.AFrameworkApplication.rb,Z.a.Rq($a.Tb("Common.ICoauthoringTelemeryInfoProvider")),l.AFrameworkApplication.fa,V.a.get_instance(),ba.a.instance,Z.a.Rq($a.Tb("Common.IPeoplesWell")),Z.a.Rq($a.Tb("Common.IPeopleInfoProvider")),e.qve,()=>this.lye()));$a.register(aa,"Common.App.CoauthTelemetry.PresenceBootTelemetry").as("Common.App.CoauthTelemetry.IPresenceBootTelemetry").qc().yc(()=>
new aa(Z.a.Rq($a.Tb("Common.ICoauthoringTelemeryInfoProvider")),Z.a.Rq($a.Tb("Common.IRealtimeChannelBasic")),Z.a.Rq($a.Tb("Common.IPeopleInfoProvider")),$a.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"),ba.a.instance,()=>this.lye(),l.AFrameworkApplication.fa,null,t.Health.instance));$a.register(m,"Common.App.CoauthTelemetry.CoauthorPositionFinder").as("Common.App.CoauthTelemetry.ICoauthorPositionFinder").qc().yc(()=>new m(Z.a.Rq($a.Tb("Common.IPeopleInfoProvider"))));$a.register(H,
"Common.App.CoauthTelemetry.GuestCoauthTelemetry").qc().yc(()=>new H(Z.a.Rq($a.Tb("Common.IPeopleInfoProvider")),Z.a.Rq($a.Tb("Common.ISystemInitiatedFeedback")),l.AFrameworkApplication.fa,"{"+l.AFrameworkApplication.userSessionId+"}"))}init(){l.AFrameworkApplication.fa.ru(()=>{Y.a.instance.resolve("Common.App.CoauthTelemetry.CoauthTelemetry").init();Y.a.instance.resolve("Common.App.CoauthTelemetry.GuestCoauthTelemetry").init();l.AFrameworkApplication.fa.pa("CoauthorGalleryTelemetryIsEnabled")&&Y.a.instance.resolve("Common.ICoauthorGalleryTelemetry").init();
l.AFrameworkApplication.fa.pa("CashTelemetryIsEnabled")&&(Y.a.instance.resolve("Common.App.CoauthTelemetry.IPresenceBootTelemetry"),Y.a.instance.resolve("Common.App.CoauthTelemetry.ICoauthorPositionFinder"))})}dispose(){}lye(){return L.a.rP&&ba.a.instance.a3(M.a.uQb)?0<ba.a.instance.QA(M.a.uQb)[M.a.dng]:!1}static main(){P.a.instance.ii(new ea)}}Object(c.a)(ea,"CoauthTelemetryPackage",null,[3,4]);var ra=a(822),O=a(38);class da extends Sys.EventArgs{constructor($a){super();this.fh=$a}}Object(c.a)(da,
"ConnectionCompletedEventArgs",Sys.EventArgs,[]);var xa=a(50),ia=a(37),Ma=a(51),Ta=a(1),Da=a(52),fa=a(1185);class ua extends O.a{constructor($a){super();this.hA=this.n0f=this.S4b=null;this.Sae=!1;this.EV=(Nb,qc)=>{if(2===qc.newState){if(this.fh){if(Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Lc=(new Date).getTime();ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa(this.$.da,435,436,1),sd=>{sd.result.eEi(Lc)},this.$.la,3)}this.raiseEvent("connectionCompleted",
new da(this.fh),qc)}else f.ULS.sendTraceTag(537167630,0,15,"RealTimeChannelController.OnConnectionStateChanged: new state is connected and this.RealTimeChannel is null");this.S4b=qc}else if(2===qc.oldState||0===qc.newState)this.S4b=null,this.raiseEvent("connectionLostEventKey")};this.Pqc=()=>{if(this.fh){const Nb=Object(h.a)(343,this.fh);Nb&&(f.ULS.sendTraceTag(537167629,0,50,"RealTimeChannelController.OnWorkbookClosed: disconnecting from RTC"),Nb.disconnect(),Nb.L6(this.EV))}this.hA=null};this.$=
$a;this.$.nj(this.Pqc);this.$.ea.QXc(this.Pqc);$a.da.gb(38,Nb=>{Nb.ure(this.Pqc)})}mob($a){this.addHandler("connectionCompleted",$a)}Duc($a){this.removeHandler("connectionCompleted",$a)}KXc($a){this.addHandler("rtcInitialized",$a)}bKb($a){this.removeHandler("rtcInitialized",$a)}sqe($a){this.addHandler("connectionLostEventKey",$a)}dWf($a){this.removeHandler("connectionLostEventKey",$a)}get fh(){return this.hA}get Ipd(){return this.Sae}dispose(){this.fh&&this.fh.L6(this.EV);this.$&&this.$.ol(this.Pqc);
this.hA=this.$=null;super.dispose()}SIe($a){ia.TaskExtensions.za(this.W6e().task,Nb=>{$a(Nb.result)},this.la)}GFe($a,Nb){this.Sae=Nb;this.xWi($a)}k0a(){this.fh&&(this.raiseEvent("rtcInitialized"),2===this.fh.connectionState&&this.S4b&&this.raiseEvent("connectionCompleted",new da(this.fh),this.S4b))}YAi(){f.ULS.sendTraceTag(537167633,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice");const $a=(new Date).getTime();ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa(this.$.da,435,436,1),Lc=>{Lc.result.hEi($a)},
this.$.la,3);var Nb=[];Nb.push(Ma.a.current.qo(66));Nb.push(Ma.a.current.qo(67));Nb=Ma.a.fwd(Nb,this.$.la);const qc=Ma.a.loadScript(9,0,1);return z.Task.aG(Nb,qc)}xWi($a){const Nb=this.YAi();ia.TaskExtensions.za(Nb,()=>{f.ULS.sendTraceTag(537167632,0,50,`RealTimeChannelController.OnLoadRealTimeChannelSlice Before RealtimeChannel create. RealtimeChannel = null: ${void 0===ra.RealtimeChannel||null===ra.RealtimeChannel}`);if(Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Lc=
(new Date).getTime();ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa(this.$.da,435,436,1),sd=>{sd.result.iEi(Lc)},this.$.la,3)}this.hA=ra.RealtimeChannel.createInstance($a,this.$.ya.UserSessionId,l.AFrameworkApplication.o0f,l.AFrameworkApplication.Bd,null,2,Da.b().d9e(),this.$.workbookContext.RtcEndpointUrl,void 0,new fa.a,void 0,void 0,this.$.workbookContext.RtcBootToken);f.ULS.sendTraceTag(571770432,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice RealtimeChannel created");Ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",
!1)&&(Y.a.instance.register(ra.RealtimeChannel,"AppRealtimeChannel.RealtimeChannel").as("Common.IRealtimeChannelBasic").as("AppRealtimeChannel.IRealtimeChannel").qc().yc(()=>this.fh),Y.a.instance.resolve("Common.IRealtimeChannelBasic"));this.W6e().setResult(this.fh);if(Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const Lc=(new Date).getTime();ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa(this.$.da,435,436,1),sd=>{sd.result.gEi(this.Ipd,Lc)},this.$.la,3)}this.raiseEvent("rtcInitialized");
f.ULS.sendTraceTag(571770403,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice raise RealTimeChannelInitializedEventKey");const qc=Object(h.a)(343,this.fh);qc&&(f.ULS.sendTraceTag(571770402,0,50,"RealTimeChannelController.OnLoadRealTimeChannelSlice attach changed handler"),qc.n2(this.EV),qc.connect())},this.la,3)}W6e(){return this.n0f||(this.n0f=new d.a)}static ka($a){$a.da.Ha(26,new ua($a))}}Object(c.a)(ua,"RealTimeChannelController",O.a,[9,10]);var Fa=a(9),ca=a(7),ka=a(98),Ca=a(109),fb=
a(25);class yb{constructor($a,Nb,qc,Lc,sd,Fd,Td,ue,Ae=!1){this.npa=null;this.VKc=!0;this.nRc=this.gx=this.HHc=null;this.Za=new ka.a;this.NAg=$a;this.HXa=Nb;this.fhe=qc;this.dhe=Lc;this.i5d=Fd;yb.he=sd;this.hCg=Td;this.Tqa=ue;this.FCg=Ae;z.Task.WAA(Nb,qc).continueWith(Object(b.a)(this,this.Wfi,"initOnTaskReady"))}qRf(){this.Za.raiseEvent("u",null,this)}Wfi(){this.HXa.result&&this.fhe.result&&(this.gx=this.HXa.result,this.nRc=this.fhe.result,this.gx.cZa(Object(b.a)(this,this.pma,"onPresenceUpdated")),
this.HHc=new Ca.a(2,2,this.i5d,Object(b.a)(this,this.RZj,"updateAwayClientsTask"),88),yb.he.fg(this.HHc))}pma($a,Nb){(this.VKc||this.Qdj(Nb.pL))&&yb.he.hna(this.HHc,0)}Qdj($a){for(let qc in $a){var Nb=this.dhe.h6e({key:qc,value:$a[qc]});if(Nb&&Nb.clientId&&(Nb=Nb.clientId.toLowerCase(),(Nb=this.npa[Nb]||this.npa[Nb.toUpperCase()])&&2===Nb.status))return!0}return!1}RZj($a){var Nb=this.gx.MOh();if(Nb){var qc=new Date,Lc=!1;if(this.VKc){this.npa=Nb;this.VKc=!1;var sd=this.npa;for(var Fd in sd){Nb=Fd;
var Td=sd[Fd];Td.N8a<qc&&(qc=Td.N8a);2===Td.status&&(Lc=!0,this.nRc.KVf(Nb))}Lc&&this.qRf();yb.he.hna($a,this.h5e(qc))}else{Td=new C.a;Fd=!1;var ue=this.npa;for(sd in ue){ue=sd;if(!(ue in this.npa)||this.NAg.clientId===ue)continue;var Ae=this.npa[ue];const Le=Nb[ue];if(Ae&&Le){Ae=Ae.status;const df=Le.status;2===Ae&&1===df?(Td.add(ue),f.ULS.sendTraceTag(38052609,392,50,ue+" returned from away")):1===Ae&&2===df&&(Fd=Lc=!0,this.nRc.KVf(ue),f.ULS.sendTraceTag(38052610,392,50,ue+" went away"));1===df&&
Le.N8a<qc&&(qc=Le.N8a)}}this.npa=Nb;yb.he.hna($a,this.h5e(qc));(0<Td.count||Lc)&&this.qRf();0<Td.count&&!this.FCg?($a=this.xRh(Td),this.BTj($a)):$a=new C.a;(Fd||0<$a.count)&&this.hCg(fb.a.m3c,2)}}}BTj($a){if($a.count)for(let Nb of $a)$a=this.Tqa.M$(String.format(CommonUIStrings.l_EditorsToastArriving,Nb),!1),$a.image=5,$a.x4="CoAuth_AuthorStatus_16x16x32",this.Tqa.gE($a)}xRh($a){const Nb=this.gx.cfd(),qc=new C.a;for(let Lc in Nb){const sd={key:Lc,value:Nb[Lc]};if($a.contains(sd.key)){const Fd=this.dhe.h6e(sd);
Fd&&(qc.add(Fd.userName),$a.remove(sd.key))}}qc.count||f.ULS.sendTraceTag(38052611,392,10,"There were no coauthor names found");return qc}h5e($a){const Nb=new Date;return Math.max($a.getTime()+this.i5d-Nb.getTime(),0)}}yb.he=null;Object(c.a)(yb,"AwayManager",null,[]);var mb=a(437),nb=a(104),X=a(293),R=a(226);class wa{}Object(c.a)(wa,"NamedSheetViewConversionEntry",null,[]);var na=a(8),Ba=a(113),Ra=a(29),qa=a(60);const La=($a,Nb,qc,Lc,sd,Fd=null)=>{Fd=$a.Na(1,Fd);return qa.g($a,"GetNamedSheetViewConversion",
Fd,Nb,qc,Lc,sd,132)};var Yb=a(41),mc=a(22);const Zb=($a,Nb)=>!!$a&&!!Nb&&$a.SheetName===Nb.SheetName&&(!!$a.NamedObjectName&&$a.NamedObjectName===Nb.NamedObjectName||!$a.NamedObjectName&&!Nb.NamedObjectName&&Yb.D($a).zd(Yb.D(Nb))),qb=($a,Nb,qc)=>{if(!Nb||!Nb.yb)return null;for(let Lc=0;Lc<Nb.yb.count;Lc++){const sd=Nb.yb.getItem(Lc);if(sd&&sd.type===qc&&sd.usedRange&&sd.usedRange.contains(Yb.D($a))&&mc.a.equals(sd.sheetName,$a.SheetName,!0))return sd}return null};class Ha extends O.a{constructor($a){super();
this.$0a=this.dta=null;this.JFc=this.Mta=!1;this.tf=()=>{const Nb=this.$.ea.Qn;if(null===Nb||void 0===Nb?0:Nb.SheetChanges)for(const qc of Nb.SheetChanges)if(2===qc.Type){if(this.dta)for(const Lc of this.dta)Lc.Range.SheetName===qc.Name&&(Lc.Range.SheetName=qc.NewName);if(this.$0a)for(const Lc of this.$0a)Lc.Range.SheetName===qc.Name&&(Lc.Range.SheetName=qc.NewName)}};this.WDf=()=>{f.ULS.sendTraceTag(537154395,0,50,"NamedSheetViewConversionManager.OnGridLoaded");this.JFc=!1;this.Woc(this,Sys.EventArgs.Empty)};
this.uc=()=>{f.ULS.sendTraceTag(537154394,0,50,"NamedSheetViewConversionManager.OnWorkbookClosing");this.JFc=!0};this.Woc=()=>{f.ULS.sendTraceTag(50620166,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: triggered with version [${this.$.ea.mya}]`);if(!this.$.isEditMode||!this.$.ea.Xb||this.$.ea.z5a||this.JFc||this.$.ea.mya===na.a.n7b)f.ULS.sendTraceTag(537154393,0,50,`NamedSheetViewConversionManager.OnConversionOutdatedEvent: Request skipped [Edit Mode: ${this.$.isEditMode}] [IsSessionActive: ${this.$.ea.Xb}] [HasRaisedSessionEnded: ${this.$.ea.z5a}] [WorkbookClosed: ${this.JFc}]`);
else{this.$0a=this.dta=null;var Nb=this.$.oa.xa.Wb();La(this.$.oa.xa,this.XTi,this.WTi,null,Nb)}};this.XTi=Nb=>{if(Ra.a.qq(Nb.Errors)){this.Mta=!0;const qc=[-1100324317,-1857233882];Ra.a.dh(Nb.Errors,qc)&&f.ULS.sendTraceTag(537154392,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionSuccess Errors: [${Ra.a.nc(Nb.Errors)}]`);Nb=Ra.a.Fz(Nb.Errors,qc,"NamedSheetViewConversionManager:OnGetNamedSheetViewConversionSuccess");this.$.ea.Tn(Nb)}else this.Mta=!1,Nb=Nb.Result,this.$.ea.mya=Nb.ConversionVersion,
this.D9i(Nb.NamedSheetViewConversionEntries),this.Saj()};this.WTi=Nb=>{this.Mta=!0;Nb=Ba.a.Pe(Nb.data);let qc=!1;Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6401332_RefreshTokenException")&&Nb.forEach(Lc=>{-1537615947===Lc.MessageId&&(qc=!0)});qc?f.ULS.sendTraceTag(512274778,0,50,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${Ra.a.nc(Nb)}].`):f.ULS.sendTraceTag(537154391,0,10,`NamedSheetViewConversionManager.OnGetNamedSheetViewConversionFailure: Errors: [${Ra.a.nc(Nb)}].`)};
this.$=$a;f.ULS.shipAssertTag(537154397,0,!!this.$.ea,"NamedSheetViewConversionManager ctor: EwaControl.SessionStateManager should not be null");this.$.nj(this.uc);this.$.ea.hP(this.WDf);this.$.ea.QNg(this.Woc);this.$.ea.$t(this.tf);this.$.ea.rv&&this.Woc(this,Sys.EventArgs.Empty)}gre($a){this.addHandler("SVCU",$a)}LWf($a){this.removeHandler("SVCU",$a)}dispose(){this.$0a=this.dta=null;this.$&&this.$.ol(this.uc);this.$.ea&&(this.$.ea.RN(this.WDf),this.$.ea.Okj(this.Woc),this.$.ea.Av(this.tf));this.$=
null;super.dispose()}O$g($a){return this.Mta?null:this.tGe($a,this.$0a,"ConvertPresencePublicToPrivate")}N$g($a){return this.Mta?null:this.tGe($a,this.dta,"ConvertPresencePrivateToPublic")}D9i($a){$a?(this.Rjh($a),this.dta=$a,this.$0a=this.keh(this.dta)):f.ULS.sendTraceTag(537154396,0,10,"NamedSheetViewConversionManager.ProcessConversionEntries: conversionEntries can be empty but not null")}Saj(){f.ULS.sendTraceTag(537154390,0,50,"NamedSheetViewConversionManager.RaiseConversionUpdatedEvent: new version is update on client from server");
this.raiseEvent("SVCU")}tGe($a,Nb,qc){if(!Nb||!Nb.length)return f.ULS.sendTraceTag(537154389,0,50,`NamedSheetViewConversionManager.${qc}: skipping convert due to ${Nb?"empty":"null"} ConversionEntries. `),$a;for(const Lc of $a){for(const sd of Nb)!sd.IsRow||!Zb(sd.Range,Lc)||Lc.FirstRow<=sd.Range.FirstRow&&Lc.LastRow>=sd.Range.LastRow||(qc={},qc.SheetName=Lc.SheetName,qc.FirstRow=qc.LastRow=Lc.FirstRow,qc.FirstColumn=qc.LastColumn=Lc.FirstColumn,Zb(sd.Range,qc)?(qc=Lc.FirstRow-sd.Range.FirstRow,0>
qc||qc>=sd.ConversionMap.length?f.ULS.sendTraceTag(537154388,0,10,`NamedSheetViewConversionManager.ConvertRanges: invalid mapIndex after adjust. Index: [${qc}], ConversionMap.Length: ${sd.ConversionMap.length}`):(qc=sd.ConversionMap[qc]-qc,Lc.FirstRow+=qc,Lc.LastRow=Lc.FirstRow,Lc.LastColumn=Math.min(Lc.LastColumn,sd.Range.LastColumn))):Lc.FirstRow<sd.Range.FirstRow&&Lc.LastRow>=sd.Range.FirstRow?Lc.LastRow=sd.Range.FirstRow-1:Lc.LastColumn>=sd.Range.FirstColumn&&(Lc.LastColumn=sd.Range.FirstColumn-
1));if(0>Lc.FirstRow||Lc.FirstRow>na.a.eB)Lc.FirstRow=Math.max(Math.min(Lc.FirstRow,na.a.eB),0);if(0>Lc.LastRow||Lc.LastRow>na.a.eB)Lc.LastRow=Math.max(Math.min(Lc.LastRow,na.a.eB),0);if(0>Lc.FirstColumn||Lc.FirstColumn>na.a.dy)Lc.FirstColumn=Math.max(Math.min(Lc.FirstColumn,na.a.dy),0);if(0>Lc.LastColumn||Lc.LastColumn>na.a.dy)Lc.LastColumn=Math.max(Math.min(Lc.LastColumn,na.a.dy),0)}return $a}keh($a){if(!$a||!$a.length)return f.ULS.sendTraceTag(537154387,0,50,`NamedSheetViewConversionManager.CreateInverseConversionEntries: skip creating inverse due to ${this.dta?
"empty":"null"} ConversionEntries. `),$a;const Nb=Array($a.length);for(let qc=0;qc<$a.length;++qc){const Lc=new wa;Lc.Range=$a[qc].Range;Lc.IsRow=$a[qc].IsRow;Lc.ConversionMap=Array($a[qc].ConversionMap.length);Lc.IsRow||(this.Mta=!0,f.ULS.sendTraceTag(537154386,0,10,"NamedSheetViewConversionManager.CreateInverseConversionEntries: adjusting presence against column sort map is NYI."));for(let sd=0;sd<$a[qc].ConversionMap.length;++sd)Lc.ConversionMap[$a[qc].ConversionMap[sd]]=sd;Nb[$a.length-qc-1]=
Lc}return Nb}Rjh($a){if($a&&$a.length)for(const Nb of $a)this.Qjh(Nb),$a=Nb.IsRow?Nb.Range.LastRow-Nb.Range.FirstRow+1:Nb.Range.LastColumn-Nb.Range.FirstColumn+1,Nb.ConversionMap.length!==$a&&(f.ULS.shipAssertTag(537154385,0,!1,`NamedSheetViewConversionManager.DecompressEntries: decompressed conversion map doesn't match expected size - Expected: [${$a}] | Actual: [${Nb.ConversionMap.length}]`),this.Mta=!0)}Qjh($a){const Nb=$a.ConversionMap;if(Nb&&Nb.length)if(0>Nb[0])f.ULS.shipAssertTag(537154384,
0,!1,"NamedSheetViewConversionManager.DecompressConversionMap: conversionMap starts with a negative number"),this.Mta=!0;else{var qc=[];for(let Lc=0;Lc<Nb.length;++Lc)if(0>Nb[Lc]){const sd=Nb[Lc-1],Fd=-1*Nb[Lc];for(let Td=1;Td<=Fd;++Td)qc.push(sd+Td)}else qc.push(Nb[Lc]);$a.ConversionMap=qc}}}Object(c.a)(Ha,"NamedSheetViewConversionManager",O.a,[418,2]);class Ya extends R.a{constructor($a){super();this.manager=null;this.$=$a;this.Db()}create(){this.nb(this.manager||(this.manager=new Ha(this.$)))}}
Object(c.a)(Ya,"NamedSheetViewConversionManagerFactory",R.a,[]);var Gb=a(89),Ja=a(535);class Na{constructor($a){this.Pa=new ka.a;this.Ggb=this.disposed=!1;this.dHb=()=>{f.ULS.sendTraceTag(537154381,0,50,"PeopleInfoProvider.OnUserListUpdated fired");this.Pa.raiseEvent("UU",this)};this.$=$a;this.$.ea.B9(this.dHb);this.Ggb=Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2")}dispose(){this.disposed||(this.$&&this.$.ea&&this.$.ea.O6(this.dHb),Gb.a.pc([this.Pa]),this.$=
this.Pa=null,this.disposed=!0)}fZa($a){this.Pa.addHandler("UU",$a)}BMd($a){this.Pa.removeHandler("UU",$a)}Yua(){const $a=[];for(const Nb of this.$.ea.uo)$a.push(this.v0h(Nb));f.ULS.sendTraceTag(537154383,0,50,`PeopleInfoProvider.GetAllUsers: Count: [${$a.length}]`);return $a}v0h($a){var Nb;this.Ggb&&!this.presenceView&&(this.presenceView=this.$.da.Aa(25));return new mb.a($a.User.UserID,$a.User.UserName,$a.UserColor,new Ja.a(1),null,$a.UserEmail,void 0,void 0,this.Ggb?null===(Nb=this.presenceView)||
void 0===Nb?void 0:Nb.isAnonymousUser($a.User.UserID):void 0,void 0,void 0,$a.JoinCoauthTime)}}Object(c.a)(Na,"PeopleInfoProvider",null,[395,2]);var Qa=a(645);class Oa{gE(){f.ULS.sendTraceTag(537154380,0,50,"PresenceBootstrapper.AddNotificationBarEntry: User state changed from inactive to active")}removeEntry(){}get isVisible(){return!1}M$($a,Nb){return new Qa.a($a,Nb)}dispose(){}static get instance(){Oa.La||(Oa.La=new Oa);return Oa.La}}Oa.La=null;Object(c.a)(Oa,"NoOpNotificationBar",null,[396,2]);
class bb{h6e($a){const Nb=$a.key;$a=$a.value;if(!$a)return null;const qc=$a.SupportsChat?4:0;return Object(ca.a)(new mb.a,{clientId:Nb,Z1c:$a.ChatThreadId,Y1c:$a.ChatThreadDiscoveryUri,zzb:$a.InChat,email:$a.Cid,capabilities:new Ja.a(qc),isAnonymous:$a.IsAnonymous})}}Object(c.a)(bb,"PresenceConverter",null,[417]);class Ga extends R.a{constructor(){super();this.BGe=null;this.Db()}create(){this.nb(this.BGe||(this.BGe=new bb))}static ka($a){$a.da.Ha(159,new Ga)}}Object(c.a)(Ga,"PresenceConverterFactory",
R.a,[]);var tb=a(127),wb=a(128);class lb{constructor($a){this.kOf=this.qHd=this.mOf=this.iOf=this.pMf=this.XOd=this.e0f=this.m0f=this.l0f=!1;this.rHd=this.cGd=this.eLb=this.hLb=this.xwc=this.aPd=0;this.Vlf=!1;this.uAd=this.Eqb=0;this.Ojc=!1;this.Rc=()=>{this.Ojc=!0;this.$.ea.ik(this.Rc)};this.$=$a;L.a.rP&&(this.uAd=window.performance.timing.navigationStart);this.uAd||f.ULS.sendTraceTag(537154379,0,15,"Navigation start time is zero");this.$.ea.Jj(this.Rc)}hEi($a){this.l0f||(this.aPd=$a,this.l0f=!0)}iEi($a){this.m0f||
(this.xwc=$a,this.m0f=!0)}gEi($a,Nb){this.e0f||(this.hLb=Nb,this.Vlf=$a,this.e0f=!0)}eEi($a){this.XOd||(this.eLb=$a,this.XOd=!0)}JDi($a){!this.qHd&&this.XOd&&(this.rHd=$a,this.qHd=!0)}EDi($a){this.pMf||(this.cGd=$a,this.pMf=!0)}IDi($a){if(!this.iOf&&this.Wga&&!this.Ojc){this.iOf=!0;const Nb=this.Gfd();Nb.RtcIntializeToPeopleWellServiceCreate=this.cGd-this.hLb;Nb.PeopleWellServiceCreateToPresenceGalleryRender=$a-this.cGd;Nb.PresenceGalleryRenderTotalTime=$a-this.Wga;wb.b(this.$).rd(tb.a.jOf,Nb,void 0,
!0)}}LDi($a){if(!this.mOf&&this.Wga&&!this.Ojc){this.mOf=!0;const Nb=this.Gfd();Nb.RtcIntializeToRtcConnect=this.eLb-this.hLb;Nb.RtcConnectToPresenceSent=$a-this.eLb;Nb.PresenceSentTotalTime=$a-this.Wga;wb.b(this.$).rd(tb.a.nOf,Nb,void 0,!0)}}KDi($a){if(!this.kOf&&this.qHd&&this.Wga&&!this.Ojc){this.kOf=!0;const Nb=this.Gfd();Nb.RtcIntializeToRtcConnect=this.eLb-this.hLb;Nb.RtcConnectToPresenceRenderInitiate=this.rHd-this.eLb;Nb.PresenceRenderInitiateToPresenceRenderFinish=$a-this.rHd;Nb.PresenceRenderTotalTime=
$a-this.Wga;wb.b(this.$).rd(tb.a.lOf,Nb,void 0,!0)}}dispose(){this.$=null}Gfd(){const $a={};$a.CoAuthorCountsOnBoot=this.$.ea.uo.length;$a.RtcConnectedLaterInSession=this.Vlf;$a.BrowserVisibilityChanged=this.xXg();$a.AppInteractiveAbsTime=this.Wga;$a.NavigationStartTime=this.uAd;$a.AppInteractiveToRtcSliceDownloadInitialize=this.aPd-this.Wga;$a.RtcSliceDownloadInitializeToRtcSliceLoad=this.xwc-this.aPd;$a.AppInteractiveToRtcSliceLoad=this.xwc-this.Wga;$a.RtcSliceLoadToRtcInitialize=this.hLb-this.xwc;
return $a}get Wga(){if(this.Eqb)return this.Eqb;ba.a.instance.a3("AppInitStatus_interactivityReady")&&(this.Eqb=ba.a.instance.QA("AppInitStatus_interactivityReady"));this.Eqb||f.ULS.sendTraceTag(537154378,0,15,"App interactive time is zero");return this.Eqb}xXg(){return L.a.rP&&ba.a.instance.a3(M.a.uQb)?0<ba.a.instance.QA(M.a.uQb)[M.a.dng]:!1}}Object(c.a)(lb,"PresenceTelemetry",null,[416,2]);class db extends R.a{constructor($a){super();this.$=$a;this.Db()}create(){this.nb(this.$.da.Aa(435)||this.$.da.Ha(435,
new lb(this.$)))}static ka($a){$a.da.Ha(436,new db($a))}}Object(c.a)(db,"PresenceTelemetryFactory",R.a,[]);var Pa=a(1348),ja=a(48),Ka=a(44),ub=a(28),Kb=a(120),W=a(13),za=a(21),Sa=a(81);class Wa extends O.a{constructor($a){super();this.nme=$a;this.sRc=this.cra=null}get yQb(){return this.nme}get ic(){return this.cra||{}}set ic($a){this.sRc=this.cra;this.cra=$a;this.raiseEvent("userPresenceChanged")}get PHd(){return this.sRc}dispose(){this.raiseEvent("userPresenceChanged");this.raiseEvent("userLeft");
this.sRc=this.cra=this.nme=null;super.dispose()}}Object(c.a)(Wa,"UserPresence",O.a,[]);class ab extends Sa.a{constructor(){super();this.ghe=this.ehe=this.Rz=null}get jy(){return this.ehe}JSd($a){this.ehe=$a}get xm(){return this.ghe}d7f($a){this.ghe=$a}get ic(){return this.Rz.ic}set ic($a){this.Rz.ic=$a}m0a(){}Q4a(){return null}Fgd(){return null}W$f(){}X$f(){}okg(){}Uzc(){}gfc(){}static z1j($a,Nb){const qc=$a.Rz.ic;Gb.a.pc($a.jy);Gb.a.pc([$a.Rz]);$a.Rz=null;$a.Rz=new Wa(Nb);$a.JSd([]);$a.d7f(Nb);$a.ic=
qc}}Object(c.a)(ab,"IUserGridPresence",Sa.a,[]);var ma;(function($a){$a[$a.multipleBrowsersImageClassName=0]="multipleBrowsersImageClassName";$a[$a.peopleImageClassName=1]="peopleImageClassName";$a[$a.peopleImageClusterPath=4]="peopleImageClusterPath";$a[$a.multipleBrowserImageClusterPath=5]="multipleBrowserImageClusterPath";$a[$a.imageDimension=6]="imageDimension";$a[$a.rtl=8]="rtl";$a[$a.pointerInputManager=9]="pointerInputManager";$a[$a.clickInputManager=10]="clickInputManager";$a[$a.vertical=
11]="vertical";$a[$a.zIndex=12]="zIndex";$a[$a.contextMenuInputManager=13]="contextMenuInputManager";$a[$a.imageDomElement=14]="imageDomElement";$a[$a.useIdleTooltip=15]="useIdleTooltip";$a[$a.viewportBoundsCallback=16]="viewportBoundsCallback";$a[$a.flipHorizontalDirection=17]="flipHorizontalDirection";$a[$a.fixRemoveFadeOutElementCrash=18]="fixRemoveFadeOutElementCrash";$a[$a.ignoreEventOnExpandedTooltip=19]="ignoreEventOnExpandedTooltip";$a[$a.ipWidthAdjustForFlyout=20]="ipWidthAdjustForFlyout"})(ma||
(ma={}));Object(c.b)("PresenceTooltipSettingKeys",ma);class ha{constructor(){this.UO={}}get($a,Nb=null){$a=ma[$a];return"number"===typeof Nb?(Nb=this.UO[$a])?Number.parseInvariant(Nb.toString()):0:this.UO[$a]}add($a,Nb){this.UO[ma[$a]]=Nb}PYa($a,Nb){ma[$a]in this.UO||(this.UO[ma[$a]]=Nb)}remove($a){delete this.UO[ma[$a]]}}Object(c.a)(ha,"PresenceTooltipSettings",null,[]);class eb extends ka.a{constructor($a){super();this._element=null;this.element=$a}get element(){return this._element}set element($a){this._element=
$a}get visible(){return"visible"===this.element.style.visibility}set visible($a){this.element.style.visibility=$a?"visible":"hidden"}get rtl(){return"rtl"===this.element.dir.toLowerCase()}set rtl($a){this.element.dir=$a?"rtl":"ltr"}get zIndex(){return this.element.style.zIndex}set zIndex($a){this.element.style.zIndex=String($a)}dispose(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element);this.element=null;super.dispose()}createElement($a){return this.element.ownerDocument.createElement($a)}aBc(){return!0}static Kgh($a){return"prControl"+
($a?"Rtl":"")}}Object(c.a)(eb,"BasePresenceControl",ka.a,[2,145]);class ta extends Sys.EventArgs{constructor($a,Nb){super();this.type=$a;this.Mub=Nb}}ta.xka="InteractivityChanged";Object(c.a)(ta,"InteractivityChangedEventArgs",Sys.EventArgs,[]);class ya{static $Sh($a){return ya.aTh($a)}static aTh($a){const Nb=document.createElementNS(ya.Q2d,"svg");Nb.setAttribute("viewBox",String.format(ya.Xih,ya.Omg,ya.Nmg));Nb.appendChild(ya.F4h($a));return Nb}static F4h($a){const Nb=ya.Omg/$a,qc=2*Nb,Lc=ya.Nmg/
2;$a=($a-12-8)*Nb/2;const sd=document.createElementNS(ya.Q2d,"g");Sys.UI.DomElement.addCssClass(sd,ya.Wih);for(let Fd=1;3>=Fd;Fd++)sd.appendChild(ya.mRh(Fd,qc,$a+(6*Fd-2)*Nb,Lc));return sd}static mRh($a,Nb,qc,Lc){const sd=document.createElementNS(ya.Q2d,"circle");Sys.UI.DomElement.addCssClass(sd,String.format("{0}-{1}",ya.w4g,$a));sd.setAttribute("cx",String.format("{0}",qc));sd.setAttribute("cy",String.format("{0}",Lc));sd.setAttribute("r",String.format("{0}",Nb));return sd}}ya.Q2d="http://www.w3.org/2000/svg";
ya.Wih="prDancingDots";ya.w4g="prAnimateCircle";ya.Xih="0 0 {0} {1}";ya.Nmg=40;ya.Omg=120;Object(c.a)(ya,"ModernPresenceTooltipDancingDots",null,[]);var sb=a(121),Qb=a(156),oc=a(14),kb=a(88),jb=a(125),Wb=a(57),wc=a(30);class Jc extends eb{constructor($a,Nb){super($a);this.hme=this.gqa=this.FIc=this.yMc=this.oJc=this.gA=this.ti=null;this.RI=Nb.get(8,!1);this.Fib=Nb.get(6,0);this.hGg=Nb.get(15,!1);this.ke=Nb;this.k9d=0;this.element=$a;this.element.className=Jc.dJh;this.uG=document.createElement("span");
this.element.appendChild(this.uG);this.Zvg=ya.$Sh(Nb.get(6,0));this.Et(Nb);this._state=5}uXc($a){this.addHandler(ta.xka,$a)}Puc($a){this.removeHandler(ta.xka,$a)}get user(){return this.hme}get state(){return this._state}dispose(){this.element&&(this.ti.Ba(oc.a.click,this.element,Object(b.a)(this,this.fd,"onClick")),this.ti.Ba(oc.a.tk,this.element,Object(b.a)(this,this.aBc,"stopPropagationAndPreventDefaultBehavior")),this.gA.Ba(oc.a.pointerDown,this.element,Object(b.a)(this,this.onPointerDown,"onPointerDown")),
this.gA.Ba(oc.a.pointerOut,this.element,Object(b.a)(this,this.AN,"onPointerOut")),this.gA.Ba(oc.a.pointerOver,this.element,Object(b.a)(this,this.Cw,"onPointerOver")),this.oJc.Ba(this.element,Object(b.a)(this,this.aBc,"stopPropagationAndPreventDefaultBehavior")));super.dispose()}Et($a){this.ti=$a.get(10);this.ti.ta(oc.a.click,this.element,Object(b.a)(this,this.fd,"onClick"));this.ti.ta(oc.a.tk,this.element,Object(b.a)(this,this.aBc,"stopPropagationAndPreventDefaultBehavior"));this.gA=$a.get(9);this.gA.ta(oc.a.pointerOver,
this.element,Object(b.a)(this,this.Cw,"onPointerOver"));this.gA.ta(oc.a.pointerOut,this.element,Object(b.a)(this,this.AN,"onPointerOut"));this.gA.ta(oc.a.pointerDown,this.element,Object(b.a)(this,this.onPointerDown,"onPointerDown"));this.oJc=$a.get(13);this.oJc.ta(this.element,Object(b.a)(this,this.aBc,"stopPropagationAndPreventDefaultBehavior"))}hide($a=null,Nb=0,qc=0){this.hGg&&$a?this.pJj($a,Nb,qc):(3===this.state&&this.fVf(),this.visible=!1,this._state=5)}pJj($a,Nb,qc=0){this.show($a,Nb,15,4,
void 0,qc)}A9f($a,Nb,qc=!1,Lc=!1,sd=!1,Fd=0){this.show($a,Nb,20,qc?2:Lc?1:0,sd,Fd)}MIj($a,Nb,qc,Lc=!1,sd=0){this.show($a,Nb,qc+20,3,Lc,sd)}show($a,Nb,qc,Lc=3,sd=!1,Fd=0){!$a||Lc===this.state&&this.Jbi(Nb,qc)||(this.AIg(Lc,sd,Fd),this.RYa($a,Lc,Fd),this._state=Lc,4===Fd||0===Fd&&!this.RI?this.element.style.left=Nb+"px":this.element.style.right=Nb+"px",this.element.style.top=qc+"px",this.visible=!0)}RYa($a,Nb,qc){this.hme=$a;Wb.a.qrb(this.uG);jb.a.q5g(this.uG);this.uG.id="fly_"+$a.clientId;this.uG.style.backgroundColor=
$a.color;4!==Nb?(this.uG.style.height=this.Fib+"px",this.uG.style.lineHeight=this.Fib+"px",jb.a.fSa(this.uG,"border-radius",this.Fib+"px")):4===qc||0===qc&&!this.RI?this.uG.style.left="0px":this.uG.style.right="0px";2!==Nb&&(4===Nb?Wb.a.iyc(this.uG,""):1===Nb?this.uG.appendChild(this.Zvg):(this.uG.setAttribute("dir","auto"),qc=wc.a.gXh($a.userName),(!$a.isAnonymous||l.AFrameworkApplication.fa.getBooleanFeatureGate("Microsoft.Office.SharedOnline.IsCustomAnonymousNameEnabled",!1))&&qc||0!==Nb?($a=$a.userName,
0===Nb&&($a=qc,jb.a.fSa(this.uG,"text-align","center")),Wb.a.iyc(this.uG,$a)):(this.yMc||(this.yMc=this.ybh()),this.uG.appendChild(this.yMc),jb.a.fSa(this.uG,"text-align","start"))))}fd($a){if(0===this.state)return this.raiseEvent(ta.xka,new ta(1,$a)),!0;3===this.state&&f.ULS.sendTraceTag(50436114,302,50,"User clicked on presence pill.");return!1}AN($a){3===this.state&&this.raiseEvent(ta.xka,new ta(3,$a));return!1}Cw($a){3!==$a.vb&&this.raiseEvent(ta.xka,new ta(2,$a));return!1}onPointerDown($a){if(3!==
$a.vb)return!0;this.raiseEvent(ta.xka,new ta(4,$a));return!1}ybh(){const $a=document.createElement("img");$a.src=sb.a.Xsa("doughperson_white_glyph.svg");$a.setAttribute("Unselectable","on");kb.a.nh($a,kb.a.Cd,kb.a.sq);return Qb.createClusteredImageFromClusterWithImageClass(this.Fib,this.Fib,null,null,Jc.gJh,"",!1,"",this.element.ownerDocument,$a)}AIg($a,Nb=!1,qc=0){if(!this.qAb(this.state)||!this.qAb($a))switch(Sys.UI.DomElement.removeCssClass(this.element,this.FIc),this.state){case 4:3===$a?this.Hga(Jc.ndd,
Jc.bZe):this.qAb($a)&&this.Hga(Jc.ldd,Jc.bZe);break;case 3:4===$a?this.Hga(Jc.rdd,Jc.aZe):this.qAb($a)&&(Nb&&this.fVf(),this.Hga(Jc.ldd,Jc.aZe,Nb?Jc.fJh:""));break;case 0:case 1:case 2:4===$a?this.Hga(Jc.rdd,Jc.pdd):3===$a&&(Nb&&this.bJg(),this.Hga(Jc.ndd,Jc.pdd,Nb?Jc.dZe:"",3===qc?Jc.jJh:Jc.hJh));break;default:4===$a?this.Hga(Jc.rdd):3===$a?this.Hga(Jc.ndd):this.qAb($a)&&this.Hga(Jc.ldd)}}Hga(...$a){this.FIc=$a.join(" ");Sys.UI.DomElement.addCssClass(this.element,this.FIc)}bJg(){this.k9d=window.setTimeout(()=>
{this.element&&(this.gqa=this.element.cloneNode(!0),this.element.parentNode.appendChild(this.gqa),this.element.style.zIndex="2",this.gqa.style.zIndex="1")},300)}fVf(){window.clearTimeout(this.k9d);this.gqa&&(Sys.UI.DomElement.removeCssClass(this.gqa,Jc.pdd+" "+Jc.dZe),Sys.UI.DomElement.addCssClass(this.gqa,Jc.eJh),z.Task.delay(300).continueWith(()=>{this.element&&this.element.parentNode===this.gqa.parentNode&&this.element.parentNode.removeChild(this.gqa)}),jb.a.LJb(this.element,"z-index"))}qAb($a){return 0===
$a||1===$a||2===$a}Jbi($a,Nb){const qc=jb.a.rD(this.element.style.top);return jb.a.rD(this.element.style.left)===$a&&qc===Nb}GNd($a){3===$a&&jb.a.O2(this.element,"left")?($a=jb.a.rD(this.element.style.left),jb.a.LJb(this.element,"left"),this.element.style.right=-1*$a+"px"):4===$a&&jb.a.O2(this.element,"right")&&($a=jb.a.rD(this.element.style.right),jb.a.LJb(this.element,"right"),this.element.style.left=-1*$a+"px")}}Jc.dJh="prModernFlyout UIFont";Jc.rdd="flyoutIdle";Jc.ndd="flyoutExpanded";Jc.ldd=
"flyoutCollapsed";Jc.bZe="flyoutFromIdle";Jc.aZe="flyoutFromExpanded";Jc.pdd="flyoutFromCollapsed";Jc.dZe="flyoutStacked";Jc.fJh="flyoutFromStacked";Jc.eJh="flyoutFadeOut";Jc.gJh="cui-img-cont-float cui-img-20by20";Jc.hJh="flyoutLtrDir";Jc.jJh="flyoutRtlDir";Object(c.a)(Jc,"ModernPresenceTooltipFlyoutControl",eb,[]);class zc{constructor($a,Nb,qc=2,Lc=4){this.offsetTop=$a;this.offsetLeft=Nb;this.Lmg=qc;this.Icf=Lc}}Object(c.a)(zc,"FlyoutsPositioningInfo",null,[]);var gd=a(40);class Va{constructor($a=
!1,Nb=!1){this.Xi=$a;this.aLc=Nb}aYh($a,Nb,qc,Lc,sd){const Fd=sd.y,Td=sd.height;var ue=this.aQh(Lc);const Ae=ue+Nb,Le=$a*qc+2*($a-1);qc=null;1===$a||this.l1g(ue,Le,Fd,Td)?$a=new zc(0,0,2):($a=this.$cd(Ae,Le,Fd,Td),$a.offsetTop-=ue);this.aLc?qc=new zc(0,0,void 0,this.Xi?4:3):(Lc=this.$Ph(Lc,sd),ue=Math.max(0,sd.x),sd=sd.width,Nb=Lc+Nb,this.m1g(Lc,ue,sd)?qc=new zc(0,0,void 0,this.Xi?3:4):this.n1g(Nb,ue)&&(qc=new zc(0,0,void 0,this.Xi?4:3)),qc||(qc=this.tIh(Lc,Nb,ue,sd)));return new zc($a.offsetTop,
qc.offsetLeft,$a.Lmg,qc.Icf)}aQh($a){return gd.a.ZPh($a)}$Ph($a,Nb){return this.Xi?Nb.width-gd.a.YPh($a):gd.a.XPh($a)}l1g($a,Nb,qc,Lc){return $a+Nb<=qc+Lc}$cd($a,Nb,qc,Lc){let sd=1,Fd=Math.max(qc,$a-Nb);Nb>$a-qc&&(sd=2,Fd=Nb<Lc?Lc-Nb:qc);return new zc(Fd,0,sd)}m1g($a,Nb,qc){return $a+150<=Nb+qc}n1g($a,Nb){return 150<=$a-Nb}tIh($a,Nb,qc,Lc){Lc-Nb>=$a-qc?$a=4:(Nb=$a,$a=3);return new zc(0,Nb,void 0,$a)}}Object(c.a)(Va,"ModernPresenceTooltipPositioner",null,[]);class Eb{constructor($a,Nb,qc,Lc,sd,Fd,
Td){this.CL=$a;this._parent=Nb;this.E6d=qc;this.xug=Lc;this.jyg=sd;this.cYa=Fd;this.RI=Td;this._element=document.createElement("div");this.element.className="prTouchTarget"}get element(){return this._element}update($a,Nb){if(3!==$a)if(5!==$a&&this.CL&&this.CL.length){if(4===$a){var qc=this.jyg;var Lc=(this.cYa-qc)/2;this.element.style.height=this.cYa+"px";this.element.style.width=this.cYa+"px";$a=jb.a.rD(this.CL[0].element.style.top);Nb=jb.a.rD(this.RI?this.CL[0].element.style.right:this.CL[0].element.style.left)}else qc=
this.E6d,Lc=(this.cYa-qc)/2,this.element.style.height=this.cYa+"px",this.element.style.width=this.zRh()+2*Lc+"px",$a=jb.a.rD(this.CL[this.CL.length-1].element.style.top),Nb=this.K0g(this.CL[this.CL.length-1].element,qc,Nb);jb.a.fSa(this.element,"border-radius",this.cYa+"px");this.element.style.top=$a-Lc-qc+"px";this.RI?this.element.style.right=Nb-Lc+"px":this.element.style.left=Nb-Lc+"px";this.element.parentNode||this._parent.insertBefore(this.element,this._parent.firstChild)}else this.element.parentNode&&
this.element.parentNode.removeChild(this.element)}K0g($a,Nb,qc){return this.RI&&!qc?jb.a.rD($a.style.right):this.RI||qc?this.RI&&qc?-jb.a.rD($a.style.left)-Nb:-jb.a.rD($a.style.right)-Nb:jb.a.rD($a.style.left)}zRh(){return this.CL&&this.CL.length?this.E6d+Math.min(this.CL.length-1,2)*this.xug:0}}Object(c.a)(Eb,"ModernPresenceTooltipTarget",null,[]);var hc=a(146),Ab=a(268);class Bb extends eb{constructor($a,Nb,qc){super($a);this.wXa=this.E8=this.BUb=this.LDa=!1;this.mA=[];this.uUb={};this.ke=qc;this.Xi=
qc.get(8,!1);this.L$d=qc.get(15,!1);this.Gvg=qc.get(12,0);this.xsa=qc.get(6,0);this.iYb=Nb;this.Dme=qc.get(16);this.aLc=qc.get(17,!1);qc.get(19,!1);this.bCg=qc.get(20,!1);this.oVb=0;this.YBg=new Va(this.Xi,this.aLc);this.khb=this.h2e();this.$Qc=!1;this.Rea=[];this.Qjb=[];this.element.id=Bb.lMh();this.element.className=eb.Kgh(this.Xi);this.wtb&&(this.zIndex=this.wtb);this.rtl=this.Xi;this.Uxj(Nb);this.pfa=this.createElement("div");this.pfa.className="prFlyoutContainer";this.element.appendChild(this.pfa);
this.CL=[];this.nqa=new Eb(this.IJ,this.element,this.xsa,4,6,32,this.Xi);this.gA=qc.get(9);this.gA.ta(oc.a.pointerDown,this.nqa.element,Object(b.a)(this,this.y$a,"onHitTarget"));this.gA.ta(oc.a.pointerOver,this.nqa.element,Object(b.a)(this,this.y$a,"onHitTarget"));this.gA.ta(oc.a.pointerOut,this.nqa.element,Object(b.a)(this,this.y$a,"onHitTarget"))}get Csc(){return Ab.a.clone(this.mA)}get IJ(){return this.CL}get wtb(){return this.Gvg}get dja(){return this.IJ?this.IJ.length:0}get DBa(){return 0<this.dja?
this.IJ[0].state:5}get vif(){return 3===this.DBa&&!this.LDa}uXc($a){this.addHandler(ta.xka,$a)}Puc($a){this.removeHandler(ta.xka,$a)}dispose(){if(this.vif)this.$Qc=!0;else{if(this.IJ)for(const $a of this.IJ)$a.Puc(Object(b.a)(this,this.B$a,"onInteractivityChanged")),Gb.a.Ja($a);this.CL=null;this.gA.Ba(oc.a.pointerDown,this.nqa.element,Object(b.a)(this,this.y$a,"onHitTarget"));this.gA.Ba(oc.a.pointerOver,this.nqa.element,Object(b.a)(this,this.y$a,"onHitTarget"));this.gA.Ba(oc.a.pointerOut,this.nqa.element,
Object(b.a)(this,this.y$a,"onHitTarget"));super.dispose()}}JW(){this.BHa();this.visible=!0}Zda(){this.visible=!0;this.vWe();this.LDa=!0}hide(){this.wVf();this.Wbf();this.nqa.update(this.DBa,this.wXa)}RYa($a){const Nb=this.DBa,qc=this.LDa;$a.clientId||($a.clientId=(Bb.wae++).toString());if($a.clientId in this.uUb){var Lc=this.pvb($a.clientId);if(0<=Lc){Lc=this.mA[Lc];if(Lc.color===$a.color&&Lc.userName===$a.userName)return;this.lcb($a.clientId)}}this.hide();Lc=new Jc(this.createElement("div"),this.ke);
Lc.uXc(Object(b.a)(this,this.B$a,"onInteractivityChanged"));this.pfa.insertBefore(Lc.element,this.pfa.firstChild);this.uUb[$a.clientId]=Lc;Array.add(this.mA,$a);Array.add(this.IJ,Lc);this.Zkg(Nb,qc);this.visible=!0}lcb($a){if(this.vif)Array.add(this.Qjb,$a);else{var Nb=this.DBa,qc=this.LDa;this.hide();this.JVf($a);this.Zkg(Nb,qc)}}I9a($a){const Nb=this.pvb($a);if(!(0>=Nb)){var qc=this.mA[Nb];$a=this.uUb[$a];Array.removeAt(this.mA,Nb);Array.insert(this.mA,0,qc);Array.removeAt(this.IJ,Nb);Array.insert(this.IJ,
0,$a);this.pfa.removeChild($a.element);this.pfa.appendChild($a.element);this.BHa()}}Zkg($a,Nb){0>=this.mA.length?this.hide():3===$a&&Nb?this.Zda():this.JW()}HMb($a,Nb){Nb?this.XHg($a):this.MUf($a)}Ina($a){$a!==this.BUb&&(this.BUb=$a,this.kSd($a))}position($a,Nb){this.element.style.top=Nb+"px";this.element.style.left=$a+"px"}BHa($a=!1){if(!$a||this.E8){this.BUb&&this.kSd(!0);var Nb=Math.min(3,this.dja)-1;$a=0;var qc=1,Lc=0;this.wXa&&($a=this.khb,qc=-1,Lc=-this.xsa);for(let sd=this.dja-1;sd>Nb;sd--)this.IJ[sd].A9f(this.mA[sd],
-4*Nb*qc+Lc,!0,!1,!0,$a);for(;0<=Nb;Nb--)this.IJ[Nb].A9f(this.mA[Nb],-4*Nb*qc+Lc,0<Nb,Array.contains(this.Rea,this.mA[Nb].clientId),Nb!==this.oVb,$a);this.oVb=0;this.nqa.update(0,this.wXa);this.zIndex=this.wtb;this.LDa=!1;this.wVf(0);this.$Qc&&this.dispose()}}vWe(){this.BUb&&this.kSd(!1);this.zIndex=this.wtb+1;let $a,Nb,qc;({offsetX:Nb,offsetY:$a,Hcf:qc}=this.Wzj());for(let Lc=0;Lc<this.dja;Lc++)this.IJ[Lc].MIj(this.mA[Lc],Nb,$a+(this.xsa+2)*Lc,Lc!==this.oVb,qc)}Wbf(){let $a=0,Nb=0;this.wXa&&($a=
this.khb,Nb=-6);for(let qc=0;qc<this.dja;qc++)this.IJ[qc].hide(this.mA[qc],Nb,$a);this.zIndex=this.wtb;this.visible=this.LDa=!1;this.$Qc&&this.dispose()}p3c($a=0){$a?(this.E8=!0,z.Task.delay($a).continueWith(()=>{this.L$d?this.$ci():this.BHa(!0);this.E8=!1})):this.L$d?this.hide():this.BHa()}$ci(){this.E8&&this.hide()}nWg(){if(l.AFrameworkApplication.sa&&l.AFrameworkApplication.sa.Qa.vw&&hc.c()){const $a=appChrome.selectors.getShyState();return $a.isActive&&0!==$a.state}return!1}B$a($a,Nb){$a=this.DBa;
this.nWg()||2!==Nb.type&&(4!==Nb.type||3===$a)?4===Nb.type&&3===$a?(this.E8&&(this.E8=!1),this.p3c()):3!==Nb.type||3!==$a||this.LDa||(1<this.dja?(this.E8=!0,z.Task.delay(250).continueWith(()=>{this.BHa(!0);this.E8=!1})):this.p3c()):(this.E8&&(this.E8=!1),3!==$a&&(this.vWe(),3===Nb.Mub.vb&&this.p3c(2E3)));this.raiseEvent(ta.xka,Nb)}y$a($a){3===$a.vb?this.B$a(this,new ta(4,$a)):$a.eventName===oc.a.pointerOver?this.B$a(this,new ta(2,$a)):$a.eventName===oc.a.pointerOut&&this.B$a(this,new ta(3,$a));return!1}Uxj($a){this.element.style.width=
$a+"px";this.element.style.height=this.xsa+"px"}JVf($a){this.MUf($a);$a=this.pvb($a);if(!(0>$a)){var Nb=this.mA[$a];Array.removeAt(this.mA,$a);delete this.uUb[Nb.clientId];Nb=this.IJ[$a];this.pfa.removeChild(Nb.element);this.ke.get(18,!1)&&Nb.Puc(Object(b.a)(this,this.B$a,"onInteractivityChanged"));Array.removeAt(this.IJ,$a);Nb.dispose()}}wVf($a=5){if(this.Qjb.length){this.visible&&this.Wbf();for(let Nb=0;Nb<this.Qjb.length;Nb++)this.JVf(this.Qjb[Nb]);Array.clear(this.Qjb);0>=this.mA.length||5===
$a?this.hide():0===$a&&this.JW()}}pvb($a){for(let Nb=0;Nb<this.mA.length;Nb++)if(this.mA[Nb].clientId===$a)return Nb;return-1}XHg($a){if(-1===this.pvb($a))f.ULS.sendTraceTag(41706451,302,15,"Cannot set active editor because client id is invalid");else{if(Array.contains(this.Rea,$a)){if(this.mA[0].clientId===$a)return;Array.remove(this.Rea,$a)}Array.add(this.Rea,$a);this.I9a($a);1!==this.DBa&&this.BHa()}}MUf($a){-1===this.pvb($a)?f.ULS.sendTraceTag(41706452,302,50,"Cannot remove active editor because client id is invalid"):
Array.contains(this.Rea,$a)&&(Array.remove(this.Rea,$a),this.mA[0].clientId===$a&&0<this.Rea.length&&this.I9a(this.Rea[this.Rea.length-1]),this.mA[0].clientId===$a&&1===this.DBa&&this.BHa())}kSd($a){$a?Sys.UI.DomElement.addCssClass(this.pfa,"prBackgroundSelection"):Sys.UI.DomElement.removeCssClass(this.pfa,"prBackgroundSelection")}Wzj(){let $a,Nb;Nb=$a=0;var qc=this.khb;if(this.Dme){const Lc=this.Dme(this);if(!Lc)return{offsetX:$a,offsetY:Nb,Hcf:qc};const sd=4===this.DBa;qc=this.YBg.aYh(this.dja,
sd?6:this.xsa,this.xsa,this.element,Lc);Nb=qc.offsetTop;this.oVb=this.dXh(qc.Lmg,qc.offsetTop);qc=qc.Icf;qc!==this.khb&&(this.GNd(qc),this.element.dir=3===qc?"rtl":"ltr",this.khb=qc);qc!==this.h2e()?($a=this.bCg?-2:sd?-6:-this.xsa,this.wXa=!0):this.wXa=!1}return{offsetX:$a,offsetY:Nb,Hcf:qc}}dXh($a,Nb){if(1===$a)return this.dja-1;$a=Math.abs(Nb);return 0<$a?$a/(this.xsa+2):0}GNd($a){for(let Nb=0;Nb<this.dja;Nb++)this.IJ[Nb].GNd($a)}h2e(){return this.Xi?3:4}static lMh(){return String.format("{0}-{1}",
"presencetooltip",Bb.wae++)}}Bb.wae=0;Object(c.a)(Bb,"ModernPresenceTooltipControl",eb,[449,2]);var ec=a(227),Qd=a(354),dc=a(240);class dd{constructor($a){this.ke=$a;this.ke.PYa(10,ec.a.instance);this.ke.PYa(9,dc.a.instance);this.ke.PYa(6,20);this.ke.PYa(13,Qd.a.instance);this.ke.PYa(17,!1)}jch(){var $a=document.createElement("div");this.ke.PYa(15,!1);return new Bb($a,20,this.ke)}}Object(c.a)(dd,"ModernPresenceTooltipFactory",null,[889]);var jd=a(180),md=a(19),vd=a(63),wd=a(163),Pd=a(12),ic=a(35),
cd=a(350),Hd;(function($a){$a[$a.none=0]="none";$a[$a.master=1]="master";$a[$a.fixed=2]="fixed";$a[$a.horizontal=3]="horizontal";$a[$a.vertical=4]="vertical";$a[$a.first=1]="first";$a[$a.last=4]="last"})(Hd||(Hd={}));Object(c.b)("PaneType",Hd);const he=($a,Nb,qc)=>{if(!Nb)return null;$a=$a.Hq;return new Sys.UI.Point(Nb.x+$a.x*(qc?1:-1),Nb.y+$a.y*(qc?1:-1))};class Lb extends O.a{constructor($a,Nb,qc){super();this.yNf=this.iza=null;this.GPd=!1;this.uz=()=>{this.mmd()};this.oF=()=>{this.mmd()};this.gridView=
$a;this.rtl=$a.rtl;this.trd=!1;this.dm=new ic.a(!0);for(let Lc=0;4>Lc;Lc++)if(this.gridView.ib.qsd(qc,Lb.aLa()[Lc])||1===Lb.aLa()[Lc]){const sd=Nb.jch(),Fd=$a.Rf(Lb.aLa()[Lc]).domElement;Fd.insertBefore(sd.element,Fd.firstChild);this.dm.add(Enum.toString(Hd,Lb.aLa()[Lc]),sd)}}uXc($a){this.addHandler("interactivityChanged",$a)}Puc($a){this.removeHandler("interactivityChanged",$a)}get element(){return null}get Csc(){const $a=ic.a.Fc(this.dm.tu,Enum.toString(Hd,Lb.aLa()[0]));return $a?$a.Csc:null}get r7i(){return this.yNf}dispose(){if(0<
this.dm.count){this.hide();const $a=this.dm.tu;for(let Nb in $a)$a[Nb].dispose()}this.gridView=null;this.dm.clear();super.dispose()}TAj($a){this.yNf=$a}JW(){const $a=this.dm.tu;for(let Nb in $a)$a[Nb].JW()}Zda(){this.mmd();const $a=this.dm.tu;for(let Nb in $a)$a[Nb].Zda()}hide(){this.$Ta();const $a=this.dm.tu;for(let Nb in $a)$a[Nb].hide()}RYa($a){const Nb=this.dm.tu;for(let qc in Nb)Nb[qc].RYa($a)}I9a($a){const Nb=this.dm.tu;for(let qc in Nb)Nb[qc].I9a($a)}lcb($a){const Nb=this.dm.tu;for(let qc in Nb)Nb[qc].lcb($a)}HMb($a,
Nb){const qc=this.dm.tu;for(let Lc in qc)qc[Lc].HMb($a,Nb)}Ina($a){this.trd!==$a&&(this.trd=$a,$a=ic.a.Fc(this.dm.tu,Enum.toString(Hd,Lb.aLa()[0])),this.iza&&$a&&($a=Pd.DOMElementExtensions.getWidth($a.element)/2,this.position(this.trd?this.iza.x+14+$a:this.iza.x-14-$a,this.iza.y)))}position($a,Nb){const qc=this.dm.tu;for(let Fd in qc){var Lc=qc[Fd],sd=Enum.parse(Hd,Fd);sd=this.gridView.Rf(sd);const Td=he(sd,new Sys.UI.Point($a,Nb),!1);this.iza=new Sys.UI.Point($a,Nb);0>Td.x&&(Td.x+=sd.domElement.scrollLeft);
Pd.DOMElementExtensions.updatePosition(Lc.element,Td.x,Td.y,!1,this.rtl)}}mmd(){this.iza&&(this.position(this.iza.x,this.iza.y),this.GPd||(this.GPd=!0,this.gridView.Ca.zG(this.uz),this.gridView.Ca.Ns(this.uz),this.gridView.view.Ps(this.oF)))}$Ta(){this.GPd&&(this.gridView.Ca.aI(this.uz),this.gridView.Ca.Kq(this.uz),this.gridView.view.Mq(this.oF))}static aLa(){return Lb.L9||(Lb.L9=[1,3,2,4])}}Lb.L9=null;Object(c.a)(Lb,"PaneInvariantTooltip",O.a,[449,2]);class Ic{}Ic.jNb=!1;Ic.Wna=!1;Object(c.a)(Ic,
"PresenceViewSettings",null,[]);class Ob{constructor($a){this.Jjc=!1;this.Cz=this.Roa=this.oOf=null;this.oGb=Nb=>{const qc=this.Waa(Nb.yy);qc&&this.xuc(qc,Nb.nza.clientId,Nb.yy)};this.RGb=Nb=>{this.nI(!1,Nb)};this.QGb=Nb=>{this.nI(!0,Nb)};this.uz=()=>{this.$kg()};this.oF=()=>{this.$kg()};this.Rya=()=>{this.Csb();this.clearCache()};this.I6h=Nb=>{Nb=Pd.DOMElementExtensions.getBounds(Nb.element);Nb=new vd.a(Nb.x,Nb.y,Nb.width,Nb.height);for(const Lc of Lb.aLa()){var qc=this.gridView.Rf(Lc);qc=Pd.DOMElementExtensions.getBoundingClientRect(qc.domElement);
if((new vd.a(qc.x,qc.y,qc.width,qc.height)).zd(Nb))return qc}return null};this.H2j=()=>{const Nb=this.qz;for(let qc in Nb){const Lc=Nb[qc];if(Lc){const sd=Lc.HMa(),Fd=this.Waa(Lc.yy),Td=sd?this.g6e(Lc.Bsc,Lc.paneType,Lc.range):null;if(Td!==Fd){Fd&&this.xuc(Fd,Lc.nza.clientId,Lc.yy);if(!Ic.Wna)break;Td&&sd&&(Td.RYa(Lc.nza),this.sUa[Lc.yy]=Td,Lc.oOb(Td),this.taf(Td,Lc))}else this.taf(Fd,Lc)}}};this.Zdi=md.a.Izh;this.KLa=20;this.gridView=za.h($a);this.$=$a;this.qIb={};this.sUa={};this.qz={};this.qUa=
{};this.$.va&&this.$.va.Vf(this.Rya);this.Csb()}dispose(){this.$Ta();this.clearCache();this.$&&this.$.va&&this.$.va.sg(this.Rya);this.gridView=null}$Ta(){this.Jjc&&(this.gridView.Ca.aI(this.uz),this.gridView.Ca.Kq(this.uz),this.gridView.view.Mq(this.oF),this.Jjc=!1)}lYj($a){const Nb=this.qz[$a],qc=this.Waa($a);Nb&&this.eVf(Nb);qc&&this.xuc(qc,Nb.nza.clientId,Nb.yy);delete this.sUa[$a];delete this.qz[$a];delete this.qUa[$a]}U0d($a){const Nb=$a.yy;this.qz[Nb]||(this.I5a($a),this.qz[Nb]=$a)}A0d($a){this.Cz=
$a;this.bYi($a)}L2j($a){const Nb=$a.yy,qc=this.g6e($a.Bsc,$a.paneType,$a.range),Lc=this.Waa(Nb);qc&&qc!==Lc&&($a.oOb(qc),this.sUa[Nb]=qc,this.qz[Nb]=$a,this.qUa[Nb]&&qc.Ina(this.qUa[Nb]));Lc!==qc&&Lc&&this.xuc(Lc,$a.nza.clientId,$a.yy);!this.Jjc&&this.gridView&&(this.gridView.Ca.zG(this.uz),this.gridView.Ca.Ns(this.uz),this.gridView.view.Ps(this.oF),this.Jjc=!0)}xuc($a,Nb,qc){$a.lcb(Nb);Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:3663630_ModernPresenceUxPerf")&&this.Waa(qc)===$a&&delete this.sUa[qc];
$a.Csc&&$a.Csc.length||((Nb=$a.r7i)&&delete this.qIb[Nb],Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:3663630_ModernPresenceUxPerf")||this.Waa(qc)===$a&&delete this.sUa[qc],$a.dispose())}eVf($a){$a&&($a.YLd(this.oGb),$a.wMd(this.RGb),$a.vMd(this.QGb),$a.oOb(null))}I5a($a){$a.tXc(this.oGb);$a.UXc(this.RGb);$a.TXc(this.QGb)}nI($a,Nb){if(Ic.Wna){Nb.cja||this.U0d(Nb);this.L2j(Nb);var qc=this.Waa(Nb.yy);qc&&(qc.RYa(Nb.nza),this.Cz===Nb.yy&&qc.I9a(Nb.yy),Nb.HMa()?$a?qc.Zda():qc.JW():qc.hide())}}bYi($a){const Nb=
this.Waa($a);jd.a(()=>{null===Nb||void 0===Nb?void 0:Nb.I9a($a)},this.$.la)}Waa($a){return this.sUa[$a]}g6e($a,Nb,qc){if(!$a)return null;$a=this.hhd($a,Nb,qc);var Lc=this.gridView.Rf(Nb).Hq;Nb=Ob.l0h($a,Nb,Lc).toString();Lc=ic.a.Fc(this.qIb,Nb);Lc||(Lc=new Lb(this.gridView,this.oOf,qc),Lc.position($a.x,$a.y),Lc.TAj(Nb),this.qIb[Nb]=Lc);return Lc}hhd($a,Nb,qc){const Lc=this.gridView.Rf(Nb).zn,sd=this.gridView.Rf(Nb).Hq;Nb=cd.a.GM(Nb,Lc.topLeft);let Fd=Math.max(sd.x,$a.x-this.KLa/2-2);Fd=Math.min(Math.max(Nb.x+
sd.x,Fd),Nb.x+sd.x+Lc.width-this.KLa);$a=Math.max(sd.y,$a.y-this.KLa/2+1);if(Nb.y+sd.y>$a||this.$Tj(qc))Fd=Math.min(Fd+this.KLa/4,Nb.x+sd.x+Lc.width-this.KLa);$a=Math.min(Math.max(Nb.y+sd.y,$a),Nb.y+sd.y+Lc.height-this.KLa);return new Sys.UI.Point(Fd,$a)}clearCache(){var $a=this.qz;for(let Nb in $a)this.eVf($a[Nb]);$a=this.qIb;for(let Nb in $a)$a[Nb].dispose();this.sUa={};this.qz={};this.qIb={};this.qUa={};Gb.a.Ja(this.Roa);this.Roa=null}Csb(){const $a=new ha;$a.add(0,md.a.KTe);$a.add(1,this.Zdi);
$a.add(12,49);$a.add(6,this.KLa);this.gridView&&($a.add(4,Ma.a.qe(3)),$a.add(5,Ma.a.qe(3)),$a.add(8,this.gridView.rtl));$a.add(18,!0);this.oOf=new dd($a);$a.add(16,this.I6h)}$kg(){Ic.Wna&&(this.Roa=wd.AsyncMethodContext.vq(this.H2j,100,Ka.a.F8i,this.Roa))}taf($a,Nb){Ic.Wna&&(this.qUa[Nb.yy]&&$a.Ina(this.qUa[Nb.yy]),Nb.HMa()?Nb.Xna(!0,!0):Nb.Xna(!1,!0))}Ina($a,Nb){this.qUa[$a]=Nb;($a=this.Waa($a))&&$a.Ina(Nb)}HMb($a,Nb){const qc=this.Waa($a);qc&&qc.HMb($a,Nb)}static l0h($a,Nb,qc){return $a.x.toString()+
"-"+$a.y.toString()+"-"+Nb.toString()+"-"+qc.x.toString()+"-"+qc.y.toString()}$Tj($a){var Nb;$a=za.h(this.$).Ca.pja($a.topRight);return null===(Nb=null===$a||void 0===$a?void 0:$a[0])||void 0===Nb?void 0:Nb.bka}}Object(c.a)(Ob,"PresenceTooltipManager",null,[2]);var Kc=a(106),Ac=a(116);class Yc extends O.a{constructor($a,Nb,qc,Lc,sd){super();this.ay=[];this.L_a=null;this.visible=!1;this.Dpb=this.eDb=null;this.cja=!1;this.LKj=()=>{Gb.a.Ja(this.Dpb);this.Dpb=null;this.visible&&(this.HMa()?this.raiseEvent("showPresenceTooltip"):
this.u4(!0))};this.EDd=Fd=>{this.lcb(Fd)};this.uz=()=>{this.$ig()};this.oF=()=>{this.$ig()};this.domElement=$a;this.gridView=Nb;this.PUc=$a.id;this.Yqa=Lc;this.$=sd;this.Ijc=!1;this.Ecf();this.oRc=qc;this.Pg=null;this.UB={};this.UB.FirstColumn=0;this.UB.FirstRow=0;this.UB.LastColumn=0;this.UB.LastRow=0}tXc($a){this.addHandler("hidePresenceTooltip",$a)}YLd($a){this.removeHandler("hidePresenceTooltip",$a)}UXc($a){this.addHandler("showPresenceTooltip",$a)}wMd($a){this.removeHandler("showPresenceTooltip",
$a)}TXc($a){this.addHandler("showFullPresenceTooltip",$a)}vMd($a){this.removeHandler("showFullPresenceTooltip",$a)}cGa($a){this.addHandler("presenceChanged",$a)}Xza($a){this.removeHandler("presenceChanged",$a)}get yy(){return this.PUc}get nza(){return this.oRc}get paneType(){return this.Yqa}get Bsc(){if(!this.domElement)return null;var $a=this.gridView.Rf(this.paneType).zn,Nb=this.gridView.rtl,qc=this.domElement.offsetWidth;if(!this.Pg&&4>=qc){if(this.UB){qc=this.gridView.hi;var Lc=this.UB.FirstRow;
Nb=Nb?this.UB.FirstColumn:this.UB.LastColumn;if(qc&&!(Lc>=qc.top&&Lc<=qc.bottom&&Nb>=qc.left&&Nb<=qc.right))return Lc=Lc<=qc.top?$a.y:$a.y+(Lc>=qc.bottom?$a.height:$a.height/2),Nb=Nb<=qc.left?$a.x:$a.x+(Nb>=qc.right?$a.width:$a.width/2),this.eDb=new Sys.UI.Point(Nb,Lc)}return this.eDb}if(this.Pg){$a=this.domElement.offsetTop-2;Lc=parseInt(this.domElement.style.left,10);let sd=0;Nb&&(sd=parseInt(this.domElement.parentNode.style.width,10)-qc-Lc,sd-=this.gridView.MR.rNa&&this.gridView.MR.dud?Ac.a.Bu:
0);return this.eDb=new Sys.UI.Point((Nb?sd:Lc)+qc+4,$a)}return this.eDb=new Sys.UI.Point(parseInt(Nb?this.domElement.style.right:this.domElement.style.left,10)+qc,this.domElement.offsetTop)}get range(){return Yb.D(this.UB)}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.aDe();this.$Ta();Gb.a.Ja(this.Dpb);this.domElement=this.gridView=null;super.dispose()}xVd($a,Nb){const qc=!!$a&&!Yb.D($a).equals(Yb.D(this.UB)),Lc=!!Nb&&(!this.Pg||this.Pg.get_id()!==Nb.get_id());
if(qc||Lc)this.raiseEvent("presenceChanged"),this.aDe(),this.cja=!1,this.UB=$a,this.Pg=Nb,this.eDb=null}u4($a){this.visible=this.cja=!1;$a&&this.raiseEvent("hidePresenceTooltip")}Kga($a){this.ay.push($a);this.Ecf();$a.cGa(this.EDd)}Xna($a,Nb){$a?(this.visible=!0,Nb&&(this.Dpb=wd.AsyncMethodContext.vq(this.LKj,this.$.ya.ShowTooltipDelayInMs,Ka.a.gUj,this.Dpb))):this.u4(Nb)}oOb(){}kgb(){if(this.domElement&&this.visible){this.L_a=Pd.DOMElementExtensions.getBoundingClientRect(this.domElement);const $a=
Math.floor(this.L_a.x);this.L_a.x=$a===this.L_a.x?$a:$a+1;this.L_a.y=Math.floor(this.L_a.y)}}HMa(){if(!this.UB)return!1;const $a=this.t0h();return $a?this.gridView.Usi($a,this.paneType):!1}t0h(){if(this.range.isSingle){var $a=this.gridView.Ca.ova(this.range,this.$.activeItemName);return $a?($a=$a.Vr(this.range))?$a.MC:null:null}return this.range}aDe(){for(let $a=0,Nb=this.ay.length;$a<Nb;$a++)this.ay[$a].Xza(this.EDd);this.ay.length=0;this.$Ta()}Ecf(){!this.Ijc&&1<=this.ay.length&&(this.Ijc=!0,this.gridView.Ca.zG(this.uz),
this.gridView.Ca.Ns(this.uz),this.gridView.view.Ps(this.oF))}$Ta(){this.Ijc&&!this.ay.length&&(this.Ijc=!1,this.gridView&&(this.gridView.Ca.aI(this.uz),this.gridView.Ca.Kq(this.uz),this.gridView.view.Mq(this.oF)))}lcb($a){$a.Xza(this.EDd);Array.remove(this.ay,$a);this.$Ta()}$ig(){this.kgb();for(let $a=0,Nb=this.ay.length;$a<Nb;$a++)this.ay[$a].kgb()}}Object(c.a)(Yc,"TooltipNotificationUnit",O.a,[468,2]);class td extends O.a{constructor($a,Nb,qc,Lc,sd,Fd,Td,ue){super();this.Gb=null;this.qz={};this.Cne=
0;this.Pg=this.Nra=null;this.Yqa=0;this.oGb=Ae=>{this.Nra&&this.Nra!==Ae||(this.Nra=null,this.u4(!1));this.raiseEvent("hidePresenceTooltip")};this.RGb=Ae=>{this.Nra&&this.Nra!==Ae||(this.Nra=null,this.Xna(!0,!1));this.raiseEvent("showPresenceTooltip")};this.QGb=Ae=>{this.Nra||this.raiseEvent("showFullPresenceTooltip");this.Nra=Ae};this.JGb=()=>{this.u4(!1);this.raiseEvent("presenceChanged")};ue=qc===W.a.instance.ob(87)||ue;this.oRc=new mb.a(Nb,qc,Lc,new Ja.a,null,null,null,null,ue);this.gridView=
$a;this.PUc=Nb;this.highlight=sd;this.ky=Fd;this.$=Td}tXc($a){this.addHandler("hidePresenceTooltip",$a)}YLd($a){this.removeHandler("hidePresenceTooltip",$a)}UXc($a){this.addHandler("showPresenceTooltip",$a)}wMd($a){this.removeHandler("showPresenceTooltip",$a)}TXc($a){this.addHandler("showFullPresenceTooltip",$a)}vMd($a){this.removeHandler("showFullPresenceTooltip",$a)}cGa($a){this.addHandler("presenceChanged",$a)}Xza($a){this.removeHandler("presenceChanged",$a)}get yy(){return this.PUc}get nza(){return this.oRc}get paneType(){return this.Yqa}get range(){return this.Gb}get Bsc(){return this.Gb||
this.Pg?he(this.gridView.Rf(this.paneType),this.xva(this.paneType).Bsc,!0):null}get cja(){return this.xva(this.paneType).cja}set cja($a){const Nb=this.qz;for(let qc in Nb)Nb[qc].cja=$a}dispose(){this.raiseEvent("hidePresenceTooltip");this.raiseEvent("presenceChanged");this.ky&&this.ky.lYj(this.yy);const $a=this.qz;for(let Nb in $a){const qc=$a[Nb];qc.YLd(this.oGb);qc.wMd(this.RGb);qc.vMd(this.QGb);qc.Xza(this.JGb);qc.dispose()}this.ky=this.Gb=this.highlight=this.gridView=this.qz=null;super.dispose()}gag($a,
Nb,qc=null){$a?(this.Gb=Yb.D($a),this.Yqa=this.gridView.ib.Ai(this.Gb.topRight)):qc?(this.Pg=qc,this.Yqa=qc.ug.paneType):this.Yqa=1;this.Cne=Nb;this.xva(this.paneType);this.xVd($a,qc)}xVd($a,Nb){const qc=this.qz;for(let Lc in qc)qc[Lc].xVd($a,Nb)}u4($a){this.xva(this.paneType).u4($a);$a=this.qz;for(let Nb in $a)$a[Nb].u4(!1)}qpe($a){const Nb=this.qz;for(let qc in Nb){const Lc=Nb[qc];Lc.Kga($a.xva(Lc.paneType))}}Kga($a){this.xva($a.paneType).Kga($a)}HMa(){let $a=this.xva(this.paneType).HMa();const Nb=
this.qz;for(let qc in Nb)$a=Nb[qc].HMa()||$a;return $a}Xna($a,Nb){this.ky.U0d(this);this.xva(this.paneType).Xna($a,Nb);Nb=this.qz;for(let qc in Nb)Nb[qc].Xna($a,!1)}oOb($a){const Nb=this.qz;for(let qc in Nb)Nb[qc].oOb($a)}kgb(){const $a=this.qz;for(let Nb in $a)$a[Nb].kgb();this.ky.U0d(this)}xva($a){return this.q_h($a,this.Cne)}A0d($a){this.ky.A0d($a)}q_h($a,Nb){const qc=this.highlight?this.highlight.NC(Nb,$a).hg:this.Pg?this.Pg.get_element():null;Nb=td.X5h(Nb,$a);let Lc=ic.a.Fc(this.qz,Nb);Lc||(Lc=
new Yc(qc,this.gridView,this.nza,$a,this.$),this.qz[Nb]=Lc,Lc.tXc(this.oGb),Lc.UXc(this.RGb),Lc.TXc(this.QGb),Lc.cGa(this.JGb));return Lc}static X5h($a,Nb){return $a.toString()+Nb.toString()}}Object(c.a)(td,"PaneInvariantTooltipNotificationUnit",O.a,[468,2]);class $d{constructor($a,Nb,qc){this.Pg=this.objectId=this.WTb=null;this.xm=$a;this.$=Nb;this.ky=qc;this.xu=new td(za.h(this.$),this.xm.User.UserID,this.xm.User.UserName,this.xm.UserColor,null,qc,this.$,this.xm.IsAnonymous)}get Pg(){return this.WTb}set Pg($a){this.WTb=
$a}dispose(){this.fzb();Gb.a.Ja(this.xu);this.objectId=this.$=this.xm=this.Pg=null}Kga($a){this.xu.qpe($a.xu)}fzb(){this.Pg&&this.xm&&this.xm.User&&(this.Pg.SDc(!1,this.xm.User.UserID,null),this.xu.u4(!0))}BNb(){Ic.jNb&&this.Pg&&this.xm&&this.xm.User&&(this.Pg.SDc(!0,this.xm.User.UserID,this.xm.UserColor),this.xu.kgb())}nI($a){Ic.Wna&&(this.xu.cja=$a,this.xu.Xna($a,!0))}KNb($a,Nb){this.xu.gag(null,0===Nb?49:50,$a)}}Object(c.a)($d,"FloatingObjectPresenceHighlight",null,[446,2]);var be=a(629),ke=a(72),
Pe=a(11),Dd=a(254),ge=a(162);class ne extends be.a{constructor($a,Nb,qc){super(Nb,za.h(Nb),!0,!1,$a.User.UserID);this.az=[];this.Fic=this.FNb=!1;this.A_=()=>{this.xm.User.UserID===this.Ixb()&&(f.ULS.sendTraceTag(521143967,0,50,`PresenceHighlight:onPresenterDetailsSaved called for User:
        ${this.xm.User.UserID}, Logging presenter information: ${this.Ixb()}, meetingId: ${this.$.ya.MeetingId}`),this.az.forEach(Lc=>{this.dNe(Lc)}),this.az=[])};ne.U0a||(ne.U0a={});this.xm=$a;this.xu=new td(this.gridView,this.xm.User.UserID,this.xm.User.UserName,this.xm.UserColor,this,qc,this.$,this.xm.IsAnonymous);this.Xqd=ge.i(this.$);this.wsi=Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6191577_PresenterPresenceOnTop");this.aqd=ge.a(this.$);this.tif=this.Xqd||this.aqd;this.A_=this.A_.bind(this);
this.tif&&this.rAi()}dispose(){var $a;Gb.a.Ja(this.xu);super.dispose();const Nb=ne.U0a;for(let Lc in Nb){var qc=Lc;const sd=Nb[Lc];sd&&!sd.children.length&&(Pd.DOMElementExtensions.vf(sd),ne.U0a[qc]=null)}null===($a=ne.excelLiveManager)||void 0===$a?void 0:$a.xcb(this.A_);this.az=null}Kga($a){this.xu.qpe($a.xu)}nI($a){Ic.Wna&&(this.Fic||(this.xu.cja=$a,this.xu.Xna($a,!0)),this.FNb=$a&&this.Fic)}KNb($a,Nb){this.xu.gag($a,0===Nb?49:50);this.FNb=!1}BNb($a){Ic.jNb&&(this.xu.Xna(!0,!0),this.Qq([$a]))}fzb($a){this.u4();
this.Nj($a)}kJe($a,Nb,qc){qc.className=ke.a.kBh;qc.style.borderColor=this.xm.UserColor;this.aqd&&qc.classList.add(ke.a.jVe);const Lc=document.createElement("div");49!==$a&&50!==$a&&(Lc.style.backgroundColor=this.xm.UserColor);qc.appendChild(Lc);Lc.className=[ke.a.mBh,ke.a.lBh][$a-49];$a=ic.a.Fc(ne.U0a,Nb.toString());if(!$a){const sd=this.gridView.Rf(Nb).domElement;$a=document.createElement("div");sd.insertBefore($a,sd.firstChild);ne.U0a[Nb.toString()]=$a}$a.appendChild(qc);this.tif&&this.uoh(Lc)}dzb(){}l5f($a,
Nb,qc,Lc){const sd=this.WPg(Lc,$a,Nb);Dd.c(qc,this.gridView.rtl,Pe.HelperMethods.sc(sd.x));qc.width=Pe.HelperMethods.sc(sd.width);qc.top=Pe.HelperMethods.sc(sd.y);qc.height=Pe.HelperMethods.sc(sd.height);Nb=Nb.hg;qc=Nb.parentNode;50===$a?ne.SJd(qc,Nb,!1):49===$a&&($a=this.NC(50),Lc.equals($a.Kkc)?ne.SJd(qc,Nb,!1):ne.SJd(qc,Nb,!0));this.B7i()}L8f(){return!1}WPg($a,Nb,qc){let Lc=$a.y+this.cxb(qc,!1);qc=$a.x+this.cxb(qc,!0)+Ac.a.Med(qc.hg.parentNode.parentNode,this.gridView.rtl);let sd=$a.width;$a=$a.height+
1;1>qc&&-1<=qc&&49===Nb&&(sd-=1-qc,qc=1);1>Lc&&-1<=Lc&&49===Nb&&($a-=1-Lc,Lc=1);sd=Math.max(0,sd-1);$a=Math.max(0,$a-2);return new vd.a(qc,Lc,sd,$a)}B7i(){this.xu.kgb();this.Fic=!1;this.FNb&&this.nI(!0);this.FNb=!1}u4(){this.Fic||(this.xu.u4(!0),this.FNb=!1)}static SJd($a,Nb,qc){qc?Nb!==$a.firstChild&&($a.removeChild(Nb),$a.insertBefore(Nb,$a.firstChild)):Nb!==$a.lastChild&&($a.removeChild(Nb),$a.appendChild(Nb))}uoh($a){var Nb;(null===(Nb=ne.excelLiveManager)||void 0===Nb?0:Nb.wab.Cz)?this.xm.User.UserID===
this.Ixb()&&(f.ULS.sendTraceTag(521143968,0,50,`PresenceHighlight:Distinct presenter presence called for User:${this.xm.User.UserID}, Logging presenter information: ${this.Ixb()}, meetingId: ${this.$.ya.MeetingId}`),this.dNe($a)):(f.ULS.sendTraceTag(509749071,0,50,`PresenceHighlight:PresenterCid is not yet saved for User:${this.xm.User.UserID}`),this.az.push($a))}dNe($a){this.aqd&&this.Yhj($a);this.Xqd&&(f.ULS.sendTraceTag(509749070,0,50,`PresenceHighlight:distinctPresenterPresenceInternal called for User:${this.xm.User.UserID}`),
this.gdi($a));this.Xqd&&this.wsi&&this.I1j($a)}rAi(){ne.excelLiveManager?ne.excelLiveManager.xob(this.A_):this.$.da.gb(473,$a=>{ne.excelLiveManager=$a;ne.excelLiveManager.xob(this.A_)})}gdi($a){jd.a(()=>{$a.style.backgroundColor=this.xm.UserColor;$a.classList.add(ke.a.rBh);f.ULS.sendTraceTag(520648066,0,50,`PresenceHighlight:Highlighting presence for User: ${this.xm.User.UserID}, Logging presenter information: ${this.Ixb()}, meetingId: ${this.$.ya.MeetingId}`)},this.$.la)}Yhj($a){jd.a(()=>{$a.parentElement.classList.remove(ke.a.jVe)},
this.$.la)}I1j($a){this.xu.A0d(ne.excelLiveManager.wab.Cz);jd.a(()=>{$a.parentElement.classList.add(ke.a.qBh)},this.$.la)}Ixb(){return ne.excelLiveManager.wab.Cz}}ne.U0a=null;Object(c.a)(ne,"PresenceHighlight",be.a,[]);class ce extends ab{constructor($a,Nb,qc){super();this.XG=new ic.a(!0);this.countFloatingObjects=this.k5c=this.j5c=0;this.sId=!1;this.Gq=()=>{this.FRd()};this.Rya=()=>{this.FRd()};this.Rz=new Wa($a);this.d7f($a);this.ky=qc;this.JSd([]);this.$=Nb;this.$.va.Vf(this.Rya);za.h(this.$).oT(this.Gq);
this.sId=Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence")}get ic(){return this.Rz.ic}set ic($a){this.Rz.ic=$a;this.FRd()}Uzc(){var $a=1===this.ic.PresenceType?50:49;for(let Nb=0;Nb<this.jy.length;Nb++)this.jy[Nb].BNb($a);for($a=0;$a<this.XG.count;$a++)this.XG.Xf($a).BNb()}gfc(){var $a=1===this.ic.PresenceType?50:49;for(let Nb=0;Nb<this.jy.length;Nb++)this.jy[Nb].fzb([$a]);for($a=0;$a<this.XG.count;$a++)this.XG.Xf($a).fzb()}dispose(){this.$&&(this.$.va&&this.$.va.sg(this.Rya),
za.h(this.$).QN(this.Gq));this.XMe();Gb.a.pc(this.jy);Gb.a.pc([this.Rz]);this.Rz=this.$=null;this.JSd(null);this.XG=null;super.dispose()}XMe(){if(this.XG){for(let $a=0;$a<this.XG.count;$a++)this.XG.Xf($a).dispose();this.XG.clear()}}m0a($a){1===this.ic.Version?this.T3g($a):this.U3g($a)}T3g($a){if($a.ic.SelectedRange&&this.ic.SelectedRange){const Nb=this.ic.SelectedRange.length,qc=$a.ic.SelectedRange.length;for(let Lc=0;Lc<Nb;Lc++)for(let sd=0;sd<qc;sd++)if(Zb(this.ic.SelectedRange[Lc],$a.ic.SelectedRange[sd])){this.jy[Lc].Kga($a.Q4a(sd));
return}}}U3g($a){var Nb;let qc=0,Lc=0;if(this.ic&&this.ic.Object&&(null===(Nb=$a.ic)||void 0===Nb?0:Nb.Object)){Nb=this.ic.Object.length;var sd=$a.ic.Object.length;for(var Fd=0;Fd<Nb;Fd++)if(this.ic.Object[Fd]&&this.Vid(this.ic.Object[Fd])){qc++;for(var Td=0;Td<sd;Td++)if($a.ic.Object[Td]&&this.Vid($a.ic.Object[Td])&&(Lc++,this.kZc(this.ic.Object[Fd],$a.ic.Object[Td]))){var ue=this.Q4a(qc),Ae=$a.Q4a(Lc);if(ue&&Ae){ue.Kga(Ae);return}}}else if(this.ic.Object[Fd]&&$a.ic.Object[Fd]&&(0===this.ic.Object[Fd].ObjectType||
2===this.ic.Object[Fd].ObjectType))for(Td=0;Td<sd;Td++)if($a.ic.Object[Td]&&(0===$a.ic.Object[Fd].ObjectType||2===$a.ic.Object[Fd].ObjectType)&&this.ic.Object[Fd].ObjectId===$a.ic.Object[Td].ObjectId&&(ue=this.Fgd(this.ic.Object[Fd].ObjectId),Ae=$a.Fgd(this.ic.Object[Fd].ObjectId),ue&&Ae)){ue.Kga(Ae);return}}if($a.ic.SelectedRange&&this.ic.SelectedRange)for(Nb=this.ic.SelectedRange.length,sd=$a.ic.SelectedRange.length,Fd=0;Fd<Nb;Fd++)for(Td=0;Td<sd;Td++)if(Zb(this.ic.SelectedRange[Fd],$a.ic.SelectedRange[Td])&&
(ue=this.Q4a(qc+Fd),Ae=$a.Q4a(Lc+Td),ue&&Ae)){ue.Kga(Ae);return}}kZc($a,Nb){return!!$a&&!!Nb&&Nb.ObjectType===$a.ObjectType&&(1===$a.ObjectType||3===$a.ObjectType)&&!$a.ObjectId.localeCompare(Nb.ObjectId)}Q4a($a){return 0<=$a&&this.jy.length>$a?this.jy[$a]:null}W$f($a){for(let Nb=0,qc=this.jy.length;Nb<qc;Nb++)this.jy[Nb].nI($a)}Fgd($a){return $a&&this.XG.hb($a)?this.XG.getItem($a):null}X$f($a,Nb=null){if($a)($a=this.XG.getItem(Nb))&&$a.nI(!0);else for($a=0;$a<this.XG.count;$a++)(Nb=this.XG.Xf($a))&&
Nb.nI(!1)}okg($a){ab.z1j(this,$a)}p6c($a,Nb){if($a<Nb)return this.jy[$a];if(!this.xm||!this.$||!this.ky)return null;$a=new ne(this.xm,this.$,this.ky);this.jy.push($a);return $a}rzj(){const $a=this.jy.length;var Nb=this.ic.SelectedRange?this.ic.SelectedRange.length:0,qc=this.$.va.na;for(let Lc=0;Lc<Nb;Lc++){let sd=this.p6c(Lc,$a);sd&&this.ic.SelectedRange[Lc]&&(this.ic.SelectedRange[Lc].NamedObjectName?sd.Nj([50,49]):(sd.KNb(this.ic.SelectedRange[Lc],this.ic.PresenceType),ce.z0d(this.ic.PresenceType,
sd,this.ic.SelectedRange[Lc],qc,this.xm,this.ky)))}qc=!!this.Rz&&!!this.Rz.PHd&&this.Rz.PHd.PresenceType!==this.Rz.ic.PresenceType;for(Nb=qc?0:Nb;Nb<$a;Nb++)this.jy[Nb].Nj([1===this.Rz.PHd.PresenceType?50:49])}Vid($a){return(null===$a||void 0===$a?0:$a.ObjectId)&&(1===this.Y4e($a.ObjectType)||2===this.Y4e($a.ObjectType))&&($a=this.$.yb.Ghd($a.ObjectId))?Yb.w($a):null}szj(){const $a=this.jy.length,Nb=this.$.va.na,qc=this.ic.SelectedRange?this.ic.SelectedRange.length:0;var Lc=this.ic.Object?this.ic.Object.length:
0;for(var sd=0;sd<$a;sd++)this.jy[sd].Nj([50,49]);this.Z4g();this.k5c=this.j5c=sd=0;for(var Fd=0;Fd<Lc;Fd++){var Td=this.ic.Object[Fd],ue=this.Vid(Td);if(ue){let Ae=this.p6c(sd,$a);1===Td.ObjectType?this.j5c++:3===Td.ObjectType&&this.k5c++;sd++;Ae.KNb(ue,Td.ObjectPresenceType);ce.z0d(Td.ObjectPresenceType,Ae,ue,Nb,this.xm,this.ky)}}for(Lc=0;Lc<qc;Lc++)this.ic&&this.ic.SelectedRange&&(Fd=this.ic.SelectedRange[Lc],Fd.NamedObjectName||(Td=!!Nb&&Fd.SheetName===Nb.name,ue=!!qb(Fd,this.$,1),Td&&ue||(Td=
this.p6c(sd+Lc,$a),Td.KNb(Fd,this.ic.PresenceType),ce.z0d(this.ic.PresenceType,Td,Fd,Nb,this.xm,this.ky))));0<(this.countFloatingObjects=this.J3f())&&f.ULS.sendTraceTag(537154370,0,50,'{{"SetAllFloatingObjectPresenceHighlights":"Success"}')}Z4g(){this.J3f();this.XMe()}J3f(){let $a=0;if(this.ic&&this.ic.Object)for(let Nb=0;Nb<this.ic.Object.length;Nb++)this.$_j(this.ic.Object[Nb])&&$a++;return $a}pfh($a,Nb){if(this.XG.hb(Nb))return Nb=this.XG.getItem(Nb),Nb.Pg=$a,Nb;if(!this.xm||!this.$||!this.ky)return null;
const qc=new $d(this.xm,this.$,this.ky);qc.Pg=$a;this.XG.add(Nb,qc);return qc}$_j($a){let Nb=!1;if((null===$a||void 0===$a?0:$a.ObjectId)&&(0===$a.ObjectType||2===$a.ObjectType||this.sId&&5===$a.ObjectType))try{const qc=this.xVh($a);if(qc){const Lc=this.pfh(qc,$a.ObjectId);Lc.KNb(qc,$a.ObjectPresenceType);5!==$a.ObjectType&&Lc.BNb();Nb=!0}}catch(qc){throw f.ULS.sendTraceTag(537154369,0,10,`{"UpdatedFloatingObjectPresence":"Fail","Exception":"${qc.stack}"}`),qc;}return Nb}xVh($a){if(!$a)return null;
let Nb=null;this.sId?-1!=$a.ObjectType&&(Nb=Kc.a(this.$).yKa($a.ObjectId)):2===$a.ObjectType?Nb=Kc.a(this.$).yKa($a.ObjectId):0===$a.ObjectType&&($a=this.$.yb.Ghd($a.ObjectId),null===$a||void 0===$a?0:$a.imageId)&&(Nb=Kc.a(this.$).iXh($a.imageId));return Nb}FRd(){try{1===this.ic.Version?(this.rzj(),f.ULS.sendTraceTag(537154368,0,50,'{{"SetGridHighlightPass":"V1"}')):(this.szj(),f.ULS.sendTraceTag(537154339,0,50,`{"FloatingObjects":"${this.countFloatingObjects}","PivotTables":"${this.j5c}","QueryTables":"${this.k5c}"}`))}catch($a){throw f.ULS.sendTraceTag(537154338,
0,10,`{"SetGridHighlight Exception":"${$a.stack}"}`),$a;}}Y4e($a){switch($a){case 0:return 0;case 1:return 1;case 3:return 2;case 2:return 9;default:return-1}}static z0d($a,Nb,qc,Lc,sd,Fd){const Td=1===$a?50:49;Lc&&qc&&Lc.name===qc.SheetName?(Nb.wk(Yb.D(qc),[Td]),Nb.BNb(Td),f.ULS.shipAssertTag(537154337,0,Nb.xu.yy===sd.User.UserID,"UserID and UnitID should match"),Fd.HMb(Nb.xu.yy,1===$a)):Nb.fzb([Td])}}Object(c.a)(ce,"UserGridPresence",ab,[]);var we=a(42),ve=a(804);class Re extends O.a{constructor($a,
Nb,qc,Lc,sd=null){super();this.Qu={};this.B5b=this.C5b=0;this.pvd=this.ftb=null;this.Orf=3E4;this.fld=!1;this.ATd=!0;this.lHd=null;this.nCf=()=>{var Fd=this.Cma;for(let Td in Fd)Fd=Td,this.npe(Fd)?(this.Ylc(Fd,!0),delete this.Eab[Fd],delete this.Cma[Fd]):f.ULS.sendTraceTag(537154377,0,50,`PresenceView.OnEcsUserListChanged: pending userId=[${Fd}] still not updated`)};this.yEd=(Fd,Td)=>{Fd={};Fd.UpdatedCount=Td.pL?Object.keys(Td.pL).length:0;Fd.DisconnectedCount=Td.caa?Td.caa.length:0;Fd.Location="canvas";
wb.b(this.$).rd(tb.a.tHd,Fd);Fd=null;this.$.Jb&&(Fd=this.$.Jb.zg("ModelUpdate","PresenceRendering"),Fd.start());var ue={};if(Td.pL){if(Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")){const cf=(new Date).getTime();ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa(this.$.da,435,436,1),vf=>{vf.result.JDi(cf)},this.$.la,3)}this.xvb||(this.Xwd(!0),this.xvb=!0);const Oe=Td.pL;for(var Ae in Oe){var Le=Oe[Ae];let cf=Ae;this.und[cf]=ub.a.Ya.Ub;if(!ge.h(this.$)||null==Le.NavigationState)if(this.nEe(cf,
new Date),this.eQg(Le),cf!==this.ftb){var df=this.Qu[cf];df||(this.npe(cf)?this.Ylc(cf,!0):(cf in this.Cma?f.ULS.sendTraceTag(537154376,0,50,`PresenceView.OnSelectionPresenceChanged: userId=[${cf}] already pending update`):(this.Eab[cf]=ub.a.Ya.Ub,ue[cf]=1),this.Cma[cf]=!0,df=this.N_h(cf),this.Qu[cf]=this.wJe(df)),df=this.Qu[cf]);df&&(df.ic=Le,Le.SelectedRange&&1<Le.SelectedRange.length?this.C5b++:this.B5b++,this.IVf(cf),this.m0a(df))}}if(Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&
this.$.ea&&this.$.ea.sLa){const cf=(new Date).getTime();ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa(this.$.da,435,436,1),vf=>{vf.result.KDi(cf)},this.$.la,3)}}if(Td.caa)for(let Oe=0,cf=Td.caa.length;Oe<cf;Oe++)Ae=Td.caa[Oe],this.I8c[Ae]=ub.a.Ya.Ub,this.yVf(Ae,!0);if(Td.caa&&0<Td.caa.length||0<ve.a(ue).length||0<ve.a(this.Cma).length)Ae=[],Ae.push(...ve.a(ue)),Ae.push(...ve.a(this.Cma)),(ue=this.$.da.Aa(292))&&ue.ygb(Ae,Td.caa);Fd&&Fd.stop();this.fld=!1;Fd=this.Qu;for(let Oe in Fd)if(0===Object(h.a)(ab,
Fd[Oe]).ic.CollabMode){this.fld=!0;break}this.raiseEvent("pcek",Td)};this.oCa=(Fd,Td)=>{Td&&this.$.ut&&(Td.Pob.HasAnyNonOcsCoauthor=this.fld)};this.CGb=()=>{const Fd=new Pa.a({},null),Td=this.Toa;for(let ue in Td){const Ae=ue,Le=Td[ue].ic;Le.SelectedRange=Le.SelectedRangeRaw;Fd.pL[Ae]=Le}this.yEd(this,Fd)};this.Uc=()=>{this.gaf()};this.OEi=()=>{this.pvd&&Kb.a(ub.a.Ya,this.pvd)<this.Orf||(this.pvd=ub.a.Ya.Ub,this.xwd(),this.CBi(),this.mCi(),this.xvb||this.Xwd(!1))};this.Rya=()=>{this.gaf();const Fd=
this.Qu;for(let Td in Fd)this.m0a(Fd[Td])};this.uc=()=>{this.xwd();this.xvb||this.Xwd(!1);this.xvb=!1};this.KGf=()=>{const Fd=this.Qu;for(let Td in Fd)Fd[Td].dispose();this.Qu={};this.zCe();this.Eab={};this.cRc={};this.ay.length=0;this.Xzc()};this.xca=(Fd,Td)=>{this.sWd(Td.fh)};this.I8c={};this.und={};this.Eab={};this.cRc={};this.$=$a;this.yOa=Lc;this.Bn=Nb;this.sje=qc;Ic.jNb=!0;Ic.Wna=!0;this.I5a();this.ky=new Ob($a);this.$.va&&this.$.va.Vf(this.Rya);this.Bn.mob(this.xca);$a.oa&&this.$.oa.Oga(this.oCa);
this.ay=[];this.Bn.k0a();$a.da.Ha(25,this);this.xvb=!1;this.$.nj(this.uc);this.DZc=ja.a.instance.yC(this.OEi,this.Orf/2,Ka.a.G8i,!0,!1);this.mHd=sd}cGa($a){this.addHandler("pcek",$a)}Xza($a){this.removeHandler("pcek",$a)}get WK(){return this.sje}get Toa(){return this.Qu}get Cma(){return this.cRc}isAnonymousUser($a){var Nb,qc;return null===(qc=null===(Nb=this.Toa[$a])||void 0===Nb?void 0:Nb.ic)||void 0===qc?void 0:qc.IsAnonymous}KVf($a){this.Toa[$a]&&this.yVf($a,!1)}sWd($a){this.ftb&&this.ftb!==$a.clientId&&
(this.ATd=!1);!Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5657706_CorrectPresenceBootTelemetry")||this.$.ea.sLa&&we.PageLoadTrackingInfo.instance.Vwj||(this.ATd=!1);this.WK.e9g($a);this.ftb=$a.clientId}sXh($a,Nb){let qc,Lc;qc=[];Lc=[];const sd=this.Toa;for(let Fd in sd){const Td=sd[Fd];if(Nb){const ue=Yb.k($a,this.$);this.R8e(ue,qc,Lc,Td)}else this.Q8e($a,qc,Lc,Td)}return{Mji:qc,zqh:Lc}}QLe($a,Nb,qc,Lc,sd){(sd=this.Toa[sd])&&(Nb?this.R8e($a,qc,Lc,sd):this.Q8e($a,qc,Lc,sd))}Q6h(){const $a=[],Nb=
this.Toa;for(let sd in Nb){var qc=Nb[sd],Lc=qc.ic.SelectedRange;if(Lc)for(const Fd of Lc){Lc=Yb.D(Fd);const Td=za.h(this.$).ha.qa.W3;if(this.$.va.na.sheetName===Fd.SheetName&&Lc.right===Td.right&&Lc.top===Td.top){qc=qc.xm;qc=new mb.a(qc.User.UserID,qc.User.UserName,qc.UserColor,new Ja.a(1),null,qc.UserEmail,void 0,void 0,void 0,void 0,void 0,qc.JoinCoauthTime);$a.push(qc);break}}}return $a}Uzc(){Ic.jNb=!0;Ic.Wna=!0;const $a=this.Qu;for(let Nb in $a)$a[Nb].Uzc()}gfc(){Ic.jNb=!1;Ic.Wna=!1;const $a=
this.Qu;for(let Nb in $a)$a[Nb].gfc()}dispose(){this.MPb();this.$&&(this.$.va&&this.$.va.sg(this.Rya),this.$.oa&&this.$.oa.cna(this.oCa),this.$.ol(this.uc));this.Bn&&this.Bn.Duc(this.xca);this.DZc&&(this.DZc.dispose(),this.DZc=null);if(this.Qu){const $a=this.Qu;for(let Nb in $a)$a[Nb].dispose()}Gb.a.pc([this.WK,this.ky]);this.zCe();this.Qu=this.$=this.sje=null;this.ay.length=0;super.dispose()}MPb(){this.WK&&(this.WK.Xza(this.yEd),this.WK.Njj(this.nCf),this.WK.klj(this.KGf),this.WK.wda(this.Uc));this.yOa.LWf(this.CGb)}wJe($a){return new ce($a,
this.$,this.ky)}npe($a){const Nb=this.$.ea.Jjd($a);if(Nb)if($a in this.Qu)this.Qu[$a].okg(Nb);else{const qc=this.wJe(Nb);this.Qu[$a]=qc;this.m0a(qc)}return!!Nb}R8e($a,Nb,qc,Lc){if($a)for(const sd of $a){if(sd){if(($a=qb(sd,this.$,1))&&Re.Ljd($a.Hi,Nb,qc,Lc))break;if(($a=qb(sd,this.$,2))&&Re.Ljd($a.Hi,Nb,qc,Lc))break}if(Lc.ic.SelectedRange)for(const Fd of Lc.ic.SelectedRange)if(Fd&&sd&&Zb(sd,Fd)){(1===Lc.ic.PresenceType?qc:Nb).push(Lc.Rz.yQb.User);return}}}Q8e($a,Nb,qc,Lc){$a&&Re.Ljd(this.DVh($a),
Nb,qc,Lc)}eQg($a){$a.SelectedRange&&($a.SelectedRangeRaw=this.Xjh($a.SelectedRange),$a.SelectedRange=this.yOa.O$g($a.SelectedRange))}Xjh($a){const Nb=Array($a.length);for(let sd=0;sd<$a.length;sd++){var qc=sd,Lc=$a[sd];const Fd={};Fd.SheetName=Lc.SheetName;Fd.FirstColumn=Lc.FirstColumn;Fd.FirstRow=Lc.FirstRow;Fd.LastRow=Lc.LastRow;Fd.LastColumn=Lc.LastColumn;Fd.NamedObjectName=Lc.NamedObjectName;Nb[qc]=Fd}return Nb}DVh($a){if($a)switch($a.type){case 0:return($a=this.$.yb.X4e($a.id))?$a.Hi:null;case 2:return $a.Hi}return null}I5a(){this.WK.cGa(this.yEd);
this.WK.vOg(this.KGf);this.WK.AMg(this.nCf);this.WK.p2(this.Uc);this.yOa.gre(this.CGb)}jsf($a,Nb,qc,Lc){const sd={};sd.a=this.$.ya.UserSessionId;sd.b=$a;sd.c=qc?"PendingUserRemoved":"Non-PendingUserRemoved";sd.d=Lc?"Disconnected":"Inactivity";sd.e=Nb;Da.b().Se(22,sd,!0)}yVf($a,Nb){$a in this.Qu&&(this.IVf($a),this.Qu[$a].dispose(),delete this.Qu[$a],f.ULS.sendTraceTag(537154375,0,50,`PresenceView.RemovePresenceForUser: userId=[${$a}] removed due to inactivity`),this.jsf($a,ub.a.Ya.Ub,!1,Nb));$a in
this.Cma&&(this.Ylc($a,!1),delete this.Eab[$a],delete this.Cma[$a],f.ULS.sendTraceTag(537154374,0,50,`PresenceView.RemovePresenceForUser: Pending userId=[${$a}] removed due to inactivity`),this.jsf($a,ub.a.Ya.Ub,!0,Nb))}IVf($a){for(let Nb=this.ay.length-1;0<=Nb;Nb--)if(this.ay[Nb].User.UserID===$a){this.ay.splice(Nb,1);for(const qc of this.Qu[$a].jy)this.ky.Ina(qc.xu.yy,!1);this.Xzc()}}mCi(){if(this.B5b||this.C5b)this.$.Yc(-70383382,-1,0,null),f.ULS.sendTraceTag(537154373,0,50,`PresenceView.LogDiscontinuousCountPresenceData: Discontinuous Presence Received with count= [${this.C5b}], Continuous Presence Received with count= [${this.B5b}]`);
this.C5b=this.B5b=0}zCe(){this.xwd();this.cRc=this.Eab=null}xwd(){const $a=this.Cma;for(let Nb in $a)this.Ylc(Nb,!1)}CBi(){var $a=this.I8c;for(let Nb in $a)this.Trf(Nb,!0,$a[Nb]);$a=this.und;for(let Nb in $a)this.Trf(Nb,!1,$a[Nb]);this.I8c={};this.und={}}Ylc($a,Nb){if(this.$.ut&&this.$.ea.Xb){const qc={};qc.a=this.$.ya.UserSessionId;qc.b=$a;qc.c=Nb;qc.e=!1;qc.d=-1;qc.f=ub.a.Ya.Ub;this.$.ea&&(qc.e=this.$.ea.tM);if($a=this.Eab[$a])qc.d=Kb.a(ub.a.Ya,$a);Da.b().Se(20,qc,!0)}}Xwd($a){if(this.$.ut){const Nb=
{e:-1,f:-1,c:!1,d:!1};Nb.b=$a;Nb.a=this.$.ya.UserSessionId;this.$.ea&&(Nb.c=this.$.ea.sLa,Nb.d=this.$.ea.tM,Nb.e=this.$.ea.uo.length,this.$.ea.tCa&&(Nb.f=Kb.a(ub.a.Ya,this.$.ea.m7j)));Da.b().Se(21,Nb,!0)}}Trf($a,Nb,qc){if(this.$.ut){const Lc={};Lc.a=this.$.ya.UserSessionId;Lc.b=$a;Lc.c=Nb;Lc.d=qc;Da.b().Se(19,Lc,!0)}}gaf(){const $a=[],Nb=this.Qu;for(let qc in Nb){const Lc=Nb[qc];if(this.WK.E2f(Lc.ic)){this.aqe($a,Lc);Array.remove(this.ay,Lc.Rz.yQb);if(1===this.WK.ic.PresenceType){const sd={};sd.a=
1===Lc.ic.PresenceType?"Editing":"Non-Editing";sd.b=this.$.ya.UserSessionId;sd.c=ub.a.Ya.Ub;Da.b().Se(18,sd)}for(const sd of Lc.jy)this.ky.Ina(sd.xu.yy,!0)}else for(const sd of Lc.jy)this.ky.Ina(sd.xu.yy,!1)}this.ay.length=0;this.ay=$a;this.Xzc()}aqe($a,Nb){const qc=Nb.Rz.yQb;if(0===Nb.ic.PresenceType){Nb=$a.length;let Lc;for(Lc=0;Lc<Nb&&0===this.Qu[$a[Lc].User.UserID].ic.PresenceType;Lc++);$a.splice(Lc,0,qc)}else $a.push(qc)}m0a($a){this.WK.E2f($a.ic)&&(this.aqe(this.ay,$a),this.Xzc());const Nb=
$a.Rz.yQb.User.UserID,qc=this.Qu;for(let sd in qc){var Lc=qc[sd];sd!==Nb&&$a.m0a(Lc)}}Xzc(){0<this.ay.length&&this.MKj()}MKj(){for(let $a=0,Nb=this.ay.length;$a<Nb;$a++){const qc=this.Qu[this.ay[$a].User.UserID];if(qc)if(this.WK.wRf(qc.ic)){qc.W$f(!0);for(const Lc of qc.jy)this.ky.Ina(Lc.xu.yy,!0)}else{const Lc=this.WK.d4e(qc.ic);Lc&&qc.X$f(!0,Lc)}}}N_h($a){const Nb={User:{}};Nb.User.UserID=$a;Nb.User.UserName=W.a.instance.ob(87);Nb.UserColor="#AAAAAA";return Nb}nEe($a,Nb){this.ATd&&this.mHd&&($a&&
Nb?this.lHd?this.lHd.rsh($a,Nb,this.ftb):this.mHd.continueWith(()=>{this.lHd=this.mHd.result;this.nEe($a,Nb)}):f.ULS.sendTraceTag(537154372,0,15,`userId: [${$a}], endTime: [${Nb}]`))}static Ljd($a,Nb,qc,Lc){if(!Lc||!Lc.ic||!Lc.ic.Object)return!1;for(const sd of Lc.ic.Object)if($a&&sd&&sd.ObjectId&&!sd.ObjectId.localeCompare($a))return(1===sd.ObjectPresenceType?qc:Nb).push(Lc.Rz.yQb.User),!0;return!1}}Object(c.a)(Re,"PresenceView",O.a,[392,393]);var rf=a(202),We=a(229),Ye=a(319);class bf extends O.a{constructor($a){super();
this.statusBarManager=null;this.$=$a;this.$.da.gb(29,Nb=>{this.statusBarManager=Nb;Nb.$I(this)})}pq($a){this.addHandler("OSC",$a)}Lq($a){this.removeHandler("OSC",$a)}rz(){this.raiseEvent("OSC")}Tr($a,Nb){if("QueryOcsConnectionStatus"===$a)Nb.Value=this.$.ea.h8a?W.a.instance.ga(923):W.a.instance.ga(924);else return!1;return!0}un(){return!0}dispose(){this.statusBarManager&&(this.statusBarManager.yF(this),this.statusBarManager=null);this.$=null;super.dispose()}}Object(c.a)(bf,"OcsStatusBarManager",O.a,
[2,200,201]);class Ve extends O.a{constructor($a,Nb){super();this.Ceg=this.aPb=this.fieldManagerPane=this.fh=null;this.Ggb=this.g3f=!1;this.xn=()=>{this.$&&this.sQd(0,!1)};this.Ri=()=>{this.oYd?this.aPb(!1):(this.ic.PresenceType=1,this.raiseEvent(Ve.m0),this.sendPresenceToService(!1))};this.$f=()=>{this.oYd?this.Ceg(!1):(this.rdb(!1),this.oQd())};this.jpc=()=>{this.ha.Ra.dc?this.sQd(1,!1):this.zQd(0,!1)};this.pma=(qc,Lc)=>{this.raiseEvent(Ve.nHd,Lc)};this.Uc=()=>{this.zQd(za.h(this.$).fb?1:0,!1)};
this.Rc=(qc,Lc)=>{We.a(Lc)&&(this.cra={})};this.CGb=()=>{this.O2f()};this.gKf=(qc,Lc)=>{if(Lc&&Lc.methodName in Ve.Trc){qc=!1;switch(Ve.Trc[Lc.methodName]){case 0:Lc=Lc.parameters.cell;break;case 1:Lc=Lc.parameters.parameters.Location;break;case 2:Lc=Yb.v(this.ha.qa.activeRange,this.$);qc=!0;break;default:return}Lc.LastColumn=Lc.FirstColumn;Lc.LastRow=Lc.FirstRow;Lc.NamedObjectName=null;this.ic.SelectedRange=[Lc];this.ic.PresenceType=0;if(qc){Lc=[];for(var sd of this.$.yb.tZh())qc={},qc.ObjectType=
this.Vaa(sd.type),qc.ObjectPresenceType=1,qc.ObjectId=sd.Hi,Lc.push(qc);this.ic.Object=Lc}else sd=qb(Lc,this.$,1),Lc=null,sd&&(Lc={},Lc.ObjectType=this.Vaa(sd.type),Lc.ObjectPresenceType=0,Lc.ObjectId=sd.Hi),this.ic.Object=[Lc];this.raiseEvent(Ve.m0);this.sendPresenceToService(!1)}};this.wm=(qc,Lc)=>{Lc.context.methodName in Ve.Trc&&(this.ic.Object=[null],this.rdb(!1))};this.eh=(qc,Lc)=>{Lc.context.methodName in Ve.Trc&&(this.ic.Object=[null],this.rdb(!1))};this.dd=(qc,Lc)=>{Lc.cN||(this.cra={},this.$.ut?
this.I5a():this.MPb())};this.uc=()=>{this.oQd()};this.Anf=()=>{this.O2f();this.Fyf.rz()};this.$=$a;this.ha=za.h(this.$).ha;this.yOa=Nb;this.mmf=Ta.EwaSettings.cl();this.$.Lk(this.dd);this.$.nj(this.uc);this.cra={};this.mXa=new mb.a(null,null,null,null);this.xAa={};this.xAa.b=0;this.xAa.c=0;this.Fyf=new bf(this.$);if(this.oYd=Ta.EwaSettings.wb())this.aPb=Ye.a(qc=>{this.ic.PresenceType=1;this.raiseEvent(Ve.m0);this.sendPresenceToService(qc)},40,this.$.la,"SelectionPresenceManager.SendPresenceToService",
!0),this.Ceg=Ye.a(qc=>{this.rdb(qc);this.oQd()},40,this.$.la,"SelectionPresenceManager.SendCurrentPresence",!0);this.g3f=Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6331623_ProcessShapeFOPresence");this.Ggb=Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:7554748_UseIsAnonymousForPresenceUserV2")}cGa($a){this.addHandler(Ve.nHd,$a)}Xza($a){this.removeHandler(Ve.nHd,$a)}AMg($a){this.$.ea.B9($a)}Njj($a){this.$.ea.O6($a)}p2($a){this.addHandler(Ve.m0,$a)}wda($a){this.removeHandler(Ve.m0,$a)}vOg($a){this.addHandler(Ve.oHd,
$a)}klj($a){this.removeHandler(Ve.oHd,$a)}get ic(){return this.cra}get amIAlone(){return!this.$.ea||this.$.ea.amIAlone}dispose(){this.$&&(this.MPb(),this.$.pl(this.dd),this.$.ol(this.uc));this.fh&&this.fh.JQa(this.pma);Gb.a.Ja(this.Fyf);this.$=this.fh=null;super.dispose()}e9g($a){this.fh?this.fh.JQa(this.pma):this.I5a();(this.fh=$a)?(this.fh.cZa(this.pma),this.rdb(!0)):this.MPb()}I5a(){this.ha.eC(this.Uc);za.h(this.$).jE(this.xn);var $a=za.h(this.$).Vb;$a.Km(this.$f);$a.xl(this.Ri);this.$.ea.Jj(this.Rc);
this.$.ea.Tqe(this.Anf);this.yOa.gre(this.CGb);$a=this.$.oa.xa;$a.dGa(this.gKf);$a.$q(this.eh);$a.rx(this.wm);this.mmf?this.$.da.gb(16,Nb=>{Nb.Iqe(this.jpc);Nb.Hqe(this.$f)}):($a=xa.GetServiceTaskFactory.Oa(this.$.da,16,74,1),ia.TaskExtensions.za($a,Nb=>{this.fieldManagerPane=Nb.result;this.fieldManagerPane.Iqe(this.jpc);this.fieldManagerPane.Hqe(this.$f)},rf.a.none,3))}MPb(){this.ha.vB(this.Uc);za.h(this.$).AF(this.xn);const $a=za.h(this.$).Vb;$a.$l(this.$f);$a.nl(this.Ri);this.$.ea.ik(this.Rc);
this.$.ea.zWf(this.Anf);this.yOa.LWf(this.CGb);this.$.oa.xa.KQa(this.gKf);this.$.oa.xa.ps(this.eh);this.$.oa.xa.ny(this.wm);this.mmf?this.$.da.gb(16,Nb=>{Nb.pWf(this.jpc);Nb.oWf(this.$f)}):this.fieldManagerPane&&(this.fieldManagerPane.pWf(this.jpc),this.fieldManagerPane.oWf(this.$f));this.raiseEvent(Ve.oHd)}E2f($a){return this.wRf($a)||!!this.d4e($a)}wRf($a){if(2===this.ic.Version&&this.ic.Object&&2===$a.Version&&$a.Object&&0<this.ic.Object.length&&0<$a.Object.length){var Nb=this.ic.Object.length,
qc=$a.Object.length;for(var Lc=0;Lc<Nb;Lc++)for(var sd=0;sd<qc;sd++)if(this.kZc(this.ic.Object[Lc],$a.Object[sd]))return!0}if(this.ic.SelectedRange&&$a.SelectedRange)for(Nb=this.ic.SelectedRange.length,qc=$a.SelectedRange.length,Lc=0;Lc<Nb;Lc++)for(sd=0;sd<qc;sd++)if(Ve.gTg(this.ic.SelectedRange[Lc],$a.SelectedRange[sd]))return!0;return!1}d4e($a){if(2===this.ic.Version&&this.ic.Object&&2===$a.Version&&$a.Object&&0<this.ic.Object.length&&0<$a.Object.length){const Nb=this.ic.Object.length,qc=$a.Object.length;
for(let Lc=0;Lc<Nb;Lc++)for(let sd=0;sd<qc;sd++)if(Ve.$Mi(this.ic.Object[Lc],$a.Object[sd]))return this.ic.Object[Lc].ObjectId}return null}kZc($a,Nb){return!!$a&&!!Nb&&$a.ObjectType===Nb.ObjectType&&(1===$a.ObjectType||3===$a.ObjectType)&&!!$a.ObjectId&&!!Nb.ObjectId&&!$a.ObjectId.localeCompare(Nb.ObjectId)}O2f(){this.rdb(!1)}rdb($a){this.ha.Ra.dc?this.sQd(0,$a):this.zQd(za.h(this.$).Vb.fb?1:0,$a)}sQd($a,Nb){var qc={};this.$.ak(qc);var Lc=this.ha.Ra.dc;if(Lc){const sd=Lc.floatingObject;qc.FirstColumn=
-1;qc.FirstRow=-1;qc.LastColumn=-1;qc.LastRow=-1;qc.NamedObjectName=sd?sd.Fg():null;this.ic.SelectedRange=[qc];this.ic.PresenceType=0;qc=null;if(this.g3f){if(null===sd||void 0===sd?0:sd.id)qc={ObjectType:this.u0h(sd.type),ObjectPresenceType:$a,DialogType:0,ObjectId:Lc.Hi}}else if(sd)switch(sd.type){case 0:if(Lc=this.$.yb.X4e(sd.id))qc={},qc.ObjectType=this.Vaa(0),qc.ObjectPresenceType=$a,qc.ObjectId=Lc.Hi;break;case 2:sd.id&&(qc={},qc.ObjectType=this.Vaa(9),qc.ObjectPresenceType=$a,qc.ObjectId=sd.Hi)}this.ic.Object=
[qc]}this.raiseEvent(Ve.m0);this.sendPresenceToService(Nb)}zQd($a,Nb){if(!za.h(this.$).fb&&!za.h(this.$).Vh){const Lc=this.$.Jb.zg("ModelUpdate","SendRangePresence");Lc.start();var qc=Yb.k(this.ha.qa.selectedRanges,this.$);this.ic.SelectedRange=this.yOa.N$g(qc);this.ic.Object=[];for(const sd of qc)if(qc=qb(sd,this.$,1)){const Fd={};Fd.ObjectType=this.Vaa(qc.type);Fd.ObjectPresenceType=0;Fd.ObjectId=qc.Hi;this.ic.Object.push(Fd)}this.ic.PresenceType=$a;this.raiseEvent(Ve.m0);this.ic.SelectedRange||
this.ic.Object?this.sendPresenceToService(Nb):f.ULS.sendTraceTag(537154371,0,50,`SelectionPresenceManager.SendRangePresence: skip sending range presence since selected range/object are both null.  UserId: [${this.fh.clientId}]`);Lc.stop()}}sendPresenceToService($a){if(this.$.ea.W8b||!this.$.ea.R4b||$a)if(this.amIAlone||++this.xAa.b,this.fh){this.ic.Version=2;this.ic.ClientType=1;this.ic.ChatThreadId=this.mXa.Z1c;this.ic.ChatThreadDiscoveryUri=this.mXa.Y1c;this.ic.InChat=this.mXa.zzb;this.ic.Cid=this.mXa.email;
this.ic.SupportsChat=!!this.mXa.capabilities&&this.mXa.capabilities.oLa(4);this.ic.CollabMode=this.$.ea.h8a?2:0;this.ic.OcsCapable=this.$.ea.ocsCapable;this.Ggb&&(this.ic.IsAnonymous=l.AFrameworkApplication.userNameUnknown||l.AFrameworkApplication.limitedEdit);this.fh.d3f(this.ic);if(Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&this.$.ea&&this.$.ea.sLa){const Nb=(new Date).getTime();ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa(this.$.da,435,436,1),qc=>
{qc.result.LDi(Nb)},this.$.la,3)}this.amIAlone||++this.xAa.c}}oQd(){this.$.ut&&(this.xAa.a=this.$.ya.UserSessionId,Da.b().Se(26,this.xAa,!0));this.xAa.b=0;this.xAa.c=0}u0h($a){switch($a){case 0:return 0;case 2:return 2;case 5:return 5;default:return-1}}Vaa($a){switch($a){case 0:return 0;case 1:return 1;case 2:return 3;case 9:return 2;default:return-1}}static get Trc(){return Ve.Qge||(Ve.Qge={["ApplyFilter"]:1,["ApplyPivot"]:0,["ApplyPivotSort"]:0,["ApplyPivotSortByValue"]:1,["ApplyWellKnownPivotFilter"]:0,
["RemovePivotFilter"]:0,["SetCustomFilter"]:1,["SetTop10Filter"]:1,["TogglePivotDrill"]:0,["RefreshAll"]:2})}static $Mi($a,Nb){return!!$a&&!!$a.ObjectId&&!!Nb&&!!Nb.ObjectId&&(0===$a.ObjectType||2===$a.ObjectType)&&$a.ObjectType===Nb.ObjectType&&!$a.ObjectId.localeCompare(Nb.ObjectId)}static gTg($a,Nb){return!$a.NamedObjectName&&Zb($a,Nb)}}Ve.nHd="presenceChanged";Ve.oHd="presenceDisabled";Ve.m0="selectionChanged";Ve.Qge=null;Object(c.a)(Ve,"SelectionPresenceManager",O.a,[413,2,414]);class Za extends R.a{constructor($a){super();
this.manager=null;this.$=$a;this.Db()}create(){this.manager?this.nb(this.manager):ia.TaskExtensions.za(xa.GetServiceTaskFactory.create(this.$.da,28,this.la,this.Xa),$a=>{this.nb(this.manager||(this.manager=new Ve(this.$,$a.result)))},this.la,3)}}Object(c.a)(Za,"SelectionPresenceManagerFactory",R.a,[]);var Xb=a(1283),ib=a(5),Rb=a(196);class lc extends Sa.a{constructor($a,Nb,qc){super();this.QPa=this.pHd=null;this.JGb=(Lc,sd)=>{if(sd.pL){Lc=[];const Td=[];var Fd=za.h(this.$).ha;const ue=!(2===Fd.Ke||
128===Fd.Ke);Fd=ue?Yb.k(Fd.qa.selectedRanges,this.$):Fd.Ra.dc.floatingObject;sd=sd.pL;for(let Le in sd)this.presenceView.QLe(Fd,ue,Lc,Td,Le);for(const Le of this.nIa)Lc.includes(Le)||Td.includes(Le)||this.presenceView.QLe(Fd,ue,Lc,Td,Le.UserID);this.nIa=[];this.nIa.push(...Lc);this.nIa.push(...Td);this.pHd&&(Gb.a.Ja(this.QPa),this.pHd=this.QPa=null);const Ae=lc.Eye(Lc,Td);this.QPa=new Rb.a;this.pHd=ia.TaskExtensions.za(z.Task.delay(1),()=>{this.ariaLiveNotifier.Ibb(Ae,ib.a.DGa)},this.QPa.token,3)}};
this.$=Nb;this.ariaLiveNotifier=$a;this.presenceView=qc;this.nIa=[];qc.cGa(this.JGb);this.$.da.Ha(231,this)}e4e($a,Nb){this.nIa=[];({Mji:$a,zqh:Nb}=this.presenceView.sXh($a,Nb));this.nIa.push(...$a);this.nIa.push(...Nb);return lc.Eye($a,Nb)}dispose(){this.presenceView.Xza(this.JGb);this.QPa&&(Gb.a.Ja(this.QPa),this.QPa=null);super.dispose()}static Eye($a,Nb){if(!$a.length&&!Nb.length)return"";if(Nb.length){if(1===Nb.length)return $a=W.a.instance.ob(83),String.format($a,Nb[0].UserName);$a=W.a.instance.ob(84);
return String.format($a,Nb.length)}if(1===$a.length)return Nb=W.a.instance.ob(85),String.format(Nb,$a[0].UserName);Nb=W.a.instance.ob(86);return String.format(Nb,$a.length)}}Object(c.a)(lc,"PresenceReadoutHandlerService",Sa.a,[394]);const nc=($a,Nb,qc,Lc,sd,Fd,Td,ue=null)=>{ue=$a.Na(1,ue);ue.Id=Nb;ue.OnBehalfOfOcs=qc;return qa.g($a,"CheckPersistedContentUpdate",ue,Lc,sd,Fd,Td,516)},Oc=($a,Nb,qc,Lc,sd,Fd,Td=null)=>{Td=$a.Na(1,Td);Td.updateInfo=Nb;return qa.g($a,"BatchCheckCollabServiceContent",Td,
qc,Lc,sd,Fd,516)},Ib=($a,Nb,qc,Lc,sd,Fd,Td,ue=null)=>{ue=$a.Na(1,ue);ue.clientIdsToAdd=Nb;ue.clientIdsToRemove=qc;return qa.g($a,"UpdatePresenceUsers",ue,Lc,sd,Fd,Td,0)},gc=($a,Nb,qc,Lc,sd,Fd=null)=>{Fd=$a.Na(1,Fd);return qa.g($a,"CheckWorkbookFileNameUpdate",Fd,Nb,qc,Lc,sd,0)},Fc=($a,Nb,qc,Lc,sd,Fd,Td,ue=null)=>{ue=$a.Na(1,ue);ue.GenerateNotifications=Nb;ue.DownloadNotifications=qc;return qa.g($a,"UploadLatencyTelemetry",ue,Lc,sd,Fd,Td,128)};class Vc{constructor($a){this.$=$a}Sed($a){return $a}jGd($a){const Nb=
Array($a.xHa.count);let qc=0;for(let Lc of $a.xHa.values)Nb[qc]=Lc,qc++;return Oc(this.$.oa.xa,Nb,$a.Kt,$a.xaa,null,null)}yYc($a,Nb){if(!Nb)return $a;if(!$a)return f.ULS.shipAssertTag(537154136,0,!!$a,"CheckCollabServiceActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),Nb;f.ULS.shipAssertTag(537154135,0,1===$a.xHa.count,"CheckCollabServiceActionAggregationPerformer.AggregateActionParameters: newActionParameters has unexpected number of entries");for(let qc of $a.xHa){let Lc;
({value:Lc}=Nb.xHa.Fc(qc.key)).returnValue?Lc.OcsSessionId!==qc.value.OcsSessionId?(f.ULS.sendTraceTag(537154134,0,15,`CheckCollabServiceActionAggregationPerformer.AggregateActionParameters: Found nonidentical OcsSessionIds. new SeqNum: ${qc.value.SeqNum}, aggregated SeqNum: ${Lc.SeqNum}`),Nb.xHa.ia(qc.key,qc.value.SeqNum<Lc.SeqNum?qc.value:Lc),Nb.Kt=qc.value.SeqNum<Lc.SeqNum?$a.Kt:Nb.Kt):(qc.value.SeqNum>Lc.SeqNum&&Nb.xHa.ia(qc.key,qc.value),Nb.Kt=$a.Kt):(Nb.xHa.add(qc.key,qc.value),Nb.Kt=$a.Kt)}return Nb}}
Object(c.a)(Vc,"CheckCollabServiceActionAggregationPerformer",null,[385,386]);class ed{constructor($a){this.$=$a}Sed($a){return $a}jGd($a){return nc(this.$.oa.xa,$a.bjh,$a.Ioc,$a.Kt,null,null,null)}yYc($a,Nb){if(!Nb)return $a;if(!$a)return f.ULS.shipAssertTag(537154133,0,!1,"CheckPersistedActionAggregationPerformer.AggregateActionParameters: Received null newActionParameters"),Nb;$a.Ioc=Nb.Ioc&&$a.Ioc;return $a}}Object(c.a)(ed,"CheckPersistedActionAggregationPerformer",null,[385,386]);class Sd{}Object(c.a)(Sd,
"RevisionGeneratedNotification",null,[]);class Zd{}Object(c.a)(Zd,"StateDownloadedNotification",null,[]);var pa=a(179);class zb extends Sa.a{constructor($a){super();this.mergeSuspensionManager=this.Me=null;this.axa=!1;this.aGd=null;this.nBc=this.mBc=this.oBc=this.Ed=!1;this.ZGb=(Nb,qc)=>{this.axa!==qc.axa&&(this.aGd=(this.axa=qc.axa)?null:ub.a.Ya.Ub)};this.dd=()=>{this.$.ut&&this.CPj()};this.Rc=(Nb,qc)=>{qc.Xb||this.fr(Nb,qc)};this.fr=()=>{if(0<this.jAa.length||0<this.fea.count)f.ULS.sendTraceTag(537154128,
13,15,`Dropping ${this.jAa.length} revisionGeneratedNotifications and ${this.fea.count} stateDownloadedNotifications.`),this.jAa=[],this.fea=new pa.a;this.Fpb.cancel();this.Eig();this.L_d();this.nZj()};this.jHf=(Nb,qc)=>{this.APj();this.BPj();Nb=new Sd;Nb.Xluid=qc.Hi;Nb.NotificationReceivedOn=ub.a.Ya.Ub.toISOString();Nb.CurrentPresenceUserCount=this.$.ea.uo.length;Nb.OurCollabModeIsUsingOcs=this.$.ea.h8a;Nb.SenderCollabMode=qc.mwj;Nb.SenderClientType=qc.lwj;Nb.SessionSiteIdentifier=qc.d7;Nb.CommandTimeInMs=
qc.f7g;f.ULS.sendTraceTag(537154127,13,50,`ContentLatencyTracker.OnRemoteRevisionGenerated: RevisionGeneratedNotification: ${JSON.stringify(Nb)}`);this.jAa.push(Nb)};this.vj=()=>{this.aHe(this.$.ea.se,"OnBlockCacheConsistent")};this.nHf=(Nb,qc)=>{(Nb=Object(h.a)(388,qc.fe))&&this.aHe(Nb.nE,"OnRenderedContent")};this.$2j=()=>{if(!this.$.ea.Xb)f.ULS.sendTraceTag(537154122,13,15,"ContentLatencyTracker.UploadLatencyTelemetryPeriodically: session isn't active");else if(this.jAa.length||this.fea.count){var Nb=
null;0<this.jAa.length&&(Nb=this.jAa,this.jAa=[]);var qc=null;if(0<this.fea.count){qc=Array(this.fea.count);let Lc=0;for(let sd of this.fea.values)qc[Lc++]=sd;this.fea=new pa.a}f.ULS.sendTraceTag(537154120,13,100,`ContentLatencyTracker.UploadLatencyTelemetryPeriodically: Uploading ${Nb?Nb.length:0} revisionGeneratedNotifications and ${qc?qc.length:0} stateDownloadedNotifications.`);Fc(this.$.oa.xa,Nb,qc,this.h1i,null,null,null)}};this.h1i=Nb=>{Nb.Result&&0<Nb.Result&&this.Fyd()};this.$=$a;this.Ca=
za.h(this.$).Ca;this.viewport=za.h(this.$).view;this.contentRefreshManager=this.$.da.Aa(292);this.Qe=this.$.Qe;this.jAa=[];this.fea=new pa.a;this.Fpb=ja.a.instance.yC(this.$2j,3E4,Ka.a.K9g,!1,!1);this.$.Lk(this.dd);this.$.ea.Jj(this.Rc);this.$.ea.QXc(this.fr);this.$.da.gb(291,Nb=>{this.Me=Nb});this.$.da.gb(343,Nb=>{this.Ed||(this.mergeSuspensionManager=Nb,this.mergeSuspensionManager.f0b(this.ZGb),this.mergeSuspensionManager.NIb())});f.ULS.sendTraceTag(537154131,13,50,"ContentLatencyTracker initialized");
this.dd(this.$,null)}dispose(){this.Ed=!0;this.Fpb&&(this.Fpb.dispose(),this.Fpb=null);this.contentRefreshManager&&(this.Eig(),this.contentRefreshManager=null);this.Ca&&(this.L_d(),this.Ca=null);this.viewport&&(this.L_d(),this.viewport=null);this.Qe&&(this.Qe=null);this.$&&(this.$.pl(this.dd),this.$.ea.ik(this.Rc),this.$.ea.VWf(this.fr),this.$=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.evc(this.ZGb),this.mergeSuspensionManager=null);super.dispose()}CPj(){this.oBc||(this.contentRefreshManager.EOg(this.jHf),
this.oBc=!0,this.Fpb.Yp())}Eig(){this.oBc&&(this.contentRefreshManager.qlj(this.jHf),this.oBc=!1)}APj(){this.mBc||(this.Ca.Tv(this.vj),this.mBc=!0)}L_d(){this.mBc&&(this.Ca.Nw(this.vj),this.mBc=!1)}BPj(){this.nBc||(this.viewport.FOg(this.nHf),this.nBc=!0)}nZj(){this.nBc&&(this.viewport.tlj(this.nHf),this.nBc=!1)}aHe($a,Nb){if($a!==na.a.oe&&!this.fea.hb($a)){var qc=ub.a.Ya.Ub.toISOString();qc=Object(ca.a)(new Zd,{StateId:$a,DownloadedOn:qc,IsHidden:this.Me?this.Me.Wh:"visible"!==window.document.visibilityState,
DocumentLastUnhidden:this.Me&&this.Me.Okc?this.Me.Okc.toISOString():null,LastLostRtcConnection:this.contentRefreshManager&&this.contentRefreshManager.ipf?this.contentRefreshManager.ipf.toISOString():null,LastOffline:this.Qe&&this.Qe.xxa?this.Qe.xxa.toISOString():null});this.mergeSuspensionManager&&(qc.IsPendingMergeBlockedByClient=this.axa,this.aGd&&(qc.PendingMergeBlockedByClientLastEnded=this.aGd.toISOString()));f.ULS.sendTraceTag(537154124,13,50,`ContentLatencyTracker.CreateAndAddstateDownloadedNotifications: ${Nb} - StateDownloadedNotification: ${JSON.stringify(qc)}`);
this.fea.add($a,qc)}}Fyd(){l.AFrameworkApplication.Ze&&l.AFrameworkApplication.Ze.Fyd()}}Object(c.a)(zb,"ContentLatencyTracker",Sa.a,[]);var Vb=a(895);class xc{}Object(c.a)(xc,"UpdateInfo",null,[]);var Sc=a(896);class Jd extends Sys.EventArgs{constructor($a,Nb,qc,Lc,sd){super();this.Hi=$a;this.mwj=Nb;this.lwj=qc;this.d7=Lc;this.f7g=sd}}Object(c.a)(Jd,"RevisionGeneratedEventArgs",Sys.EventArgs,[]);class ye{constructor($a,Nb,qc,Lc){this.QEc=this.Asc=this.Grc=this.Cfc=0;this.tbe=this.Bgf=!1;this.clientId=
$a;this.Mih=Nb;this.$=Lc;this.FEi=gd.a.Td()+qc}get dkf(){return this.tbe}l1j(){this.Asc||(this.Asc=gd.a.Td(),this.QDb())}i1j(){this.Cfc||(this.Cfc=gd.a.Td(),this.QDb())}k1j(){this.Grc||(this.Grc=gd.a.Td(),this.QDb())}m1j($a){this.QEc||(this.QEc=gd.a.Td(),this.Bgf=$a,this.QDb())}QDb($a=0){this.dkf||($a&&$a>this.FEi?this.h_(!0):this.Asc&&this.Grc&&this.Cfc&&this.QEc&&this.h_(!1))}dispose(){this.$=null}h_($a){const Nb={};Nb.CoAuthorsCount=this.$.ea.uo.length;Nb.HostNotificationTime=this.Cfc;Nb.PeerNotificationTime=
this.Grc;Nb.PresenceNotificationTime=this.Asc;Nb.UserFetchTime=this.QEc;Nb.IsAlreadyFetchedFromServer=this.Bgf;Nb.IsTimeout=$a;Nb.ClientId=this.clientId;Nb.CurrentUserClientId=this.Mih;Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6875242_useStringLiteralToPrintJsonObjectInLogs")?f.ULS.sendTraceTag(541388879,0,50,`Host Notification Latency Entry: ${JSON.stringify(Nb)}`):f.ULS.sendTraceTag(541388879,0,50,"Host Notification Latency Entry: {0}",Nb);this.tbe=!0}}Object(c.a)(ye,"HostNotificationLatencyEntry",
null,[2]);class pe{constructor($a,Nb,qc){this.bjh=$a;this.Ioc=Nb;this.Kt=qc}}Object(c.a)(pe,"PersistedContentUpdateActionParameters",null,[]);class re{constructor($a,Nb,qc){this.LIc={};this.MIc={};this.Kt=qc;this.Z0b($a,this.LIc);this.Z0b(Nb,this.MIc)}get R2c(){return ve.a(this.LIc)}get S2c(){return ve.a(this.MIc)}get Vif(){return!this.R2c.length&&!this.S2c.length}pYj($a){this.Z0b($a.R2c,this.LIc);this.Z0b($a.S2c,this.MIc)}Z0b($a,Nb){if($a)for(const qc of $a)Nb[qc]=!0}}Object(c.a)(re,"UpdatePresenceUsersActionParameters",
null,[]);class He extends O.a{constructor($a,Nb,qc,Lc,sd){super();this.fh=null;this.hBd=!1;this.Tce=this.currentUserId=this.xmd=null;this.gEd=(Fd,Td)=>{if(Td.pL){Fd=Td.pL;for(let ue in Fd)(Fd=ue)&&Fd!==this.currentUserId&&!this.p0a.has(Fd)&&this.bdc(Fd).l1j()}};this.mB=()=>{this.dTf()};this.Jca=(Fd,Td)=>{this.hBd=!0;Fd=Object(h.a)(Object,Td.O7);if(1===Td.type){var ue=Ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1);if(null===Fd||void 0===Fd?0:Fd[na.a.Bdi]){if(!ue||
!Object(h.a)(String,Fd[na.a.Qcf]))return;var Ae=this.jGe(Object(h.a)(String,Fd[na.a.Qcf]));Object(h.a)(String,Fd[na.a.Rcf])===na.a.zdi?(Ae=[Ae],Ae[0]===this.currentUserId||this.p0a.has(Ae[0])||this.bdc(Ae[0]).i1j(),this.N8f(Ae)&&this.ygb(Ae,null)):Object(h.a)(String,Fd[na.a.Rcf])===na.a.Adi&&Ae!==this.currentUserId&&this.ygb(null,null)}else{Td=Array.isArray(Td.O7)?Td.O7:null;!Td&&Fd&&(Td=Array.isArray(Fd[na.a.COe])?Fd[na.a.COe]:null);if(Td&&ue)for(Ae of Td)Ae===this.currentUserId||this.p0a.has(Ae)||
this.bdc(Ae).k1j();Td&&!this.N8f(Td)||this.ygb(Td,null);return}}if(Fd)if(0===Td.type)({KSf:Ae}=this.mpb(Fd)).returnValue?(this.ZOa(Fd),na.a.se in Fd&&(this.$.ea.YW(Fd[na.a.se],"ContentRefreshManager.OnUpdateNotificationReceived"),this.Xig())):f.ULS.sendTraceTag(22905367,0,50,`RTC ContentUpdate session identifier mismatch. Received: ${Ae}. Expected: ${this.$.ea.d7}. Ignoring this update.`);else{if(3===Td.type){if(!(na.a.c0f in Fd)){f.ULS.sendTraceTag(537154117,13,10,"RTC WetContentUpdate does not specify a type. Ignoring this update.");
return}Td=Fd[na.a.c0f];Td===na.a.Frj?this.eai(Fd):Td!==na.a.Drj&&Td!==na.a.Hrj&&Td!==na.a.Irj&&Td!==na.a.Grj&&Td!==na.a.Erj&&f.ULS.sendTraceTag(537154081,13,50,`RTC WetContentUpdate of unknown type ${Td}. Ignoring this update.`);return}if(4===Td.type){Ae=!1;na.a.BMf in Fd&&(Ae=Fd[na.a.BMf]);if(this.mpb(Fd).returnValue)return;this.$.ea.jni()&&this.K3g();if(this.$.ea.h8a&&Ae)return;ue=Fd[na.a.q5i];this.$.ea.Xb&&ue&&this.p5i.xMf(new pe(ue,Ae,this.FAf))}else if(8===Td.type){if(this.Vij)return;let Le=
0;const df=Fd[na.a.Brj],Oe=Fd[na.a.zrj],cf=Fd[na.a.Arj];na.a.d0f in Fd&&(Le=Fd[na.a.d0f]);this.$.ea.Xb&&df&&(Ae=Object(ca.a)(new xc,{OcsSessionId:df,ClientId:Oe&&Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5544917_HookUpRevisionTrackerOnXLO")?Oe:"",SeqNum:cf,XrevidSaved:Le}),ue=Array(1),ue[0]=Ae,Oc(this.$.oa.xa,ue,this.FAf,()=>{f.ULS.sendTraceTag(537154080,0,10,`BatchCheckCollabServiceContent failed. OcsSessionId: ${df}, ClientId: ${Oe}, SeqNum: ${cf}, XrevidSaved: ${Le}`)},null,null))}}2===Td.type?
Fd&&this.mpb(Fd).returnValue||(f.ULS.sendTraceTag(537154079,0,50,"RTC : FileNameUpdate received. Now invoking CheckWorkbookFileNameUpdate web method"),gc(this.$.oa.xa,null,null,null,null)):12!==Td.type||Fd&&this.mpb(Fd).returnValue||this.raiseEvent("LabelUpdateEventKey")};this.FAf=Fd=>{var Td=Fd.Errors;Ra.a.qq(Td)?(Td=Ra.a.Fz(Td,[1552731907],"ContentRefreshManager"),Ra.a.Xga(Td)||this.$.ea.Tn(Td)):(Td=Fd.StateId+1,Fd.Result&&this.$.ea.se<Td&&this.$.ea.YW(na.a.oe,"ContentRefreshManager.OnCheckForUpdateSuccess"))};
this.eh=()=>{this.vrj&&this.hBd&&this.$.ea.W8b&&this.Xig()};this.pBf=()=>{this.hBd=!1;this.$.ea.Rda=500;this.Tce=ub.a.Ya.Ub};this.xca=(Fd,Td)=>{this.sWd(Td.fh)};this.$=$a;this.Bn=Nb;this.$.oa.$q(this.eh);this.Bn.mob(this.xca);this.Bn.sqe(this.pBf);this.p5i=Lc;this.G1j=sd;this.ELa={};this.p0a=new Set;this.Bn.k0a();Ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)&&(this.currentUserId=this.$.workbookContext.ClientId,this.dTf(),this.$.ea.B9(this.mB));this.Vij=
Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:6195367_RemoveWebRequestsForCollabServiceContentUpdates")}EOg($a){this.addHandler("ekcrmrrg",$a)}qlj($a){this.removeHandler("ekcrmrrg",$a)}$Ya($a){this.addHandler("ekcrmmcu",$a)}ucb($a){this.removeHandler("ekcrmmcu",$a)}xNg($a){this.addHandler("LabelUpdateEventKey",$a)}ykj($a){this.removeHandler("LabelUpdateEventKey",$a)}get ipf(){return this.Tce}get vrj(){return!!this.fh&&2===this.fh.connectionState}ygb($a,Nb){this.$.ea.Xb&&(f.ULS.sendTraceTag(39150978,
0,50,`ContentRefreshManager.UpdatePresenceUsers: clientIdsToAdd=[${$a?$a.join(","):"null"}] clientIdsToRemove=[${Nb?Nb.join(","):"null"}]`),this.G1j.xMf(new re($a,Nb,null)))}dispose(){this.fh&&(this.fh.gKb(this.Jca),this.fh.JQa(this.gEd));this.$&&(this.$.oa.ps(this.eh),this.$.ea.O6(this.mB));this.Bn&&(this.Bn.Duc(this.xca),this.Bn.dWf(this.pBf));this.$=this.fh=this.p0a=this.ELa=null;super.dispose()}sWd($a){this.fh&&(this.fh.gKb(this.Jca),this.fh.JQa(this.gEd));this.fh=Object(h.a)(343,$a);this.fh.eZa(this.Jca);
Ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)&&this.fh.cZa(this.gEd);this.currentUserId=this.fh.clientId}dTf(){const $a=!this.fh;var Nb=this.$.ea.uo;for(const qc of Nb)(Nb=qc.User.UserID)&&Nb!==this.currentUserId&&!this.p0a.has(Nb)&&this.bdc(Nb).m1j($a)}eai($a){if(na.a.b0f in $a&&na.a.a0f in $a&&na.a.$_f in $a){var Nb=$a[na.a.$_f];1!==Nb||na.a.d7 in $a&&na.a.wwc in $a||f.ULS.sendTraceTag(537154076,13,10,`RTC WetContentUpdate was sent from ECS and is missing some expected fields. Has SessionSiteIdentifier: ${na.a.d7 in
$a}, Has UserOperationTimeInMs: ${na.a.wwc in $a}.`);var qc;({KSf:qc}=this.mpb($a)).returnValue||($a=new Jd($a[na.a.b0f],$a[na.a.a0f],Nb,qc,na.a.wwc in $a?$a[na.a.wwc]:0),this.raiseEvent("ekcrmrrg",$a,this))}else f.ULS.sendTraceTag(537154077,13,10,"RTC WetContentUpdate is missing some critical fields. Ignoring this update.")}mpb($a){$a=na.a.d7 in $a?$a[na.a.d7]:null;return{returnValue:this.$.ea.d7===$a,KSf:$a}}Xig(){this.$.ea.Rda=Math.max(He.xVg,this.$.ea.Rda)}N8f($a){for(const Nb of $a)if(!this.$.ea.Jjd(Nb))return!0;
return!1}K3g(){this.$.Yc(1562177611,-1,0,null)}ZOa($a){na.a.Ovf in $a&&na.a.Pvf in $a&&na.a.Rvf in $a&&($a=Object(ca.a)(new Vb.a,{Pending:$a[na.a.Pvf],Current:$a[na.a.Ovf],SuspensionStartTimestamp:$a[na.a.Rvf]}),this.raiseEvent("ekcrmmcu",new Sc.a($a),this))}bdc($a){$a=this.jGe($a);if(!this.ELa[$a]){const Nb=new ye($a,this.currentUserId,4E4,this.$);this.ELa[$a]=Nb}this.D1f();return Object(h.a)(ye,this.ELa[$a])}jGe($a){if(!$a)return $a;let Nb=$a.toLocaleLowerCase();Nb.startsWith("{")||(Nb="{"+$a+"}");
return Nb}D1f(){this.xmd||n.a.isEmpty(this.ELa)||!Ta.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.EditorsTableNotification",!1)||(this.xmd=z.Task.delay(2E4).continueWith(()=>{this.ydi()}))}ydi(){const $a=[],Nb=gd.a.Td(),qc=this.ELa;for(let sd in qc){var Lc=sd;const Fd=Object(h.a)(ye,qc[sd]);Fd.QDb(Nb);Fd.dkf&&(Fd.dispose(),$a.push(Lc))}for(const sd of $a)delete this.ELa[sd],this.p0a.add(sd);this.xmd=null;this.D1f()}}He.xVg=3E4;Object(c.a)(He,"ContentRefreshManager",O.a,[387]);var ze=
a(71);class ef{constructor($a){this.$=$a}Sed($a){return $a+5E3}jGd($a){return this.$.ea.Xb?ia.TaskExtensions.ts(ia.TaskExtensions.ts(z.Task.delay(0),()=>Ib(this.$.oa.xa,$a.R2c,$a.S2c,$a.Kt,null,null,null),rf.a.none,0,ze.a.current),()=>z.Task.delay(5E3),rf.a.none,0,ze.a.current):z.Task.Sa(!0)}yYc($a,Nb){if(!Nb)return $a;if(!$a)return f.ULS.shipAssertTag(537154073,0,!1,"UpdatePresenceUsersActionAggregationPerformer.AggregateActionParameters: Received null newActionParameter"),Nb;if(Nb.Vif)return Nb;
if($a.Vif)return $a;Nb.pYj($a);return Nb}}Object(c.a)(ef,"UpdatePresenceUsersActionAggregationPerformer",null,[385,386]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.CoauthTelemetry");ea.main();Type.registerNamespace("Common.App.CollabControls");Type.registerNamespace("Common.App.Presence");Type.registerNamespace("RealtimePresenceUI");Fa.a.Fa(ua.ka);(()=>{Fa.a.Fa($a=>{Ta.EwaSettings.isChangeGateEnabled("OfficeVSO:5140517_PresenceBootBreakDownMetrics")&&db.ka($a);const Nb=$a.da;
Nb.Ha(28,new Ya($a));Nb.Ha(158,new Za($a));Fa.a.Fa(Ga.ka);const qc=xa.GetServiceTaskFactory.create($a.da,158,Nb.la,1),Lc=xa.GetServiceTaskFactory.create($a.da,28,Nb.la,1);ia.TaskExtensions.za(ia.TaskExtensions.Fd([qc,Lc],Nb.la),()=>{const sd=new d.a,Fd=Nb.Aa(26);Fd.SIe(Object(b.a)(sd,sd.setResult,"setResult"));const Td=new Re($a,Fd,qc.result,Lc.result,Z.a.Rq(Y.a.instance.Tb("Common.App.CoauthTelemetry.IPresenceBootTelemetry")));X.a.getInstance($a.da).add(Td);Nb.Ha(159,new Ga);ia.TaskExtensions.za(xa.GetServiceTaskFactory.create(Nb,
159,Nb.la,1),ue=>{const Ae=new d.a;Ae.setResult(Td);new yb(Object(ca.a)(new mb.a,{clientId:$a.workbookContext.ClientId}),sd.task,Ae.task,ue.result,nb.a.instance,l.AFrameworkApplication.fa.pa("AwayStatusOneMinuteTimeoutIsEnabled")?6E4:l.AFrameworkApplication.fa.vd("AwayCoauthorThresholdMs",9E5),Object(b.a)(l.AFrameworkApplication.rb,l.AFrameworkApplication.rb.processAction,"processAction"),Oa.instance)},Nb.la)},Nb.la,3);Y.a.instance.register(193,"Microsoft.Office.Excel.WebUI.Client.ISessionStateManager").as("Common.ICoauthoringTelemeryInfoProvider").qc().yc(()=>
$a.ea);Y.a.instance.resolve("Common.ICoauthoringTelemeryInfoProvider");Y.a.instance.register(Na,"Microsoft.Office.Excel.WebUI.Client.Presence.PeopleInfoProvider").as("Common.IPeopleInfoProvider").qc().yc(()=>new Na($a));Y.a.instance.resolve("Common.IPeopleInfoProvider")})})();Fa.a.Fa(Xb.a.ka);Fa.a.Fa($a=>{const Nb=$a.da,qc=xa.GetServiceTaskFactory.Oa($a.da,211,212,1);Nb.gb(25,Lc=>{ia.TaskExtensions.za(qc,sd=>{Nb.Aa(231)||new lc(sd.result,$a,Lc)},Nb.la,3)})});(()=>{Fa.a.Fa($a=>{ia.TaskExtensions.za(xa.GetServiceTaskFactory.Oa($a.da,
12,477,0),Nb=>{var qc=new Vc($a),Lc=$a.da.Aa(291);qc=Nb.result.p5c(qc,qc,Lc,"collabService");var sd=new ed($a);Lc=Nb.result.p5c(sd,sd,Lc,"persisted");sd=new ef($a);Nb=Nb.result.p5c(sd,sd,null,"updatePresence");$a.da.Ha(292,new He($a,$a.da.Aa(26),qc,Lc,Nb));X.a.getInstance($a.da).add(new zb($a));X.a.getInstance($a.da).add(qc);X.a.getInstance($a.da).add(Lc)},$a.la)})})()},737:function(r,F,a){a.r(F);a.d(F,"RtcUtils",function(){return f});r=a(0);var c=a(15),b=a(822),e=a(39);class f{static b2c(d,h=b.RealtimeChannel.Oyd){let l;
try{l=e.c(d)}catch(k){throw d=String.format("Failed to JSON-serialize payload : {0}",k),c.ULS.sendTraceTag(18637072,500,10,d),Error.argument("payload",d);}if(l.length>h)throw d=String.format("Payload exceeds maximum length: {0} > {1}.",l.length,h),c.ULS.sendTraceTag(18637074,500,10,d),Error.argument("payload",d);return l}static deserialize(d,h,l){if(!d)return null;if(Object.getType(d)!==String){var k=String.format("Failed to deserialize [{0}] - object is not of type [String] and is instead of type [{1}]. ExtraInfo: [{2}].",
h,Object.getType(d).getName(),l);c.ULS.sendTraceTag(18637075,500,10,k);return null}k=null;try{k=e.a(d)}catch(t){d=String.format("Failed to deserialize [{0}]. Exception deserializing the object : [{1}]. ExtraInfo: [{2}].",h,t,l),c.ULS.sendTraceTag(18637077,500,10,d)}return k}static f$a(d){if(!d)return"";if("string"===typeof d)return d.toString();try{return e.c(d)}catch(h){return d.toString()}}static UEh(d){let h,l,k;h=0;k=l=null;if(!d)return{hdf:h,jdf:l,exception:k};try{const t=d.source;t&&Object.getType(t)===
String&&(k=t);const n=d.context;n&&(d=n,h=d.status?d.status:0,l=d.statusText?d.statusText:null)}catch(t){}return{hdf:h,jdf:l,exception:k}}}Object(r.a)(f,"RtcUtils",null,[])},822:function(r,F,a){a.r(F);r=a(0);var c=a(15),b=a(85),e=a(160),f=a(894),d=a(100),h=a(4);class l{constructor(mb,nb){this.status=mb;this.N8a=nb}}Object(r.a)(l,"UserStatusInfo",null,[]);var k=a(79),t=a(573),n=a(192);class z{constructor(mb){this.messageId=mb;this.bwj=(new Date).getTime();this.qvd=new n.a}}Object(r.a)(z,"MessageLatencyDetails",
null,[]);class w{constructor(mb,nb,X){this.L8=null;this.oPc=this.VSc=0;this.ke=nb;this.uee=X;this.vmb=!1;this.Mg=mb;this.Mg.eZa(Object(b.a)(this,this.Ndj,"receiveMessage"))}start(){if(this.uee&&!this.vmb){const mb=this.ke.k0f;this.oPc=this.ke.h0f;mb<=this.oPc?(c.ULS.sendTraceTag(570975114,500,15,"LogMetrics cannot be started because configuration values are incorrect. RtcSendTelemetryMessageIntervalInMS({0}) should be greater than RtcLogClientMessageMetricsTimeOutInMs({1})",this.ke.k0f,this.ke.h0f),
this.uee=!1):(this.vmb=!0,this.VSc=window.setInterval(Object(b.a)(this,this.jj,"sendMessage"),mb))}}jj(){if(this.vmb){const mb=t.a.create().toString();this.L8=new z(mb);this.Mg.hJd(16,mb,!1,new e.a);window.setTimeout(()=>{this.mDi(mb)},this.oPc)}}mDi(mb){this.L8&&this.L8.messageId===mb&&(0<this.L8.qvd.count?(mb=this.L8.qvd.toArray().join(","),c.ULS.sendTraceTag(571339719,500,15,"ClientMessageLatencies:[{0}]",mb)):c.ULS.sendTraceTag(562312150,500,50,"No client message latencies recorded"),this.L8=
null)}stop(){this.VSc&&(window.clearInterval(this.VSc),this.vmb=!1)}Ndj(mb,nb){16===nb.type?this.Mg.hJd(17,nb.O7,!1,new e.a):17===nb.type&&this.vmb&&nb.O7&&this.N9i(nb.O7)}N9i(mb){mb&&this.L8&&mb.toString()===this.L8.messageId&&(mb=(new Date).getTime()-this.L8.bwj,this.L8.qvd.add(mb))}static get instance(){return w.La}static Shd(mb,nb,X){return w.instance||(w.La=new w(mb,nb,X))}}w.La=null;Object(r.a)(w,"ClientToClientMessageTelemetry",null,[]);var m=a(957),u=a(893);class y{constructor(mb,nb){this.data=
mb;this.timeStamp=nb}}Object(r.a)(y,"PresenceData",null,[]);class v{constructor(mb){this.g9=!1;this.gYa=0;this.hJc=!1;this.setTimeout=v.h8c;this.clearTimeout=v.X7c;this.PEi=Object(b.a)(this,this.fEi,"logRtcConnectingUsageStatement");this.em=mb}kQi(){this.g9||(this.gYa=this.setTimeout(()=>{this.g9=!1;this.ssf()},8E3),this.g9=!0,this.hJc=!1)}kRi(){this.jM()}S_i(){this.ssf()}ssf(){this.jM();this.hJc||(this.hJc=!0,this.PEi())}fEi(){c.ULS.sendTraceTag(4539720,500,50,"Usage statement for the Rtc_ConnectedEver KPI for [{0}]",
this.em)}jM(){this.g9&&this.clearTimeout(this.gYa);this.gYa=0;this.g9=!1}static h8c(mb,nb){return window.setTimeout(mb,nb)}static X7c(mb){window.clearTimeout(mb)}}Object(r.a)(v,"ConnectedUsageKpiLogger",null,[927]);class C{constructor(){this.USf=this.ZJd;this.XSf=this.bKd;this.WSf=this.aKd;this.aTf=this.dKd;this.$Sf=this.cKd;this.iKd=this.jKd;this.cJb=this.gKd;this.nQa=this.eKd;this.oQa=this.fKd;this.VSf=this.$Jd;this.fFb=this.AAd;this.Onc=this.CAd}ZJd(){}bKd(){}aKd(){}dKd(){}cKd(){}gKd(){}fKd(){}eKd(){}jKd(){}$Jd(){}AAd(){}CAd(){}}
Object(r.a)(C,"NoopRealtimeChannelMetrics",null,[922,69]);class x{}x.$Pb="presenceUpdated";x.updateNotification="updateNotification";x.EMf="persistentStateCleared";x.updatePersistentState="persistentStateUpdated";Object(r.a)(x,"RtcClientMethodNames",null,[]);class B{}B.Odi="realtimeChannelHub";B.$Pb="UpdatePresence";B.Qda="SendUpdateNotification";B.Hfd="GetCompletePersistentStateWithMetadata";B.updatePersistentState="UpdatePersistentState";B.mgb="UpdateClientInfo";Object(r.a)(B,"RtcHubMethodNames",
null,[]);class H{constructor(mb){this.Jr=mb}Ggj(mb){this.Jr.on(x.$Pb,mb)}ghj(mb){this.Jr.on(x.updateNotification,mb)}Egj(mb){this.Jr.on(x.updatePersistentState,mb)}Dgj(mb){this.Jr.on(x.EMf,mb)}SYj(mb){this.Jr.off(x.$Pb,mb)}bZj(mb){this.Jr.off(x.updateNotification,mb)}RYj(mb){this.Jr.off(x.updatePersistentState,mb)}QYj(mb){this.Jr.off(x.EMf,mb)}$Pb(mb){return this.Jr.invoke(B.$Pb,mb)}mgb(mb){return this.Jr.invoke(B.mgb,mb)}Qda(mb,nb){return this.Jr.invoke(B.Qda,mb,nb)}Hfd(mb){return this.Jr.invoke(B.Hfd,
mb)}updatePersistentState(mb,nb){return this.Jr.invoke(B.updatePersistentState,mb,nb)}}Object(r.a)(H,"RealtimeChannelProxy",null,[928,929,930]);class I{constructor(){this.IHc=this.h5d=!1;this.GHc=0;this.NIc=this.pTc=this.oTc=this.cHc=!1;this.OKc=0;this.Oie=!1;this.Nie=this.Mie=0;this.uSc=!1;this.zSc=this.xSc=this.ASc=this.vSc=0;this.ySc=!1}get uVg(){return this.IHc}get tVg(){return this.GHc}get SQg(){return this.cHc}get UFj(){return this.oTc}get VFj(){return this.pTc}get E5g(){return this.NIc}get kac(){return this.OKc}get rtcJsClientFrequentlyLogsMetrics(){return this.Oie}get f0f(){return this.Mie}get Crj(){return this.Nie}get rtcClientMessageTelemetryEnabled(){return this.uSc}get xrj(){return this.vSc}get k0f(){return this.ASc}get h0f(){return this.xSc}get j0f(){return this.zSc}get i0f(){return this.ySc}static createInstance(mb){const {RealtimeChannel:nb}=
a(822);return mb?Object.assign(new I,{h5d:mb.pa("AwayStatusManagerIsEnabled"),IHc:mb.pa("AwayStatusOneMinuteTimeoutIsEnabled"),GHc:mb.vd("AwayCoauthorThresholdMs",9E5),cHc:mb.pa("RtcAllowCrossDomainAccessEnabled"),oTc:mb.pa("ShouldLogOnContentNotification"),pTc:mb.pa("ShouldLogOnHostSubscriptionNotification"),NIc:mb.pa("RtcClientMetricsEnabled"),OKc:mb.vd("RtcFindSessionRequestTimeoutInMS",6E4),Oie:mb.pa("RtcJsClientFrequentlyLogsMetrics"),Mie:mb.vd("RtcJsClientFrequentMetricsLatencyThresholdInMS",
1E3),Nie:mb.vd("RtcJsClientFrequentMetricsLogIntervalInMS",3E5),uSc:mb.pa("RtcClientMessageTelemetryEnabled"),vSc:mb.vd("RtcClientMessageTelemetrySampleSize",5),ASc:mb.vd("RtcSendTelemetryMessageIntervalInMS",3E5),xSc:mb.vd("RtcLogClientMessageMetricsTimeOutInMs",2E4),zSc:mb.vd("RtcMaxPayloadSizeInCharactersOverride",nb.Oyd),ySc:mb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.RTCLogSignalrHeartBeatMessages",!1)}):Object.assign(new I,{h5d:!1,IHc:!1,GHc:9E5,cHc:!1,oTc:!1,pTc:!0,NIc:!1,OKc:9E4,
uSc:!1,vSc:5,ASc:3E5,xSc:2E4,zSc:nb.Oyd,ySc:!1})}}Object(r.a)(I,"RealtimeChannelSettings",null,[925]);var U=a(1185),S=a(84),G=a(381);class D{constructor(mb){this.Zmb=null;this.Jda=0;this.AJa=!1;this.Mg=mb;this.Mg.n2(Object(b.a)(this,this.EV,"onConnectionStateChanged"))}EV(mb,nb){this.Jda=nb.newState}J0i(){c.ULS.sendTraceTag(18637070,500,15,"Too many undelivered messages. Restarting RTC connection.");this.Mg.ntc()}xgi(mb){this.Zmb.init(mb)}}Object(r.a)(D,"ARtcMessageHandler",null,[]);var E=a(1229);
class N{constructor(){this.Presence=null;this.TimeStamp=0}}Object(r.a)(N,"PresenceDataEntryForClients",null,[]);var M=a(111);class L{constructor(mb,nb=""){this.zDg=mb;this.LI=nb}send(){return this.zDg()}get messageId(){return this.LI}}Object(r.a)(L,"MessageHandler",null,[937]);class aa{constructor(){this.R5d=this.fJc=!1;this.callback=null}p$a(mb){this.callback=mb;this.jgg()}Luf(mb){this.fJc||(this.fJc=!0,this.Mug=mb,this.jgg())}jgg(){this.fJc&&this.callback&&!this.R5d&&(this.R5d=!0,this.callback(this.Mug))}}
Object(r.a)(aa,"CompletionTask",null,[]);class V{constructor(){this.see=new aa;this.qee=new aa}Qpc(mb){this.see.p$a(mb)}Ppc(mb){this.qee.p$a(mb)}sEb(mb){this.see.Luf(mb)}$xa(mb){this.qee.Luf(mb)}Gyd(){this.sEb(2);this.$xa(2)}}Object(r.a)(V,"MessageStatus",null,[938]);class P extends Sys.EventArgs{constructor(mb,nb,X,R){super();this.WMd=mb;this.reconnectDelay=nb;this.reason=X;this.nQd=R}}Object(r.a)(P,"RefreshConnectionReconnectArgs",Sys.EventArgs,[]);var ba=a(1005);class Y{constructor(){this.RTc=
this.Ap=null}get Bc(){return this.Ap?this.RTc?this.RTc.getTime()-this.Ap.getTime():(new Date).getTime()-this.Ap.getTime():0}start(){this.Ap=new Date}stop(){this.RTc=new Date}}Object(r.a)(Y,"SimpleStopwatch",null,[]);var Z=a(1006),ea;(function(mb){mb[mb.contentUpdate=0]="contentUpdate";mb[mb.editorsTableUpdate=1]="editorsTableUpdate";mb[mb.fileNameUpdate=2]="fileNameUpdate";mb[mb.wetContentUpdate=3]="wetContentUpdate";mb[mb.persistedContentUpdate=4]="persistedContentUpdate";mb[mb.clientRtcReconnectRequest=
5]="clientRtcReconnectRequest";mb[mb.replicationTelemetry=6]="replicationTelemetry";mb[mb.lockUpdate=7]="lockUpdate";mb[mb.collabServiceContentUpdate=8]="collabServiceContentUpdate";mb[mb.trackChangeSettingUpdate=9]="trackChangeSettingUpdate";mb[mb.saveTargetUpdate=10]="saveTargetUpdate";mb[mb.uploadToOcsUpdate=11]="uploadToOcsUpdate";mb[mb.labelUpdate=12]="labelUpdate";mb[mb.hostNotificationSubscriptionStatus=13]="hostNotificationSubscriptionStatus";mb[mb.subscribeOrExtend=14]="subscribeOrExtend";
mb[mb.elapsedBootTelemetry=15]="elapsedBootTelemetry";mb[mb.clientToClientTelemetryMessage=16]="clientToClientTelemetryMessage";mb[mb.clientToClientResponseMessage=17]="clientToClientResponseMessage";mb[mb.verifyNotificationPipeline=18]="verifyNotificationPipeline";mb[mb.hostNotificationHeartbeat=19]="hostNotificationHeartbeat";mb[mb.secondaryMetadataUpdate=20]="secondaryMetadataUpdate";mb[mb.last=21]="last"})(ea||(ea={}));Object(r.b)("UpdateNotificationType",ea);var ra=a(986),O=a(984),da=a(985);
class xa extends D{constructor(mb,nb,X,R,wa,na,Ba,Ra,qa,La){super(Ba);this.Jr=null;this.Jde=!1;this.LI=0;this.aRc=new G.a;this.Rzg=xa.hSh();this.NQc=h.AFrameworkApplication.fa.Wa("OwningFeatureCrewForRtcNotificationKpis");this.ke=mb;this.mfe=this.lfe=0;this.Zmb=nb;this.Zmb.g0b(Object(b.a)(this,this.J0i,"onTooManyUndeliveredMessages"));this._clientId=X;this.kCg=wa;this.Mg.COg(Object(b.a)(this,this.EYi,"onRefreshProxyRequired"));this.Mg.AOg(Object(b.a)(this,this.DYi,"onRefreshAllPersistentStateRequest"));
this.Mg.TOg(Object(b.a)(this,this.Qda,"sendUpdateNotification"));this.Mg.mNg(Object(b.a)(this,this.KVi,"onInternalPresenceUpdated"));this.Mg.nNg(Object(b.a)(this,this.LVi,"onInternalUpdateNotificationReceived"));this.Mg.lNg(Object(b.a)(this,this.JVi,"onInternalPersistentStateUpdated"));this.Mg.kNg(Object(b.a)(this,this.IVi,"onInternalPersistentStateCleared"));this.Mg.SOg(Object(b.a)(this,this.zxc,"sendPersistentState"));this.Mg.nPg(Object(b.a)(this,this.mgb,"updateClientInfo"));this.rh=na;this.em=
R;this.Il=Ra;this.QB=qa;this.Tkb=La;this.cVa=Object(S.a)(String,h.AFrameworkApplication.Rb.Application)||""}EYi(mb,nb){this.Jr=this.kCg(nb.hubConnection);this.Zmb.reset();this.Jr.Ggj(Object(b.a)(this,this.pma,"onPresenceUpdated"));this.Jr.Egj(Object(b.a)(this,this.$Oa,"onPersistentStateUpdated"));this.Jr.Dgj(Object(b.a)(this,this.bEd,"onPersistentStateCleared"));this.Jr.ghj(Object(b.a)(this,this.Jca,"onUpdateNotificationReceived"))}EV(mb,nb){this.Jda=nb.newState;2===nb.newState&&this.Pvj()}Pvj(){for(let mb of this.aRc)this.Qda(null,
new ba.a(mb.key,mb.value,!1,new e.a));this.aRc=new G.a}DYi(mb,nb){nb.w2c();for(mb=0;3>mb;++mb)this.zvj(mb,nb)}zvj(mb,nb){try{this.Jr.Hfd(mb).done(X=>{nb.Qgb(nb.o4c,"GetCompletePresenceSuccess")&&(nb.g9g.S_i(),c.ULS.sendTraceTag(3249540,500,50,"Successfully retrieved complete session state for [{0}]",this.em),this.Mg.Lbj(),this.SXi(mb,X),this.Mg.hbj(X),nb.pWe.hb(mb)&&this.Mg.gRf(mb,nb.pWe.ma(mb),new e.a))}).fail(X=>{const {RtcUtils:R}=a(737);nb.Qgb(nb.o4c,"GetCompletePresenceFail")&&(c.ULS.sendTraceTag(3249541,
500,15,"Failed to retrieve complete session state : {0} for [{1}]",R.f$a(X),this.em),this.Mg.ntc())}).always(()=>{nb.stopwatch&&nb.stopwatch.stop()})}catch(X){c.ULS.sendTraceTag(595132428,500,10,"Exception thrown while calling hub method GetCompletePersistentStateWithMetadata. Promise not even created. Current event token: {0}, Exception message: {1}",nb.o4c,X.message)}}zxc(mb,nb){var {RtcUtils:X}=a(737);mb=nb.presence;let R;const wa=nb.uoa;this.QB.Zx(1,0);try{R=X.b2c(mb,this.Tkb)}catch(Ba){this.QB.Zx(1,
3);c.ULS.sendTraceTag(574407636,500,10,"Exception thrown while trying to serialize presence. Exception message: {0}",Ba.message);wa.setException(Ba);return}X=new d.a;X.ia(this._clientId,Object.assign(new N,{Presence:mb,TimeStamp:(new Date).getTime()}));this.Mg.oRf(nb.type,X);if(2!==this.Jda)this.Il.nQa(),this.QB.Zx(1,2),wa.setResult(null);else{var na=this.LI.toString();++this.LI;mb=new L(()=>this.Rvj(nb.type,R,na),na);mb=this.Ieg(0,nb.type).add(mb);mb.Qpc(Ba=>{2===Ba&&this.QB.Zx(1,6);wa.setResult(null)});
mb.Ppc(()=>{})}}Rvj(mb,nb,X){let R=null;const wa=new Y,na=new V;c.ULS.sendTraceTag(3249501,500,50,"Sending presence update for [{0}]",this.em);if(2!==this.Jda)return this.Il.nQa(),this.QB.Zx(1,2),c.ULS.sendTraceTag(7934171,500,15,"Connection is lost - unable to send the message for [{0}]",this.em),na.Gyd(),na;this.rh&&20>this.lfe&&(R=this.rh.Gc("WebServiceCall","Send Presence Message"),this.lfe++);wa.start();na.sEb(1);try{this.Jr.updatePersistentState(mb,nb).done(()=>{this.Il.cJb();this.QB.Zx(1,1);
c.ULS.sendTraceTag(3249502,500,50,"Successfully delivered presence update message [{0}] for [{1}]",X,this.em);na.$xa(1);wa&&(wa.stop(),wa.Bc>this.ke.f0f?this.QB.Zx(1,4):this.QB.Zx(1,5))}).fail(Ba=>{const {RtcUtils:Ra}=a(737);this.AJa||(this.Il.nQa(),this.QB.Zx(1,3),c.ULS.sendTraceTag(3249503,500,15,"Server failed to process the presence update message [{0}]: [{1}] for [{2}]",X,Ra.f$a(Ba),this.em));na.$xa(2)}).always(()=>{R&&R.stop()})}catch(Ba){c.ULS.sendTraceTag(593072906,500,15,"Exception when invoking hub method UpdatePersistentState, error: {1}",
Ba.message),this.QB.Zx(1,3),na.$xa(2)}return na}mgb(mb,nb){({RtcUtils:mb}=a(737));const X=nb.D5g,R=nb.uoa;let wa;try{wa=mb.b2c(X,this.Tkb)}catch(na){c.ULS.sendTraceTag(544318999,500,10,"Exception thrown while trying to serialize clientInfo. Exception message: {0}",na.message);R.setException(na);return}try{this.Jr.mgb(wa).done(()=>{c.ULS.sendTraceTag(544319E3,500,50,"Successfully delivered clientInfo.")}).fail(na=>{const {RtcUtils:Ba}=a(737);this.AJa||c.ULS.sendTraceTag(544319001,500,15,"Server failed to process udpate clientInfo: {0}.",
Ba.f$a(na));R.setResult(null)})}catch(na){c.ULS.sendTraceTag(544319002,500,15,"Exception when invoking hub method UpdateClientInfo: error: {0}",na.message),R.setResult(null)}}Qda(mb,nb){({RtcUtils:mb}=a(737));const X=nb.type,R=nb.O7,wa=nb.rlh,na=nb.uoa;let Ba;this.QB.Zx(0,0);try{Ba=mb.b2c(R,this.Tkb)}catch(qa){this.QB.Zx(0,3);c.ULS.sendTraceTag(574407637,500,10,"Exception thrown while trying to serialize updateHint. Exception message: {0}",qa.message);na.setException(qa);return}if(2!==this.Jda)wa?
this.aRc.ia(X,R):(this.Il.nQa(),this.QB.Zx(0,2)),na.setResult(null);else{var Ra=this.LI.toString();++this.LI;nb=new L(()=>this.kwj(X,Ba,Ra),Ra);nb=this.Ieg(1,X).add(nb);nb.Qpc(qa=>{2===qa&&this.QB.Zx(0,6);na.setResult(null)});nb.Ppc(()=>{})}}kwj(mb,nb,X){let R=null;const wa=new Y,na=new V;c.ULS.sendTraceTag(3249505,500,50,"Sending update notification for [{0}]",this.em);if(2!==this.Jda)return this.Il.nQa(),this.QB.Zx(0,2),c.ULS.sendTraceTag(7934172,500,15,"Connection is lost - unable to send the message for [{0}]",
this.em),na.Gyd(),na;this.rh&&3===mb&&20>this.mfe&&(R=this.rh.Gc("WebServiceCall","Send WetContent Update"),this.mfe++);wa.start();na.sEb(1);this.Jr.Qda(mb,nb).done(()=>{this.Il.cJb();this.QB.Zx(0,1);c.ULS.sendTraceTag(3249506,500,50,"Successfully delivered update notification message [{0}] for [{1}]",X,this.em);na.$xa(1);wa&&(wa.stop(),wa.Bc>this.ke.f0f?this.QB.Zx(0,4):this.QB.Zx(0,5))}).fail(Ba=>{const {RtcUtils:Ra}=a(737);this.AJa||(this.Il.nQa(),this.QB.Zx(0,3),c.ULS.sendTraceTag(3249507,500,
15,"Server failed to process the update notification message [{0}] : [{1}] for [{2}]",X,Ra.f$a(Ba),this.em));na.$xa(2)}).always(()=>{R&&R.stop()});return na}Iv(){this.Jr.SYj(Object(b.a)(this,this.pma,"onPresenceUpdated"));this.Jr.RYj(Object(b.a)(this,this.$Oa,"onPersistentStateUpdated"));this.Jr.QYj(Object(b.a)(this,this.bEd,"onPersistentStateCleared"));this.Jr.bZj(Object(b.a)(this,this.Jca,"onUpdateNotificationReceived"))}KVi(mb,nb){this.pma(nb.pL,nb.caa)}pma(mb){this.Il.oQa();this.$Oa(0,mb)}JVi(mb,
nb){this.$Oa(nb.type,nb.pL)}SXi(mb,nb){const X={};for(let R in nb)X[R]=nb[R].Presence;this.vGf(mb,X,nb)}$Oa(mb,nb){this.Il.oQa();this.vGf(mb,nb)}vGf(mb,nb,X=null){var {RtcUtils:R}=a(737);if(c.ULS.Wda(500,100))for(var wa in nb);delete nb[this._clientId];if(!M.a.isEmpty(nb)){for(var na in nb)wa=na,nb[wa]=R.deserialize(nb[na],"Presence",wa,!1,this.Tkb);R=new d.a;na=(new Date).getTime();for(let Ba in nb){wa=nb[Ba];let Ra=Ba,qa;X?(qa=X[Ra],qa.Presence=wa):qa=Object.assign(new N,{Presence:wa,TimeStamp:na});
R.ia(Ra,qa)}this.Mg.oRf(mb,R);switch(mb){case 0:this.Jde||(c.ULS.sendTraceTag(4539734,500,50,"Raising first presence update notification for [{0}]",this.em),this.Jde=!0,h.AFrameworkApplication.Ze&&h.AFrameworkApplication.Ze.EGi());this.Mg.YQf(nb,[]);break;default:this.Mg.Dbj(mb,nb)}}}IVi(mb,nb){this.bEd(nb.V2c)}bEd(mb){this.Il.oQa();if(c.ULS.Wda(500,100))for(let nb=0;nb<mb.length;++nb);mb.length&&(this.Mg.acj(mb),this.Mg.Cbj(mb),this.Mg.YQf({},mb))}LVi(mb,nb){this.Jca(nb.type,nb.O7)}Jca(mb,nb=null){this.ke.UFj&&
0===mb&&c.ULS.sendTraceTag(40128990,500,50,"Received ContentUpdate notification from the server");if(0===mb&&this.NQc&&0<this.NQc.length){var X=Object.assign(new ra.a,{topLevelKpiName:"ContentUpdateNotificationReceived",featureName:"RtcNotification",crewAlias:this.NQc,vetoPillar:"RealTimeCoauth"});(X=E.a.getInstance(X))&&X.logKpiUsage(this.Rzg)}this.ke.VFj&&13===mb&&c.ULS.sendTraceTag(575221780,500,50,String.format("Received HostSubscription notification from the server : {0}",nb||"<none>"));this.Il.oQa();
5===mb?(nb=(mb=this.p4i(nb))?String.format("Received client reconnection request from the server. Reason: {0}, Backoff time: {1} ",mb.reason,mb.reconnectDelay):"Received client reconnection request from the server without params.",c.ULS.sendTraceTag(18637071,500,50,nb),this.Mg.ntc(mb)):(nb=a(737).RtcUtils.deserialize(nb,String.format("UpdateNotification-{0}",ea[mb]),null,!1,this.Tkb),this.Mg.$bj(mb,nb))}p4i(mb){try{if(!mb||""===mb)return null;const nb=JSON.parse(mb);return new P(nb[Z.a.$Od],nb[Z.a.wrj],
nb[Z.a.yrj],nb[Z.a.nQd])}catch(nb){return c.ULS.sendTraceTag(593844380,500,15,"Error when parsing reconnect hint: {0}",nb.message),null}}Ieg(mb,nb){return this.Zmb.h5h(this.i5h(mb,nb))}i5h(mb,nb){return mb+","+nb}static hSh(){var mb=new Map;mb.set("SkipAria","True");mb=Object.assign(new O.a,{extendedProperties:mb});return Object.assign(new da.a,{kpiName:"ContentUpdateNotificationReceived",kpiType:0,optionalProperties:mb,blockFutureEmissionDurationInMs:3E5})}}Object(r.a)(xa,"RtcMessageHandler",D,[]);
var ia=a(98);class Ma{constructor(mb,nb=""){this.Qib=this.Ymb=0;this.DNc=!1;this.fYa=this.IYb=null;this.EWa=!1;this.uje=mb;this.Jeg=nb;this.setTimeout=Ma.h8c;this.rFa=this.Ymb=this.Qib=0}hKd(){0<this.rFa&&0<this.Qib&&c.ULS.sendTraceTag(36545635,500,50,"Throttler [{0}] dropped [{1}] messages out of [{2}]",this.Jeg,this.Qib,this.rFa);0<this.rFa&&0<this.Ymb&&c.ULS.sendTraceTag(36545634,500,50,"Throttler [{0}] throttled [{1}] messages out of [{2}]",this.Jeg,this.Ymb,this.rFa)}get m7a(){return this.DNc}Jyc(mb,
nb){this.Ymb++;this.wrb(!0);this.DNc=!0;this.IYb=mb;this.fYa=nb}wrb(mb){this.DNc=!1;this.fYa&&mb&&(this.Qib++,this.fYa.Gyd());this.fYa=this.IYb=null}static h8c(mb,nb){return window.setTimeout(mb,nb)}}Object(r.a)(Ma,"ThrottlerBase",null,[]);class Ta extends Ma{constructor(mb,nb=""){super(mb,nb);this.w9a=this.xBa=0;this.Za=new ia.a;this.DWa=!1;this.aWb=this.PSb=this.ESb=this.uUc=0;this.NYb=[];this.clearTimeout=Ta.X7c}add(mb){this.EWa||this.init(Ta.WKe,Ta.OKe);this.rFa++;const nb=new V;this.m7a?this.Jyc(mb,
nb):this.aWb<this.w9a?this.PLb(mb,nb):(this.Jyc(mb,nb),this.DWa=!1);return nb}PLb(mb,nb){mb=this.uje(mb);const X=this.setTimeout(Object(b.a)(this,this.QWi,"onMessageWaitTimeExpired"),this.xBa);++this.aWb;Array.add(this.NYb,X);const R=this.ESb;mb.Qpc(wa=>{nb.sEb(wa)});mb.Ppc(wa=>{this.ESb===R&&(this.PWi(R,X),nb.$xa(wa))})}PWi(mb,nb){this.ESb===mb&&(--this.aWb,this.clearTimeout(nb),Array.remove(this.NYb,nb),this.m7a&&this.$vj())}$vj(){this.m7a&&!this.DWa&&(this.uUc=this.setTimeout(Object(b.a)(this,
this.awj,"sendThrottledMessageFromTimer"),0),this.DWa=!0)}awj(){this.DWa=!1;if(this.m7a){const mb=this.IYb,nb=this.fYa;this.wrb(!1);this.PLb(mb,nb)}}QWi(){++this.PSb;this.PSb>Math.floor(this.w9a/2)&&(this.PSb=-1E9,this.Za.raiseEvent("TMUDM"))}g0b(mb){this.Za.addHandler("TMUDM",mb)}reset(){this.rFa=this.Ymb=this.Qib=this.PSb=0;++this.ESb;for(const mb of this.NYb)this.clearTimeout(mb);this.aWb=0;this.NYb=[];this.wrb(!0);this.DWa&&(this.clearTimeout(this.uUc),this.uUc=0,this.DWa=!1)}init(mb,nb){this.EWa||
(this.xBa=mb,this.w9a=nb,this.EWa=!0)}static createInstance(mb,nb=""){return new Ta(mb,nb)}static X7c(mb){window.clearTimeout(mb)}}Ta.WKe=15E3;Ta.OKe=5;Object(r.a)(Ta,"MaxOutstandingThrottler",Ma,[936,935]);class Da extends Ma{constructor(mb,nb=""){super(mb,nb);this.D9a=0;this.vkb=(new Date(0)).getTime();this.currentTime=()=>(new Date).getTime()}init(mb){this.EWa||(this.D9a=mb,this.EWa=!0)}add(mb){this.EWa||this.init(Da.FKe);this.rFa++;const nb=this.currentTime(),X=new V;this.vkb>nb&&(this.vkb=nb);
this.m7a?(this.wrb(!0),this.Jyc(mb,X)):this.vkb+this.D9a<=nb?this.PLb(mb,X):(this.Jyc(mb,X),this.setTimeout(Object(b.a)(this,this.Zvj,"sendThrottledMessage"),this.vkb+this.D9a-nb));return X}Zvj(){if(this.m7a){const mb=this.IYb,nb=this.fYa;this.wrb(!1);this.PLb(mb,nb)}}PLb(mb,nb){this.vkb=this.currentTime();mb=this.uje(mb);mb.Qpc(X=>{nb.sEb(X)});mb.Ppc(X=>{nb.$xa(X)})}static createInstance(mb,nb=""){return new Da(mb,nb)}}Da.FKe=200;Object(r.a)(Da,"MaxRateThrottler",Ma,[934,935]);class fa{mIe(mb,nb=
""){return Ta.createInstance(mb,nb)}Eeh(mb,nb=""){return Da.createInstance(mb,nb)}}Object(r.a)(fa,"ThrottlerFactory",null,[926]);var ua=a(1007);class Fa{constructor(mb){this.ke=null;this.dx=!1;this.Za=new ia.a;this.CPc=new d.a;this.BPc=new d.a;this.vUc=mb;this.jWa=this.vUc.mIe(nb=>nb.send(),"GlobalMaxOustandingThrottler");this.jWa.g0b(()=>{this.Za.raiseEvent("TMUDM")})}init(mb){this.dx||(this.ke=mb,this.jWa.init(this.ke.xBa,this.ke.O7h),this.dx=!0)}h5h(mb){this.dx||this.init(new ua.a(Da.FKe,Ta.WKe,
Ta.OKe,Fa.EHi));if(!({value:nb}=this.CPc.Fc(mb)).returnValue){if(!({value:nb}=this.BPc.Fc(mb)).returnValue){var nb="MaxOutstandingThrottler-"+mb;nb=this.vUc.mIe(Object(b.a)(this.jWa,this.jWa.add,"add"),nb);nb.init(this.ke.xBa,this.ke.DHi);nb.g0b(()=>{this.Za.raiseEvent("TMUDM")});this.BPc.add(mb,nb)}const X="MaxRateThrottler-"+mb;nb=this.vUc.Eeh(Object(b.a)(nb,nb.add,"add"),X);nb.init(this.ke.zIi);this.CPc.add(mb,nb)}return nb}reset(){for(let mb of this.CPc)mb.value.hKd();for(let mb of this.BPc)mb.value.hKd(),
mb.value.reset();this.jWa.hKd();this.jWa.reset()}g0b(mb){this.Za.addHandler("TMUDM",mb)}}Fa.EHi=1E3;Object(r.a)(Fa,"ThrottlerManager",null,[924]);var ca;(function(mb){mb[mb.unspecified=0]="unspecified";mb[mb.word=1]="word";mb[mb.excel=2]="excel";mb[mb.powerPoint=3]="powerPoint";mb[mb.test=4]="test";mb[mb.wacFrontEnd=5]="wacFrontEnd";mb[mb.oneNote=6]="oneNote";mb[mb.visio=7]="visio";mb[mb.officeMobile=8]="officeMobile";mb[mb.cosmosDBChangefeed=9]="cosmosDBChangefeed";mb[mb.last=10]="last"})(ca||(ca=
{}));Object(r.b)("RtcClientAppName",ca);const ka=(mb,nb,X,R,wa,na,Ba,Ra,qa=null,La=null,Yb=null,mc=null)=>{const Zb=I.createInstance(h.AFrameworkApplication.fa),qb=h.AFrameworkApplication.buildVersion?h.AFrameworkApplication.buildVersion:"1.0",Ha=Ca(mb,nb,Ba,qb),Ya=Zb.E5g?a(1347).RealtimeChannelMetrics.createInstance(Ha):new C;var Gb=m.a.create(wa);Zb.rtcJsClientFrequentlyLogsMetrics&&Gb.ONj(Zb.Crj);var Ja="";Ja=qa&&""!==qa?qa:"/rtc2/";Gb.aYe=k.a.QJ(Ja);const Na=Ja+"signalr";qa=Ja+"findsession";const Qa=
B.Odi;Ja=new fa;Yb=Yb||U.a.getInstance();c.ULS.shipAssertTag(556867617,500,Zb.j0f<=a(822).RealtimeChannel.fvf,"Client attempting to override max payload size beyond absolute limit");const Oa=Math.min(Zb.j0f,a(822).RealtimeChannel.fvf);Gb.evf=Oa;Gb=new xa(Zb,new Fa(Ja),mb,Ha,bb=>new H(bb.createHubProxy(Qa)),Ra,Yb,Ya,Gb,Oa);La||(La=a(1211).FindSessionStrategy.createInstance(nb,wa,qa,Ra,qb,Ba,mb,Ha,Yb,na,R,mc));La.kac=Zb.kac;nb=new v(Ha);X=X?X.split(","):null;mb=new (a(822).RealtimeChannel)(mb,X,Ha,
Ra,()=>$.hubConnection(Na),La,Gb,nb,Yb,Ya,Zb,wa);mb.init();return mb},Ca=(mb,nb,X)=>String.format("ClientID={0}, App={1}, ClientType={2}, SessionId={3}",mb,fb(ca[X]),fb("browser"),nb),fb=mb=>mb?mb.charAt(0).toLocaleUpperCase()+mb.substring(1,mb.length):mb;a.d(F,"RealtimeChannel",function(){return yb});class yb{constructor(mb,nb,X,R,wa,na,Ba,Ra,qa,La,Yb,mc){this.QTc=!1;this.h1=null;this.rG=new d.a;this.gib=1;this.QO=null;this.Ut=!1;this.zOc=(new Date(0)).getTime();this.lke=0;this._clientId=mb;this.TYb=
nb;this.wL=0;this.rh=R;this.gJc=Ra;this.qDg=Ba;this.lsg=qa;this.Pug=wa;this.wpa=na;this.em=X;this.Il=La;this.ke=Yb;this.ph=mc;this.mEg=1>100*Math.random()}get jOa(){return this.wpa.jOa}set jOa(mb){this.wpa.jOa=mb}get mAa(){return this.qDg}get Mg(){return this.lsg}init(){this.Mg.BOg(Object(b.a)(this,this.$7b,"disconnectAndCreateNewConnection"));this.Mg.pPg(Object(b.a)(this,this.Y0i,"onUpdatePersistentStateRequestReceivedInternal"));this.Mg.oPg(Object(b.a)(this,this.X0i,"onUpdatePersistentStateClearedRequestReceived"));
this.ph.NWc(this.Il);h.AFrameworkApplication.efb(()=>{this.Il.iKd();m.a.instance&&m.a.instance.Qwd()});this.uIe();this.onh();this.Mg.VOg(Object(b.a)(this,this.v_j,"updateConnectionQueryString"))}onh(){try{const X=$.signalR;if(!X)throw Error.invalidOperation("Failed to retrieve Signalr object");const R=X.version;if(!R)throw Error.invalidOperation("Signalr object is missing version information");if("2.1.1"===R){var mb=X.transports;if(!mb)throw Error.invalidOperation("Failed to retrieve transports object");
var nb=mb.longPolling;if(!nb)throw Error.invalidOperation("Failed to retrieve longPolling object");if(!nb.supportsKeepAlive)throw Error.invalidOperation("LongPolling object does not have a field called supportsKeepAlive");nb.supportsKeepAlive=this.dhh()}}catch(X){c.ULS.sendTraceTag(6432339,500,15,"Failed to disable longPolling KeepAlives: {0}",X.message)}}dhh(){return()=>!1}uIe(){const mb=++this.gib;this.zOc=(new Date(0)).getTime();this.QO=this.Pug();this.Mg.Jbj(this.QO);this.QO.stateChanged(nb=>
{this.mQi(nb,mb)});this.QO.connectionSlow(Object(b.a)(this,this.H_i,"onSlowConnection"));this.QO.error(Object(b.a)(this,this.v_i,"onSignalRError"));this.QO.log=Object(b.a)(this,this.w_i,"onSignalRLog")}Qgb(mb,nb){return mb!==this.gib?(c.ULS.sendTraceTag(4309017,500,50,"ConnectionToken verification failed for {0}",nb),!1):!0}connect(){2!==this.wL&&1!==this.wL&&(c.ULS.sendTraceTag(4539721,500,50,"Starting a new RTC connection for client [{0}]",this.em),this.gJc.kQi(),u.a.instance.PNj(),this.EV(1,this.wL),
this.gbg())}gbg(){const mb=this.gib;this.QTc=!1;this.Il.USf();this.wpa.w2h(Object(b.a)(this,this.b9g,"connectSignalrConnection"),Object(b.a)(this,this.LCf,"onFailureToConnect"),Object(b.a)(this.mAa,this.mAa.xgi,"initThrottlerManager"),Object(b.a)(this,this.Qgb,"verifyConnectionToken"),mb)}LCf(mb=null){this.Il.WSf();let nb=null;!mb||"documentsessiondeleted"!==(nb=mb.toLowerCase())&&"documentsessionexpired"!==nb?this.$7b():(c.ULS.sendTraceTag(41788292,500,15,"In RealtimeChannel method OnFailureToConnect: Disconnect was called for [{0}], due to non-retriable RtcErrorCode:{1}",
this.em,mb),this.disconnect())}$7b(mb,nb=null){c.ULS.sendTraceTag(4309018,500,50,"Disconnecting the connection [{0}]",this.h1);mb=(mb=2===this.wL||1===this.wL)&&!this.mAa.AJa;let X=!0,R=0;nb&&Object.getType(nb)!==Object.getType(Sys.EventArgs.Empty)&&nb.WMd&&""!==nb.WMd&&(mb=!0,this.wpa.vBj(nb.WMd),X=nb.nQd,R=nb.reconnectDelay);mb&&this.EV(1,this.wL);++this.gib;this.mAa.Iv();this.OOj(X);this.wpa.noh();this.uIe();mb&&window.setTimeout(Object(b.a)(this,this.gbg,"startConnecting"),Math.min(R,3E4))}v_j(){let mb=
null;const nb=({correlationId:mb}=this.wpa.V2e()).returnValue;this.QO.qs=nb;c.ULS.sendTraceTag(40768457,500,50,"Connection parameters refresh finished for client [{0}], CorrelationId:{1}",this.em,mb)}b9g(mb){this.zOc=(new Date).getTime();let nb=null;this.QO.qs=({correlationId:nb}=this.wpa.V2e()).returnValue;this.ke.SQg&&(this.QO.url=mb,m.a.instance&&(m.a.instance.HFe=k.a.QJ(mb)));let X=null;this.rh&&(X=this.rh.Gc("WebServiceCall","ConnectToServer"));c.ULS.sendTraceTag(3290048,500,50,"Connecting to server for client [{0}]",
this.em);mb={};this.TYb&&(mb.transport=1===this.TYb.length?this.TYb[0]:this.TYb);mb.pingInterval=null;u.a.instance.bJb(1,0);mb.waitForPageLoad=!1;this.QO.start(mb,null).done(R=>{this.Il.XSf();u.a.instance.bJb(1,1,!0);c.ULS.sendTraceTag(3457857,500,50,"Successfully connected to server using connection [{0}], CorrelationId:{1}",R.id,nb)}).fail(R=>{c.ULS.sendTraceTag(3457858,500,15,"Failed to connect to server : connection string: {0}, CorrelationId:{1},  ClientDetails: [{2}]",this.wpa.uC,nb,this.em);
this.LCf();this.Il.VSf(R);u.a.instance.bJb(1,1,!1);this.Mg.dRf(0,{["CorrelationId"]:nb,["ErrorDetails"]:R,["ConnectionState"]:f.a[this.wL]})}).always(()=>{X&&X.stop();m.a.instance&&(m.a.instance.yKc=!1)})}disconnect(){0===this.wL?c.ULS.sendTraceTag(36545632,500,50,"Disconnect for [{0}] was called but the channel is already Disconnected",this.em):(this.Il.$Sf(),m.a.instance&&(m.a.instance.yKc=!0),c.ULS.sendTraceTag(36545633,500,50,"Starting explicit disconnect for [{0}]",this.em),this.mAa.AJa=!0,this.gJc.kRi(),
this.EV(0,this.wL),this.$7b(),this.mAa.AJa=!1)}OOj(mb){const nb=this.M0g(),X=this.QO,R=this.h1,wa=()=>{if(this.QTc)c.ULS.sendTraceTag(591692192,500,15,"Stop connection was called twice, possibly on the same connection.");else try{this.QTc=!0,X.stop(!0,mb)}catch(na){c.ULS.sendTraceTag(591692191,500,15,"Stopping connection failed: {0}",na.message)}};0<nb?(c.ULS.sendTraceTag(4309020,500,50,"Waiting to stop connection [{0}]: [{1}] ms.",R,nb),window.setTimeout(wa,nb)):(c.ULS.sendTraceTag(36804372,500,
50,"Stopping connection [{0}].",R),wa())}M0g(){let mb=0;0===this.QO.state&&(mb=this.zOc+yb.o6j-(new Date).getTime(),0>mb&&(mb=0));return mb}get connectionState(){return this.wL}n2(mb){this.Mg.n2(mb)}L6(mb){this.Mg.L6(mb)}d3f(mb){this.zxc(0,mb)}zxc(mb,nb){const X=new e.a;this.Mg.gRf(mb,nb,X);return X.task}cZa(mb){this.Mg.cZa(mb)}JQa(mb){this.Mg.JQa(mb)}HXc(mb){this.Mg.HXc(mb)}jMd(mb){this.Mg.jMd(mb)}eyb(mb){return this.o6h(mb)}cfd(){return this.bfd(0)}bfd(mb){const nb={};for(let X of this.rG)X.value.hb(mb)&&
(nb[X.key]=X.value.ma(mb).data);return nb}o6h(mb){return this.rG.hb(mb)&&this.rG.ma(mb).hb(0)?this.rG.ma(mb).ma(0).data:null}Y0i(mb,nb){for(let X of nb.U2j)this.rG.hb(X.key)||this.rG.ia(X.key,new G.a),mb=X.value,this.rG.ma(X.key).ia(nb.type,new y(mb.Presence,new Date(mb.TimeStamp))),X.key===this._clientId&&0===nb.type&&this.Mg.tbj(mb.Presence)}X0i(mb,nb){for(const X of nb.V2c)this.rG.remove(X)}GOh(){const mb=new G.a;if(!this.rG.hb(this._clientId))return mb;for(let nb of this.rG.ma(this._clientId))mb.ia(nb.key,
nb.value.data);return mb}Qda(mb,nb=null,X=!1){const R=new e.a;this.Mg.hJd(mb,nb,X,R);return R.task}eZa(mb){this.Mg.eZa(mb)}gKb(mb){this.Mg.gKb(mb)}Jva(mb){let nb,X;return({value:nb}=this.rG.Fc(mb)).returnValue&&({value:X}=nb.Fc(0)).returnValue?new l(this.s6h(X),X.timeStamp):null}MOh(){const mb={};for(let nb of this.rG)nb.value.Fc(0).returnValue&&(mb[nb.key]=this.Jva(nb.key));return mb}mgb(mb){const nb=new e.a;this.Mg.Zbj(mb,nb);return nb.task}get clientId(){return this._clientId}get $Kj(){return this.mEg}dispose(){this.Ut||
(this.mAa.Iv(),this.ph.zij(this.Il),this.Il.iKd(),m.a.instance&&m.a.instance.Qwd(),this.Ut=!0)}mQi(mb,nb){this.Qgb(nb,"StateChangedSignalR")&&this.EV(this.vGe(mb.newState),this.vGe(mb.oldState))}EV(mb,nb){if((1!==this.wL||0!==nb||1!==mb)&&this.wL!==nb){var X=String.format.apply(null,["Unexpected connection state change : Current state is '{0}' while the event indicates ('{1}'->'{2}') transition"].concat([this.wL,nb,mb]));c.ULS.sendTraceTag(3290053,500,10,X)}if(this.wL!==mb){switch(mb){case 2:m.a.instance&&
m.a.instance.HGi();this.h1=this.QO.id;c.ULS.sendTraceTag(3249539,500,50,"Established connection [{0}] for client [{1}]",this.h1,this.em);this.HEi(this.QO);c.ULS.sendTraceTag(4298369,500,50,"Retrieving complete session state");X=null;this.rh&&(X=this.rh.Gc("WebServiceCall","Receive First Presence"));const R=this.gib;this.Mg.Ibj(Object(b.a)(this,this.Qgb,"verifyConnectionToken"),R,this.gJc,Object(b.a)(this,this.w2c,"clearExistingPersistentState"),this.GOh(),X);this.ke.rtcClientMessageTelemetryEnabled&&
w.Shd(this.Mg,this.ke,100*Math.random()<=this.ke.xrj).start();break;case 1:2===nb&&c.ULS.sendTraceTag(4298644,500,50,"Lost connection [{0}] to the server ...trying to re-establish it",this.h1);break;case 0:if(w.instance&&w.instance.stop(),this.mAa.AJa)c.ULS.sendTraceTag(3249543,500,50,"Connection [{0}] has been explicitly closed",this.h1);else{1===nb&&(c.ULS.sendTraceTag(7672737,500,50,"Signalr detected an unexpected disconnect event while attempting to re-establish connection [{0}]. Kicking off global reconnect logic ...",
this.h1),this.Il.aTf());2===nb&&c.ULS.sendTraceTag(36574532,500,50,"Signalr detected a disconnect event triggered by a period of client inactivity for connection [{0}]. Kicking off global reconnect logic ...",this.h1);this.$7b();return}}this.wL=mb;this.Mg.Qaj(mb,nb)}}HEi(mb){if(mb&&mb.transport&&mb.transport.name){mb=mb.transport.name;var nb=mb.toLowerCase();"websockets"===nb?c.ULS.sendTraceTag(4290723,500,50,"Transport name - {0} for [{1}]",mb,this.em):"serversentevents"===nb?c.ULS.sendTraceTag(4290752,
500,50,"Transport name - {0} for [{1}]",mb,this.em):"foreverframe"===nb?c.ULS.sendTraceTag(4290753,500,50,"Transport name - {0} for [{1}]",mb,this.em):"longpolling"===nb?c.ULS.sendTraceTag(4290754,500,50,"Transport name - {0} for [{1}]",mb,this.em):"mocktransport"!==nb&&c.ULS.sendTraceTag(4290755,500,15,"Unknown transport protocol encountered - '{0}'",mb)}else c.ULS.sendTraceTag(4290722,500,10,"Transport protocol name is missing")}H_i(){if(this.ke.i0f){const mb=k.a.Ux(this.jOa,"mid");c.ULS.sendTraceTag(3249544,
500,15,"Detected that the connection [{0}] is slow for target machine [{1}]",this.h1,mb)}else c.ULS.sendTraceTag(522716053,500,50,"Detected that the connection [{0}] is slow",this.h1)}v_i(){c.ULS.sendTraceTag(3249545,600,15,"SignalR ERROR for connection [{0}];",this.h1)}w_i(mb){mb=a(737).RtcUtils.f$a(mb);if(this.ke.i0f&&mb.startsWith("Keep alive timed out.")){const nb=k.a.Ux(this.jOa,"mid");c.ULS.sendTraceTag(522716054,500,15,"SignalR lib: {0}. Target Machine: {1}",mb,nb)}else this.$Kj&&2E3>this.lke&&
!mb.startsWith("Invok")&&!mb.startsWith("Trigger")&&(c.ULS.sendTraceTag(578950464,500,50,"SignalR lib: {0}",mb),this.lke++)}w2c(){let mb;const nb=[];({value:mb}=this.rG.Fc(this._clientId)).returnValue&&this.rG.remove(this._clientId);for(let X of this.rG.keys)Array.add(nb,X);for(const X of nb)this.rG.remove(X);mb&&this.rG.ia(this._clientId,mb);this.Mg.nbj(nb)}vGe(mb){switch(mb){case 0:return 1;case 2:return 1;case 1:return 2;case 4:return 0;default:throw Error.argumentOutOfRange("state",mb,"Unknown SignalR state");
}}s6h(mb){return mb&&mb.timeStamp?(new Date).getTime()-mb.timeStamp.getTime()>(this.ke.uVg?6E4:this.ke.tVg)?2:1:1}static createInstance(mb,nb,X,R,wa,na,Ba,Ra=null,qa=null,La=null,Yb=null,mc=null,Zb=null){return ka(mb,nb,X,Zb,R,wa,na,Ba,Ra,qa,La,mc,Yb)}}yb.fvf=31E3;yb.Oyd=8E3;yb.o6j=15E3;Object(r.a)(yb,"RealtimeChannel",null,[343,896])},893:function(r,F,a){a.d(F,"a",function(){return c});r=a(0);class c{constructor(){this.Ske=!1;this.tRc=null;this.l7d=0;this.NKc=this.zJe();this.DSb=this.zJe();this.fDa=
this.gWa=0;this.jw=()=>new Date}get KPj(){return this.Ske}zJe(){const b=Array(6);for(let e=0;e<b.length;e++)b[e]=0;return b}kVh(){return this.NKc.toString()}$Rh(){return this.DSb.toString()}PNj(){this.tRc=this.jw()}bJb(b,e,f=!1){this.KPj||(f&&(this.Ske=!0),f=this.jw(),0===b&&5<this.gWa||1===b&&5<this.fDa||(this.l7d<b?(1===this.gWa%2&&(this.NKc[this.gWa]=-1,this.gWa++),this.l7d=b,1===e&&(this.DSb[this.fDa]=-1,this.fDa++),this.DSb[this.fDa]=this.ZWd(f),this.fDa++):0===b?(this.NKc[this.gWa]=this.ZWd(f),
this.gWa++):(this.DSb[this.fDa]=this.ZWd(f),this.fDa++)))}ZWd(b){const e=b.getTime()-this.tRc.getTime();this.tRc=b;return e}static get instance(){c.La||(c.La=new c);return c.La}static set instance(b){c.La=b}}c.La=null;Object(r.a)(c,"LatencyMetrics",null,[])},957:function(r,F,a){r=a(0);var c=a(15),b=a(85),e=a(111),f;(function(k){k[k.SendNotification=0]="SendNotification";k[k.SendPersistentState=1]="SendPersistentState";k[k.FindSession=2]="FindSession";k[k.Last=3]="Last"})(f||(f={}));Object(r.b)("ApiType",
f);var d;(function(k){k[k.AttemptCount=0]="AttemptCount";k[k.SuccessCount=1]="SuccessCount";k[k.DropCount=2]="DropCount";k[k.FailedCount=3]="FailedCount";k[k.LatencyOverThresholdCount=4]="LatencyOverThresholdCount";k[k.LatencyUnderThresholdCount=5]="LatencyUnderThresholdCount";k[k.ThrottledCount=6]="ThrottledCount";k[k.Last=7]="Last"})(d||(d={}));Object(r.b)("EventCountType",d);var h=a(893);a.d(F,"a",function(){return l});class l{constructor(k){this.HFe=this.aYe=null;this.evf=this.WZe=0;this.Il=null;
this.Ode=this.nPc=0;this.ph=k;this.Whi();this.yKc=this.F9d=this.LPc=!1;this.hPc=0}get EEh(){return this.yKc}ONj(k){this.Ode=k;window.setInterval(Object(b.a)(this,this.Qwd,"logMetricsBatchAndReset"),k);this.nPc=(new Date).getTime()}Zx(k,t){this.NEj(k)&&!this.F9d||this.EEh||!window.navigator.onLine||this.ph.s7a||(this.Il[k][t]++,this.LPc=!0)}Whi(){this.Il=Array(3);for(let k=0;3>k;k++){this.Il[k]=Array(7);for(let t=0;7>t;t++)this.Il[k][t]=0}}MYg(){const k={};for(let t=0;3>t;t++)for(let n=0;7>n;n++)this.twi(t,
n)&&(k[f[t]+d[n]]=this.Il[t][n]);k.FSDomain=this.aYe;k.ConnectionDomain=this.HFe;k.FSRetryInterval=this.WZe;k.MaxPayloadSize=this.evf;k.LogNumber=this.hPc;1===this.hPc&&(k.FSLatencies=h.a.instance.kVh(),k.ConLatencies=h.a.instance.$Rh());return k}twi(k,t){return 2===k&&3!==t&&0!==t?!1:!0}NEj(k){return 2===k?!1:!0}Qwd(){if(this.LPc){this.hPc++;if((new Date).getTime()-this.nPc<5E3+this.Ode){var k=e.a.toJSON(this.MYg());c.ULS.sendTraceTag(50644352,500,15,k)}this.nPc=(new Date).getTime();for(k=0;3>k;k++)for(let t=
0;7>t;t++)this.Il[k][t]=0;this.LPc=!1}}HGi(){this.F9d=!0}static get instance(){return l.La}static create(k){l.instance||(l.La=new l(k));return l.instance}}l.La=null;Object(r.a)(l,"FrequentLoggingMetrics",null,[908])}}]);

//# sourceMappingURL=https://artifacts.dev.azure.com/office/_apis/symbol/symsrv/EwaDSEsNext.cl.js.map/c51889a05ec1a5d63954f38da53e88c8/EwaDSEsNext.cl.js.map